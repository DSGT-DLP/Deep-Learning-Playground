!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).firebase=t()}(this,function(){"use strict";!function(e){var t,n,o,r,i,s,a,c,l,u;function h(e){if("string"!=typeof e&&(e=String(e)),/[^a-z0-9\-#$%&'*+.\^_`|~]/i.test(e))throw new TypeError("Invalid character in header field name");return e.toLowerCase()}function d(e){return e="string"!=typeof e?String(e):e}function f(t){var e={next:function(){var e=t.shift();return{done:void 0===e,value:e}}};return n&&(e[Symbol.iterator]=function(){return e}),e}function p(t){this.map={},t instanceof p?t.forEach(function(e,t){this.append(t,e)},this):Array.isArray(t)?t.forEach(function(e){this.append(e[0],e[1])},this):t&&Object.getOwnPropertyNames(t).forEach(function(e){this.append(e,t[e])},this)}function g(e){if(e.bodyUsed)return Promise.reject(new TypeError("Already read"));e.bodyUsed=!0}function m(n){return new Promise(function(e,t){n.onload=function(){e(n.result)},n.onerror=function(){t(n.error)}})}function v(e){var t=new FileReader,n=m(t);return t.readAsArrayBuffer(e),n}function y(e){if(e.slice)return e.slice(0);var t=new Uint8Array(e.byteLength);return t.set(new Uint8Array(e)),t.buffer}function _(){return this.bodyUsed=!1,this._initBody=function(e){if(this._bodyInit=e)if("string"==typeof e)this._bodyText=e;else if(o&&Blob.prototype.isPrototypeOf(e))this._bodyBlob=e;else if(r&&FormData.prototype.isPrototypeOf(e))this._bodyFormData=e;else if(t&&URLSearchParams.prototype.isPrototypeOf(e))this._bodyText=e.toString();else if(i&&o&&a(e))this._bodyArrayBuffer=y(e.buffer),this._bodyInit=new Blob([this._bodyArrayBuffer]);else{if(!i||!ArrayBuffer.prototype.isPrototypeOf(e)&&!c(e))throw new Error("unsupported BodyInit type");this._bodyArrayBuffer=y(e)}else this._bodyText="";this.headers.get("content-type")||("string"==typeof e?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):t&&URLSearchParams.prototype.isPrototypeOf(e)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))},o&&(this.blob=function(){var e=g(this);if(e)return e;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(new Blob([this._bodyArrayBuffer]));if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))},this.arrayBuffer=function(){return this._bodyArrayBuffer?g(this)||Promise.resolve(this._bodyArrayBuffer):this.blob().then(v)}),this.text=function(){var e,t,n=g(this);if(n)return n;if(this._bodyBlob)return e=this._bodyBlob,t=new FileReader,n=m(t),t.readAsText(e),n;if(this._bodyArrayBuffer)return Promise.resolve(function(e){for(var t=new Uint8Array(e),n=new Array(t.length),r=0;r<t.length;r++)n[r]=String.fromCharCode(t[r]);return n.join("")}(this._bodyArrayBuffer));if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)},r&&(this.formData=function(){return this.text().then(b)}),this.json=function(){return this.text().then(JSON.parse)},this}function w(e,t){var n,r=(t=t||{}).body;if(e instanceof w){if(e.bodyUsed)throw new TypeError("Already read");this.url=e.url,this.credentials=e.credentials,t.headers||(this.headers=new p(e.headers)),this.method=e.method,this.mode=e.mode,r||null==e._bodyInit||(r=e._bodyInit,e.bodyUsed=!0)}else this.url=String(e);if(this.credentials=t.credentials||this.credentials||"omit",!t.headers&&this.headers||(this.headers=new p(t.headers)),this.method=(e=t.method||this.method||"GET",n=e.toUpperCase(),-1<l.indexOf(n)?n:e),this.mode=t.mode||this.mode||null,this.referrer=null,("GET"===this.method||"HEAD"===this.method)&&r)throw new TypeError("Body not allowed for GET or HEAD requests");this._initBody(r)}function b(e){var r=new FormData;return e.trim().split("&").forEach(function(e){var t,n;e&&(t=(n=e.split("=")).shift().replace(/\+/g," "),n=n.join("=").replace(/\+/g," "),r.append(decodeURIComponent(t),decodeURIComponent(n)))}),r}function I(e,t){t=t||{},this.type="default",this.status=void 0===t.status?200:t.status,this.ok=200<=this.status&&this.status<300,this.statusText="statusText"in t?t.statusText:"OK",this.headers=new p(t.headers),this.url=t.url||"",this._initBody(e)}e.fetch||(t="URLSearchParams"in e,n="Symbol"in e&&"iterator"in Symbol,o="FileReader"in e&&"Blob"in e&&function(){try{return new Blob,!0}catch(e){return!1}}(),r="FormData"in e,(i="ArrayBuffer"in e)&&(s=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"],a=function(e){return e&&DataView.prototype.isPrototypeOf(e)},c=ArrayBuffer.isView||function(e){return e&&-1<s.indexOf(Object.prototype.toString.call(e))}),p.prototype.append=function(e,t){e=h(e),t=d(t);var n=this.map[e];this.map[e]=n?n+","+t:t},p.prototype.delete=function(e){delete this.map[h(e)]},p.prototype.get=function(e){return e=h(e),this.has(e)?this.map[e]:null},p.prototype.has=function(e){return this.map.hasOwnProperty(h(e))},p.prototype.set=function(e,t){this.map[h(e)]=d(t)},p.prototype.forEach=function(e,t){for(var n in this.map)this.map.hasOwnProperty(n)&&e.call(t,this.map[n],n,this)},p.prototype.keys=function(){var n=[];return this.forEach(function(e,t){n.push(t)}),f(n)},p.prototype.values=function(){var t=[];return this.forEach(function(e){t.push(e)}),f(t)},p.prototype.entries=function(){var n=[];return this.forEach(function(e,t){n.push([t,e])}),f(n)},n&&(p.prototype[Symbol.iterator]=p.prototype.entries),l=["DELETE","GET","HEAD","OPTIONS","POST","PUT"],w.prototype.clone=function(){return new w(this,{body:this._bodyInit})},_.call(w.prototype),_.call(I.prototype),I.prototype.clone=function(){return new I(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new p(this.headers),url:this.url})},I.error=function(){var e=new I(null,{status:0,statusText:""});return e.type="error",e},u=[301,302,303,307,308],I.redirect=function(e,t){if(-1===u.indexOf(t))throw new RangeError("Invalid status code");return new I(null,{status:t,headers:{location:e}})},e.Headers=p,e.Request=w,e.Response=I,e.fetch=function(n,r){return new Promise(function(i,e){var t=new w(n,r),s=new XMLHttpRequest;s.onload=function(){var e,r,t={status:s.status,statusText:s.statusText,headers:(e=s.getAllResponseHeaders()||"",r=new p,e.replace(/\r?\n[\t ]+/g," ").split(/\r?\n/).forEach(function(e){var t=e.split(":"),n=t.shift().trim();n&&(t=t.join(":").trim(),r.append(n,t))}),r)};t.url="responseURL"in s?s.responseURL:t.headers.get("X-Request-URL");var n="response"in s?s.response:s.responseText;i(new I(n,t))},s.onerror=function(){e(new TypeError("Network request failed"))},s.ontimeout=function(){e(new TypeError("Network request failed"))},s.open(t.method,t.url,!0),"include"===t.credentials?s.withCredentials=!0:"omit"===t.credentials&&(s.withCredentials=!1),"responseType"in s&&o&&(s.responseType="blob"),t.headers.forEach(function(e,t){s.setRequestHeader(t,e)}),s.send(void 0===t._bodyInit?null:t._bodyInit)})},e.fetch.polyfill=!0)}("undefined"!=typeof self?self:void 0);function e(e){try{return!!e()}catch(e){return!0}}function t(e){if(!g(e))throw TypeError(String(e)+" is not an object");return e}var n="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},r=function(e){return e&&e.Math==Math&&e},i=r("object"==typeof globalThis&&globalThis)||r("object"==typeof window&&window)||r("object"==typeof self&&self)||r("object"==typeof n&&n)||Function("return this")(),s={exports:{}},o=!e(function(){return 7!=Object.defineProperty({},1,{get:function(){return 7}})[1]}),a={},c=function(e){return"object"==typeof e?null!==e:"function"==typeof e},l=c,u=i.document,h=l(u)&&l(u.createElement),d=function(e){return h?u.createElement(e):{}},f=d,p=!o&&!e(function(){return 7!=Object.defineProperty(f("div"),"a",{get:function(){return 7}}).a}),g=c,m=c,v=function(e,t){if(!m(e))return e;var n,r;if(t&&"function"==typeof(n=e.toString)&&!m(r=n.call(e)))return r;if("function"==typeof(n=e.valueOf)&&!m(r=n.call(e)))return r;if(!t&&"function"==typeof(n=e.toString)&&!m(r=n.call(e)))return r;throw TypeError("Can't convert object to primitive value")},y=p,_=t,w=v,b=Object.defineProperty;a.f=o?b:function(e,t,n){if(_(e),t=w(t,!0),_(n),y)try{return b(e,t,n)}catch(e){}if("get"in n||"set"in n)throw TypeError("Accessors not supported");return"value"in n&&(e[t]=n.value),e};var I=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}},T=a,E=I,S=o?function(e,t,n){return T.f(e,t,E(1,n))}:function(e,t,n){return e[t]=n,e},k=i,C=S,A=function(t,n){try{C(k,t,n)}catch(e){k[t]=n}return n},N=A,x="__core-js_shared__",R=i[x]||N(x,{}),P=R;(s.exports=function(e,t){return P[e]||(P[e]=void 0!==t?t:{})})("versions",[]).push({version:"3.6.5",mode:"global",copyright:"Â© 2020 Denis Pushkarev (zloirock.ru)"});function D(e,t){return M.call(e,t)}function O(e){return"Symbol("+String(void 0===e?"":e)+")_"+(++L+F).toString(36)}var M={}.hasOwnProperty,L=0,F=Math.random(),U=e,V=!!Object.getOwnPropertySymbols&&!U(function(){return!String(Symbol())}),j=V&&!Symbol.sham&&"symbol"==typeof Symbol.iterator,q=i,B=s.exports,K=D,$=O,z=V,W=j,G=B("wks"),H=q.Symbol,Q=W?H:H&&H.withoutSetter||$,Y=function(e){return K(G,e)||(z&&K(H,e)?G[e]=H[e]:G[e]=Q("Symbol."+e)),G[e]},J={};J[Y("toStringTag")]="z";var X="[object z]"===String(J),Z={exports:{}},ee=R,te=Function.toString;"function"!=typeof ee.inspectSource&&(ee.inspectSource=function(e){return te.call(e)});var ne,re,ie,se,oe,ae,ce,le,ue=ee.inspectSource,he=ue,de=i.WeakMap,fe="function"==typeof de&&/native code/.test(he(de)),pe=s.exports,ge=O,me=pe("keys"),ve=function(e){return me[e]||(me[e]=ge(e))},ye={},_e=c,we=S,be=D,Ie=ve,Te=ye,Ee=i.WeakMap;ce=fe?(ne=new Ee,re=ne.get,ie=ne.has,se=ne.set,oe=function(e,t){return se.call(ne,e,t),t},ae=function(e){return re.call(ne,e)||{}},function(e){return ie.call(ne,e)}):(Te[le=Ie("state")]=!0,oe=function(e,t){return we(e,le,t),t},ae=function(e){return be(e,le)?e[le]:{}},function(e){return be(e,le)});var Se={set:oe,get:ae,has:ce,enforce:function(e){return ce(e)?ae(e):oe(e,{})},getterFor:function(n){return function(e){var t;if(!_e(e)||(t=ae(e)).type!==n)throw TypeError("Incompatible receiver, "+n+" required");return t}}},ke=i,Ce=S,Ae=D,Ne=A,xe=ue,Re=Se.get,Pe=Se.enforce,De=String(String).split("String");(Z.exports=function(e,t,n,r){var i=!!r&&!!r.unsafe,s=!!r&&!!r.enumerable,o=!!r&&!!r.noTargetGet;"function"==typeof n&&("string"!=typeof t||Ae(n,"name")||Ce(n,"name",t),Pe(n).source=De.join("string"==typeof t?t:"")),e!==ke?(i?!o&&e[t]&&(s=!0):delete e[t],s?e[t]=n:Ce(e,t,n)):s?e[t]=n:Ne(t,n)})(Function.prototype,"toString",function(){return"function"==typeof this&&Re(this).source||xe(this)});var Oe={}.toString,Me=function(e){return Oe.call(e).slice(8,-1)},Le=X,Fe=Me,Ue=Y("toStringTag"),Ve="Arguments"==Fe(function(){return arguments}()),je=Le?Fe:function(e){var t,n;return void 0===e?"Undefined":null===e?"Null":"string"==typeof(n=function(e,t){try{return e[t]}catch(e){}}(t=Object(e),Ue))?n:Ve?Fe(t):"Object"==(n=Fe(t))&&"function"==typeof t.callee?"Arguments":n},qe=je,Be=Z.exports;X||Be(Object.prototype,"toString",X?{}.toString:function(){return"[object "+qe(this)+"]"},{unsafe:!0});var Ke=Math.ceil,$e=Math.floor,ze=function(e){return isNaN(e=+e)?0:(0<e?$e:Ke)(e)},We=function(e){if(null==e)throw TypeError("Can't call method on "+e);return e},Ge=ze,He=We,Qe=function(a){return function(e,t){var n,r,i=String(He(e)),s=Ge(t),o=i.length;return s<0||o<=s?a?"":void 0:(n=i.charCodeAt(s))<55296||56319<n||s+1===o||(r=i.charCodeAt(s+1))<56320||57343<r?a?i.charAt(s):n:a?i.slice(s,s+2):r-56320+(n-55296<<10)+65536}},Ye={codeAt:Qe(!1),charAt:Qe(!0)},Je={},Xe={},Ze={}.propertyIsEnumerable,et=Object.getOwnPropertyDescriptor,tt=et&&!Ze.call({1:2},1);Xe.f=tt?function(e){var t=et(this,e);return!!t&&t.enumerable}:Ze;function nt(e){return at(ct(e))}var rt=e,it=Me,st="".split,ot=rt(function(){return!Object("z").propertyIsEnumerable(0)})?function(e){return"String"==it(e)?st.call(e,""):Object(e)}:Object,at=ot,ct=We,lt=Xe,ut=I,ht=nt,dt=v,ft=D,pt=p,gt=Object.getOwnPropertyDescriptor;Je.f=o?gt:function(e,t){if(e=ht(e),t=dt(t,!0),pt)try{return gt(e,t)}catch(e){}if(ft(e,t))return ut(!lt.f.call(e,t),e[t])};function mt(e){return"function"==typeof e?e:void 0}function vt(e,t){return arguments.length<2?mt(_t[e])||mt(wt[e]):_t[e]&&_t[e][t]||wt[e]&&wt[e][t]}var yt=i,_t=yt,wt=i,bt={},It=ze,Tt=Math.min,Et=function(e){return 0<e?Tt(It(e),9007199254740991):0},St=ze,kt=Math.max,Ct=Math.min,At=nt,Nt=Et,xt=function(e,t){var n=St(e);return n<0?kt(n+t,0):Ct(n,t)},Rt=function(a){return function(e,t,n){var r,i=At(e),s=Nt(i.length),o=xt(n,s);if(a&&t!=t){for(;o<s;)if((r=i[o++])!=r)return!0}else for(;o<s;o++)if((a||o in i)&&i[o]===t)return a||o||0;return!a&&-1}},r={includes:Rt(!0),indexOf:Rt(!1)},Pt=D,Dt=nt,Ot=r.indexOf,Mt=ye,n=function(e,t){var n,r=Dt(e),i=0,s=[];for(n in r)!Pt(Mt,n)&&Pt(r,n)&&s.push(n);for(;t.length>i;)Pt(r,n=t[i++])&&(~Ot(s,n)||s.push(n));return s},l=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],Lt=n,Ft=l.concat("length","prototype");bt.f=Object.getOwnPropertyNames||function(e){return Lt(e,Ft)};N={};N.f=Object.getOwnPropertySymbols;var Ut=bt,Vt=N,jt=t,x=vt("Reflect","ownKeys")||function(e){var t=Ut.f(jt(e)),n=Vt.f;return n?t.concat(n(e)):t},qt=D,Bt=x,Kt=Je,$t=a,U=function(e,t){for(var n=Bt(t),r=$t.f,i=Kt.f,s=0;s<n.length;s++){var o=n[s];qt(e,o)||r(e,o,i(t,o))}},zt=e,Wt=/#|\.prototype\./,B=function(e,t){var n=Ht[Gt(e)];return n==Yt||n!=Qt&&("function"==typeof t?zt(t):!!t)},Gt=B.normalize=function(e){return String(e).replace(Wt,".").toLowerCase()},Ht=B.data={},Qt=B.NATIVE="N",Yt=B.POLYFILL="P",q=B,Jt=i,Xt=Je.f,Zt=S,en=Z.exports,tn=A,nn=U,rn=q,W=function(e,t){var n,r,i,s=e.target,o=e.global,a=e.stat,c=o?Jt:a?Jt[s]||tn(s,{}):(Jt[s]||{}).prototype;if(c)for(n in t){if(r=t[n],i=e.noTargetGet?(i=Xt(c,n))&&i.value:c[n],!rn(o?n:s+(a?".":"#")+n,e.forced)&&void 0!==i){if(typeof r==typeof i)continue;nn(r,i)}(e.sham||i&&i.sham)&&Zt(r,"sham",!0),en(c,n,r,e)}},sn=We,$=function(e){return Object(sn(e))},J=!e(function(){function e(){}return e.prototype.constructor=null,Object.getPrototypeOf(new e)!==e.prototype}),on=D,an=$,R=J,cn=ve("IE_PROTO"),ln=Object.prototype,ee=R?Object.getPrototypeOf:function(e){return e=an(e),on(e,cn)?e[cn]:"function"==typeof e.constructor&&e instanceof e.constructor?e.constructor.prototype:e instanceof Object?ln:null},he=ee,de=S,pe=D,fe=Y("iterator"),Ee=!1;[].keys&&("next"in(or=[].keys())?(ar=he(he(or)))!==Object.prototype&&(Er=ar):Ee=!0),pe(Er=null==Er?{}:Er,fe)||de(Er,fe,function(){return this});function un(){}var hn,Te={IteratorPrototype:Er,BUGGY_SAFARI_ITERATORS:Ee},dn=n,fn=l,Ie=Object.keys||function(e){return dn(e,fn)},pn=a,gn=t,mn=Ie,Le=o?Object.defineProperties:function(e,t){gn(e);for(var n,r=mn(t),i=r.length,s=0;s<i;)pn.f(e,n=r[s++],t[n]);return e},Be=vt("document","documentElement"),vn=t,yn=Le,_n=l,X=ye,wn=Be,bn=d,In="prototype",Tn="script",En=ve("IE_PROTO"),Sn=function(e){return"<"+Tn+">"+e+"</"+Tn+">"},kn=function(){try{hn=document.domain&&new ActiveXObject("htmlfile")}catch(e){}var e,t;kn=hn?function(e){e.write(Sn("")),e.close();var t=e.parentWindow.Object;return e=null,t}(hn):(e=bn("iframe"),t="java"+Tn+":",e.style.display="none",wn.appendChild(e),e.src=String(t),(e=e.contentWindow.document).open(),e.write(Sn("document.F=Object")),e.close(),e.F);for(var n=_n.length;n--;)delete kn[In][_n[n]];return kn()};X[En]=!0;function Cn(){return this}function An(){return this}var Qe=Object.create||function(e,t){var n;return null!==e?(un[In]=vn(e),n=new un,un[In]=null,n[En]=e):n=kn(),void 0===t?n:yn(n,t)},Nn=a.f,xn=D,Rn=Y("toStringTag"),tt=function(e,t,n){e&&!xn(e=n?e:e.prototype,Rn)&&Nn(e,Rn,{configurable:!0,value:t})},Ze={},Pn=Te.IteratorPrototype,Dn=Qe,On=I,Mn=tt,Ln=Ze,Fn=c,Un=t,Vn=function(e){if(!Fn(e)&&null!==e)throw TypeError("Can't set "+String(e)+" as a prototype");return e},rt=Object.setPrototypeOf||("__proto__"in{}?function(){var n,r=!1,e={};try{(n=Object.getOwnPropertyDescriptor(Object.prototype,"__proto__").set).call(e,[]),r=e instanceof Array}catch(e){}return function(e,t){return Un(e),Vn(t),r?n.call(e,t):e.__proto__=t,e}}():void 0),jn=W,qn=function(e,t,n){var r=t+" Iterator";return e.prototype=Dn(Pn,{next:On(1,n)}),Mn(e,r,!1),Ln[r]=Cn,e},Bn=ee,Kn=rt,$n=tt,zn=S,Wn=Z.exports,p=Y,Gn=Ze,Hn=Te.IteratorPrototype,Qn=Te.BUGGY_SAFARI_ITERATORS,Yn=p("iterator"),Jn="values",Xn="entries",Rt=function(e,t,n,r,i,s,o){qn(n,t,r);function a(e){if(e===i&&p)return p;if(!Qn&&e in d)return d[e];switch(e){case"keys":case Jn:case Xn:return function(){return new n(this,e)}}return function(){return new n(this)}}var c,l,u=t+" Iterator",h=!1,d=e.prototype,f=d[Yn]||d["@@iterator"]||i&&d[i],p=!Qn&&f||a(i),g="Array"==t&&d.entries||f;if(g&&(g=Bn(g.call(new e)),Hn!==Object.prototype&&g.next&&(Bn(g)!==Hn&&(Kn?Kn(g,Hn):"function"!=typeof g[Yn]&&zn(g,Yn,An)),$n(g,u,!0))),i==Jn&&f&&f.name!==Jn&&(h=!0,p=function(){return f.call(this)}),d[Yn]!==p&&zn(d,Yn,p),Gn[t]=p,i)if(c={values:a(Jn),keys:s?p:a("keys"),entries:a(Xn)},o)for(l in c)!Qn&&!h&&l in d||Wn(d,l,c[l]);else jn({target:t,proto:!0,forced:Qn||h},c);return c},Zn=Ye.charAt,r=Se,x=Rt,er="String Iterator",tr=r.set,nr=r.getterFor(er);x(String,"String",function(e){tr(this,{type:er,string:String(e),index:0})},function(){var e=nr(this),t=e.string,n=e.index;return n>=t.length?{value:void 0,done:!0}:(n=Zn(t,n),e.index+=n.length,{value:n,done:!1})});var B=Qe,A=a,rr=Y("unscopables"),ir=Array.prototype;null==ir[rr]&&A.f(ir,rr,{configurable:!0,value:B(null)});var J=function(e){ir[rr][e]=!0},sr=nt,R=J,he=Ze,or=Se,ar=Rt,cr="Array Iterator",lr=or.set,ur=or.getterFor(cr),pe=ar(Array,"Array",function(e,t){lr(this,{type:cr,target:sr(e),index:0,kind:t})},function(){var e=ur(this),t=e.target,n=e.kind,r=e.index++;return!t||r>=t.length?{value:e.target=void 0,done:!0}:"keys"==n?{value:r,done:!1}:"values"==n?{value:t[r],done:!1}:{value:[r,t[r]],done:!1}},"values");he.Arguments=he.Array,R("keys"),R("values"),R("entries");var hr,dr=i,fr={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0},pr=pe,gr=S,de=Y,mr=de("iterator"),vr=de("toStringTag"),yr=pr.values;for(hr in fr){var _r=dr[hr],wr=_r&&_r.prototype;if(wr){if(wr[mr]!==yr)try{gr(wr,mr,yr)}catch(Ob){wr[mr]=yr}if(wr[vr]||gr(wr,vr,hr),fr[hr])for(var br in pr)if(wr[br]!==pr[br])try{gr(wr,br,pr[br])}catch(Ob){wr[br]=pr[br]}}}function Ir(e,t){this.stopped=e,this.result=t}var fe=i.Promise,Tr=Z.exports,Er=function(e,t,n){for(var r in t)Tr(e,r,t[r],n);return e},Sr=vt,kr=a,Cr=o,Ar=Y("species"),Ee=function(e){var t=Sr(e),n=kr.f;Cr&&t&&!t[Ar]&&n(t,Ar,{configurable:!0,get:function(){return this}})},n=function(e){if("function"!=typeof e)throw TypeError(String(e)+" is not a function");return e},Le=function(e,t,n){if(!(e instanceof t))throw TypeError("Incorrect "+(n?n+" ":"")+"invocation");return e},l={exports:{}},Nr=Ze,xr=Y("iterator"),Rr=Array.prototype,X=function(e){return void 0!==e&&(Nr.Array===e||Rr[xr]===e)},Pr=n,Te=function(r,i,e){if(Pr(r),void 0===i)return r;switch(e){case 0:return function(){return r.call(i)};case 1:return function(e){return r.call(i,e)};case 2:return function(e,t){return r.call(i,e,t)};case 3:return function(e,t,n){return r.call(i,e,t,n)}}return function(){return r.apply(i,arguments)}},Dr=je,Or=Ze,Mr=Y("iterator"),p=function(e){if(null!=e)return e[Mr]||e["@@iterator"]||Or[Dr(e)]},Lr=t,Ye=function(t,e,n,r){try{return r?e(Lr(n)[0],n[1]):e(n)}catch(e){var i=t.return;throw void 0!==i&&Lr(i.call(t)),e}},Fr=t,Ur=X,Vr=Et,jr=Te,qr=p,Br=Ye;(l.exports=function(e,t,n,r,i){var s,o,a,c,l,u,h,d=jr(t,n,r?2:1);if(i)s=e;else{if("function"!=typeof(o=qr(e)))throw TypeError("Target is not iterable");if(Ur(o)){for(a=0,c=Vr(e.length);a<c;a++)if((l=r?d(Fr(h=e[a])[0],h[1]):d(e[a]))&&l instanceof Ir)return l;return new Ir(!1)}s=o.call(e)}for(u=s.next;!(h=u.call(s)).done;)if("object"==typeof(l=Br(s,d,h.value,r))&&l&&l instanceof Ir)return l;return new Ir(!1)}).stop=function(e){return new Ir(!0,e)};var Kr=Y("iterator"),$r=!1;try{var zr=0,Wr={next:function(){return{done:!!zr++}},return:function(){$r=!0}};Wr[Kr]=function(){return this},Array.from(Wr,function(){throw 2})}catch(Ob){}function Gr(e){return function(){ai(e)}}var Hr,r=function(e,t){if(!t&&!$r)return!1;var n=!1;try{var r={};r[Kr]=function(){return{next:function(){return{done:n=!0}}}},e(r)}catch(e){}return n},Qr=t,Yr=n,Jr=Y("species"),x=function(e,t){var n,r=Qr(e).constructor;return void 0===r||null==(n=Qr(r)[Jr])?t:Yr(n)},A=vt("navigator","userAgent")||"",B=/(iphone|ipod|ipad).*applewebkit/i.test(A),Xr=i,or=e,ar=Me,he=Te,Zr=Be,ei=d,R=B,ti=Xr.location,de=Xr.setImmediate,Ze=Xr.clearImmediate,ni=Xr.process,Wr=Xr.MessageChannel,ri=Xr.Dispatch,ii=0,si={},oi="onreadystatechange",ai=function(e){var t;si.hasOwnProperty(e)&&(t=si[e],delete si[e],t())},Be=function(e){ai(e.data)},d=function(e){Xr.postMessage(e+"",ti.protocol+"//"+ti.host)};de&&Ze||(de=function(e){for(var t=[],n=1;n<arguments.length;)t.push(arguments[n++]);return si[++ii]=function(){("function"==typeof e?e:Function(e)).apply(void 0,t)},Hr(ii),ii},Ze=function(e){delete si[e]},"process"==ar(ni)?Hr=function(e){ni.nextTick(Gr(e))}:ri&&ri.now?Hr=function(e){ri.now(Gr(e))}:Wr&&!R?(wi=(yi=new Wr).port2,yi.port1.onmessage=Be,Hr=he(wi.postMessage,wi,1)):!Xr.addEventListener||"function"!=typeof postMessage||Xr.importScripts||or(d)||"file:"===ti.protocol?Hr=oi in ei("script")?function(e){Zr.appendChild(ei("script"))[oi]=function(){Zr.removeChild(this),ai(e)}}:function(e){setTimeout(Gr(e),0)}:(Hr=d,Xr.addEventListener("message",Be,!1)));var ci,li,ui,hi,di,fi,pi,gi,ar={set:de,clear:Ze},mi=i,R=Je.f,Wr=Me,vi=ar.set,yi=B,he=mi.MutationObserver||mi.WebKitMutationObserver,_i=mi.process,wi=mi.Promise,bi="process"==Wr(_i),or=R(mi,"queueMicrotask"),d=or&&or.value;d||(ci=function(){var e,t;for(bi&&(e=_i.domain)&&e.exit();li;){t=li.fn,li=li.next;try{t()}catch(e){throw li?hi():ui=void 0,e}}ui=void 0,e&&e.enter()},hi=bi?function(){_i.nextTick(ci)}:he&&!yi?(di=!0,fi=document.createTextNode(""),new he(ci).observe(fi,{characterData:!0}),function(){fi.data=di=!di}):wi&&wi.resolve?(pi=wi.resolve(void 0),gi=pi.then,function(){gi.call(pi,ci)}):function(){vi.call(mi,ci)});function Ii(e){var n,r;this.promise=new e(function(e,t){if(void 0!==n||void 0!==r)throw TypeError("Bad Promise constructor");n=e,r=t}),this.resolve=Ti(n),this.reject=Ti(r)}var Be=d||function(e){var t={fn:e,next:void 0};ui&&(ui.next=t),li||(li=t,hi()),ui=t},de={},Ti=n;de.f=function(e){return new Ii(e)};var Ei=t,Si=c,ki=de,Ze=function(e,t){if(Ei(e),Si(t)&&t.constructor===e)return t;var n=ki.f(e);return(0,n.resolve)(t),n.promise},Ci=i,B=function(e){try{return{error:!1,value:e()}}catch(e){return{error:!0,value:e}}},Wr=A,R=i.process,or=R&&R.versions,yi=or&&or.v8;yi?Vi=(Li=yi.split("."))[0]+Li[1]:Wr&&(!(Li=Wr.match(/Edge\/(\d+)/))||74<=Li[1])&&(Li=Wr.match(/Chrome\/(\d+)/))&&(Vi=Li[1]);var Ai,Ni,xi,Ri,he=Vi&&+Vi,wi=W,Pi=i,d=vt,A=fe,R=Z.exports,or=Er,yi=tt,Wr=Ee,Di=c,Oi=n,Mi=Le,Li=Me,Fi=ue,Ui=l.exports,Vi=r,ji=x,qi=ar.set,Bi=Be,Ki=Ze,$i=function(e,t){var n=Ci.console;n&&n.error&&(1===arguments.length?n.error(e):n.error(e,t))},ue=de,zi=B,ar=Se,Be=q,Wi=he,Gi=Y("species"),Hi="Promise",Qi=ar.get,Yi=ar.set,Ji=ar.getterFor(Hi),Xi=A,Zi=Pi.TypeError,es=Pi.document,ts=Pi.process,ns=d("fetch"),rs=ue.f,is=rs,ss="process"==Li(ts),os=!!(es&&es.createEvent&&Pi.dispatchEvent),as="unhandledrejection",cs="rejectionhandled",ls=1,us=2,hs=1,ds=2,Be=Be(Hi,function(){if(!(Fi(Xi)!==String(Xi))){if(66===Wi)return!0;if(!ss&&"function"!=typeof PromiseRejectionEvent)return!0}if(51<=Wi&&/native code/.test(Xi))return!1;function e(e){e(function(){},function(){})}var t=Xi.resolve(1);return(t.constructor={})[Gi]=e,!(t.then(function(){})instanceof e)}),Vi=Be||!Vi(function(e){Xi.all(e).catch(function(){})}),fs=function(e){var t;return!(!Di(e)||"function"!=typeof(t=e.then))&&t},ps=function(f,p,g){var m;p.notified||(p.notified=!0,m=p.reactions,Bi(function(){for(var r,i,e=p.value,t=p.state==ls,n=0;m.length>n;){var s,o,a,c=m[n++],l=t?c.ok:c.fail,u=c.resolve,h=c.reject,d=c.domain;try{l?(t||(p.rejection===ds&&function(e,t){qi.call(Pi,function(){if(ss)ts.emit("rejectionHandled",e);else gs(cs,e,t.value)})}(f,p),p.rejection=hs),!0===l?s=e:(d&&d.enter(),s=l(e),d&&(d.exit(),a=!0)),s===c.promise?h(Zi("Promise-chain cycle")):(o=fs(s))?o.call(s,u,h):u(s)):h(e)}catch(e){d&&!a&&d.exit(),h(e)}}p.reactions=[],p.notified=!1,g&&!p.rejection&&(r=f,i=p,qi.call(Pi,function(){var e,t=i.value,n=ms(i);if(n&&(e=zi(function(){ss?ts.emit("unhandledRejection",t,r):gs(as,r,t)}),i.rejection=ss||ms(i)?ds:hs,e.error))throw e.value}))}))},gs=function(e,t,n){var r,i;os?((r=es.createEvent("Event")).promise=t,r.reason=n,r.initEvent(e,!1,!0),Pi.dispatchEvent(r)):r={promise:t,reason:n},(i=Pi["on"+e])?i(r):e===as&&$i("Unhandled promise rejection",n)},ms=function(e){return e.rejection!==hs&&!e.parent},vs=function(t,n,r,i){return function(e){t(n,r,e,i)}},ys=function(e,t,n,r){t.done||(t.done=!0,(t=r?r:t).value=n,t.state=us,ps(e,t,!0))},_s=function(n,r,e,t){if(!r.done){r.done=!0,t&&(r=t);try{if(n===e)throw Zi("Promise can't be resolved itself");var i=fs(e);i?Bi(function(){var t={done:!1};try{i.call(e,vs(_s,n,t,r),vs(ys,n,t,r))}catch(e){ys(n,t,e,r)}}):(r.value=e,r.state=ls,ps(n,r,!1))}catch(e){ys(n,{done:!1},e,r)}}};Be&&(Xi=function(e){Mi(this,Xi,Hi),Oi(e),Ai.call(this);var t=Qi(this);try{e(vs(_s,this,t),vs(ys,this,t))}catch(e){ys(this,t,e)}},(Ai=function(e){Yi(this,{type:Hi,done:!1,notified:!1,parent:!1,reactions:[],rejection:!1,state:0,value:void 0})}).prototype=or(Xi.prototype,{then:function(e,t){var n=Ji(this),r=rs(ji(this,Xi));return r.ok="function"!=typeof e||e,r.fail="function"==typeof t&&t,r.domain=ss?ts.domain:void 0,n.parent=!0,n.reactions.push(r),0!=n.state&&ps(this,n,!1),r.promise},catch:function(e){return this.then(void 0,e)}}),Ni=function(){var e=new Ai,t=Qi(e);this.promise=e,this.resolve=vs(_s,e,t),this.reject=vs(ys,e,t)},ue.f=rs=function(e){return e===Xi||e===xi?new Ni:is(e)},"function"==typeof A&&(Ri=A.prototype.then,R(A.prototype,"then",function(e,t){var n=this;return new Xi(function(e,t){Ri.call(n,e,t)}).then(e,t)},{unsafe:!0}),"function"==typeof ns&&wi({global:!0,enumerable:!0,forced:!0},{fetch:function(e){return Ki(Xi,ns.apply(Pi,arguments))}}))),wi({global:!0,wrap:!0,forced:Be},{Promise:Xi}),yi(Xi,Hi,!1),Wr(Hi),xi=d(Hi),wi({target:Hi,stat:!0,forced:Be},{reject:function(e){var t=rs(this);return t.reject.call(void 0,e),t.promise}}),wi({target:Hi,stat:!0,forced:Be},{resolve:function(e){return Ki(this,e)}}),wi({target:Hi,stat:!0,forced:Vi},{all:function(e){var a=this,t=rs(a),c=t.resolve,l=t.reject,n=zi(function(){var r=Oi(a.resolve),i=[],s=0,o=1;Ui(e,function(e){var t=s++,n=!1;i.push(void 0),o++,r.call(a,e).then(function(e){n||(n=!0,i[t]=e,--o||c(i))},l)}),--o||c(i)});return n.error&&l(n.value),t.promise},race:function(e){var n=this,r=rs(n),i=r.reject,t=zi(function(){var t=Oi(n.resolve);Ui(e,function(e){t.call(n,e).then(r.resolve,i)})});return t.error&&i(t.value),r.promise}});var d=W,ws=n,bs=de,Is=B,Ts=l.exports;d({target:"Promise",stat:!0},{allSettled:function(e){var a=this,t=bs.f(a),c=t.resolve,n=t.reject,r=Is(function(){var r=ws(a.resolve),i=[],s=0,o=1;Ts(e,function(e){var t=s++,n=!1;i.push(void 0),o++,r.call(a,e).then(function(e){n||(n=!0,i[t]={status:"fulfilled",value:e},--o||c(i))},function(e){n||(n=!0,i[t]={status:"rejected",reason:e},--o||c(i))})}),--o||c(i)});return r.error&&n(r.value),t.promise}});var Be=W,Es=fe,wi=e,Ss=vt,ks=x,Cs=Ze,Vi=Z.exports;Be({target:"Promise",proto:!0,real:!0,forced:!!Es&&wi(function(){Es.prototype.finally.call({then:function(){}},function(){})})},{finally:function(t){var n=ks(this,Ss("Promise")),e="function"==typeof t;return this.then(e?function(e){return Cs(n,t()).then(function(){return e})}:t,e?function(e){return Cs(n,t()).then(function(){throw e})}:t)}}),"function"!=typeof Es||Es.prototype.finally||Vi(Es.prototype,"finally",Ss("Promise").prototype.finally),yt.Promise;function As(e,t){var n=this;if(!(n instanceof As))return new As(e,t);Rs&&(n=Rs(new Error(t),xs(n)));var r=[];return Ps(e,r.push,r),Ns?Os(n,{errors:r,type:"AggregateError"}):n.errors=r,void 0!==t&&Ds(n,"message",String(t)),n}var d=W,Ns=o,xs=ee,Rs=rt,fe=Qe,Ze=a,Be=I,Ps=l.exports,Ds=S,wi=Se,Os=wi.set,Ms=wi.getterFor("AggregateError");As.prototype=fe(Error.prototype,{constructor:Be(5,As),message:Be(5,""),name:Be(5,"AggregateError")}),Ns&&Ze.f(As.prototype,"errors",{get:function(){return Ms(this).errors},configurable:!0}),d({global:!0},{AggregateError:As});var Ls=de,Fs=B;W({target:"Promise",stat:!0},{try:function(e){var t=Ls.f(this),n=Fs(e);return(n.error?t.reject:t.resolve)(n.value),t.promise}});var Vi=W,Us=n,Vs=vt,js=de,qs=B,Bs=l.exports,Ks="No one promise resolved";Vi({target:"Promise",stat:!0},{any:function(e){var c=this,t=js.f(c),l=t.resolve,u=t.reject,n=qs(function(){var r=Us(c.resolve),i=[],s=0,o=1,a=!1;Bs(e,function(e){var t=s++,n=!1;i.push(void 0),o++,r.call(c,e).then(function(e){n||a||(a=!0,l(e))},function(e){n||a||(n=!0,i[t]=e,--o||u(new(Vs("AggregateError"))(i,Ks)))})}),--o||u(new(Vs("AggregateError"))(i,Ks))});return n.error&&u(n.value),t.promise}});function $s(e){throw e}var zs=Me,wi=Array.isArray||function(e){return"Array"==zs(e)},Ws=c,Gs=wi,Hs=Y("species"),fe=function(e,t){var n;return new(void 0===(n=Gs(e)&&("function"==typeof(n=e.constructor)&&(n===Array||Gs(n.prototype))||Ws(n)&&null===(n=n[Hs]))?void 0:n)?Array:n)(0===t?0:t)},Qs=Te,Ys=ot,Js=$,Xs=Et,Zs=fe,eo=[].push,Be=function(f){var p=1==f,g=2==f,m=3==f,v=4==f,y=6==f,_=5==f||y;return function(e,t,n,r){for(var i,s,o=Js(e),a=Ys(o),c=Qs(t,n,3),l=Xs(a.length),u=0,h=r||Zs,d=p?h(e,l):g?h(e,0):void 0;u<l;u++)if((_||u in a)&&(s=c(i=a[u],u,o),f))if(p)d[u]=s;else if(s)switch(f){case 3:return!0;case 5:return i;case 6:return u;case 2:eo.call(d,i)}else if(v)return!1;return y?-1:m||v?v:d}},Ze={forEach:Be(0),map:Be(1),filter:Be(2),some:Be(3),every:Be(4),find:Be(5),findIndex:Be(6)},to=o,no=e,ro=D,io=Object.defineProperty,so={},d=function(e,t){if(ro(so,e))return so[e];var n=[][e],r=!!ro(t=t||{},"ACCESSORS")&&t.ACCESSORS,i=ro(t,0)?t[0]:$s,s=ro(t,1)?t[1]:void 0;return so[e]=!!n&&!no(function(){if(r&&!to)return!0;var e={length:-1};r?io(e,1,{enumerable:!0,get:$s}):e[1]=1,n.call(e,i,s)})},de=W,oo=Ze.find,B=J,Vi="find",ao=!0,Be=d(Vi);Vi in[]&&Array(1)[Vi](function(){ao=!1}),de({target:"Array",proto:!0,forced:ao||!Be},{find:function(e){return oo(this,e,1<arguments.length?arguments[1]:void 0)}}),B(Vi);var co=i,lo=Te,uo=Function.call,de=function(e,t,n){return lo(uo,co[e].prototype[t],n)};de("Array","find");var Be=W,ho=Ze.findIndex,B=J,Vi="findIndex",fo=!0,J=d(Vi);Vi in[]&&Array(1)[Vi](function(){fo=!1}),Be({target:"Array",proto:!0,forced:fo||!J},{findIndex:function(e){return ho(this,e,1<arguments.length?arguments[1]:void 0)}}),B(Vi),de("Array","findIndex");var po=v,go=a,mo=I,J=function(e,t,n){var r=po(t);r in e?go.f(e,r,mo(0,n)):e[r]=n},vo=Te,yo=$,_o=Ye,wo=X,bo=Et,Io=J,To=p,B=function(e){var t,n,r,i,s,o,a=yo(e),c="function"==typeof this?this:Array,l=arguments.length,u=1<l?arguments[1]:void 0,h=void 0!==u,d=To(a),f=0;if(h&&(u=vo(u,2<l?arguments[2]:void 0,2)),null==d||c==Array&&wo(d))for(n=new c(t=bo(a.length));f<t;f++)o=h?u(a[f],f):a[f],Io(n,f,o);else for(s=(i=d.call(a)).next,n=new c;!(r=s.call(i)).done;f++)o=h?_o(i,u,[r.value,f],!0):r.value,Io(n,f,o);return n.length=f,n};W({target:"Array",stat:!0,forced:!r(function(e){Array.from(e)})},{from:B}),yt.Array.from;var Eo=e,Vi=W,So=Ze.some,Ye=d,X=function(e,t){var n=[][e];return!!n&&Eo(function(){n.call(null,t||function(){throw 1},1)})}("some"),B=Ye("some");Vi({target:"Array",proto:!0,forced:!X||!B},{some:function(e){return So(this,e,1<arguments.length?arguments[1]:void 0)}}),de("Array","some");function ko(e){return xo(e)&&Ro(Ko,Po(e))}var Co,d="undefined"!=typeof ArrayBuffer&&"undefined"!=typeof DataView,Ao=o,No=i,xo=c,Ro=D,Po=je,Do=S,Oo=Z.exports,Ye=a.f,Vi=ee,Mo=rt,X=Y,B=O,Lo=No.Int8Array,Fo=Lo&&Lo.prototype,je=No.Uint8ClampedArray,ee=je&&je.prototype,Uo=Lo&&Vi(Lo),Vo=Fo&&Vi(Fo),je=Object.prototype,jo=je.isPrototypeOf,X=X("toStringTag"),qo=B("TYPED_ARRAY_TAG"),Bo=d&&!!Mo&&"Opera"!==Po(No.opera),d=!1,Ko={Int8Array:1,Uint8Array:1,Uint8ClampedArray:1,Int16Array:2,Uint16Array:2,Int32Array:4,Uint32Array:4,Float32Array:4,Float64Array:8};for(Co in Ko)No[Co]||(Bo=!1);if((!Bo||"function"!=typeof Uo||Uo===Function.prototype)&&(Uo=function(){throw TypeError("Incorrect invocation")},Bo))for(Co in Ko)No[Co]&&Mo(No[Co],Uo);if((!Bo||!Vo||Vo===je)&&(Vo=Uo.prototype,Bo))for(Co in Ko)No[Co]&&Mo(No[Co].prototype,Vo);if(Bo&&Vi(ee)!==Vo&&Mo(ee,Vo),Ao&&!Ro(Vo,X))for(Co in d=!0,Ye(Vo,X,{get:function(){return xo(this)?this[qo]:void 0}}),Ko)No[Co]&&Do(No[Co],qo,Co);var Ye=i,X={NATIVE_ARRAY_BUFFER_VIEWS:Bo,TYPED_ARRAY_TAG:d&&qo,aTypedArray:function(e){if(ko(e))return e;throw TypeError("Target is not a typed array")},aTypedArrayConstructor:function(e){if(Mo){if(jo.call(Uo,e))return e}else for(var t in Ko)if(Ro(Ko,Co)){t=No[t];if(t&&(e===t||jo.call(t,e)))return e}throw TypeError("Target is not a typed array constructor")},exportTypedArrayMethod:function(e,t,n){if(Ao){if(n)for(var r in Ko){r=No[r];r&&Ro(r.prototype,e)&&delete r.prototype[e]}Vo[e]&&!n||Oo(Vo,e,!n&&Bo&&Fo[e]||t)}},exportTypedArrayStaticMethod:function(e,t,n){var r,i;if(Ao){if(Mo){if(n)for(r in Ko)(i=No[r])&&Ro(i,e)&&delete i[e];if(Uo[e]&&!n)return;try{return Oo(Uo,e,!n&&Bo&&Lo[e]||t)}catch(e){}}for(r in Ko)!(i=No[r])||i[e]&&!n||Oo(i,e,t)}},isView:function(e){var t=Po(e);return"DataView"===t||Ro(Ko,t)},isTypedArray:ko,TypedArray:Uo,TypedArrayPrototype:Vo},d=pe,pe=Y("iterator"),Ye=Ye.Uint8Array,$o=d.values,zo=d.keys,Wo=d.entries,Go=X.aTypedArray,d=X.exportTypedArrayMethod,X=Ye&&Ye.prototype[pe],Ye=!!X&&("values"==X.name||null==X.name),X=function(){return $o.call(Go(this))};d("entries",function(){return Wo.call(Go(this))}),d("keys",function(){return zo.call(Go(this))}),d("values",X,!Ye),d(pe,X,!Ye);var Ho=o,X=e,Qo=Ie,Yo=N,Jo=Xe,Xo=$,Zo=ot,ea=Object.assign,ta=Object.defineProperty,Ye=!ea||X(function(){if(Ho&&1!==ea({b:1},ea(ta({},"a",{enumerable:!0,get:function(){ta(this,"b",{value:3,enumerable:!1})}}),{b:2})).b)return!0;var e={},t={},n=Symbol(),r="abcdefghijklmnopqrst";return e[n]=7,r.split("").forEach(function(e){t[e]=e}),7!=ea({},e)[n]||Qo(ea({},t)).join("")!=r})?function(e,t){for(var n=Xo(e),r=arguments.length,i=1,s=Yo.f,o=Jo.f;i<r;)for(var a,c=Zo(arguments[i++]),l=s?Qo(c).concat(s(c)):Qo(c),u=l.length,h=0;h<u;)a=l[h++],Ho&&!o.call(c,a)||(n[a]=c[a]);return n}:ea;W({target:"Object",stat:!0,forced:Object.assign!==Ye},{assign:Ye}),yt.Object.assign;var na=o,ra=Ie,ia=nt,sa=Xe.f,ot=function(a){return function(e){for(var t,n=ia(e),r=ra(n),i=r.length,s=0,o=[];s<i;)t=r[s++],na&&!sa.call(n,t)||o.push(a?[t,n[t]]:n[t]);return o}},X={entries:ot(!0),values:ot(!1)},Ye=W,oa=X.entries;Ye({target:"Object",stat:!0},{entries:function(e){return oa(e)}}),yt.Object.entries;var ot=W,aa=X.values;ot({target:"Object",stat:!0},{values:function(e){return aa(e)}}),yt.Object.values;var ca=c,la=Me,ua=Y("match"),ha=function(e){var t;return ca(e)&&(void 0!==(t=e[ua])?!!t:"RegExp"==la(e))},Ye=function(e){if(ha(e))throw TypeError("The method doesn't accept regular expressions");return e},da=Y("match"),X=function(t){var n=/./;try{"/./"[t](n)}catch(e){try{return n[da]=!1,"/./"[t](n)}catch(e){}}return!1},fa=Ye,pa=We;W({target:"String",proto:!0,forced:!X("includes")},{includes:function(e){return!!~String(pa(this)).indexOf(fa(e),1<arguments.length?arguments[1]:void 0)}}),de("String","includes");var ot=W,Me=Je.f,ga=Et,ma=Ye,va=We,X=X,ya="".startsWith,_a=Math.min,X=X("startsWith");ot({target:"String",proto:!0,forced:!!(X||(!(Me=Me(String.prototype,"startsWith"))||Me.writable))&&!X},{startsWith:function(e){var t=String(va(this));ma(e);var n=ga(_a(1<arguments.length?arguments[1]:void 0,t.length)),r=String(e);return ya?ya.call(t,r,n):t.slice(n,n+r.length)===r}}),de("String","startsWith");var wa=ze,ba=We;W({target:"String",proto:!0},{repeat:"".repeat||function(e){var t=String(ba(this)),n="",r=wa(e);if(r<0||r==1/0)throw RangeError("Wrong number of repetitions");for(;0<r;(r>>>=1)&&(t+=t))1&r&&(n+=t);return n}}),de("String","repeat");var Ia=e,Ta=he,Ea=Y("species"),ze=W,We=e,Sa=wi,ka=c,Ca=$,Aa=Et,Na=J,xa=fe,de=function(t){return 51<=Ta||!Ia(function(){var e=[];return(e.constructor={})[Ea]=function(){return{foo:1}},1!==e[t](Boolean).foo})},Et=he,Ra=Y("isConcatSpreadable"),Pa=9007199254740991,Da="Maximum allowed index exceeded",J=51<=Et||!We(function(){var e=[];return e[Ra]=!1,e.concat()[0]!==e}),fe=de("concat");ze({target:"Array",proto:!0,forced:!J||!fe},{concat:function(e){for(var t,n,r,i=Ca(this),s=xa(i,0),o=0,a=-1,c=arguments.length;a<c;a++)if(function(e){if(!ka(e))return!1;var t=e[Ra];return void 0!==t?!!t:Sa(e)}(r=-1===a?i:arguments[a])){if(n=Aa(r.length),Pa<o+n)throw TypeError(Da);for(t=0;t<n;t++,o++)t in r&&Na(s,o,r[t])}else{if(Pa<=o)throw TypeError(Da);Na(s,o++,r)}return s.length=o,s}});var he={},Oa=nt,Ma=bt.f,La={}.toString,Fa="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[];he.f=function(e){return Fa&&"[object Window]"==La.call(e)?function(e){try{return Ma(e)}catch(e){return Fa.slice()}}(e):Ma(Oa(e))};Et={};Et.f=Y;function Ua(e,t){var n=_c[e]=Za(fc[lc]);return uc(n,{type:cc,tag:e,description:t}),$a||(n.description=t),n}function Va(t,e){Ha(t);var n=Ya(e),r=ec(n).concat(Ac(n));return oc(r,function(e){$a&&!Cc.call(n,e)||kc(t,e,n[e])}),t}var ja=yt,qa=D,Ba=Et,Ka=a.f,We=function(e){var t=ja.Symbol||(ja.Symbol={});qa(t,e)||Ka(t,e,{value:Ba.f(e)})},de=W,ze=i,J=vt,$a=o,fe=V,V=j,j=e,za=D,Wa=wi,Ga=c,Ha=t,Qa=$,Ya=nt,Ja=v,Xa=I,Za=Qe,ec=Ie,v=bt,I=he,tc=N,Ie=Je,bt=a,he=Xe,N=S,Je=Z.exports,Xe=s.exports,S=ve,nc=ye,rc=O,ic=Y,s=Et,sc=We,ve=tt,Y=Se,oc=Ze.forEach,ac=S("hidden"),cc="Symbol",lc="prototype",S=ic("toPrimitive"),uc=Y.set,hc=Y.getterFor(cc),dc=Object[lc],fc=ze.Symbol,pc=J("JSON","stringify"),gc=Ie.f,mc=bt.f,vc=I.f,yc=he.f,_c=Xe("symbols"),wc=Xe("op-symbols"),bc=Xe("string-to-symbol-registry"),Ic=Xe("symbol-to-string-registry"),Xe=Xe("wks"),ze=ze.QObject,Tc=!ze||!ze[lc]||!ze[lc].findChild,Ec=$a&&j(function(){return 7!=Za(mc({},"a",{get:function(){return mc(this,"a",{value:7}).a}})).a})?function(e,t,n){var r=gc(dc,t);r&&delete dc[t],mc(e,t,n),r&&e!==dc&&mc(dc,t,r)}:mc,Sc=V?function(e){return"symbol"==typeof e}:function(e){return Object(e)instanceof fc},kc=function(e,t,n){e===dc&&kc(wc,t,n),Ha(e);var r=Ja(t,!0);return Ha(n),za(_c,r)?(n.enumerable?(za(e,ac)&&e[ac][r]&&(e[ac][r]=!1),n=Za(n,{enumerable:Xa(0,!1)})):(za(e,ac)||mc(e,ac,Xa(1,{})),e[ac][r]=!0),Ec(e,r,n)):mc(e,r,n)},Cc=function(e){var t=Ja(e,!0),n=yc.call(this,t);return!(this===dc&&za(_c,t)&&!za(wc,t))&&(!(n||!za(this,t)||!za(_c,t)||za(this,ac)&&this[ac][t])||n)},ze=function(e,t){var n=Ya(e),r=Ja(t,!0);if(n!==dc||!za(_c,r)||za(wc,r)){var i=gc(n,r);return!i||!za(_c,r)||za(n,ac)&&n[ac][r]||(i.enumerable=!0),i}},V=function(e){var t=vc(Ya(e)),n=[];return oc(t,function(e){za(_c,e)||za(nc,e)||n.push(e)}),n},Ac=function(e){var t=e===dc,n=vc(t?wc:Ya(e)),r=[];return oc(n,function(e){!za(_c,e)||t&&!za(dc,e)||r.push(_c[e])}),r};fe||(Je((fc=function(){if(this instanceof fc)throw TypeError("Symbol is not a constructor");var e=arguments.length&&void 0!==arguments[0]?String(arguments[0]):void 0,t=rc(e),n=function(e){this===dc&&n.call(wc,e),za(this,ac)&&za(this[ac],t)&&(this[ac][t]=!1),Ec(this,t,Xa(1,e))};return $a&&Tc&&Ec(dc,t,{configurable:!0,set:n}),Ua(t,e)})[lc],"toString",function(){return hc(this).tag}),Je(fc,"withoutSetter",function(e){return Ua(rc(e),e)}),he.f=Cc,bt.f=kc,Ie.f=ze,v.f=I.f=V,tc.f=Ac,s.f=function(e){return Ua(ic(e),e)},$a&&(mc(fc[lc],"description",{configurable:!0,get:function(){return hc(this).description}}),Je(dc,"propertyIsEnumerable",Cc,{unsafe:!0}))),de({global:!0,wrap:!0,forced:!fe,sham:!fe},{Symbol:fc}),oc(ec(Xe),function(e){sc(e)}),de({target:cc,stat:!0,forced:!fe},{for:function(e){var t=String(e);if(za(bc,t))return bc[t];var n=fc(t);return bc[t]=n,Ic[n]=t,n},keyFor:function(e){if(!Sc(e))throw TypeError(e+" is not a symbol");if(za(Ic,e))return Ic[e]},useSetter:function(){Tc=!0},useSimple:function(){Tc=!1}}),de({target:"Object",stat:!0,forced:!fe,sham:!$a},{create:function(e,t){return void 0===t?Za(e):Va(Za(e),t)},defineProperty:kc,defineProperties:Va,getOwnPropertyDescriptor:ze}),de({target:"Object",stat:!0,forced:!fe},{getOwnPropertyNames:V,getOwnPropertySymbols:Ac}),de({target:"Object",stat:!0,forced:j(function(){tc.f(1)})},{getOwnPropertySymbols:function(e){return tc.f(Qa(e))}}),pc&&de({target:"JSON",stat:!0,forced:!fe||j(function(){var e=fc();return"[null]"!=pc([e])||"{}"!=pc({a:e})||"{}"!=pc(Object(e))})},{stringify:function(e,t,n){for(var r,i=[e],s=1;s<arguments.length;)i.push(arguments[s++]);if((Ga(r=t)||void 0!==e)&&!Sc(e))return Wa(t)||(t=function(e,t){if("function"==typeof r&&(t=r.call(this,e,t)),!Sc(t))return t}),i[1]=t,pc.apply(null,i)}}),fc[lc][S]||N(fc[lc],S,fc[lc].valueOf),ve(fc,cc),nc[ac]=!0,We("asyncIterator");var Nc,xc,Rc,Pc,Dc,S=W,Oc=D,Mc=c,ve=a.f,U=U,Lc=i.Symbol;!o||"function"!=typeof Lc||"description"in Lc.prototype&&void 0===Lc().description||(Nc={},U(xc=function(){var e=arguments.length<1||void 0===arguments[0]?void 0:String(arguments[0]),t=this instanceof xc?new Lc(e):void 0===e?Lc():Lc(e);return""===e&&(Nc[t]=!0),t},Lc),(U=xc.prototype=Lc.prototype).constructor=xc,Rc=U.toString,Pc="Symbol(test)"==String(Lc("test")),Dc=/^Symbol\((.*)\)[^)]+$/,ve(U,"description",{configurable:!0,get:function(){var e=Mc(this)?this.valueOf():this,t=Rc.call(e);if(Oc(Nc,e))return"";t=Pc?t.slice(7,-1):t.replace(Dc,"$1");return""===t?void 0:t}}),S({global:!0,forced:!0},{Symbol:xc})),We("hasInstance"),We("isConcatSpreadable"),We("iterator"),We("match"),We("matchAll"),We("replace"),We("search"),We("species"),We("split"),We("toPrimitive"),We("toStringTag"),We("unscopables"),tt(Math,"Math",!0),tt(i.JSON,"JSON",!0),yt.Symbol,We("asyncDispose"),We("dispose"),We("observable"),We("patternMatch"),We("replaceAll"),Et.f("iterator");function Fc(e){jc(e,Bc,{value:{objectID:"O"+ ++Kc,weakData:{}}})}var We={exports:{}},Et=!e(function(){return Object.isExtensible(Object.preventExtensions({}))}),ye=ye,Uc=c,Vc=D,jc=a.f,qc=Et,Bc=O("meta"),Kc=0,$c=Object.isExtensible||function(){return!0},zc=We.exports={REQUIRED:!1,fastKey:function(e,t){if(!Uc(e))return"symbol"==typeof e?e:("string"==typeof e?"S":"P")+e;if(!Vc(e,Bc)){if(!$c(e))return"F";if(!t)return"E";Fc(e)}return e[Bc].objectID},getWeakData:function(e,t){if(!Vc(e,Bc)){if(!$c(e))return!0;if(!t)return!1;Fc(e)}return e[Bc].weakData},onFreeze:function(e){return qc&&zc.REQUIRED&&$c(e)&&!Vc(e,Bc)&&Fc(e),e}};ye[Bc]=!0;var Wc=c,Gc=rt,Hc=W,Qc=i,Yc=q,Jc=Z.exports,Xc=We.exports,Zc=l.exports,el=Le,tl=c,nl=e,rl=r,il=tt,sl=function(e,t,n){var r,i;return Gc&&"function"==typeof(r=t.constructor)&&r!==n&&Wc(i=r.prototype)&&i!==n.prototype&&Gc(e,i),e},tt=function(r,e,t){function n(e){var n=f[e];Jc(f,e,"add"==e?function(e){return n.call(this,0===e?0:e),this}:"delete"==e?function(e){return!(u&&!tl(e))&&n.call(this,0===e?0:e)}:"get"==e?function(e){return u&&!tl(e)?void 0:n.call(this,0===e?0:e)}:"has"==e?function(e){return!(u&&!tl(e))&&n.call(this,0===e?0:e)}:function(e,t){return n.call(this,0===e?0:e,t),this})}var i,s,o,a,c,l=-1!==r.indexOf("Map"),u=-1!==r.indexOf("Weak"),h=l?"set":"add",d=Qc[r],f=d&&d.prototype,p=d,g={};return Yc(r,"function"!=typeof d||!(u||f.forEach&&!nl(function(){(new d).entries().next()})))?(p=t.getConstructor(e,r,l,h),Xc.REQUIRED=!0):Yc(r,!0)&&(s=(i=new p)[h](u?{}:-0,1)!=i,o=nl(function(){i.has(1)}),a=rl(function(e){new d(e)}),c=!u&&nl(function(){for(var e=new d,t=5;t--;)e[h](t,t);return!e.has(-0)}),a||(((p=e(function(e,t){el(e,p,r);var n=sl(new d,e,p);return null!=t&&Zc(t,n[h],n,l),n})).prototype=f).constructor=p),(o||c)&&(n("delete"),n("has"),l&&n("get")),(c||s)&&n(h),u&&f.clear&&delete f.clear),g[r]=p,Hc({global:!0,forced:p!=d},g),il(p,r),u||t.setStrong(p,r,l),p},ol=a.f,al=Qe,cl=Er,ll=Te,ul=Le,hl=l.exports,dl=Rt,fl=Ee,pl=o,gl=We.exports.fastKey,ml=Se.set,vl=Se.getterFor,Rt={getConstructor:function(e,n,r,i){function s(e,t,n){var r,i,s=c(e),o=a(e,t);return o?o.value=n:(s.last=o={index:i=gl(t,!0),key:t,value:n,previous:r=s.last,next:void 0,removed:!1},s.first||(s.first=o),r&&(r.next=o),pl?s.size++:e.size++,"F"!==i&&(s.index[i]=o)),e}function a(e,t){var n,r=c(e),i=gl(t);if("F"!==i)return r.index[i];for(n=r.first;n;n=n.next)if(n.key==t)return n}var o=e(function(e,t){ul(e,o,n),ml(e,{type:n,index:al(null),first:void 0,last:void 0,size:0}),pl||(e.size=0),null!=t&&hl(t,e[i],e,r)}),c=vl(n);return cl(o.prototype,{clear:function(){for(var e=c(this),t=e.index,n=e.first;n;)n.removed=!0,n.previous&&(n.previous=n.previous.next=void 0),delete t[n.index],n=n.next;e.first=e.last=void 0,pl?e.size=0:this.size=0},delete:function(e){var t,n,r=c(this),i=a(this,e);return i&&(t=i.next,n=i.previous,delete r.index[i.index],i.removed=!0,n&&(n.next=t),t&&(t.previous=n),r.first==i&&(r.first=t),r.last==i&&(r.last=n),pl?r.size--:this.size--),!!i},forEach:function(e){for(var t,n=c(this),r=ll(e,1<arguments.length?arguments[1]:void 0,3);t=t?t.next:n.first;)for(r(t.value,t.key,this);t&&t.removed;)t=t.previous},has:function(e){return!!a(this,e)}}),cl(o.prototype,r?{get:function(e){var t=a(this,e);return t&&t.value},set:function(e,t){return s(this,0===e?0:e,t)}}:{add:function(e){return s(this,e=0===e?0:e,e)}}),pl&&ol(o.prototype,"size",{get:function(){return c(this).size}}),o},setStrong:function(e,t,n){var r=t+" Iterator",i=vl(t),s=vl(r);dl(e,t,function(e,t){ml(this,{type:r,target:e,state:i(e),kind:t,last:void 0})},function(){for(var e=s(this),t=e.kind,n=e.last;n&&n.removed;)n=n.previous;return e.target&&(e.last=n=n?n.next:e.state.first)?"keys"==t?{value:n.key,done:!1}:"values"==t?{value:n.value,done:!1}:{value:[n.key,n.value],done:!1}:{value:e.target=void 0,done:!0}},n?"entries":"values",!n,!0),fl(t)}};tt("Map",function(e){return function(){return e(this,arguments.length?arguments[0]:void 0)}},Rt),yt.Map;var yl=n,_l=Te,wl=l.exports,Ee=function(e){var t,n,r,i,s=arguments.length,o=1<s?arguments[1]:void 0;return yl(this),(t=void 0!==o)&&yl(o),null==e?new this:(n=[],t?(r=0,i=_l(o,2<s?arguments[2]:void 0,2),wl(e,function(e){n.push(i(e,r++))})):wl(e,n.push,n),new this(n))};W({target:"Map",stat:!0},{from:Ee});o=function(){for(var e=arguments.length,t=new Array(e);e--;)t[e]=arguments[e];return new this(t)};W({target:"Map",stat:!0},{of:o});var bl=t,Il=n,We=function(){for(var e,t=bl(this),n=Il(t.delete),r=!0,i=0,s=arguments.length;i<s;i++)e=n.call(t,arguments[i]),r=r&&e;return!!r},Tl=We;W({target:"Map",proto:!0,real:!0,forced:!1},{deleteAll:function(){return Tl.apply(this,arguments)}});var El=t,Sl=p,Se=function(e){return Map.prototype.entries.call(e)},p=W,kl=t,Cl=Te,Al=Se,Nl=l.exports;p({target:"Map",proto:!0,real:!0,forced:!1},{every:function(e){var n=kl(this),t=Al(n),r=Cl(e,1<arguments.length?arguments[1]:void 0,3);return!Nl(t,function(e,t){if(!r(t,e,n))return Nl.stop()},void 0,!0,!0).stopped}});var p=W,xl=vt,Rl=t,Pl=n,Dl=Te,Ol=x,Ml=Se,Ll=l.exports;p({target:"Map",proto:!0,real:!0,forced:!1},{filter:function(e){var n=Rl(this),t=Ml(n),r=Dl(e,1<arguments.length?arguments[1]:void 0,3),i=new(Ol(n,xl("Map"))),s=Pl(i.set);return Ll(t,function(e,t){r(t,e,n)&&s.call(i,e,t)},void 0,!0,!0),i}});var p=W,Fl=t,Ul=Te,Vl=Se,jl=l.exports;p({target:"Map",proto:!0,real:!0,forced:!1},{find:function(e){var n=Fl(this),t=Vl(n),r=Ul(e,1<arguments.length?arguments[1]:void 0,3);return jl(t,function(e,t){if(r(t,e,n))return jl.stop(t)},void 0,!0,!0).result}});var p=W,ql=t,Bl=Te,Kl=Se,$l=l.exports;p({target:"Map",proto:!0,real:!0,forced:!1},{findKey:function(e){var n=ql(this),t=Kl(n),r=Bl(e,1<arguments.length?arguments[1]:void 0,3);return $l(t,function(e,t){if(r(t,e,n))return $l.stop(e)},void 0,!0,!0).result}});var p=W,zl=l.exports,Wl=n;p({target:"Map",stat:!0},{groupBy:function(e,n){var r=new this;Wl(n);var i=Wl(r.has),s=Wl(r.get),o=Wl(r.set);return zl(e,function(e){var t=n(e);i.call(r,t)?s.call(r,t).push(e):o.call(r,t,[e])}),r}});var p=W,Gl=t,Hl=Se,Ql=function(e,t){return e===t||e!=e&&t!=t},Yl=l.exports;p({target:"Map",proto:!0,real:!0,forced:!1},{includes:function(n){return Yl(Hl(Gl(this)),function(e,t){if(Ql(t,n))return Yl.stop()},void 0,!0,!0).stopped}});var p=W,Jl=l.exports,Xl=n;p({target:"Map",stat:!0},{keyBy:function(e,t){var n=new this;Xl(t);var r=Xl(n.set);return Jl(e,function(e){r.call(n,t(e),e)}),n}});var p=W,Zl=t,eu=Se,tu=l.exports;p({target:"Map",proto:!0,real:!0,forced:!1},{keyOf:function(n){return tu(eu(Zl(this)),function(e,t){if(t===n)return tu.stop(e)},void 0,!0,!0).result}});var p=W,nu=vt,ru=t,iu=n,su=Te,ou=x,au=Se,cu=l.exports;p({target:"Map",proto:!0,real:!0,forced:!1},{mapKeys:function(e){var n=ru(this),t=au(n),r=su(e,1<arguments.length?arguments[1]:void 0,3),i=new(ou(n,nu("Map"))),s=iu(i.set);return cu(t,function(e,t){s.call(i,r(t,e,n),t)},void 0,!0,!0),i}});var p=W,lu=vt,uu=t,hu=n,du=Te,fu=x,pu=Se,gu=l.exports;p({target:"Map",proto:!0,real:!0,forced:!1},{mapValues:function(e){var n=uu(this),t=pu(n),r=du(e,1<arguments.length?arguments[1]:void 0,3),i=new(fu(n,lu("Map"))),s=hu(i.set);return gu(t,function(e,t){s.call(i,e,r(t,e,n))},void 0,!0,!0),i}});var p=W,mu=t,vu=n,yu=l.exports;p({target:"Map",proto:!0,real:!0,forced:!1},{merge:function(e){for(var t=mu(this),n=vu(t.set),r=0;r<arguments.length;)yu(arguments[r++],n,t,!0);return t}});var p=W,_u=t,wu=n,bu=Se,Iu=l.exports;p({target:"Map",proto:!0,real:!0,forced:!1},{reduce:function(n){var r=_u(this),e=bu(r),i=arguments.length<2,s=i?void 0:arguments[1];if(wu(n),Iu(e,function(e,t){s=i?(i=!1,t):n(s,t,e,r)},void 0,!0,!0),i)throw TypeError("Reduce of empty map with no initial value");return s}});var p=W,Tu=t,Eu=Te,Su=Se,ku=l.exports;p({target:"Map",proto:!0,real:!0,forced:!1},{some:function(e){var n=Tu(this),t=Su(n),r=Eu(e,1<arguments.length?arguments[1]:void 0,3);return ku(t,function(e,t){if(r(t,e,n))return ku.stop()},void 0,!0,!0).stopped}});var Cu=t,Au=n;W({target:"Map",proto:!0,real:!0,forced:!1},{update:function(e,t){var n=Cu(this),r=arguments.length;Au(t);var i=n.has(e);if(!i&&r<3)throw TypeError("Updating absent value");r=i?n.get(e):Au(2<r?arguments[2]:void 0)(e,n);return n.set(e,t(r,e,n)),n}});var Nu=t,p=function(e,t){var n,r=Nu(this),i=2<arguments.length?arguments[2]:void 0;if("function"!=typeof t&&"function"!=typeof i)throw TypeError("At least one callback required");return r.has(e)?(n=r.get(e),"function"==typeof t&&(n=t(n),r.set(e,n))):"function"==typeof i&&(n=i(),r.set(e,n)),n};W({target:"Map",proto:!0,real:!0,forced:!1},{upsert:p});W({target:"Map",proto:!0,real:!0,forced:!1},{updateOrInsert:p}),tt("Set",function(e){return function(){return e(this,arguments.length?arguments[0]:void 0)}},Rt),yt.Set,W({target:"Set",stat:!0},{from:Ee}),W({target:"Set",stat:!0},{of:o});var xu=t,Ru=n,Pu=function(){for(var e=xu(this),t=Ru(e.add),n=0,r=arguments.length;n<r;n++)t.call(e,arguments[n]);return e};W({target:"Set",proto:!0,real:!0,forced:!1},{addAll:function(){return Pu.apply(this,arguments)}});var Du=We;W({target:"Set",proto:!0,real:!0,forced:!1},{deleteAll:function(){return Du.apply(this,arguments)}});var o=function(e){return Set.prototype.values.call(e)},We=W,Ou=t,Mu=Te,Lu=o,Fu=l.exports;We({target:"Set",proto:!0,real:!0,forced:!1},{every:function(e){var t=Ou(this),n=Lu(t),r=Mu(e,1<arguments.length?arguments[1]:void 0,3);return!Fu(n,function(e){if(!r(e,e,t))return Fu.stop()},void 0,!1,!0).stopped}});var We=W,Uu=vt,Vu=t,ju=n,qu=x,Bu=l.exports;We({target:"Set",proto:!0,real:!0,forced:!1},{difference:function(e){var t=Vu(this),n=new(qu(t,Uu("Set")))(t),r=ju(n.delete);return Bu(e,function(e){r.call(n,e)}),n}});var We=W,Ku=vt,$u=t,zu=n,Wu=Te,Gu=x,Hu=o,Qu=l.exports;We({target:"Set",proto:!0,real:!0,forced:!1},{filter:function(e){var t=$u(this),n=Hu(t),r=Wu(e,1<arguments.length?arguments[1]:void 0,3),i=new(Gu(t,Ku("Set"))),s=zu(i.add);return Qu(n,function(e){r(e,e,t)&&s.call(i,e)},void 0,!1,!0),i}});var We=W,Yu=t,Ju=Te,Xu=o,Zu=l.exports;We({target:"Set",proto:!0,real:!0,forced:!1},{find:function(e){var t=Yu(this),n=Xu(t),r=Ju(e,1<arguments.length?arguments[1]:void 0,3);return Zu(n,function(e){if(r(e,e,t))return Zu.stop(e)},void 0,!1,!0).result}});var We=W,eh=vt,th=t,nh=n,rh=x,ih=l.exports;We({target:"Set",proto:!0,real:!0,forced:!1},{intersection:function(e){var t=th(this),n=new(rh(t,eh("Set"))),r=nh(t.has),i=nh(n.add);return ih(e,function(e){r.call(t,e)&&i.call(n,e)}),n}});var We=W,sh=t,oh=n,ah=l.exports;We({target:"Set",proto:!0,real:!0,forced:!1},{isDisjointFrom:function(e){var t=sh(this),n=oh(t.has);return!ah(e,function(e){if(!0===n.call(t,e))return ah.stop()}).stopped}});var We=W,ch=vt,lh=t,uh=n,hh=function(e){var t=Sl(e);if("function"!=typeof t)throw TypeError(String(e)+" is not iterable");return El(t.call(e))},dh=l.exports;We({target:"Set",proto:!0,real:!0,forced:!1},{isSubsetOf:function(e){var t=hh(this),n=lh(e),r=n.has;return"function"!=typeof r&&(n=new(ch("Set"))(e),r=uh(n.has)),!dh(t,function(e){if(!1===r.call(n,e))return dh.stop()},void 0,!1,!0).stopped}});var We=W,fh=t,ph=n,gh=l.exports;We({target:"Set",proto:!0,real:!0,forced:!1},{isSupersetOf:function(e){var t=fh(this),n=ph(t.has);return!gh(e,function(e){if(!1===n.call(t,e))return gh.stop()}).stopped}});var We=W,mh=t,vh=o,yh=l.exports;We({target:"Set",proto:!0,real:!0,forced:!1},{join:function(e){var t=mh(this),n=vh(t),r=void 0===e?",":String(e),t=[];return yh(n,t.push,t,!1,!0),t.join(r)}});var We=W,_h=vt,wh=t,bh=n,Ih=Te,Th=x,Eh=o,Sh=l.exports;We({target:"Set",proto:!0,real:!0,forced:!1},{map:function(e){var t=wh(this),n=Eh(t),r=Ih(e,1<arguments.length?arguments[1]:void 0,3),i=new(Th(t,_h("Set"))),s=bh(i.add);return Sh(n,function(e){s.call(i,r(e,e,t))},void 0,!1,!0),i}});var We=W,kh=t,Ch=n,Ah=o,Nh=l.exports;We({target:"Set",proto:!0,real:!0,forced:!1},{reduce:function(t){var n=kh(this),e=Ah(n),r=arguments.length<2,i=r?void 0:arguments[1];if(Ch(t),Nh(e,function(e){i=r?(r=!1,e):t(i,e,e,n)},void 0,!1,!0),r)throw TypeError("Reduce of empty set with no initial value");return i}});var We=W,xh=t,Rh=Te,Ph=o,Dh=l.exports;We({target:"Set",proto:!0,real:!0,forced:!1},{some:function(e){var t=xh(this),n=Ph(t),r=Rh(e,1<arguments.length?arguments[1]:void 0,3);return Dh(n,function(e){if(r(e,e,t))return Dh.stop()},void 0,!1,!0).stopped}});var We=W,Oh=vt,Mh=t,Lh=n,Fh=x,Uh=l.exports;We({target:"Set",proto:!0,real:!0,forced:!1},{symmetricDifference:function(e){var t=Mh(this),n=new(Fh(t,Oh("Set")))(t),r=Lh(n.delete),i=Lh(n.add);return Uh(e,function(e){r.call(n,e)||i.call(n,e)}),n}});var We=W,Vh=vt,jh=t,qh=n,Bh=x,Kh=l.exports;We({target:"Set",proto:!0,real:!0,forced:!1},{union:function(e){var t=jh(this),t=new(Bh(t,Vh("Set")))(t);return Kh(e,qh(t.add),t),t}});var $h,zh,Wh,Gh=c,Hh=Math.floor;W({target:"Number",stat:!0},{isInteger:function(e){return!Gh(e)&&isFinite(e)&&Hh(e)===e}}),yt.Number.isInteger;function Qh(e){var t=Zh(e);return ed.encodeByteArray(t,!0)}const Yh={NODE_CLIENT:!1,NODE_ADMIN:!1,SDK_VERSION:"${JSCORE_VERSION}"},Jh=function(e,t){if(!e)throw Xh(t)},Xh=function(e){return new Error("Firebase Database ("+Yh.SDK_VERSION+") INTERNAL ASSERT FAILED: "+e)},Zh=function(t){const n=[];let r=0;for(let i=0;i<t.length;i++){let e=t.charCodeAt(i);e<128?n[r++]=e:(e<2048?n[r++]=e>>6|192:(55296==(64512&e)&&i+1<t.length&&56320==(64512&t.charCodeAt(i+1))?(e=65536+((1023&e)<<10)+(1023&t.charCodeAt(++i)),n[r++]=e>>18|240,n[r++]=e>>12&63|128):n[r++]=e>>12|224,n[r++]=e>>6&63|128),n[r++]=63&e|128)}return n},ed={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"==typeof atob,encodeByteArray(n,e){if(!Array.isArray(n))throw Error("encodeByteArray takes an array as a parameter");this.init_();var r=e?this.byteToCharMapWebSafe_:this.byteToCharMap_;const i=[];for(let u=0;u<n.length;u+=3){var s=n[u],o=u+1<n.length,a=o?n[u+1]:0,c=u+2<n.length,l=c?n[u+2]:0;let e=(15&a)<<2|l>>6,t=63&l;c||(t=64,o||(e=64)),i.push(r[s>>2],r[(3&s)<<4|a>>4],r[e],r[t])}return i.join("")},encodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?btoa(e):this.encodeByteArray(Zh(e),t)},decodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?atob(e):function(e){const t=[];let n=0,r=0;for(;n<e.length;){var i,s,o=e[n++];o<128?t[r++]=String.fromCharCode(o):191<o&&o<224?(i=e[n++],t[r++]=String.fromCharCode((31&o)<<6|63&i)):239<o&&o<365?(s=((7&o)<<18|(63&e[n++])<<12|(63&e[n++])<<6|63&e[n++])-65536,t[r++]=String.fromCharCode(55296+(s>>10)),t[r++]=String.fromCharCode(56320+(1023&s))):(i=e[n++],s=e[n++],t[r++]=String.fromCharCode((15&o)<<12|(63&i)<<6|63&s))}return t.join("")}(this.decodeStringToByteArray(e,t))},decodeStringToByteArray(e,t){this.init_();var n=t?this.charToByteMapWebSafe_:this.charToByteMap_;const r=[];for(let c=0;c<e.length;){var i=n[e.charAt(c++)],s=c<e.length?n[e.charAt(c)]:0;++c;var o=c<e.length?n[e.charAt(c)]:64;++c;var a=c<e.length?n[e.charAt(c)]:64;if(++c,null==i||null==s||null==o||null==a)throw Error();r.push(i<<2|s>>4),64!==o&&(r.push(s<<4&240|o>>2),64!==a&&r.push(o<<6&192|a))}return r},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let e=0;e<this.ENCODED_VALS.length;e++)this.byteToCharMap_[e]=this.ENCODED_VALS.charAt(e),this.charToByteMap_[this.byteToCharMap_[e]]=e,this.byteToCharMapWebSafe_[e]=this.ENCODED_VALS_WEBSAFE.charAt(e),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[e]]=e,e>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(e)]=e,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(e)]=e)}}},td=function(e){return Qh(e).replace(/\./g,"")},nd=function(e){try{return ed.decodeString(e,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};function rd(e,t){if(!(t instanceof Object))return t;switch(t.constructor){case Date:const n=t;return new Date(n.getTime());case Object:void 0===e&&(e={});break;case Array:e=[];break;default:return t}for(const r in t)t.hasOwnProperty(r)&&"__proto__"!==r&&(e[r]=rd(e[r],t[r]));return e}class id{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}wrapCallback(n){return(e,t)=>{e?this.reject(e):this.resolve(t),"function"==typeof n&&(this.promise.catch(()=>{}),1===n.length?n(e):n(e,t))}}}function sd(e,t){if(e.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');var n=t||"demo-project",r=e.iat||0,i=e.sub||e.user_id;if(!i)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");i=Object.assign({iss:`https://securetoken.google.com/${n}`,aud:n,iat:r,exp:r+3600,auth_time:r,sub:i,user_id:i,firebase:{sign_in_provider:"custom",identities:{}}},e);return[td(JSON.stringify({alg:"none",type:"JWT"})),td(JSON.stringify(i)),""].join(".")}function od(){return"undefined"!=typeof navigator&&"string"==typeof navigator.userAgent?navigator.userAgent:""}function ad(){return"undefined"!=typeof window&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(od())}function cd(){try{return"[object process]"===Object.prototype.toString.call(global.process)}catch(e){return!1}}function ld(){var e="object"==typeof chrome?chrome.runtime:"object"==typeof browser?browser.runtime:void 0;return"object"==typeof e&&void 0!==e.id}function ud(){return"object"==typeof navigator&&"ReactNative"===navigator.product}function hd(){const e=od();return 0<=e.indexOf("MSIE ")||0<=e.indexOf("Trident/")}function dd(){return!0===Yh.NODE_ADMIN}function fd(){return"object"==typeof indexedDB}function pd(){return new Promise((t,n)=>{try{let e=!0;const r="validate-browser-context-for-indexeddb-analytics-module",i=self.indexedDB.open(r);i.onsuccess=()=>{i.result.close(),e||self.indexedDB.deleteDatabase(r),t(!0)},i.onupgradeneeded=()=>{e=!1},i.onerror=()=>{var e;n((null===(e=i.error)||void 0===e?void 0:e.message)||"")}}catch(e){n(e)}})}function gd(){return!("undefined"==typeof navigator||!navigator.cookieEnabled)}class md extends Error{constructor(e,t,n){super(t),this.code=e,this.customData=n,this.name="FirebaseError",Object.setPrototypeOf(this,md.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,vd.prototype.create)}}class vd{constructor(e,t,n){this.service=e,this.serviceName=t,this.errors=n}create(e,...t){var r,n=t[0]||{},i=`${this.service}/${e}`,s=this.errors[e],s=s?(r=n,s.replace(yd,(e,t)=>{var n=r[t];return null!=n?String(n):`<${t}?>`})):"Error",s=`${this.serviceName}: ${s} (${i}).`;return new md(i,s,n)}}const yd=/\{\$([^}]+)}/g;function _d(e){return JSON.parse(e)}function wd(e){return JSON.stringify(e)}function bd(e){let t={},n={},r={},i="";try{var s=e.split(".");t=_d(nd(s[0])||""),n=_d(nd(s[1])||""),i=s[2],r=n.d||{},delete n.d}catch(e){}return{header:t,claims:n,data:r,signature:i}}function Id(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function Td(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]}function Ed(e){for(const t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}function Sd(e,t,n){const r={};for(const i in e)Object.prototype.hasOwnProperty.call(e,i)&&(r[i]=t.call(n,e[i],i,e));return r}function kd(e,t){if(e===t)return 1;const n=Object.keys(e),r=Object.keys(t);for(const o of n){if(!r.includes(o))return;var i=e[o],s=t[o];if(Cd(i)&&Cd(s)){if(!kd(i,s))return}else if(i!==s)return}for(const a of r)if(!n.includes(a))return;return 1}function Cd(e){return null!==e&&"object"==typeof e}function Ad(e){const t=[];for(const[n,r]of Object.entries(e))Array.isArray(r)?r.forEach(e=>{t.push(encodeURIComponent(n)+"="+encodeURIComponent(e))}):t.push(encodeURIComponent(n)+"="+encodeURIComponent(r));return t.length?"&"+t.join("&"):""}function Nd(e){const r={},t=e.replace(/^\?/,"").split("&");return t.forEach(e=>{var t,n;e&&([t,n]=e.split("="),r[decodeURIComponent(t)]=decodeURIComponent(n))}),r}function xd(e){var t=e.indexOf("?");if(!t)return"";var n=e.indexOf("#",t);return e.substring(t,0<n?n:void 0)}class Rd{constructor(){this.chain_=[],this.buf_=[],this.W_=[],this.pad_=[],this.inbuf_=0,this.total_=0,this.blockSize=64,this.pad_[0]=128;for(let e=1;e<this.blockSize;++e)this.pad_[e]=0;this.reset()}reset(){this.chain_[0]=1732584193,this.chain_[1]=4023233417,this.chain_[2]=2562383102,this.chain_[3]=271733878,this.chain_[4]=3285377520,this.inbuf_=0,this.total_=0}compress_(n,r){r=r||0;const i=this.W_;if("string"==typeof n)for(let e=0;e<16;e++)i[e]=n.charCodeAt(r)<<24|n.charCodeAt(r+1)<<16|n.charCodeAt(r+2)<<8|n.charCodeAt(r+3),r+=4;else for(let t=0;t<16;t++)i[t]=n[r]<<24|n[r+1]<<16|n[r+2]<<8|n[r+3],r+=4;for(let d=16;d<80;d++){var e=i[d-3]^i[d-8]^i[d-14]^i[d-16];i[d]=4294967295&(e<<1|e>>>31)}let t=this.chain_[0],s=this.chain_[1],o=this.chain_[2],a=this.chain_[3],c=this.chain_[4],l,u;for(let f=0;f<80;f++){u=f<40?f<20?(l=a^s&(o^a),1518500249):(l=s^o^a,1859775393):f<60?(l=s&o|a&(s|o),2400959708):(l=s^o^a,3395469782);var h=(t<<5|t>>>27)+l+c+u+i[f]&4294967295;c=a,a=o,o=4294967295&(s<<30|s>>>2),s=t,t=h}this.chain_[0]=this.chain_[0]+t&4294967295,this.chain_[1]=this.chain_[1]+s&4294967295,this.chain_[2]=this.chain_[2]+o&4294967295,this.chain_[3]=this.chain_[3]+a&4294967295,this.chain_[4]=this.chain_[4]+c&4294967295}update(n,r){if(null!=n){var i=(r=void 0===r?n.length:r)-this.blockSize;let e=0;const s=this.buf_;let t=this.inbuf_;for(;e<r;){if(0===t)for(;e<=i;)this.compress_(n,e),e+=this.blockSize;if("string"==typeof n){for(;e<r;)if(s[t]=n.charCodeAt(e),++t,++e,t===this.blockSize){this.compress_(s),t=0;break}}else for(;e<r;)if(s[t]=n[e],++t,++e,t===this.blockSize){this.compress_(s),t=0;break}}this.inbuf_=t,this.total_+=r}}digest(){const t=[];let e=8*this.total_;this.inbuf_<56?this.update(this.pad_,56-this.inbuf_):this.update(this.pad_,this.blockSize-(this.inbuf_-56));for(let r=this.blockSize-1;56<=r;r--)this.buf_[r]=255&e,e/=256;this.compress_(this.buf_);let n=0;for(let i=0;i<5;i++)for(let e=24;0<=e;e-=8)t[n]=this.chain_[i]>>e&255,++n;return t}}function Pd(e,t){const n=new Dd(e,t);return n.subscribe.bind(n)}class Dd{constructor(e,t){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=t,this.task.then(()=>{e(this)}).catch(e=>{this.error(e)})}next(t){this.forEachObserver(e=>{e.next(t)})}error(t){this.forEachObserver(e=>{e.error(t)}),this.close(t)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,t,n){let r;if(void 0===e&&void 0===t&&void 0===n)throw new Error("Missing Observer.");r=function(e,t){if("object"!=typeof e||null===e)return!1;for(const n of t)if(n in e&&"function"==typeof e[n])return!0;return!1}(e,["next","error","complete"])?e:{next:e,error:t,complete:n},void 0===r.next&&(r.next=Od),void 0===r.error&&(r.error=Od),void 0===r.complete&&(r.complete=Od);var i=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?r.error(this.finalError):r.complete()}catch(e){}}),this.observers.push(r),i}unsubscribeOne(e){void 0!==this.observers&&void 0!==this.observers[e]&&(delete this.observers[e],--this.observerCount,0===this.observerCount&&void 0!==this.onNoObservers&&this.onNoObservers(this))}forEachObserver(t){if(!this.finalized)for(let e=0;e<this.observers.length;e++)this.sendOne(e,t)}sendOne(e,t){this.task.then(()=>{if(void 0!==this.observers&&void 0!==this.observers[e])try{t(this.observers[e])}catch(e){"undefined"!=typeof console&&console.error&&console.error(e)}})}close(e){this.finalized||(this.finalized=!0,void 0!==e&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function Od(){}function Md(e,t,n,r){let i;if(r<t?i="at least "+t:n<r&&(i=0===n?"none":"no more than "+n),i){var s=e+" failed: Was called with "+r+(1===r?" argument.":" arguments.")+" Expects "+i+".";throw new Error(s)}}function Ld(e,t){return`${e} failed: ${t} argument `}function Fd(e,t,n,r){if((!r||n)&&"function"!=typeof n)throw new Error(Ld(e,t)+"must be a valid function.")}function Ud(e,t,n,r){if((!r||n)&&("object"!=typeof n||null===n))throw new Error(Ld(e,t)+"must be a valid context object.")}function Vd(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,e=>{const t=16*Math.random()|0,n="x"===e?t:3&t|8;return n.toString(16)})}const jd=function(e){let t=0;for(let r=0;r<e.length;r++){var n=e.charCodeAt(r);n<128?t++:n<2048?t+=2:55296<=n&&n<=56319?(t+=4,r++):t+=3}return t},qd=1e3,Bd=2,Kd=144e5,$d=.5;function zd(e,t=qd,n=Bd){var r=t*Math.pow(n,e),i=Math.round($d*r*(Math.random()-.5)*2);return Math.min(Kd,r+i)}function Wd(e){return e&&e._delegate?e._delegate:e}class Gd{constructor(e,t,n){this.name=e,this.instanceFactory=t,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}const Hd="[DEFAULT]";class Qd{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){var t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){const r=new id;if(this.instancesDeferred.set(t,r),this.isInitialized(t)||this.shouldAutoInitialize())try{var n=this.getOrInitializeService({instanceIdentifier:t});n&&r.resolve(n)}catch(e){}}return this.instancesDeferred.get(t).promise}getImmediate(e){var t=this.normalizeInstanceIdentifier(null==e?void 0:e.identifier),n=null!==(n=null==e?void 0:e.optional)&&void 0!==n&&n;if(!this.isInitialized(t)&&!this.shouldAutoInitialize()){if(n)return null;throw Error(`Service ${this.name} is not available`)}try{return this.getOrInitializeService({instanceIdentifier:t})}catch(e){if(n)return null;throw e}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,this.shouldAutoInitialize()){if("EAGER"===e.instantiationMode)try{this.getOrInitializeService({instanceIdentifier:Hd})}catch(e){}for(var[t,n]of this.instancesDeferred.entries()){t=this.normalizeInstanceIdentifier(t);try{var r=this.getOrInitializeService({instanceIdentifier:t});n.resolve(r)}catch(e){}}}}clearInstance(e=Hd){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter(e=>"INTERNAL"in e).map(e=>e.INTERNAL.delete()),...e.filter(e=>"_delete"in e).map(e=>e._delete())])}isComponentSet(){return null!=this.component}isInitialized(e=Hd){return this.instances.has(e)}getOptions(e=Hd){return this.instancesOptions.get(e)||{}}initialize(e={}){var{options:t={}}=e,n=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(n))throw Error(`${this.name}(${n}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);var r,i,s=this.getOrInitializeService({instanceIdentifier:n,options:t});for([r,i]of this.instancesDeferred.entries())n===this.normalizeInstanceIdentifier(r)&&i.resolve(s);return s}onInit(e,t){var n=this.normalizeInstanceIdentifier(t);const r=null!==(i=this.onInitCallbacks.get(n))&&void 0!==i?i:new Set;r.add(e),this.onInitCallbacks.set(n,r);var i=this.instances.get(n);return i&&e(i,n),()=>{r.delete(e)}}invokeOnInitCallbacks(e,t){var n=this.onInitCallbacks.get(t);if(n)for(const r of n)try{r(e,t)}catch(e){}}getOrInitializeService({instanceIdentifier:e,options:t={}}){let n=this.instances.get(e);if(!n&&this.component&&(n=this.component.instanceFactory(this.container,{instanceIdentifier:(r=e)===Hd?void 0:r,options:t}),this.instances.set(e,n),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(n,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,n)}catch(e){}var r;return n||null}normalizeInstanceIdentifier(e=Hd){return!this.component||this.component.multipleInstances?e:Hd}shouldAutoInitialize(){return!!this.component&&"EXPLICIT"!==this.component.instantiationMode}}class Yd{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const t=this.getProvider(e.name);if(t.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){const t=this.getProvider(e.name);t.isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);var t=new Qd(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}const Jd=[];(zh=$h=$h||{})[zh.DEBUG=0]="DEBUG",zh[zh.VERBOSE=1]="VERBOSE",zh[zh.INFO=2]="INFO",zh[zh.WARN=3]="WARN",zh[zh.ERROR=4]="ERROR",zh[zh.SILENT=5]="SILENT";const Xd={debug:$h.DEBUG,verbose:$h.VERBOSE,info:$h.INFO,warn:$h.WARN,error:$h.ERROR,silent:$h.SILENT},Zd=$h.INFO,ef={[$h.DEBUG]:"log",[$h.VERBOSE]:"log",[$h.INFO]:"info",[$h.WARN]:"warn",[$h.ERROR]:"error"},tf=(e,t,...n)=>{if(!(t<e.logLevel)){var r=(new Date).toISOString(),i=ef[t];if(!i)throw new Error(`Attempted to log a message with an invalid logType (value: ${t})`);console[i](`[${r}]  ${e.name}:`,...n)}};class nf{constructor(e){this.name=e,this._logLevel=Zd,this._logHandler=tf,this._userLogHandler=null,Jd.push(this)}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in $h))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel="string"==typeof e?Xd[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if("function"!=typeof e)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,$h.DEBUG,...e),this._logHandler(this,$h.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,$h.VERBOSE,...e),this._logHandler(this,$h.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,$h.INFO,...e),this._logHandler(this,$h.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,$h.WARN,...e),this._logHandler(this,$h.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,$h.ERROR,...e),this._logHandler(this,$h.ERROR,...e)}}const rf=(t,e)=>e.some(e=>t instanceof e);let sf,of;const af=new WeakMap,cf=new WeakMap,lf=new WeakMap,uf=new WeakMap,hf=new WeakMap;let df={get(e,t,n){if(e instanceof IDBTransaction){if("done"===t)return cf.get(e);if("objectStoreNames"===t)return e.objectStoreNames||lf.get(e);if("store"===t)return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return gf(e[t])},set(e,t,n){return e[t]=n,!0},has(e,t){return e instanceof IDBTransaction&&("done"===t||"store"===t)||t in e}};function ff(r){return r!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?(of=of||[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey]).includes(r)?function(...e){return r.apply(mf(this),e),gf(af.get(this))}:function(...e){return gf(r.apply(mf(this),e))}:function(e,...t){var n=r.call(mf(this),e,...t);return lf.set(n,e.sort?e.sort():[e]),gf(n)}}function pf(e){return"function"==typeof e?ff(e):(e instanceof IDBTransaction&&(s=e,cf.has(s)||(t=new Promise((e,t)=>{const n=()=>{s.removeEventListener("complete",r),s.removeEventListener("error",i),s.removeEventListener("abort",i)},r=()=>{e(),n()},i=()=>{t(s.error||new DOMException("AbortError","AbortError")),n()};s.addEventListener("complete",r),s.addEventListener("error",i),s.addEventListener("abort",i)}),cf.set(s,t))),rf(e,sf=sf||[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])?new Proxy(e,df):e);var s,t}function gf(e){if(e instanceof IDBRequest)return function(s){const e=new Promise((e,t)=>{const n=()=>{s.removeEventListener("success",r),s.removeEventListener("error",i)},r=()=>{e(gf(s.result)),n()},i=()=>{t(s.error),n()};s.addEventListener("success",r),s.addEventListener("error",i)});return e.then(e=>{e instanceof IDBCursor&&af.set(e,s)}).catch(()=>{}),hf.set(e,s),e}(e);if(uf.has(e))return uf.get(e);var t=pf(e);return t!==e&&(uf.set(e,t),hf.set(t,e)),t}const mf=e=>hf.get(e);function vf(e,t,{blocked:n,upgrade:r,blocking:i,terminated:s}={}){const o=indexedDB.open(e,t),a=gf(o);return r&&o.addEventListener("upgradeneeded",e=>{r(gf(o.result),e.oldVersion,e.newVersion,gf(o.transaction))}),n&&o.addEventListener("blocked",()=>n()),a.then(e=>{s&&e.addEventListener("close",()=>s()),i&&e.addEventListener("versionchange",()=>i())}).catch(()=>{}),a}function yf(e,{blocked:t}={}){const n=indexedDB.deleteDatabase(e);return t&&n.addEventListener("blocked",()=>t()),gf(n).then(()=>{})}const _f=["get","getKey","getAll","getAllKeys","count"],wf=["put","add","delete","clear"],bf=new Map;function If(e,t){if(e instanceof IDBDatabase&&!(t in e)&&"string"==typeof t){if(bf.get(t))return bf.get(t);const i=t.replace(/FromIndex$/,""),s=t!==i,o=wf.includes(i);if(i in(s?IDBIndex:IDBObjectStore).prototype&&(o||_f.includes(i))){var n=async function(e,...t){var n=this.transaction(e,o?"readwrite":"readonly");let r=n.store;return s&&(r=r.index(t.shift())),(await Promise.all([r[i](...t),o&&n.done]))[0]};return bf.set(t,n),n}}}df={...Wh=df,get:(e,t,n)=>If(e,t)||Wh.get(e,t,n),has:(e,t)=>!!If(e,t)||Wh.has(e,t)};class Tf{constructor(e){this.container=e}getPlatformInfoString(){const e=this.container.getProviders();return e.map(e=>{if("VERSION"!==(null==(t=e.getComponent())?void 0:t.type))return null;var t,t=e.getImmediate();return`${t.library}/${t.version}`}).filter(e=>e).join(" ")}}const Ef="@firebase/app",Sf=new nf("@firebase/app");var kf;const Cf="[DEFAULT]",Af={"@firebase/app":"fire-core","@firebase/app-compat":"fire-core-compat","@firebase/analytics":"fire-analytics","@firebase/analytics-compat":"fire-analytics-compat","@firebase/app-check":"fire-app-check","@firebase/app-check-compat":"fire-app-check-compat","@firebase/auth":"fire-auth","@firebase/auth-compat":"fire-auth-compat","@firebase/database":"fire-rtdb","@firebase/database-compat":"fire-rtdb-compat","@firebase/functions":"fire-fn","@firebase/functions-compat":"fire-fn-compat","@firebase/installations":"fire-iid","@firebase/installations-compat":"fire-iid-compat","@firebase/messaging":"fire-fcm","@firebase/messaging-compat":"fire-fcm-compat","@firebase/performance":"fire-perf","@firebase/performance-compat":"fire-perf-compat","@firebase/remote-config":"fire-rc","@firebase/remote-config-compat":"fire-rc-compat","@firebase/storage":"fire-gcs","@firebase/storage-compat":"fire-gcs-compat","@firebase/firestore":"fire-fst","@firebase/firestore-compat":"fire-fst-compat","fire-js":"fire-js",firebase:"fire-js-all"},Nf=new Map,xf=new Map;function Rf(t,n){try{t.container.addComponent(n)}catch(e){Sf.debug(`Component ${n.name} failed to register with FirebaseApp ${t.name}`,e)}}function Pf(e,t){e.container.addOrOverwriteComponent(t)}function Df(e){var t=e.name;if(xf.has(t))return Sf.debug(`There were multiple attempts to register component ${t}.`),!1;xf.set(t,e);for(const n of Nf.values())Rf(n,e);return!0}function Of(e,t){const n=e.container.getProvider("heartbeat").getImmediate({optional:!0});return n&&n.triggerHeartbeat(),e.container.getProvider(t)}const Mf=new vd("app","Firebase",{"no-app":"No Firebase App '{$appName}' has been created - call Firebase App.initializeApp()","bad-app-name":"Illegal App name: '{$appName}","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","storage-open":"Error thrown when opening storage. Original error: {$originalErrorMessage}.","storage-get":"Error thrown when reading from storage. Original error: {$originalErrorMessage}.","storage-set":"Error thrown when writing to storage. Original error: {$originalErrorMessage}.","storage-delete":"Error thrown when deleting from storage. Original error: {$originalErrorMessage}."});class Lf{constructor(e,t,n){this._isDeleted=!1,this._options=Object.assign({},e),this._config=Object.assign({},t),this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=n,this.container.addComponent(new Gd("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw Mf.create("app-deleted",{appName:this._name})}}const Ff="9.9.1";function Uf(e,t={}){if("object"!=typeof t){const r=t;t={name:r}}var n=Object.assign({name:Cf,automaticDataCollectionEnabled:!1},t);const r=n.name;if("string"!=typeof r||!r)throw Mf.create("bad-app-name",{appName:String(r)});var i=Nf.get(r);if(i){if(kd(e,i.options)&&kd(n,i.config))return i;throw Mf.create("duplicate-app",{appName:r})}const s=new Yd(r);for(const o of xf.values())s.addComponent(o);n=new Lf(e,n,s);return Nf.set(r,n),n}function Vf(e=Cf){var t=Nf.get(e);if(!t)throw Mf.create("no-app",{appName:e});return t}async function jf(e){var t=e.name;Nf.has(t)&&(Nf.delete(t),await Promise.all(e.container.getProviders().map(e=>e.delete())),e.isDeleted=!0)}function qf(e,t,n){let r=null!==(s=Af[e])&&void 0!==s?s:e;n&&(r+=`-${n}`);var i=r.match(/\s|\//),s=t.match(/\s|\//);if(i||s){const o=[`Unable to register library "${r}" with version "${t}":`];return i&&o.push(`library name "${r}" contains illegal characters (whitespace or "/")`),i&&s&&o.push("and"),s&&o.push(`version name "${t}" contains illegal characters (whitespace or "/")`),void Sf.warn(o.join(" "))}Df(new Gd(`${r}-version`,()=>({library:r,version:t}),"VERSION"))}function Bf(e,t){if(null!==e&&"function"!=typeof e)throw Mf.create("invalid-log-argument");!function(s,e){for(const t of Jd){let i=null;e&&e.level&&(i=Xd[e.level]),t.userLogHandler=null===s?null:(e,t,...n)=>{var r=n.map(e=>{if(null==e)return null;if("string"==typeof e)return e;if("number"==typeof e||"boolean"==typeof e)return e.toString();if(e instanceof Error)return e.message;try{return JSON.stringify(e)}catch(e){return null}}).filter(e=>e).join(" ");t>=(null!==i&&void 0!==i?i:e.logLevel)&&s({level:$h[t].toLowerCase(),message:r,args:n,type:e.name})}}}(e,t)}function Kf(e){var t;t=e,Jd.forEach(e=>{e.setLogLevel(t)})}const $f="firebase-heartbeat-database",zf=1,Wf="firebase-heartbeat-store";let Gf=null;function Hf(){return Gf=Gf||vf($f,zf,{upgrade:(e,t)=>{0===t&&e.createObjectStore(Wf)}}).catch(e=>{throw Mf.create("storage-open",{originalErrorMessage:e.message})}),Gf}async function Qf(e,t){try{const n=await Hf(),r=n.transaction(Wf,"readwrite"),i=r.objectStore(Wf);return await i.put(t,Yf(e)),r.done}catch(e){throw Mf.create("storage-set",{originalErrorMessage:null===e||void 0===e?void 0:e.message})}}function Yf(e){return`${e.name}!${e.options.appId}`}class Jf{constructor(e){this.container=e,this._heartbeatsCache=null;var t=this.container.getProvider("app").getImmediate();this._storage=new Zf(t),this._heartbeatsCachePromise=this._storage.read().then(e=>this._heartbeatsCache=e)}async triggerHeartbeat(){const e=this.container.getProvider("platform-logger").getImmediate();var t=e.getPlatformInfoString();const n=Xf();if(null===this._heartbeatsCache&&(this._heartbeatsCache=await this._heartbeatsCachePromise),this._heartbeatsCache.lastSentHeartbeatDate!==n&&!this._heartbeatsCache.heartbeats.some(e=>e.date===n))return this._heartbeatsCache.heartbeats.push({date:n,agent:t}),this._heartbeatsCache.heartbeats=this._heartbeatsCache.heartbeats.filter(e=>{var t=new Date(e.date).valueOf();return Date.now()-t<=2592e6}),this._storage.overwrite(this._heartbeatsCache)}async getHeartbeatsHeader(){if(null===this._heartbeatsCache&&await this._heartbeatsCachePromise,null===this._heartbeatsCache||0===this._heartbeatsCache.heartbeats.length)return"";var e=Xf(),{heartbeatsToSend:t,unsentEntries:n}=function(e,t=1024){const n=[];let r=e.slice();for(const i of e){const s=n.find(e=>e.agent===i.agent);if(s){if(s.dates.push(i.date),ep(n)>t){s.dates.pop();break}}else if(n.push({agent:i.agent,dates:[i.date]}),ep(n)>t){n.pop();break}r=r.slice(1)}return{heartbeatsToSend:n,unsentEntries:r}}(this._heartbeatsCache.heartbeats),t=td(JSON.stringify({version:2,heartbeats:t}));return this._heartbeatsCache.lastSentHeartbeatDate=e,0<n.length?(this._heartbeatsCache.heartbeats=n,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),t}}function Xf(){const e=new Date;return e.toISOString().substring(0,10)}class Zf{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return!!fd()&&pd().then(()=>!0).catch(()=>!1)}async read(){return await this._canUseIndexedDBPromise&&await async function(e){try{const t=await Hf();return t.transaction(Wf).objectStore(Wf).get(Yf(e))}catch(e){throw Mf.create("storage-get",{originalErrorMessage:null===e||void 0===e?void 0:e.message})}}(this.app)||{heartbeats:[]}}async overwrite(e){var t;if(await this._canUseIndexedDBPromise){var n=await this.read();return Qf(this.app,{lastSentHeartbeatDate:null!==(t=e.lastSentHeartbeatDate)&&void 0!==t?t:n.lastSentHeartbeatDate,heartbeats:e.heartbeats})}}async add(e){var t;if(await this._canUseIndexedDBPromise){var n=await this.read();return Qf(this.app,{lastSentHeartbeatDate:null!==(t=e.lastSentHeartbeatDate)&&void 0!==t?t:n.lastSentHeartbeatDate,heartbeats:[...n.heartbeats,...e.heartbeats]})}}}function ep(e){return td(JSON.stringify({version:2,heartbeats:e})).length}kf="",Df(new Gd("platform-logger",e=>new Tf(e),"PRIVATE")),Df(new Gd("heartbeat",e=>new Jf(e),"PRIVATE")),qf(Ef,"0.7.29",kf),qf(Ef,"0.7.29","esm2017"),qf("fire-js","");var tp=Object.freeze({__proto__:null,SDK_VERSION:Ff,_DEFAULT_ENTRY_NAME:Cf,_addComponent:Rf,_addOrOverwriteComponent:Pf,_apps:Nf,_clearComponents:function(){xf.clear()},_components:xf,_getProvider:Of,_registerComponent:Df,_removeServiceInstance:function(e,t,n=Cf){Of(e,t).clearInstance(n)},deleteApp:jf,getApp:Vf,getApps:function(){return Array.from(Nf.values())},initializeApp:Uf,onLog:Bf,registerVersion:qf,setLogLevel:Kf,FirebaseError:md});class np{constructor(e,t){this._delegate=e,this.firebase=t,Rf(e,new Gd("app-compat",()=>this,"PUBLIC")),this.container=e.container}get automaticDataCollectionEnabled(){return this._delegate.automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this._delegate.automaticDataCollectionEnabled=e}get name(){return this._delegate.name}get options(){return this._delegate.options}delete(){return new Promise(e=>{this._delegate.checkDestroyed(),e()}).then(()=>(this.firebase.INTERNAL.removeApp(this.name),jf(this._delegate)))}_getService(e,t=Cf){var n;this._delegate.checkDestroyed();const r=this._delegate.container.getProvider(e);return r.isInitialized()||"EXPLICIT"!==(null===(n=r.getComponent())||void 0===n?void 0:n.instantiationMode)||r.initialize(),r.getImmediate({identifier:t})}_removeServiceInstance(e,t=Cf){this._delegate.container.getProvider(e).clearInstance(t)}_addComponent(e){Rf(this._delegate,e)}_addOrOverwriteComponent(e){Pf(this._delegate,e)}toJSON(){return{name:this.name,automaticDataCollectionEnabled:this.automaticDataCollectionEnabled,options:this.options}}}const rp=new vd("app-compat","Firebase",{"no-app":"No Firebase App '{$appName}' has been created - call Firebase App.initializeApp()","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance."});function ip(i){const s={},o={__esModule:!0,initializeApp:function(e,t={}){var n=Uf(e,t);if(Id(s,n.name))return s[n.name];var r=new i(n,o);return s[n.name]=r},app:a,registerVersion:qf,setLogLevel:Kf,onLog:Bf,apps:null,SDK_VERSION:Ff,INTERNAL:{registerComponent:function(n){const r=n.name,t=r.replace("-compat","");{var e;Df(n)&&"PUBLIC"===n.type&&(e=(e=a())=>{if("function"!=typeof e[t])throw rp.create("invalid-app-argument",{appName:r});return e[t]()},void 0!==n.serviceProps&&rd(e,n.serviceProps),o[t]=e,i.prototype[t]=function(...e){const t=this._getService.bind(this,r);return t.apply(this,n.multipleInstances?e:[])})}return"PUBLIC"===n.type?o[t]:null},removeApp:function(e){delete s[e]},useAsService:function(e,t){if("serverAuth"===t)return null;var n=t;return n},modularAPIs:tp}};function a(e){if(e=e||Cf,!Id(s,e))throw rp.create("no-app",{appName:e});return s[e]}return o.default=o,Object.defineProperty(o,"apps",{get:function(){return Object.keys(s).map(e=>s[e])}}),a.App=i,o}l=function e(){const t=ip(np);return t.INTERNAL=Object.assign(Object.assign({},t.INTERNAL),{createFirebaseNamespace:e,extendNamespace:function(e){rd(t,e)},createSubscribe:Pd,ErrorFactory:vd,deepExtend:rd}),t}();const sp=new nf("@firebase/app-compat");if("object"==typeof self&&self.self===self&&void 0!==self.firebase){sp.warn(`
    Warning: Firebase is already defined in the global scope. Please make sure
    Firebase library is only loaded once.
  `);const T$=self.firebase.SDK_VERSION;T$&&0<=T$.indexOf("LITE")&&sp.warn(`
    Warning: You are trying to load Firebase while using Firebase Performance standalone script.
    You should load Firebase Performance with this instance of Firebase to avoid loading duplicate code.
    `)}const op=l;qf("@firebase/app-compat","0.1.30",void 0);op.registerVersion("firebase","9.9.1","app-compat");We="@firebase/installations",c="0.5.12";const ap=1e4,cp=`w:${c}`,lp="FIS_v2",up="https://firebaseinstallations.googleapis.com/v1",hp=36e5;const dp=new vd("installations","Installations",{"missing-app-config-values":'Missing App configuration value: "{$valueName}"',"not-registered":"Firebase Installation is not registered.","installation-not-found":"Firebase Installation not found.","request-failed":'{$requestName} request failed with error "{$serverCode} {$serverStatus}: {$serverMessage}"',"app-offline":"Could not process request. Application offline.","delete-pending-registration":"Can't delete installation while there is a pending registration request."});function fp(e){return e instanceof md&&e.code.includes("request-failed")}function pp({projectId:e}){return`${up}/projects/${e}/installations`}function gp(e){return{token:e.token,requestStatus:2,expiresIn:(e=e.expiresIn,Number(e.replace("s","000"))),creationTime:Date.now()}}async function mp(e,t){var n=(await t.json()).error;return dp.create("request-failed",{requestName:e,serverCode:n.code,serverMessage:n.message,serverStatus:n.status})}function vp({apiKey:e}){return new Headers({"Content-Type":"application/json",Accept:"application/json","x-goog-api-key":e})}function yp(e,{refreshToken:t}){const n=vp(e);return n.append("Authorization",(t=t,`${lp} ${t}`)),n}async function _p(e){var t=await e();return 500<=t.status&&t.status<600?e():t}function wp(t){return new Promise(e=>{setTimeout(e,t)})}const bp=/^[cdef][\w-]{21}$/,Ip="";function Tp(){try{const t=new Uint8Array(17),n=self.crypto||self.msCrypto;n.getRandomValues(t),t[0]=112+t[0]%16;var e=function(e){const t=function(e){const t=btoa(String.fromCharCode(...e));return t.replace(/\+/g,"-").replace(/\//g,"_")}(e);return t.substr(0,22)}(t);return bp.test(e)?e:Ip}catch(e){return Ip}}function Ep(e){return`${e.appName}!${e.appId}`}const Sp=new Map;function kp(e,t){var n=Ep(e);Cp(n,t),function(e,t){const n=function(){!Ap&&"BroadcastChannel"in self&&(Ap=new BroadcastChannel("[Firebase] FID Change"),Ap.onmessage=e=>{Cp(e.data.key,e.data.fid)});return Ap}();n&&n.postMessage({key:e,fid:t});0===Sp.size&&Ap&&(Ap.close(),Ap=null)}(n,t)}function Cp(e,t){var n=Sp.get(e);if(n)for(const r of n)r(t)}let Ap=null;const Np="firebase-installations-store";let xp=null;function Rp(){return xp=xp||vf("firebase-installations-database",1,{upgrade:(e,t)=>{0===t&&e.createObjectStore(Np)}}),xp}async function Pp(e,t){var n=Ep(e);const r=await Rp(),i=r.transaction(Np,"readwrite"),s=i.objectStore(Np);var o=await s.get(n);return await s.put(t,n),await i.done,o&&o.fid===t.fid||kp(e,t.fid),t}async function Dp(e){var t=Ep(e);const n=await Rp(),r=n.transaction(Np,"readwrite");await r.objectStore(Np).delete(t),await r.done}async function Op(e,t){var n=Ep(e);const r=await Rp(),i=r.transaction(Np,"readwrite"),s=i.objectStore(Np);var o=await s.get(n),a=t(o);return void 0===a?await s.delete(n):await s.put(a,n),await i.done,!a||o&&o.fid===a.fid||kp(e,a.fid),a}async function Mp(n){let r;var e=await Op(n.appConfig,e=>{var t=Fp(e||{fid:Tp(),registrationStatus:0}),t=function(e,t){{if(0!==t.registrationStatus)return 1===t.registrationStatus?{installationEntry:t,registrationPromise:async function(e){let t=await Lp(e.appConfig);for(;1===t.registrationStatus;)await wp(100),t=await Lp(e.appConfig);if(0!==t.registrationStatus)return t;{var{installationEntry:n,registrationPromise:r}=await Mp(e);return r||n}}(e)}:{installationEntry:t};if(!navigator.onLine){var n=Promise.reject(dp.create("app-offline"));return{installationEntry:t,registrationPromise:n}}var r={fid:t.fid,registrationStatus:1,registrationTime:Date.now()},n=async function(t,n){try{var e=await async function({appConfig:e,heartbeatServiceProvider:t},{fid:n}){const r=pp(e),i=vp(e),s=t.getImmediate({optional:!0});!s||(o=await s.getHeartbeatsHeader())&&i.append("x-firebase-client",o);var o={fid:n,authVersion:lp,appId:e.appId,sdkVersion:cp};const a={method:"POST",headers:i,body:JSON.stringify(o)},c=await _p(()=>fetch(r,a));if(c.ok){o=await c.json();return{fid:o.fid||n,registrationStatus:2,refreshToken:o.refreshToken,authToken:gp(o.authToken)}}throw await mp("Create Installation",c)}(t,n);return Pp(t.appConfig,e)}catch(e){throw fp(e)&&409===e.customData.serverCode?await Dp(t.appConfig):await Pp(t.appConfig,{fid:n.fid,registrationStatus:0}),e}}(e,r);return{installationEntry:r,registrationPromise:n}}}(n,t);return r=t.registrationPromise,t.installationEntry});return e.fid===Ip?{installationEntry:await r}:{installationEntry:e,registrationPromise:r}}function Lp(e){return Op(e,e=>{if(!e)throw dp.create("installation-not-found");return Fp(e)})}function Fp(e){return 1===(t=e).registrationStatus&&t.registrationTime+ap<Date.now()?{fid:e.fid,registrationStatus:0}:e;var t}async function Up({appConfig:e,heartbeatServiceProvider:t},n){const r=([i,s]=[e,n["fid"]],`${pp(i)}/${s}/authTokens:generate`);var i,s;const o=yp(e,n),a=t.getImmediate({optional:!0});!a||(c=await a.getHeartbeatsHeader())&&o.append("x-firebase-client",c);var c={installation:{sdkVersion:cp,appId:e.appId}};const l={method:"POST",headers:o,body:JSON.stringify(c)},u=await _p(()=>fetch(r,l));if(u.ok)return gp(await u.json());throw await mp("Generate Auth Token",u)}async function Vp(r,i=!1){let s;var e=await Op(r.appConfig,e=>{if(!qp(e))throw dp.create("not-registered");var t,n=e.authToken;if(i||2!==(t=n).requestStatus||function(e){var t=Date.now();return t<e.creationTime||e.creationTime+e.expiresIn<t+hp}(t)){if(1===n.requestStatus)return s=async function(e,t){let n=await jp(e.appConfig);for(;1===n.authToken.requestStatus;)await wp(100),n=await jp(e.appConfig);var r=n.authToken;return 0===r.requestStatus?Vp(e,t):r}(r,i),e;if(!navigator.onLine)throw dp.create("app-offline");n=(t=e,n={requestStatus:1,requestTime:Date.now()},Object.assign(Object.assign({},t),{authToken:n}));return s=async function(t,n){try{var r=await Up(t,n),e=Object.assign(Object.assign({},n),{authToken:r});return await Pp(t.appConfig,e),r}catch(e){throw!fp(e)||401!==e.customData.serverCode&&404!==e.customData.serverCode?(r=Object.assign(Object.assign({},n),{authToken:{requestStatus:0}}),await Pp(t.appConfig,r)):await Dp(t.appConfig),e}}(r,n),n}return e});return s?await s:e.authToken}function jp(e){return Op(e,e=>{if(!qp(e))throw dp.create("not-registered");var t,n=e.authToken;return 1===(t=n).requestStatus&&t.requestTime+ap<Date.now()?Object.assign(Object.assign({},e),{authToken:{requestStatus:0}}):e})}function qp(e){return void 0!==e&&2===e.registrationStatus}async function Bp(e,t=!1){var n,r=e;return await((n=(await Mp(r)).registrationPromise)&&await n),(await Vp(r,t)).token}function Kp(e){return dp.create("missing-app-config-values",{valueName:e})}const $p="installations",zp=e=>{var t=e.getProvider("app").getImmediate();return{app:t,appConfig:function(e){if(!e||!e.options)throw Kp("App Configuration");if(!e.name)throw Kp("App Name");for(const t of["projectId","apiKey","appId"])if(!e.options[t])throw Kp(t);return{appName:e.name,projectId:e.options.projectId,apiKey:e.options.apiKey,appId:e.options.appId}}(t),heartbeatServiceProvider:Of(t,"heartbeat"),_delete:()=>Promise.resolve()}},Wp=e=>{const t=Of(e.getProvider("app").getImmediate(),$p).getImmediate();return{getId:()=>async function(e){var t=e;const{installationEntry:n,registrationPromise:r}=await Mp(t);return(r||Vp(t)).catch(console.error),n.fid}(t),getToken:e=>Bp(t,e)}};Df(new Gd($p,zp,"PUBLIC")),Df(new Gd("installations-internal",Wp,"PRIVATE")),qf(We,c),qf(We,c,"esm2017");const Gp="analytics",Hp="firebase_id",Qp="origin",Yp="https://firebase.googleapis.com/v1alpha/projects/-/apps/{app-id}/webConfig",Jp="https://www.googletagmanager.com/gtag/js",Xp=new nf("@firebase/analytics");function Zp(e){return Promise.all(e.map(e=>e.catch(e=>e)))}function eg(r,i,s,o){return async function(e,t,n){try{"event"===e?await async function(e,n,r,i,s){try{let t=[];if(s&&s.send_to){let e=s.send_to;Array.isArray(e)||(e=[e]);const c=await Zp(r);for(const l of e){var o=c.find(e=>e.measurementId===l),a=o&&n[o.appId];if(!a){t=[];break}t.push(a)}}0===t.length&&(t=Object.values(n)),await Promise.all(t),e("event",i,s||{})}catch(e){Xp.error(e)}}(r,i,s,t,n):"config"===e?await async function(e,t,n,r,i,s){var o=r[i];try{if(o)await t[o];else{const c=await Zp(n);var a=c.find(e=>e.measurementId===i);a&&await t[a.appId]}}catch(e){Xp.error(e)}e("config",i,s)}(r,i,s,o,t,n):"consent"===e?r("consent","update",n):r("set",t)}catch(e){Xp.error(e)}}}const tg=new vd("analytics","Analytics",{"already-exists":"A Firebase Analytics instance with the appId {$id}  already exists. Only one Firebase Analytics instance can be created for each appId.","already-initialized":"initializeAnalytics() cannot be called again with different options than those it was initially called with. It can be called again with the same options to return the existing instance, or getAnalytics() can be used to get a reference to the already-intialized instance.","already-initialized-settings":"Firebase Analytics has already been initialized.settings() must be called before initializing any Analytics instanceor it will have no effect.","interop-component-reg-failed":"Firebase Analytics Interop Component failed to instantiate: {$reason}","invalid-analytics-context":"Firebase Analytics is not supported in this environment. Wrap initialization of analytics in analytics.isSupported() to prevent initialization in unsupported environments. Details: {$errorInfo}","indexeddb-unavailable":"IndexedDB unavailable or restricted in this environment. Wrap initialization of analytics in analytics.isSupported() to prevent initialization in unsupported environments. Details: {$errorInfo}","fetch-throttle":"The config fetch request timed out while in an exponential backoff state. Unix timestamp in milliseconds when fetch request throttling ends: {$throttleEndTimeMillis}.","config-fetch-failed":"Dynamic config fetch failed: [{$httpStatus}] {$responseMessage}","no-api-key":'The "apiKey" field is empty in the local Firebase config. Firebase Analytics requires this field tocontain a valid API key.',"no-app-id":'The "appId" field is empty in the local Firebase config. Firebase Analytics requires this field tocontain a valid app ID.'}),ng=30;const rg=new class{constructor(e={},t=1e3){this.throttleMetadata=e,this.intervalMillis=t}getThrottleMetadata(e){return this.throttleMetadata[e]}setThrottleMetadata(e,t){this.throttleMetadata[e]=t}deleteThrottleMetadata(e){delete this.throttleMetadata[e]}};async function ig(e){var t,{appId:n,apiKey:r}=e,r={method:"GET",headers:new Headers({Accept:"application/json","x-goog-api-key":r})},n=Yp.replace("{app-id}",n);const i=await fetch(n,r);if(200===i.status||304===i.status)return i.json();{let e="";try{var s=await i.json();null!==(t=s.error)&&void 0!==t&&t.message&&(e=s.error.message)}catch(e){}throw tg.create("config-fetch-failed",{httpStatus:i.status,responseMessage:e})}}async function sg(e,t=rg,n){var{appId:r,apiKey:i,measurementId:s}=e.options;if(!r)throw tg.create("no-app-id");if(!i){if(s)return{measurementId:s,appId:r};throw tg.create("no-api-key")}var o=t.getThrottleMetadata(r)||{backoffCount:0,throttleEndTimeMillis:Date.now()};const a=new cg;return setTimeout(async()=>{a.abort()},void 0!==n?n:6e4),async function t(n,{throttleEndTimeMillis:e,backoffCount:r},i,s=rg){var o;const{appId:a,measurementId:c}=n;try{await og(i,e)}catch(e){if(c)return Xp.warn("Timed out fetching this Firebase app's measurement ID from the server."+` Falling back to the measurement ID ${c}`+` provided in the "measurementId" field in the local Firebase config. [${null===(o=e)||void 0===o?void 0:o.message}]`),{appId:a,measurementId:c};throw e}try{const l=await ig(n);return s.deleteThrottleMetadata(a),l}catch(e){const u=e;if(!ag(u)){if(s.deleteThrottleMetadata(a),c)return Xp.warn("Failed to fetch this Firebase app's measurement ID from the server."+` Falling back to the measurement ID ${c}`+` provided in the "measurementId" field in the local Firebase config. [${null===u||void 0===u?void 0:u.message}]`),{appId:a,measurementId:c};throw e}const h=503===Number(null===(o=null===u||void 0===u?void 0:u.customData)||void 0===o?void 0:o.httpStatus)?zd(r,s.intervalMillis,ng):zd(r,s.intervalMillis),d={throttleEndTimeMillis:Date.now()+h,backoffCount:r+1};return s.setThrottleMetadata(a,d),Xp.debug(`Calling attemptFetch again in ${h} millis`),t(n,d,i,s)}}({appId:r,apiKey:i,measurementId:s},o,a,t)}function og(i,s){return new Promise((e,t)=>{var n=Math.max(s-Date.now(),0);const r=setTimeout(e,n);i.addEventListener(()=>{clearTimeout(r),t(tg.create("fetch-throttle",{throttleEndTimeMillis:s}))})})}function ag(e){if(!(e instanceof md&&e.customData))return!1;var t=Number(e.customData.httpStatus);return 429===t||500===t||503===t||504===t}class cg{constructor(){this.listeners=[]}addEventListener(e){this.listeners.push(e)}abort(){this.listeners.forEach(e=>e())}}async function lg(t,e,n,r,i,s,o){const a=sg(t);a.then(e=>{n[e.measurementId]=e.appId,t.options.measurementId&&e.measurementId!==t.options.measurementId&&Xp.warn(`The measurement ID in the local Firebase config (${t.options.measurementId})`+` does not match the measurement ID fetched from the server (${e.measurementId}).`+" To ensure analytics events are always sent to the correct Analytics property, update the measurement ID field in the local config or remove it from the local config.")}).catch(e=>Xp.error(e)),e.push(a);var c=async function(){if(!fd())return Xp.warn(tg.create("indexeddb-unavailable",{errorInfo:"IndexedDB is not available in this environment."}).message),!1;try{await pd()}catch(e){return Xp.warn(tg.create("indexeddb-unavailable",{errorInfo:null===e||void 0===e?void 0:e.toString()}).message),!1}return!0}().then(e=>{if(e)return r.getId()}),[l,u]=await Promise.all([a,c]);!function(){var e=window.document.getElementsByTagName("script");for(const t of Object.values(e))if(t.src&&t.src.includes(Jp))return t}()&&function(e,t){const n=document.createElement("script");n.src=`${Jp}?l=${e}&id=${t}`,n.async=!0,document.head.appendChild(n)}(s,l.measurementId),i("js",new Date);const h=null!==(c=null==o?void 0:o.config)&&void 0!==c?c:{};return h[Qp]="firebase",h.update=!0,null!=u&&(h[Hp]=u),i("config",l.measurementId,h),l.measurementId}class ug{constructor(e){this.app=e}_delete(){return delete hg[this.app.options.appId],Promise.resolve()}}let hg={},dg=[];const fg={};let pg="dataLayer",gg="gtag",mg,vg,yg=!1;function _g(e){if(yg)throw tg.create("already-initialized");e.dataLayerName&&(pg=e.dataLayerName),e.gtagName&&(gg=e.gtagName)}function wg(e,t,n){!function(){const e=[];var t;ld()&&e.push("This is a browser extension environment."),gd()||e.push("Cookies are not available."),0<e.length&&(t=e.map((e,t)=>`(${t+1}) ${e}`).join(" "),t=tg.create("invalid-analytics-context",{errorInfo:t}),Xp.warn(t.message))}();var r,i,s=e.options.appId;if(!s)throw tg.create("no-app-id");if(!e.options.apiKey){if(!e.options.measurementId)throw tg.create("no-api-key");Xp.warn('The "apiKey" field is empty in the local Firebase config. This is needed to fetch the latest'+` measurement ID for this Firebase app. Falling back to the measurement ID ${e.options.measurementId}`+' provided in the "measurementId" field in the local Firebase config.')}if(null!=hg[s])throw tg.create("already-exists",{id:s});return yg||(function(e){let t=[];Array.isArray(window[e])?t=window[e]:window[e]=t,t}(pg),{wrappedGtag:r,gtagCore:i}=function(e,t,n,r,i){let s=function(){window[r].push(arguments)};return window[i]&&"function"==typeof window[i]&&(s=window[i]),window[i]=eg(s,e,t,n),{gtagCore:s,wrappedGtag:window[i]}}(hg,dg,fg,pg,gg),vg=r,mg=i,yg=!0),hg[s]=lg(e,dg,fg,t,mg,pg,n),new ug(e)}async function bg(){if(ld())return!1;if(!gd())return!1;if(!fd())return!1;try{return await pd()}catch(e){return!1}}function Ig(e,t,n){e=Wd(e),async function(e,t,n,r){if(r&&r.global)return e("set",{screen_name:n}),Promise.resolve();e("config",await t,{update:!0,screen_name:n})}(vg,hg[e.app.options.appId],t,n).catch(e=>Xp.error(e))}function Tg(e,t,n){e=Wd(e),async function(e,t,n,r){if(r&&r.global)return e("set",{user_id:n}),Promise.resolve();e("config",await t,{update:!0,user_id:n})}(vg,hg[e.app.options.appId],t,n).catch(e=>Xp.error(e))}function Eg(e,t,n){e=Wd(e),async function(e,t,n,r){if(r&&r.global){const i={};for(const s of Object.keys(n))i[`user_properties.${s}`]=n[s];return e("set",i),Promise.resolve()}e("config",await t,{update:!0,user_properties:n})}(vg,hg[e.app.options.appId],t,n).catch(e=>Xp.error(e))}function Sg(e,t){e=Wd(e),async function(e,t){var n=await e;window[`ga-disable-${n}`]=!t}(hg[e.app.options.appId],t).catch(e=>Xp.error(e))}function kg(e,t,n,r){e=Wd(e),async function(e,t,n,r,i){var s;i&&i.global?e("event",n,r):(s=await t,e("event",n,Object.assign(Object.assign({},r),{send_to:s})))}(vg,hg[e.app.options.appId],t,n,r).catch(e=>Xp.error(e))}const Cg="@firebase/analytics";Df(new Gd(Gp,(e,{options:t})=>{return wg(e.getProvider("app").getImmediate(),e.getProvider("installations-internal").getImmediate(),t)},"PUBLIC")),Df(new Gd("analytics-internal",function(e){try{const r=e.getProvider(Gp).getImmediate();return{logEvent:(e,t,n)=>kg(r,e,t,n)}}catch(e){throw tg.create("interop-component-reg-failed",{reason:e})}},"PRIVATE")),qf(Cg,"0.8.0"),qf(Cg,"0.8.0","esm2017");var Ag,Ng;class xg{constructor(e,t){this.app=e,this._delegate=t}logEvent(e,t,n){kg(this._delegate,e,t,n)}setCurrentScreen(e,t){Ig(this._delegate,e,t)}setUserId(e,t){Tg(this._delegate,e,t)}setUserProperties(e,t){Eg(this._delegate,e,t)}setAnalyticsCollectionEnabled(e){Sg(this._delegate,e)}}(W=Ag=Ag||{}).ADD_SHIPPING_INFO="add_shipping_info",W.ADD_PAYMENT_INFO="add_payment_info",W.ADD_TO_CART="add_to_cart",W.ADD_TO_WISHLIST="add_to_wishlist",W.BEGIN_CHECKOUT="begin_checkout",W.CHECKOUT_PROGRESS="checkout_progress",W.EXCEPTION="exception",W.GENERATE_LEAD="generate_lead",W.LOGIN="login",W.PAGE_VIEW="page_view",W.PURCHASE="purchase",W.REFUND="refund",W.REMOVE_FROM_CART="remove_from_cart",W.SCREEN_VIEW="screen_view",W.SEARCH="search",W.SELECT_CONTENT="select_content",W.SELECT_ITEM="select_item",W.SELECT_PROMOTION="select_promotion",W.SET_CHECKOUT_OPTION="set_checkout_option",W.SHARE="share",W.SIGN_UP="sign_up",W.TIMING_COMPLETE="timing_complete",W.VIEW_CART="view_cart",W.VIEW_ITEM="view_item",W.VIEW_ITEM_LIST="view_item_list",W.VIEW_PROMOTION="view_promotion",W.VIEW_SEARCH_RESULTS="view_search_results";const Rg=e=>{var t=e.getProvider("app-compat").getImmediate(),n=e.getProvider("analytics").getImmediate();return new xg(t,n)};Ng={Analytics:xg,settings:_g,isSupported:bg,EventName:Ag},op.INTERNAL.registerComponent(new Gd("analytics-compat",Rg,"PUBLIC").setServiceProps(Ng).setMultipleInstances(!0)),op.registerVersion("@firebase/analytics-compat","0.1.13");const Pg=new Map,Dg={activated:!1,tokenObservers:[]},Og={initialized:!1,enabled:!1};function Mg(e){return Pg.get(e)||Dg}function Lg(e,t){Pg.set(e,t)}const Fg="https://content-firebaseappcheck.googleapis.com/v1",Ug="exchangeDebugToken",Vg={OFFSET_DURATION:3e5,RETRIAL_MIN_WAIT:3e4,RETRIAL_MAX_WAIT:96e4};class jg{constructor(e,t,n,r,i){if(this.operation=e,this.retryPolicy=t,this.getWaitDuration=n,this.lowerBound=r,this.upperBound=i,this.pending=null,i<(this.nextErrorWaitInterval=r))throw new Error("Proactive refresh lower bound greater than upper bound!")}start(){this.nextErrorWaitInterval=this.lowerBound,this.process(!0).catch(()=>{})}stop(){this.pending&&(this.pending.reject("cancelled"),this.pending=null)}isRunning(){return!!this.pending}async process(e){this.stop();try{this.pending=new id,t=this.getNextRun(e),await new Promise(e=>{setTimeout(e,t)}),this.pending.resolve(),await this.pending.promise,this.pending=new id,await this.operation(),this.pending.resolve(),await this.pending.promise,this.process(!0).catch(()=>{})}catch(e){this.retryPolicy(e)?this.process(!1).catch(()=>{}):this.stop()}var t}getNextRun(e){if(e)return this.nextErrorWaitInterval=this.lowerBound,this.getWaitDuration();var t=this.nextErrorWaitInterval;return this.nextErrorWaitInterval*=2,this.nextErrorWaitInterval>this.upperBound&&(this.nextErrorWaitInterval=this.upperBound),t}}const qg=new vd("appCheck","AppCheck",{"already-initialized":"You have already called initializeAppCheck() for FirebaseApp {$appName} with different options. To avoid this error, call initializeAppCheck() with the same options as when it was originally called. This will return the already initialized instance.","use-before-activation":"App Check is being used before initializeAppCheck() is called for FirebaseApp {$appName}. Call initializeAppCheck() before instantiating other Firebase services.","fetch-network-error":"Fetch failed to connect to a network. Check Internet connection. Original error: {$originalErrorMessage}.","fetch-parse-error":"Fetch client could not parse response. Original error: {$originalErrorMessage}.","fetch-status-error":"Fetch server returned an HTTP error status. HTTP status: {$httpStatus}.","storage-open":"Error thrown when opening storage. Original error: {$originalErrorMessage}.","storage-get":"Error thrown when reading from storage. Original error: {$originalErrorMessage}.","storage-set":"Error thrown when writing to storage. Original error: {$originalErrorMessage}.","recaptcha-error":"ReCAPTCHA error.",throttled:"Requests throttled due to {$httpStatus} error. Attempts allowed again after {$time}"});function Bg(e=!1){var t;return e?null===(t=self.grecaptcha)||void 0===t?void 0:t.enterprise:self.grecaptcha}function Kg(e){if(!Mg(e).activated)throw qg.create("use-before-activation",{appName:e.name})}function $g(e){var t=Math.round(e/1e3),n=Math.floor(t/86400),r=Math.floor((t-3600*n*24)/3600),i=Math.floor((t-3600*n*24-3600*r)/60),t=t-3600*n*24-3600*r-60*i;let s="";return n&&(s+=zg(n)+"d:"),r&&(s+=zg(r)+"h:"),s+=zg(i)+"m:"+zg(t)+"s",s}function zg(e){return 0===e?"00":10<=e?e.toString():"0"+e}async function Wg({url:e,body:t},n){const r={"Content-Type":"application/json"},i=n.getImmediate({optional:!0});!i||(c=await i.getHeartbeatsHeader())&&(r["X-Firebase-Client"]=c);var s={method:"POST",body:JSON.stringify(t),headers:r};let o;try{o=await fetch(e,s)}catch(e){throw qg.create("fetch-network-error",{originalErrorMessage:null===e||void 0===e?void 0:e.message})}if(200!==o.status)throw qg.create("fetch-status-error",{httpStatus:o.status});let a;try{a=await o.json()}catch(e){throw qg.create("fetch-parse-error",{originalErrorMessage:null===e||void 0===e?void 0:e.message})}var c=a.ttl.match(/^([\d.]+)(s)$/);if(!c||!c[2]||isNaN(Number(c[1])))throw qg.create("fetch-parse-error",{originalErrorMessage:"ttl field (timeToLive) is not in standard Protobuf Duration "+`format: ${a.ttl}`});s=1e3*Number(c[1]),c=Date.now();return{token:a.token,expireTimeMillis:c+s,issuedAtTimeMillis:c}}const Gg="firebase-app-check-database",Hg=1,Qg="firebase-app-check-store",Yg="debug-token";let Jg=null;function Xg(){return Jg||(Jg=new Promise((t,n)=>{try{const e=indexedDB.open(Gg,Hg);e.onsuccess=e=>{t(e.target.result)},e.onerror=e=>{var t;n(qg.create("storage-open",{originalErrorMessage:null===(t=e.target.error)||void 0===t?void 0:t.message}))},e.onupgradeneeded=e=>{const t=e.target.result;0===e.oldVersion&&t.createObjectStore(Qg,{keyPath:"compositeKey"})}}catch(e){n(qg.create("storage-open",{originalErrorMessage:null===e||void 0===e?void 0:e.message}))}}),Jg)}async function Zg(e,t){const n=await Xg(),r=n.transaction(Qg,"readwrite"),i=r.objectStore(Qg),s=i.put({compositeKey:e,value:t});return new Promise((t,n)=>{s.onsuccess=e=>{t()},r.onerror=e=>{var t;n(qg.create("storage-set",{originalErrorMessage:null===(t=e.target.error)||void 0===t?void 0:t.message}))}})}async function em(e){const t=await Xg(),i=t.transaction(Qg,"readonly"),n=i.objectStore(Qg),s=n.get(e);return new Promise((n,r)=>{s.onsuccess=e=>{var t=e.target.result;n(t?t.value:void 0)},i.onerror=e=>{var t;r(qg.create("storage-get",{originalErrorMessage:null===(t=e.target.error)||void 0===t?void 0:t.message}))}})}function tm(e){return`${e.options.appId}-${e.name}`}const nm=new nf("@firebase/app-check");async function rm(t){if(fd()){let e=void 0;try{e=await em(tm(t))}catch(e){nm.warn(`Failed to read token from IndexedDB. Error: ${e}`)}return e}}function im(e,t){return fd()?Zg(tm(e),t).catch(e=>{nm.warn(`Failed to write token to IndexedDB. Error: ${e}`)}):Promise.resolve()}async function sm(){let e=void 0;try{e=await em(Yg)}catch(e){}if(e)return e;var t,n=Vd();return t=n,Zg(Yg,t).catch(e=>nm.warn(`Failed to persist debug token to IndexedDB. Error: ${e}`)),n}function om(){return Og.enabled}async function am(){var e=Og;if(e.enabled&&e.token)return e.token.promise;throw Error(`
            Can't get debug token in production mode.
        `)}function cm(){var e=function(){if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if("undefined"!=typeof global)return global;throw new Error("Unable to locate global object.")}();const t=Og;if(t.initialized=!0,"string"==typeof e.FIREBASE_APPCHECK_DEBUG_TOKEN||!0===e.FIREBASE_APPCHECK_DEBUG_TOKEN){t.enabled=!0;const n=new id;t.token=n,"string"==typeof e.FIREBASE_APPCHECK_DEBUG_TOKEN?n.resolve(e.FIREBASE_APPCHECK_DEBUG_TOKEN):n.resolve(sm())}}const lm={error:"UNKNOWN_ERROR"};async function um(e,t=!1){var n=e.app;Kg(n);const r=Mg(n);let i=r.token,s=void 0;if(i||(a=await r.cachedTokenPromise)&&gm(a)&&(i=a),!t&&i&&gm(i))return{token:i.token};let o=!1;if(om()){r.exchangeTokenPromise||(r.exchangeTokenPromise=Wg(function(e,t){var{projectId:n,appId:r,apiKey:i}=e.options;return{url:`${Fg}/projects/${n}/apps/${r}:${Ug}?key=${i}`,body:{debug_token:t}}}(n,await am()),e.heartbeatServiceProvider).then(e=>(r.exchangeTokenPromise=void 0,e)),o=!0);var a=await r.exchangeTokenPromise;return await im(n,a),Lg(n,Object.assign(Object.assign({},r),{token:a})),{token:a.token}}try{r.exchangeTokenPromise||(r.exchangeTokenPromise=r.provider.getToken().then(e=>(r.exchangeTokenPromise=void 0,e)),o=!0),i=await r.exchangeTokenPromise}catch(e){"appCheck/throttled"===e.code?nm.warn(e.message):nm.error(e),s=e}let c;return i?(c={token:i.token},Lg(n,Object.assign(Object.assign({},r),{token:i})),await im(n,i)):c=(e=s,{token:function(e){return ed.encodeString(JSON.stringify(e),!1)}(lm),error:e}),o&&pm(n,c),c}function hm(e,t,n,r){var i=e["app"];const s=Mg(i);var o={next:n,error:r,type:t};if(Lg(i,Object.assign(Object.assign({},s),{tokenObservers:[...s.tokenObservers,o]})),s.token&&gm(s.token)){const a=s.token;Promise.resolve().then(()=>{n({token:a.token}),fm(e)}).catch(()=>{})}s.cachedTokenPromise.then(()=>fm(e))}function dm(e,t){const n=Mg(e);var r=n.tokenObservers.filter(e=>e.next!==t);0===r.length&&n.tokenRefresher&&n.tokenRefresher.isRunning()&&n.tokenRefresher.stop(),Lg(e,Object.assign(Object.assign({},n),{tokenObservers:r}))}function fm(e){var t=e["app"],n=Mg(t);let r=n.tokenRefresher;r||(r=function(n){const r=n["app"];return new jg(async()=>{var e=Mg(r);let t;if(t=e.token?await um(n,!0):await um(n),t.error)throw t.error},()=>!0,()=>{var e=Mg(r);if(e.token){var t=e.token.issuedAtTimeMillis+.5*(e.token.expireTimeMillis-e.token.issuedAtTimeMillis)+3e5,e=e.token.expireTimeMillis-3e5,t=Math.min(t,e);return Math.max(0,t-Date.now())}return 0},Vg.RETRIAL_MIN_WAIT,Vg.RETRIAL_MAX_WAIT)}(e),Lg(t,Object.assign(Object.assign({},n),{tokenRefresher:r}))),!r.isRunning()&&n.isTokenAutoRefreshEnabled&&r.start()}function pm(e,t){for(const n of Mg(e).tokenObservers)try{"EXTERNAL"===n.type&&null!=t.error?n.error(t.error):n.next(t)}catch(e){}}function gm(e){return 0<e.expireTimeMillis-Date.now()}class mm{constructor(e,t){this.app=e,this.heartbeatServiceProvider=t}_delete(){var e=Mg(this.app)["tokenObservers"];for(const t of e)dm(this.app,t.next);return Promise.resolve()}}const vm="https://www.google.com/recaptcha/api.js",ym="https://www.google.com/recaptcha/enterprise.js";function _m(t,n){var e=Mg(t);const r=new id;Lg(t,Object.assign(Object.assign({},e),{reCAPTCHAState:{initialized:r}}));const i=Im(t);e=Bg(!1);return e?bm(t,n,e,i,r):function(e){const t=document.createElement("script");t.src=vm,t.onload=e,document.head.appendChild(t)}(()=>{var e=Bg(!1);if(!e)throw new Error("no recaptcha");bm(t,n,e,i,r)}),r.promise}function wm(t,n){var e=Mg(t);const r=new id;Lg(t,Object.assign(Object.assign({},e),{reCAPTCHAState:{initialized:r}}));const i=Im(t);e=Bg(!0);return e?bm(t,n,e,i,r):function(e){const t=document.createElement("script");t.src=ym,t.onload=e,document.head.appendChild(t)}(()=>{var e=Bg(!0);if(!e)throw new Error("no recaptcha");bm(t,n,e,i,r)}),r.promise}function bm(r,i,s,o,a){s.ready(()=>{var e,t,n;e=r,t=s.render(o,{sitekey:i,size:"invisible"}),n=Mg(e),Lg(e,Object.assign(Object.assign({},n),{reCAPTCHAState:Object.assign(Object.assign({},n.reCAPTCHAState),{widgetId:t})})),a.resolve(s)})}function Im(e){var t=`fire_app_check_${e.name}`;const n=document.createElement("div");return n.id=t,n.style.display="none",document.body.appendChild(n),t}async function Tm(r){Kg(r);const i=await Mg(r).reCAPTCHAState.initialized.promise;return new Promise((e,t)=>{const n=Mg(r).reCAPTCHAState;i.ready(()=>{e(i.execute(n.widgetId,{action:"fire_app_check"}))})})}class Em{constructor(e){this._siteKey=e,this._throttleData=null}async getToken(){Am(this._throttleData);var t=await Tm(this._app).catch(e=>{throw qg.create("recaptcha-error")});let e;try{e=await Wg(function(e,t){var{projectId:n,appId:r,apiKey:i}=e.options;return{url:`${Fg}/projects/${n}/apps/${r}:exchangeRecaptchaV3Token?key=${i}`,body:{recaptcha_v3_token:t}}}(this._app,t),this._heartbeatServiceProvider)}catch(e){throw null!==(t=e.code)&&void 0!==t&&t.includes("fetch-status-error")?(this._throttleData=Cm(Number(null===(t=e.customData)||void 0===t?void 0:t.httpStatus),this._throttleData),qg.create("throttled",{time:$g(this._throttleData.allowRequestsAfter-Date.now()),httpStatus:this._throttleData.httpStatus})):e}return this._throttleData=null,e}initialize(e){this._app=e,this._heartbeatServiceProvider=Of(e,"heartbeat"),_m(e,this._siteKey).catch(()=>{})}isEqual(e){return e instanceof Em&&this._siteKey===e._siteKey}}class Sm{constructor(e){this._siteKey=e,this._throttleData=null}async getToken(){Am(this._throttleData);var t=await Tm(this._app).catch(e=>{throw qg.create("recaptcha-error")});let e;try{e=await Wg(function(e,t){var{projectId:n,appId:r,apiKey:i}=e.options;return{url:`${Fg}/projects/${n}/apps/${r}:exchangeRecaptchaEnterpriseToken?key=${i}`,body:{recaptcha_enterprise_token:t}}}(this._app,t),this._heartbeatServiceProvider)}catch(e){throw null!==(t=e.code)&&void 0!==t&&t.includes("fetch-status-error")?(this._throttleData=Cm(Number(null===(t=e.customData)||void 0===t?void 0:t.httpStatus),this._throttleData),qg.create("throttled",{time:$g(this._throttleData.allowRequestsAfter-Date.now()),httpStatus:this._throttleData.httpStatus})):e}return this._throttleData=null,e}initialize(e){this._app=e,this._heartbeatServiceProvider=Of(e,"heartbeat"),wm(e,this._siteKey).catch(()=>{})}isEqual(e){return e instanceof Sm&&this._siteKey===e._siteKey}}class km{constructor(e){this._customProviderOptions=e}async getToken(){var e=await this._customProviderOptions.getToken(),t=function(e){const t=bd(e).claims;return"object"==typeof t&&t.hasOwnProperty("iat")?t.iat:null}(e.token),t=null!==t&&t<Date.now()&&0<t?1e3*t:Date.now();return Object.assign(Object.assign({},e),{issuedAtTimeMillis:t})}initialize(e){this._app=e}isEqual(e){return e instanceof km&&this._customProviderOptions.getToken.toString()===e._customProviderOptions.getToken.toString()}}function Cm(e,t){if(404===e||403===e)return{backoffCount:1,allowRequestsAfter:Date.now()+864e5,httpStatus:e};var n=t?t.backoffCount:0,r=zd(n,1e3,2);return{backoffCount:n+1,allowRequestsAfter:Date.now()+r,httpStatus:e}}function Am(e){if(e&&Date.now()-e.allowRequestsAfter<=0)throw qg.create("throttled",{time:$g(e.allowRequestsAfter-Date.now()),httpStatus:e.httpStatus})}function Nm(e=Vf(),t){const n=Of(e=Wd(e),"app-check");if(Og.initialized||cm(),om()&&am().then(e=>console.log(`App Check debug token: ${e}. You will need to add it to your app's App Check settings in the Firebase console for it to work.`)),n.isInitialized()){var r=n.getImmediate();const i=n.getOptions();if(i.isTokenAutoRefreshEnabled===t.isTokenAutoRefreshEnabled&&i.provider.isEqual(t.provider))return r;throw qg.create("already-initialized",{appName:e.name})}r=n.initialize({options:t});return function(t,e,n){const r=Mg(t),i=Object.assign(Object.assign({},r),{activated:!0});i.provider=e,i.cachedTokenPromise=rm(t).then(e=>(e&&gm(e)&&(Lg(t,Object.assign(Object.assign({},Mg(t)),{token:e})),pm(t,{token:e.token})),e)),i.isTokenAutoRefreshEnabled=void 0===n?t.automaticDataCollectionEnabled:n,Lg(t,i),i.provider.initialize(t)}(e,t.provider,t.isTokenAutoRefreshEnabled),Mg(e).isTokenAutoRefreshEnabled&&hm(r,"INTERNAL",()=>{}),r}const xm="app-check-internal";Df(new Gd("app-check",e=>{var t,n=e.getProvider("app").getImmediate(),r=e.getProvider("heartbeat");return t=n,e=r,new mm(t,e)},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,t,n)=>{e.getProvider(xm).initialize()})),Df(new Gd(xm,e=>{var t,n=e.getProvider("app-check").getImmediate();return t=n,{getToken:e=>um(t,e),addTokenListener:e=>hm(t,"INTERNAL",e),removeTokenListener:e=>dm(t.app,e)}},"PUBLIC").setInstantiationMode("EXPLICIT")),qf("@firebase/app-check","0.5.12");const Rm=new vd("appCheck","AppCheck",{"use-before-activation":"App Check is being used before activate() is called for FirebaseApp {$appName}. Call activate() before instantiating other Firebase services."});class Pm{constructor(e){this.app=e}activate(e,t){let n;n="string"==typeof e?new Em(e):e instanceof Sm||e instanceof Em||e instanceof km?e:new km({getToken:e.getToken}),this._delegate=Nm(this.app,{provider:n,isTokenAutoRefreshEnabled:t})}setTokenAutoRefreshEnabled(e){if(!this._delegate)throw Rm.create("use-before-activation",{appName:this.app.name});!function(e,t){var n=e.app;const r=Mg(n);r.tokenRefresher&&(!0===t?r.tokenRefresher.start():r.tokenRefresher.stop()),Lg(n,Object.assign(Object.assign({},r),{isTokenAutoRefreshEnabled:t}))}(this._delegate,e)}getToken(e){if(!this._delegate)throw Rm.create("use-before-activation",{appName:this.app.name});return async function(e,t){var n=await um(e,t);if(n.error)throw n.error;return{token:n.token}}(this._delegate,e)}onTokenChanged(e,t,n){if(!this._delegate)throw Rm.create("use-before-activation",{appName:this.app.name});return function(e,t,n){let r=()=>{},i=()=>{};return r=null!=t.next?t.next.bind(t):t,null!=t.error?i=t.error.bind(t):n&&(i=n),hm(e,"EXTERNAL",r,i),()=>dm(e.app,r)}(this._delegate,e,t)}}const Dm=e=>{var t=e.getProvider("app-compat").getImmediate();return new Pm(t)};function Om(e,t){var n={};for(i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols)for(var r=0,i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]]);return n}op.INTERNAL.registerComponent(new Gd("appCheck-compat",Dm,"PUBLIC").setServiceProps({ReCaptchaEnterpriseProvider:Sm,ReCaptchaV3Provider:Em,CustomProvider:km})),op.registerVersion("@firebase/app-check-compat","0.2.12");const Mm={FACEBOOK:"facebook.com",GITHUB:"github.com",GOOGLE:"google.com",PASSWORD:"password",PHONE:"phone",TWITTER:"twitter.com"},Lm={EMAIL_SIGNIN:"EMAIL_SIGNIN",PASSWORD_RESET:"PASSWORD_RESET",RECOVER_EMAIL:"RECOVER_EMAIL",REVERT_SECOND_FACTOR_ADDITION:"REVERT_SECOND_FACTOR_ADDITION",VERIFY_AND_CHANGE_EMAIL:"VERIFY_AND_CHANGE_EMAIL",VERIFY_EMAIL:"VERIFY_EMAIL"};function Fm(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}function Um(){return{"admin-restricted-operation":"This operation is restricted to administrators only.","argument-error":"","app-not-authorized":"This app, identified by the domain where it's hosted, is not authorized to use Firebase Authentication with the provided API key. Review your key configuration in the Google API console.","app-not-installed":"The requested mobile application corresponding to the identifier (Android package name or iOS bundle ID) provided is not installed on this device.","captcha-check-failed":"The reCAPTCHA response token provided is either invalid, expired, already used or the domain associated with it does not match the list of whitelisted domains.","code-expired":"The SMS code has expired. Please re-send the verification code to try again.","cordova-not-ready":"Cordova framework is not ready.","cors-unsupported":"This browser is not supported.","credential-already-in-use":"This credential is already associated with a different user account.","custom-token-mismatch":"The custom token corresponds to a different audience.","requires-recent-login":"This operation is sensitive and requires recent authentication. Log in again before retrying this request.","dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK.","dynamic-link-not-activated":"Please activate Dynamic Links in the Firebase Console and agree to the terms and conditions.","email-change-needs-verification":"Multi-factor users must always have a verified email.","email-already-in-use":"The email address is already in use by another account.","emulator-config-failed":'Auth instance has already been used to make a network call. Auth can no longer be configured to use the emulator. Try calling "connectAuthEmulator()" sooner.',"expired-action-code":"The action code has expired.","cancelled-popup-request":"This operation has been cancelled due to another conflicting popup being opened.","internal-error":"An internal AuthError has occurred.","invalid-app-credential":"The phone verification request contains an invalid application verifier. The reCAPTCHA token response is either invalid or expired.","invalid-app-id":"The mobile app identifier is not registed for the current project.","invalid-user-token":"This user's credential isn't valid for this project. This can happen if the user's token has been tampered with, or if the user isn't for the project associated with this API key.","invalid-auth-event":"An internal AuthError has occurred.","invalid-verification-code":"The SMS verification code used to create the phone auth credential is invalid. Please resend the verification code sms and be sure to use the verification code provided by the user.","invalid-continue-uri":"The continue URL provided in the request is invalid.","invalid-cordova-configuration":"The following Cordova plugins must be installed to enable OAuth sign-in: cordova-plugin-buildinfo, cordova-universal-links-plugin, cordova-plugin-browsertab, cordova-plugin-inappbrowser and cordova-plugin-customurlscheme.","invalid-custom-token":"The custom token format is incorrect. Please check the documentation.","invalid-dynamic-link-domain":"The provided dynamic link domain is not configured or authorized for the current project.","invalid-email":"The email address is badly formatted.","invalid-emulator-scheme":"Emulator URL must start with a valid scheme (http:// or https://).","invalid-api-key":"Your API key is invalid, please check you have copied it correctly.","invalid-cert-hash":"The SHA-1 certificate hash provided is invalid.","invalid-credential":"The supplied auth credential is malformed or has expired.","invalid-message-payload":"The email template corresponding to this action contains invalid characters in its message. Please fix by going to the Auth email templates section in the Firebase Console.","invalid-multi-factor-session":"The request does not contain a valid proof of first factor successful sign-in.","invalid-oauth-provider":"EmailAuthProvider is not supported for this operation. This operation only supports OAuth providers.","invalid-oauth-client-id":"The OAuth client ID provided is either invalid or does not match the specified API key.","unauthorized-domain":"This domain is not authorized for OAuth operations for your Firebase project. Edit the list of authorized domains from the Firebase console.","invalid-action-code":"The action code is invalid. This can happen if the code is malformed, expired, or has already been used.","wrong-password":"The password is invalid or the user does not have a password.","invalid-persistence-type":"The specified persistence type is invalid. It can only be local, session or none.","invalid-phone-number":"The format of the phone number provided is incorrect. Please enter the phone number in a format that can be parsed into E.164 format. E.164 phone numbers are written in the format [+][country code][subscriber number including area code].","invalid-provider-id":"The specified provider ID is invalid.","invalid-recipient-email":"The email corresponding to this action failed to send as the provided recipient email address is invalid.","invalid-sender":"The email template corresponding to this action contains an invalid sender email or name. Please fix by going to the Auth email templates section in the Firebase Console.","invalid-verification-id":"The verification ID used to create the phone auth credential is invalid.","invalid-tenant-id":"The Auth instance's tenant ID is invalid.","login-blocked":"Login blocked by user-provided method: {$originalMessage}","missing-android-pkg-name":"An Android Package Name must be provided if the Android App is required to be installed.","auth-domain-config-required":"Be sure to include authDomain when calling firebase.initializeApp(), by following the instructions in the Firebase console.","missing-app-credential":"The phone verification request is missing an application verifier assertion. A reCAPTCHA response token needs to be provided.","missing-verification-code":"The phone auth credential was created with an empty SMS verification code.","missing-continue-uri":"A continue URL must be provided in the request.","missing-iframe-start":"An internal AuthError has occurred.","missing-ios-bundle-id":"An iOS Bundle ID must be provided if an App Store ID is provided.","missing-or-invalid-nonce":"The request does not contain a valid nonce. This can occur if the SHA-256 hash of the provided raw nonce does not match the hashed nonce in the ID token payload.","missing-multi-factor-info":"No second factor identifier is provided.","missing-multi-factor-session":"The request is missing proof of first factor successful sign-in.","missing-phone-number":"To send verification codes, provide a phone number for the recipient.","missing-verification-id":"The phone auth credential was created with an empty verification ID.","app-deleted":"This instance of FirebaseApp has been deleted.","multi-factor-info-not-found":"The user does not have a second factor matching the identifier provided.","multi-factor-auth-required":"Proof of ownership of a second factor is required to complete sign-in.","account-exists-with-different-credential":"An account already exists with the same email address but different sign-in credentials. Sign in using a provider associated with this email address.","network-request-failed":"A network AuthError (such as timeout, interrupted connection or unreachable host) has occurred.","no-auth-event":"An internal AuthError has occurred.","no-such-provider":"User was not linked to an account with the given provider.","null-user":"A null user object was provided as the argument for an operation which requires a non-null user object.","operation-not-allowed":"The given sign-in provider is disabled for this Firebase project. Enable it in the Firebase console, under the sign-in method tab of the Auth section.","operation-not-supported-in-this-environment":'This operation is not supported in the environment this application is running on. "location.protocol" must be http, https or chrome-extension and web storage must be enabled.',"popup-blocked":"Unable to establish a connection with the popup. It may have been blocked by the browser.","popup-closed-by-user":"The popup has been closed by the user before finalizing the operation.","provider-already-linked":"User can only be linked to one identity for the given provider.","quota-exceeded":"The project's quota for this operation has been exceeded.","redirect-cancelled-by-user":"The redirect operation has been cancelled by the user before finalizing.","redirect-operation-pending":"A redirect sign-in operation is already pending.","rejected-credential":"The request contains malformed or mismatching credentials.","second-factor-already-in-use":"The second factor is already enrolled on this account.","maximum-second-factor-count-exceeded":"The maximum allowed number of second factors on a user has been exceeded.","tenant-id-mismatch":"The provided tenant ID does not match the Auth instance's tenant ID",timeout:"The operation has timed out.","user-token-expired":"The user's credential is no longer valid. The user must sign in again.","too-many-requests":"We have blocked all requests from this device due to unusual activity. Try again later.","unauthorized-continue-uri":"The domain of the continue URL is not whitelisted.  Please whitelist the domain in the Firebase console.","unsupported-first-factor":"Enrolling a second factor or signing in with a multi-factor account requires sign-in with a supported first factor.","unsupported-persistence-type":"The current environment does not support the specified persistence type.","unsupported-tenant-operation":"This operation is not supported in a multi-tenant context.","unverified-email":"The operation requires a verified email.","user-cancelled":"The user did not grant your application the permissions it requested.","user-not-found":"There is no user record corresponding to this identifier. The user may have been deleted.","user-disabled":"The user account has been disabled by an administrator.","user-mismatch":"The supplied credentials do not correspond to the previously signed in user.","user-signed-out":"","weak-password":"The password must be 6 characters long or more.","web-storage-unsupported":"This browser is not supported or 3rd party cookies and data may be disabled.","already-initialized":"initializeAuth() has already been called with different options. To avoid this error, call initializeAuth() with the same options as when it was originally called, or call getAuth() to return the already initialized instance."}}const Vm=Fm,jm=new vd("auth","Firebase",Fm()),qm=new nf("@firebase/auth");function Bm(e,...t){qm.logLevel<=$h.ERROR&&qm.error(`Auth (${Ff}): ${e}`,...t)}function Km(e,...t){throw Gm(e,...t)}function $m(e,...t){return Gm(e,...t)}function zm(e,t,n){var r=Object.assign(Object.assign({},Vm()),{[t]:n});const i=new vd("auth","Firebase",r);return i.create(t,{appName:e.name})}function Wm(e,t,n){if(!(t instanceof n))throw n.name!==t.constructor.name&&Km(e,"argument-error"),zm(e,"argument-error",`Type of ${t.constructor.name} does not match expected instance.`+"Did you pass a reference from a different Auth SDK?")}function Gm(e,...t){if("string"==typeof e)return jm.create(e,...t);{var n=t[0];const r=[...t.slice(1)];return r[0]&&(r[0].appName=e.name),e._errorFactory.create(n,...r)}}function Hm(e,t,...n){if(!e)throw Gm(t,...n)}function Qm(e){var t="INTERNAL ASSERTION FAILED: "+e;throw Bm(t),new Error(t)}function Ym(e,t){e||Qm(t)}const Jm=new Map;function Xm(e){Ym(e instanceof Function,"Expected a class definition");let t=Jm.get(e);return t?Ym(t instanceof e,"Instance stored in cache mismatched with class"):(t=new e,Jm.set(e,t)),t}function Zm(){var e;return"undefined"!=typeof self&&(null===(e=self.location)||void 0===e?void 0:e.href)||""}function ev(){return"http:"===tv()||"https:"===tv()}function tv(){var e;return"undefined"!=typeof self&&(null===(e=self.location)||void 0===e?void 0:e.protocol)||null}class nv{constructor(e,t){Ym((this.shortDelay=e)<(this.longDelay=t),"Short delay should be less than long delay!"),this.isMobile=ad()||ud()}get(){return"undefined"!=typeof navigator&&navigator&&"onLine"in navigator&&"boolean"==typeof navigator.onLine&&(ev()||ld()||"connection"in navigator)&&!navigator.onLine?Math.min(5e3,this.shortDelay):this.isMobile?this.longDelay:this.shortDelay}}function rv(e,t){Ym(e.emulator,"Emulator should always be set here");var n=e.emulator["url"];return t?`${n}${t.startsWith("/")?t.slice(1):t}`:n}class iv{static initialize(e,t,n){this.fetchImpl=e,t&&(this.headersImpl=t),n&&(this.responseImpl=n)}static fetch(){return this.fetchImpl||("undefined"!=typeof self&&"fetch"in self?self.fetch:void Qm("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill"))}static headers(){return this.headersImpl||("undefined"!=typeof self&&"Headers"in self?self.Headers:void Qm("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill"))}static response(){return this.responseImpl||("undefined"!=typeof self&&"Response"in self?self.Response:void Qm("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill"))}}const sv={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"internal-error",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error"},ov=new nv(3e4,6e4);function av(e,t){return e.tenantId&&!t.tenantId?Object.assign(Object.assign({},t),{tenantId:e.tenantId}):t}async function cv(i,s,o,a,e={}){return lv(i,e,async()=>{let e={},t={};a&&("GET"===s?t=a:e={body:JSON.stringify(a)});var n=Ad(Object.assign({key:i.config.apiKey},t)).slice(1);const r=await i._getAdditionalHeaders();return r["Content-Type"]="application/json",i.languageCode&&(r["X-Firebase-Locale"]=i.languageCode),iv.fetch()(hv(i,i.config.apiHost,o,n),Object.assign({method:s,headers:r,referrerPolicy:"no-referrer"},e))})}async function lv(t,e,n){t._canInitEmulator=!1;var r=Object.assign(Object.assign({},sv),e);try{const o=new dv(t),a=await Promise.race([n(),o.promise]);o.clearNetworkTimeout();var i=await a.json();if("needConfirmation"in i)throw fv(t,"account-exists-with-different-credential",i);if(a.ok&&!("errorMessage"in i))return i;{const c=a.ok?i.errorMessage:i.error.message,[l,u]=c.split(" : ");if("FEDERATED_USER_ID_ALREADY_LINKED"===l)throw fv(t,"credential-already-in-use",i);if("EMAIL_EXISTS"===l)throw fv(t,"email-already-in-use",i);if("USER_DISABLED"===l)throw fv(t,"user-disabled",i);var s=r[l]||l.toLowerCase().replace(/[_\s]+/g,"-");if(u)throw zm(t,s,u);Km(t,s)}}catch(e){if(e instanceof md)throw e;Km(t,"network-request-failed")}}async function uv(e,t,n,r,i={}){var s=await cv(e,t,n,r,i);return"mfaPendingCredential"in s&&Km(e,"multi-factor-auth-required",{_serverResponse:s}),s}function hv(e,t,n,r){var i=`${t}${n}?${r}`;return e.config.emulator?rv(e.config,i):`${e.config.apiScheme}://${i}`}class dv{constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((e,t)=>{this.timer=setTimeout(()=>t($m(this.auth,"network-request-failed")),ov.get())})}clearNetworkTimeout(){clearTimeout(this.timer)}}function fv(e,t,n){const r={appName:e.name};n.email&&(r.email=n.email),n.phoneNumber&&(r.phoneNumber=n.phoneNumber);const i=$m(e,t,r);return i.customData._tokenResponse=n,i}function pv(e){if(e)try{const t=new Date(Number(e));if(!isNaN(t.getTime()))return t.toUTCString()}catch(e){}}function gv(e){return 1e3*Number(e)}function mv(e){var[t,n,r]=e.split(".");if(void 0===t||void 0===n||void 0===r)return Bm("JWT malformed, contained fewer than 3 sections"),null;try{var i=nd(n);return i?JSON.parse(i):(Bm("Failed to decode base64 JWT payload"),null)}catch(e){return Bm("Caught error parsing JWT payload as JSON",null===e||void 0===e?void 0:e.toString()),null}}async function vv(t,n,e=!1){if(e)return n;try{return n}catch(e){throw e instanceof md&&(n=[e["code"]][0],"auth/user-disabled"===n||"auth/user-token-expired"===n)&&t.auth.currentUser===t&&await t.auth.signOut(),e}}class yv{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,null!==this.timerId&&clearTimeout(this.timerId))}getInterval(e){if(e){var t=this.errorBackoff;return this.errorBackoff=Math.min(2*this.errorBackoff,96e4),t}this.errorBackoff=3e4;t=(null!==(t=this.user.stsTokenManager.expirationTime)&&void 0!==t?t:0)-Date.now()-3e5;return Math.max(0,t)}schedule(e=!1){var t;this.isRunning&&(t=this.getInterval(e),this.timerId=setTimeout(async()=>{await this.iteration()},t))}async iteration(){try{await this.user.getIdToken(!0)}catch(e){return void("auth/network-request-failed"===(null===e||void 0===e?void 0:e.code)&&this.schedule(!0))}this.schedule()}}class _v{constructor(e,t){this.createdAt=e,this.lastLoginAt=t,this._initializeTime()}_initializeTime(){this.lastSignInTime=pv(this.lastLoginAt),this.creationTime=pv(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}async function wv(e){var t=e.auth,n=await e.getIdToken(),r=await vv(e,async function(e,t){return cv(e,"POST","/v1/accounts:lookup",t)}(t,{idToken:n}));Hm(null==r?void 0:r.users.length,t,"internal-error");var i=r.users[0];e._notifyReloadListener(i);var s,o,t=null!==(n=i.providerUserInfo)&&void 0!==n&&n.length?i.providerUserInfo.map(e=>{var t=e["providerId"],n=Om(e,["providerId"]);return{providerId:t,uid:n.rawId||"",displayName:n.displayName||null,email:n.email||null,phoneNumber:n.phoneNumber||null,photoURL:n.photoUrl||null}}):[],r=(s=e.providerData,o=t,[...s.filter(t=>!o.some(e=>e.providerId===t.providerId)),...o]),n=e.isAnonymous,t=!(e.email&&i.passwordHash||null!==r&&r.length),t=!!n&&t,t={uid:i.localId,displayName:i.displayName||null,photoURL:i.photoUrl||null,email:i.email||null,emailVerified:i.emailVerified||!1,phoneNumber:i.phoneNumber||null,tenantId:i.tenantId||null,providerData:r,metadata:new _v(i.createdAt,i.lastLoginAt),isAnonymous:t};Object.assign(e,t)}class bv{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){Hm(e.idToken,"internal-error"),Hm(void 0!==e.idToken,"internal-error"),Hm(void 0!==e.refreshToken,"internal-error");var t,n,n="expiresIn"in e&&void 0!==e.expiresIn?Number(e.expiresIn):(t=e.idToken,Hm(n=mv(t),"internal-error"),Hm(void 0!==n.exp,"internal-error"),Hm(void 0!==n.iat,"internal-error"),Number(n.exp)-Number(n.iat));this.updateTokensAndExpiration(e.idToken,e.refreshToken,n)}async getToken(e,t=!1){return Hm(!this.accessToken||this.refreshToken,e,"user-token-expired"),t||!this.accessToken||this.isExpired?this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null:this.accessToken}clearRefreshToken(){this.refreshToken=null}async refresh(e,t){var i,s,{accessToken:n,refreshToken:r,expiresIn:o}=(s=t,await{accessToken:(o=await lv(i=e,{},async()=>{var e=Ad({grant_type:"refresh_token",refresh_token:s}).slice(1),{tokenApiHost:t,apiKey:n}=i.config,n=hv(i,t,"/v1/token",`key=${n}`);const r=await i._getAdditionalHeaders();return r["Content-Type"]="application/x-www-form-urlencoded",iv.fetch()(n,{method:"POST",headers:r,body:e})})).access_token,expiresIn:o.expires_in,refreshToken:o.refresh_token});this.updateTokensAndExpiration(n,r,Number(o))}updateTokensAndExpiration(e,t,n){this.refreshToken=t||null,this.accessToken=e||null,this.expirationTime=Date.now()+1e3*n}static fromJSON(e,t){var{refreshToken:n,accessToken:r,expirationTime:i}=t;const s=new bv;return n&&(Hm("string"==typeof n,"internal-error",{appName:e}),s.refreshToken=n),r&&(Hm("string"==typeof r,"internal-error",{appName:e}),s.accessToken=r),i&&(Hm("number"==typeof i,"internal-error",{appName:e}),s.expirationTime=i),s}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new bv,this.toJSON())}_performRefresh(){return Qm("not implemented")}}function Iv(e,t){Hm("string"==typeof e||void 0===e,"internal-error",{appName:t})}class Tv{constructor(e){var{uid:t,auth:n,stsTokenManager:r}=e,i=Om(e,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.proactiveRefresh=new yv(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=t,this.auth=n,this.stsTokenManager=r,this.accessToken=r.accessToken,this.displayName=i.displayName||null,this.email=i.email||null,this.emailVerified=i.emailVerified||!1,this.phoneNumber=i.phoneNumber||null,this.photoURL=i.photoURL||null,this.isAnonymous=i.isAnonymous||!1,this.tenantId=i.tenantId||null,this.providerData=i.providerData?[...i.providerData]:[],this.metadata=new _v(i.createdAt||void 0,i.lastLoginAt||void 0)}async getIdToken(e){var t=await vv(this,this.stsTokenManager.getToken(this.auth,e));return Hm(t,this.auth,"internal-error"),this.accessToken!==t&&(this.accessToken=t,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),t}getIdTokenResult(e){return async function(e,t=!1){const n=Wd(e);var r=await n.getIdToken(t),i=mv(r);Hm(i&&i.exp&&i.auth_time&&i.iat,n.auth,"internal-error");var s="object"==typeof i.firebase?i.firebase:void 0,o=null==s?void 0:s.sign_in_provider;return{claims:i,token:r,authTime:pv(gv(i.auth_time)),issuedAtTime:pv(gv(i.iat)),expirationTime:pv(gv(i.exp)),signInProvider:o||null,signInSecondFactor:(null==s?void 0:s.sign_in_second_factor)||null}}(this,e)}reload(){return async function(e){const t=Wd(e);await wv(t),await t.auth._persistUserIfCurrent(t),t.auth._notifyListenersIfCurrent(t)}(this)}_assign(e){this!==e&&(Hm(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(e=>Object.assign({},e)),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){return new Tv(Object.assign(Object.assign({},this),{auth:e,stsTokenManager:this.stsTokenManager._clone()}))}_onReload(e){Hm(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,t=!1){let n=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),n=!0),t&&await wv(this),await this.auth._persistUserIfCurrent(this),n&&this.auth._notifyListenersIfCurrent(this)}async delete(){var e=await this.getIdToken();return await vv(this,async function(e,t){return cv(e,"POST","/v1/accounts:delete",t)}(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return Object.assign(Object.assign({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>Object.assign({},e)),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,t){var n=null!==(o=t.displayName)&&void 0!==o?o:void 0,r=null!==(g=t.email)&&void 0!==g?g:void 0,i=null!==(a=t.phoneNumber)&&void 0!==a?a:void 0,s=null!==(l=t.photoURL)&&void 0!==l?l:void 0,o=null!==(c=t.tenantId)&&void 0!==c?c:void 0,a=null!==(g=t._redirectEventId)&&void 0!==g?g:void 0,c=null!==(l=t.createdAt)&&void 0!==l?l:void 0,l=null!==(g=t.lastLoginAt)&&void 0!==g?g:void 0;const{uid:u,emailVerified:h,isAnonymous:d,providerData:f,stsTokenManager:p}=t;Hm(u&&p,e,"internal-error");var g=bv.fromJSON(this.name,p);Hm("string"==typeof u,e,"internal-error"),Iv(n,e.name),Iv(r,e.name),Hm("boolean"==typeof h,e,"internal-error"),Hm("boolean"==typeof d,e,"internal-error"),Iv(i,e.name),Iv(s,e.name),Iv(o,e.name),Iv(a,e.name),Iv(c,e.name),Iv(l,e.name);const m=new Tv({uid:u,auth:e,email:r,emailVerified:h,displayName:n,isAnonymous:d,photoURL:s,phoneNumber:i,tenantId:o,stsTokenManager:g,createdAt:c,lastLoginAt:l});return f&&Array.isArray(f)&&(m.providerData=f.map(e=>Object.assign({},e))),a&&(m._redirectEventId=a),m}static async _fromIdTokenResponse(e,t,n=!1){const r=new bv;r.updateFromServerResponse(t);var i=new Tv({uid:t.localId,auth:e,stsTokenManager:r,isAnonymous:n});return await wv(i),i}}class Ev{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,t){this.storage[e]=t}async _get(e){var t=this.storage[e];return void 0===t?null:t}async _remove(e){delete this.storage[e]}_addListener(e,t){}_removeListener(e,t){}}Ev.type="NONE";const Sv=Ev;function kv(e,t,n){return`firebase:${e}:${t}:${n}`}class Cv{constructor(e,t,n){this.persistence=e,this.auth=t,this.userKey=n;var{config:r,name:i}=this.auth;this.fullUserKey=kv(this.userKey,r.apiKey,i),this.fullPersistenceKey=kv("persistence",r.apiKey,i),this.boundEventHandler=t._onStorageEvent.bind(t),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){var e=await this.persistence._get(this.fullUserKey);return e?Tv._fromJSON(this.auth,e):null}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence!==e){var t=await this.getCurrentUser();return await this.removeCurrentUser(),this.persistence=e,t?this.setCurrentUser(t):void 0}}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,t,n="authUser"){if(!t.length)return new Cv(Xm(Sv),e,n);const r=(await Promise.all(t.map(async e=>{if(await e._isAvailable())return e}))).filter(e=>e);let i=r[0]||Xm(Sv);const s=kv(n,e.config.apiKey,e.name);let o=null;for(const u of t)try{var a=await u._get(s);if(a){var c=Tv._fromJSON(e,a);u!==i&&(o=c),i=u;break}}catch(e){}var l=r.filter(e=>e._shouldAllowMigration);return i._shouldAllowMigration&&l.length&&(i=l[0],o&&await i._set(s,o.toJSON()),await Promise.all(t.map(async e=>{if(e!==i)try{await e._remove(s)}catch(e){}}))),new Cv(i,e,n)}}function Av(e){const t=e.toLowerCase();if(t.includes("opera/")||t.includes("opr/")||t.includes("opios/"))return"Opera";if(Pv(t))return"IEMobile";if(t.includes("msie")||t.includes("trident/"))return"IE";if(t.includes("edge/"))return"Edge";if(Nv(t))return"Firefox";if(t.includes("silk/"))return"Silk";if(Ov(t))return"Blackberry";if(Mv(t))return"Webos";if(xv(t))return"Safari";if((t.includes("chrome/")||Rv(t))&&!t.includes("edge/"))return"Chrome";if(Dv(t))return"Android";var n=e.match(/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/);return 2===(null==n?void 0:n.length)?n[1]:"Other"}function Nv(e=od()){return/firefox\//i.test(e)}function xv(e=od()){const t=e.toLowerCase();return t.includes("safari/")&&!t.includes("chrome/")&&!t.includes("crios/")&&!t.includes("android")}function Rv(e=od()){return/crios\//i.test(e)}function Pv(e=od()){return/iemobile/i.test(e)}function Dv(e=od()){return/android/i.test(e)}function Ov(e=od()){return/blackberry/i.test(e)}function Mv(e=od()){return/webos/i.test(e)}function Lv(e=od()){return/iphone|ipad|ipod/i.test(e)||/macintosh/i.test(e)&&/mobile/i.test(e)}function Fv(e=od()){return Lv(e)||Dv(e)||Mv(e)||Ov(e)||/windows phone/i.test(e)||Pv(e)}function Uv(e,t=[]){let n;switch(e){case"Browser":n=Av(od());break;case"Worker":n=`${Av(od())}-${e}`;break;default:n=e}var r=t.length?t.join(","):"FirebaseCore-web";return`${n}/JsCore/${Ff}/${r}`}class Vv{constructor(e){this.auth=e,this.queue=[]}pushCallback(r,e){var t=n=>new Promise((e,t)=>{try{e(r(n))}catch(e){t(e)}});t.onAbort=e,this.queue.push(t);const n=this.queue.length-1;return()=>{this.queue[n]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser!==e){const t=[];try{for(const n of this.queue)await n(e),n.onAbort&&t.push(n.onAbort)}catch(e){t.reverse();for(const r of t)try{r()}catch(e){}throw this.auth._errorFactory.create("login-blocked",{originalMessage:null===e||void 0===e?void 0:e.message})}}}}class jv{constructor(e,t,n){this.app=e,this.heartbeatServiceProvider=t,this.config=n,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new Bv(this),this.idTokenSubscription=new Bv(this),this.beforeStateQueue=new Vv(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=jm,this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=n.sdkClientVersion}_initializeWithPersistence(t,n){return n&&(this._popupRedirectResolver=Xm(n)),this._initializationPromise=this.queue(async()=>{var e;if(!this._deleted&&(this.persistenceManager=await Cv.create(this,t),!this._deleted)){if(null!==(e=this._popupRedirectResolver)&&void 0!==e&&e._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch(e){}await this.initializeCurrentUser(n),this.lastNotifiedUid=(null===(e=this.currentUser)||void 0===e?void 0:e.uid)||null,this._deleted||(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(!this._deleted){var e=await this.assertedPersistence.getCurrentUser();if(this.currentUser||e)return this.currentUser&&e&&this.currentUser.uid===e.uid?(this._currentUser._assign(e),void await this.currentUser.getIdToken()):void await this._updateCurrentUser(e,!0)}}async initializeCurrentUser(e){var t,n,r,i=await this.assertedPersistence.getCurrentUser();let s=i,o=!1;if(e&&this.config.authDomain&&(await this.getOrInitRedirectPersistenceManager(),t=null===(r=this.redirectUser)||void 0===r?void 0:r._redirectEventId,n=null===s||void 0===s?void 0:s._redirectEventId,r=await this.tryRedirectSignIn(e),t&&t!==n||null==r||!r.user||(s=r.user,o=!0)),!s)return this.directlySetCurrentUser(null);if(s._redirectEventId)return Hm(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===s._redirectEventId?this.directlySetCurrentUser(s):this.reloadAndSetCurrentUserOrClear(s);if(o)try{await this.beforeStateQueue.runMiddleware(s)}catch(e){s=i,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(e))}return s?this.reloadAndSetCurrentUserOrClear(s):this.directlySetCurrentUser(null)}async tryRedirectSignIn(e){let t=null;try{t=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch(e){await this._setRedirectUser(null)}return t}async reloadAndSetCurrentUserOrClear(e){try{await wv(e)}catch(e){if("auth/network-request-failed"!==(null===e||void 0===e?void 0:e.code))return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=function(){if("undefined"==typeof navigator)return null;var e=navigator;return e.languages&&e.languages[0]||e.language||null}()}async _delete(){this._deleted=!0}async updateCurrentUser(e){const t=e?Wd(e):null;return t&&Hm(t.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(t&&t._clone(this))}async _updateCurrentUser(e,t=!1){if(!this._deleted)return e&&Hm(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),t||await this.beforeStateQueue.runMiddleware(e),this.queue(async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()})}async signOut(){return await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0)}setPersistence(e){return this.queue(async()=>{await this.assertedPersistence.setPersistence(Xm(e))})}_getPersistence(){return this.assertedPersistence.persistence.type}_updateErrorMap(e){this._errorFactory=new vd("auth","Firebase",e())}onAuthStateChanged(e,t,n){return this.registerStateListener(this.authStateSubscription,e,t,n)}beforeAuthStateChanged(e,t){return this.beforeStateQueue.pushCallback(e,t)}onIdTokenChanged(e,t,n){return this.registerStateListener(this.idTokenSubscription,e,t,n)}toJSON(){var e;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:null===(e=this._currentUser)||void 0===e?void 0:e.toJSON()}}async _setRedirectUser(e,t){const n=await this.getOrInitRedirectPersistenceManager(t);return null===e?n.removeCurrentUser():n.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){var t;return this.redirectPersistenceManager||(Hm(t=e&&Xm(e)||this._popupRedirectResolver,this,"argument-error"),this.redirectPersistenceManager=await Cv.create(this,[Xm(t._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()),this.redirectPersistenceManager}async _redirectUserForId(e){var t;return this._isInitialized&&await this.queue(async()=>{}),(null===(t=this._currentUser)||void 0===t?void 0:t._redirectEventId)===e?this._currentUser:(null===(t=this.redirectUser)||void 0===t?void 0:t._redirectEventId)===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(e))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var e;this._isInitialized&&(this.idTokenSubscription.next(this.currentUser),e=null!==(e=null===(e=this.currentUser)||void 0===e?void 0:e.uid)&&void 0!==e?e:null,this.lastNotifiedUid!==e&&(this.lastNotifiedUid=e,this.authStateSubscription.next(this.currentUser)))}registerStateListener(e,t,n,r){if(this._deleted)return()=>{};const i="function"==typeof t?t:t.next.bind(t),s=this._isInitialized?Promise.resolve():this._initializationPromise;return Hm(s,this,"internal-error"),s.then(()=>i(this.currentUser)),"function"==typeof t?e.addObserver(t,n,r):e.addObserver(t)}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&(this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh()),(this.currentUser=e)?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return Hm(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){e&&!this.frameworks.includes(e)&&(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=Uv(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){const e={"X-Client-Version":this.clientVersion};this.app.options.appId&&(e["X-Firebase-gmpid"]=this.app.options.appId);var t=await(null===(t=this.heartbeatServiceProvider.getImmediate({optional:!0}))||void 0===t?void 0:t.getHeartbeatsHeader());return t&&(e["X-Firebase-Client"]=t),e}}function qv(e){return Wd(e)}class Bv{constructor(e){this.auth=e,this.observer=null,this.addObserver=Pd(e=>this.observer=e)}get next(){return Hm(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}function Kv(e,t,n){const r=qv(e);Hm(r._canInitEmulator,r,"emulator-config-failed"),Hm(/^https?:\/\//.test(t),r,"invalid-emulator-scheme");var i=!(null==n||!n.disableWarnings);const s=$v(t);var{host:o,port:a}=function(e){const t=$v(e),n=/(\/\/)?([^?#/]+)/.exec(e.substr(t.length));if(!n)return{host:"",port:null};const r=n[2].split("@").pop()||"",i=/^(\[[^\]]+\])(:|$)/.exec(r);{if(i){var s=i[1];return{host:s,port:zv(r.substr(s.length+1))}}var[o,s]=r.split(":");return{host:o,port:zv(s)}}}(t);r.config.emulator={url:`${s}//${o}${null===a?"":`:${a}`}/`},r.settings.appVerificationDisabledForTesting=!0,r.emulatorConfig=Object.freeze({host:o,port:a,protocol:s.replace(":",""),options:Object.freeze({disableWarnings:i})}),i||function(){function e(){const e=document.createElement("p"),t=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",t.position="fixed",t.width="100%",t.backgroundColor="#ffffff",t.border=".1em solid #000000",t.color="#b50000",t.bottom="0px",t.left="0px",t.margin="0px",t.zIndex="10000",t.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}"undefined"!=typeof console&&"function"==typeof console.info&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials.");"undefined"!=typeof window&&"undefined"!=typeof document&&("loading"===document.readyState?window.addEventListener("DOMContentLoaded",e):e())}()}function $v(e){var t=e.indexOf(":");return t<0?"":e.substr(0,t+1)}function zv(e){if(!e)return null;var t=Number(e);return isNaN(t)?null:t}class Wv{constructor(e,t){this.providerId=e,this.signInMethod=t}toJSON(){return Qm("not implemented")}_getIdTokenResponse(e){return Qm("not implemented")}_linkToIdToken(e,t){return Qm("not implemented")}_getReauthenticationResolver(e){return Qm("not implemented")}}async function Gv(e,t){return cv(e,"POST","/v1/accounts:resetPassword",av(e,t))}async function Hv(e,t){return cv(e,"POST","/v1/accounts:update",t)}async function Qv(e,t){return cv(e,"POST","/v1/accounts:sendOobCode",av(e,t))}class Yv extends Wv{constructor(e,t,n,r=null){super("password",n),this._email=e,this._password=t,this._tenantId=r}static _fromEmailAndPassword(e,t){return new Yv(e,t,"password")}static _fromEmailAndCode(e,t,n=null){return new Yv(e,t,"emailLink",n)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(e){var t="string"==typeof e?JSON.parse(e):e;if(null!=t&&t.email&&null!=t&&t.password){if("password"===t.signInMethod)return this._fromEmailAndPassword(t.email,t.password);if("emailLink"===t.signInMethod)return this._fromEmailAndCode(t.email,t.password,t.tenantId)}return null}async _getIdTokenResponse(e){switch(this.signInMethod){case"password":return async function(e,t){return uv(e,"POST","/v1/accounts:signInWithPassword",av(e,t))}(e,{returnSecureToken:!0,email:this._email,password:this._password});case"emailLink":return async function(e,t){return uv(e,"POST","/v1/accounts:signInWithEmailLink",av(e,t))}(e,{email:this._email,oobCode:this._password});default:Km(e,"internal-error")}}async _linkToIdToken(e,t){switch(this.signInMethod){case"password":return Hv(e,{idToken:t,returnSecureToken:!0,email:this._email,password:this._password});case"emailLink":return async function(e,t){return uv(e,"POST","/v1/accounts:signInWithEmailLink",av(e,t))}(e,{idToken:t,email:this._email,oobCode:this._password});default:Km(e,"internal-error")}}_getReauthenticationResolver(e){return this._getIdTokenResponse(e)}}async function Jv(e,t){return uv(e,"POST","/v1/accounts:signInWithIdp",av(e,t))}class Xv extends Wv{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const t=new Xv(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(t.idToken=e.idToken),e.accessToken&&(t.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(t.nonce=e.nonce),e.pendingToken&&(t.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(t.accessToken=e.oauthToken,t.secret=e.oauthTokenSecret):Km("argument-error"),t}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){var t="string"==typeof e?JSON.parse(e):e,{providerId:n,signInMethod:r}=t,t=Om(t,["providerId","signInMethod"]);if(!n||!r)return null;const i=new Xv(n,r);return i.idToken=t.idToken||void 0,i.accessToken=t.accessToken||void 0,i.secret=t.secret,i.nonce=t.nonce,i.pendingToken=t.pendingToken||null,i}_getIdTokenResponse(e){return Jv(e,this.buildRequest())}_linkToIdToken(e,t){const n=this.buildRequest();return n.idToken=t,Jv(e,n)}_getReauthenticationResolver(e){const t=this.buildRequest();return t.autoCreate=!1,Jv(e,t)}buildRequest(){const e={requestUri:"http://localhost",returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const t={};this.idToken&&(t.id_token=this.idToken),this.accessToken&&(t.access_token=this.accessToken),this.secret&&(t.oauth_token_secret=this.secret),t.providerId=this.providerId,this.nonce&&!this.pendingToken&&(t.nonce=this.nonce),e.postBody=Ad(t)}return e}}const Zv={USER_NOT_FOUND:"user-not-found"};class ey extends Wv{constructor(e){super("phone","phone"),this.params=e}static _fromVerification(e,t){return new ey({verificationId:e,verificationCode:t})}static _fromTokenResponse(e,t){return new ey({phoneNumber:e,temporaryProof:t})}_getIdTokenResponse(e){return async function(e,t){return uv(e,"POST","/v1/accounts:signInWithPhoneNumber",av(e,t))}(e,this._makeVerificationRequest())}_linkToIdToken(e,t){return async function(e,t){var n=await uv(e,"POST","/v1/accounts:signInWithPhoneNumber",av(e,t));if(n.temporaryProof)throw fv(e,"account-exists-with-different-credential",n);return n}(e,Object.assign({idToken:t},this._makeVerificationRequest()))}_getReauthenticationResolver(e){return async function(e,t){return uv(e,"POST","/v1/accounts:signInWithPhoneNumber",av(e,Object.assign(Object.assign({},t),{operation:"REAUTH"})),Zv)}(e,this._makeVerificationRequest())}_makeVerificationRequest(){var{temporaryProof:e,phoneNumber:t,verificationId:n,verificationCode:r}=this.params;return e&&t?{temporaryProof:e,phoneNumber:t}:{sessionInfo:n,code:r}}toJSON(){const e={providerId:this.providerId};return this.params.phoneNumber&&(e.phoneNumber=this.params.phoneNumber),this.params.temporaryProof&&(e.temporaryProof=this.params.temporaryProof),this.params.verificationCode&&(e.verificationCode=this.params.verificationCode),this.params.verificationId&&(e.verificationId=this.params.verificationId),e}static fromJSON(e){var{verificationId:t,verificationCode:n,phoneNumber:r,temporaryProof:i}=e="string"==typeof e?JSON.parse(e):e;return n||t||r||i?new ey({verificationId:t,verificationCode:n,phoneNumber:r,temporaryProof:i}):null}}class ty{constructor(e){var t=Nd(xd(e)),n=null!==(r=t.apiKey)&&void 0!==r?r:null,r=null!==(i=t.oobCode)&&void 0!==i?i:null,i=function(e){switch(e){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}(null!==(i=t.mode)&&void 0!==i?i:null);Hm(n&&r&&i,"argument-error"),this.apiKey=n,this.operation=i,this.code=r,this.continueUrl=null!==(r=t.continueUrl)&&void 0!==r?r:null,this.languageCode=null!==(r=t.languageCode)&&void 0!==r?r:null,this.tenantId=null!==(t=t.tenantId)&&void 0!==t?t:null}static parseLink(e){var t,n,r,t=(t=Nd(xd(e=e)).link,n=t?Nd(xd(t)).deep_link_id:null,((r=Nd(xd(e)).deep_link_id)?Nd(xd(r)).link:null)||r||n||t||e);try{return new ty(t)}catch(e){return null}}}class ny{constructor(){this.providerId=ny.PROVIDER_ID}static credential(e,t){return Yv._fromEmailAndPassword(e,t)}static credentialWithLink(e,t){var n=ty.parseLink(t);return Hm(n,"argument-error"),Yv._fromEmailAndCode(e,n.code,n.tenantId)}}ny.PROVIDER_ID="password",ny.EMAIL_PASSWORD_SIGN_IN_METHOD="password",ny.EMAIL_LINK_SIGN_IN_METHOD="emailLink";class ry{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}class iy extends ry{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}class sy extends iy{static credentialFromJSON(e){var t="string"==typeof e?JSON.parse(e):e;return Hm("providerId"in t&&"signInMethod"in t,"argument-error"),Xv._fromParams(t)}credential(e){return this._credential(Object.assign(Object.assign({},e),{nonce:e.rawNonce}))}_credential(e){return Hm(e.idToken||e.accessToken,"argument-error"),Xv._fromParams(Object.assign(Object.assign({},e),{providerId:this.providerId,signInMethod:this.providerId}))}static credentialFromResult(e){return sy.oauthCredentialFromTaggedObject(e)}static credentialFromError(e){return sy.oauthCredentialFromTaggedObject(e.customData||{})}static oauthCredentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;var{oauthIdToken:t,oauthAccessToken:n,oauthTokenSecret:r,pendingToken:i,nonce:s,providerId:o}=e;if(!(n||r||t||i))return null;if(!o)return null;try{return new sy(o)._credential({idToken:t,accessToken:n,nonce:s,pendingToken:i})}catch(e){return null}}}class oy extends iy{constructor(){super("facebook.com")}static credential(e){return Xv._fromParams({providerId:oy.PROVIDER_ID,signInMethod:oy.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return oy.credentialFromTaggedObject(e)}static credentialFromError(e){return oy.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!(e&&"oauthAccessToken"in e))return null;if(!e.oauthAccessToken)return null;try{return oy.credential(e.oauthAccessToken)}catch(e){return null}}}oy.FACEBOOK_SIGN_IN_METHOD="facebook.com",oy.PROVIDER_ID="facebook.com";class ay extends iy{constructor(){super("google.com"),this.addScope("profile")}static credential(e,t){return Xv._fromParams({providerId:ay.PROVIDER_ID,signInMethod:ay.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:t})}static credentialFromResult(e){return ay.credentialFromTaggedObject(e)}static credentialFromError(e){return ay.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;var{oauthIdToken:t,oauthAccessToken:n}=e;if(!t&&!n)return null;try{return ay.credential(t,n)}catch(e){return null}}}ay.GOOGLE_SIGN_IN_METHOD="google.com",ay.PROVIDER_ID="google.com";class cy extends iy{constructor(){super("github.com")}static credential(e){return Xv._fromParams({providerId:cy.PROVIDER_ID,signInMethod:cy.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return cy.credentialFromTaggedObject(e)}static credentialFromError(e){return cy.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!(e&&"oauthAccessToken"in e))return null;if(!e.oauthAccessToken)return null;try{return cy.credential(e.oauthAccessToken)}catch(e){return null}}}cy.GITHUB_SIGN_IN_METHOD="github.com",cy.PROVIDER_ID="github.com";class ly extends Wv{constructor(e,t){super(e,e),this.pendingToken=t}_getIdTokenResponse(e){return Jv(e,this.buildRequest())}_linkToIdToken(e,t){const n=this.buildRequest();return n.idToken=t,Jv(e,n)}_getReauthenticationResolver(e){const t=this.buildRequest();return t.autoCreate=!1,Jv(e,t)}toJSON(){return{signInMethod:this.signInMethod,providerId:this.providerId,pendingToken:this.pendingToken}}static fromJSON(e){var{providerId:t,signInMethod:n,pendingToken:r}="string"==typeof e?JSON.parse(e):e;return t&&n&&r&&t===n?new ly(t,r):null}static _create(e,t){return new ly(e,t)}buildRequest(){return{requestUri:"http://localhost",returnSecureToken:!0,pendingToken:this.pendingToken}}}class uy extends ry{constructor(e){Hm(e.startsWith("saml."),"argument-error"),super(e)}static credentialFromResult(e){return uy.samlCredentialFromTaggedObject(e)}static credentialFromError(e){return uy.samlCredentialFromTaggedObject(e.customData||{})}static credentialFromJSON(e){var t=ly.fromJSON(e);return Hm(t,"argument-error"),t}static samlCredentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;var{pendingToken:t,providerId:n}=e;if(!t||!n)return null;try{return ly._create(n,t)}catch(e){return null}}}class hy extends iy{constructor(){super("twitter.com")}static credential(e,t){return Xv._fromParams({providerId:hy.PROVIDER_ID,signInMethod:hy.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:t})}static credentialFromResult(e){return hy.credentialFromTaggedObject(e)}static credentialFromError(e){return hy.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;var{oauthAccessToken:t,oauthTokenSecret:n}=e;if(!t||!n)return null;try{return hy.credential(t,n)}catch(e){return null}}}async function dy(e,t){return uv(e,"POST","/v1/accounts:signUp",av(e,t))}hy.TWITTER_SIGN_IN_METHOD="twitter.com",hy.PROVIDER_ID="twitter.com";class fy{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,t,n,r=!1){var i=await Tv._fromIdTokenResponse(e,n,r),s=py(n);return new fy({user:i,providerId:s,_tokenResponse:n,operationType:t})}static async _forOperation(e,t,n){await e._updateTokensIfNecessary(n,!0);var r=py(n);return new fy({user:e,providerId:r,_tokenResponse:n,operationType:t})}}function py(e){return e.providerId||("phoneNumber"in e?"phone":null)}class gy extends md{constructor(e,t,n,r){var i;super(t.code,t.message),this.operationType=n,this.user=r,Object.setPrototypeOf(this,gy.prototype),this.customData={appName:e.name,tenantId:null!==(i=e.tenantId)&&void 0!==i?i:void 0,_serverResponse:t.customData._serverResponse,operationType:n}}static _fromErrorAndOperation(e,t,n,r){return new gy(e,t,n,r)}}function my(t,n,e,r){const i="reauthenticate"===n?e._getReauthenticationResolver(t):e._getIdTokenResponse(t);return i.catch(e=>{if("auth/multi-factor-auth-required"===e.code)throw gy._fromErrorAndOperation(t,e,n,r);throw e})}function vy(e){return new Set(e.map(({providerId:e})=>e).filter(e=>!!e))}async function yy(e,t){const n=Wd(e);await wy(!0,n,t);var r=(e=n.auth,t={idToken:await n.getIdToken(),deleteProvider:[t]},await cv(e,"POST","/v1/accounts:update",t))["providerUserInfo"];const i=vy(r||[]);return n.providerData=n.providerData.filter(e=>i.has(e.providerId)),i.has("phone")||(n.phoneNumber=null),await n.auth._persistUserIfCurrent(n),n}async function _y(e,t,n=!1){var r=await vv(e,t._linkToIdToken(e.auth,await e.getIdToken()),n);return fy._forOperation(e,"link",r)}async function wy(e,t,n){await wv(t);const r=vy(t.providerData);var i=!1===e?"provider-already-linked":"no-such-provider";Hm(r.has(n)===e,t.auth,i)}async function by(e,t,n=!1){var r=e["auth"],i="reauthenticate";try{var s=await vv(e,my(r,i,t,e),n);Hm(s.idToken,r,"internal-error");var o=mv(s.idToken);Hm(o,r,"internal-error");var a=o["sub"];return Hm(e.uid===a,r,"user-mismatch"),fy._forOperation(e,i,s)}catch(e){throw"auth/user-not-found"===(null===e||void 0===e?void 0:e.code)&&Km(r,"user-mismatch"),e}}async function Iy(e,t,n=!1){var r=await my(e,"signIn",t),r=await fy._fromIdTokenResponse(e,"signIn",r);return n||await e._updateCurrentUser(r.user),r}async function Ty(e,t){return Iy(qv(e),t)}async function Ey(e,t){var n=Wd(e);return await wy(!1,n,t.providerId),_y(n,t)}async function Sy(e,t){return by(Wd(e),t)}async function ky(e,t){const n=qv(e);var r=await uv(n,"POST","/v1/accounts:signInWithCustomToken",av(n,{token:t,returnSecureToken:!0})),r=await fy._fromIdTokenResponse(n,"signIn",r);return await n._updateCurrentUser(r.user),r}class Cy{constructor(e,t){this.factorId=e,this.uid=t.mfaEnrollmentId,this.enrollmentTime=new Date(t.enrolledAt).toUTCString(),this.displayName=t.displayName}static _fromServerResponse(e,t){return"phoneInfo"in t?Ay._fromServerResponse(e,t):Km(e,"internal-error")}}class Ay extends Cy{constructor(e){super("phone",e),this.phoneNumber=e.phoneInfo}static _fromServerResponse(e,t){return new Ay(t)}}function Ny(e,t,n){var r;Hm(0<(null===(r=n.url)||void 0===r?void 0:r.length),e,"invalid-continue-uri"),Hm(void 0===n.dynamicLinkDomain||0<n.dynamicLinkDomain.length,e,"invalid-dynamic-link-domain"),t.continueUrl=n.url,t.dynamicLinkDomain=n.dynamicLinkDomain,t.canHandleCodeInApp=n.handleCodeInApp,n.iOS&&(Hm(0<n.iOS.bundleId.length,e,"missing-ios-bundle-id"),t.iOSBundleId=n.iOS.bundleId),n.android&&(Hm(0<n.android.packageName.length,e,"missing-android-pkg-name"),t.androidInstallApp=n.android.installApp,t.androidMinimumVersionCode=n.android.minimumVersion,t.androidPackageName=n.android.packageName)}async function xy(e,t,n){var r=Wd(e),i={requestType:"PASSWORD_RESET",email:t};n&&Ny(r,i,n),await Qv(r,i)}async function Ry(e,t){await cv(e=Wd(e),"POST","/v1/accounts:update",av(e,{oobCode:t}))}async function Py(e,t){var n=Wd(e),r=await Gv(n,{oobCode:t}),i=r.requestType;switch(Hm(i,n,"internal-error"),i){case"EMAIL_SIGNIN":break;case"VERIFY_AND_CHANGE_EMAIL":Hm(r.newEmail,n,"internal-error");break;case"REVERT_SECOND_FACTOR_ADDITION":Hm(r.mfaInfo,n,"internal-error");default:Hm(r.email,n,"internal-error")}let s=null;return r.mfaInfo&&(s=Cy._fromServerResponse(qv(n),r.mfaInfo)),{data:{email:("VERIFY_AND_CHANGE_EMAIL"===r.requestType?r.newEmail:r.email)||null,previousEmail:("VERIFY_AND_CHANGE_EMAIL"===r.requestType?r.email:r.newEmail)||null,multiFactorInfo:s},operation:i}}async function Dy(e,t,n){var r=Wd(e),i={requestType:"EMAIL_SIGNIN",email:t};Hm(n.handleCodeInApp,r,"argument-error"),n&&Ny(r,i,n),await Qv(r,i)}async function Oy(e,t){var n=ev()?Zm():"http://localhost",n=(await cv(e=Wd(e),"POST","/v1/accounts:createAuthUri",av(e,{identifier:t,continueUri:n})))["signinMethods"];return n||[]}async function My(e,t){var n=Wd(e),r={requestType:"VERIFY_EMAIL",idToken:await e.getIdToken()};t&&Ny(n.auth,r,t);var r=(await Qv(n.auth,r))["email"];r!==e.email&&await e.reload()}async function Ly(e,t,n){var r=Wd(e),i={requestType:"VERIFY_AND_CHANGE_EMAIL",idToken:await e.getIdToken(),newEmail:t};n&&Ny(r.auth,i,n);var i=(await Qv(r.auth,i))["email"];i!==e.email&&await e.reload()}async function Fy(e,{displayName:t,photoURL:n}){if(void 0!==t||void 0!==n){const i=Wd(e);var r=await i.getIdToken(),r=await vv(i,async function(e,t){return cv(e,"POST","/v1/accounts:update",t)}(i.auth,{idToken:r,displayName:t,photoUrl:n,returnSecureToken:!0}));i.displayName=r.displayName||null,i.photoURL=r.photoUrl||null;const s=i.providerData.find(({providerId:e})=>"password"===e);s&&(s.displayName=i.displayName,s.photoURL=i.photoURL),await i._updateTokensIfNecessary(r)}}async function Uy(e,t,n){var r=e["auth"];const i={idToken:await e.getIdToken(),returnSecureToken:!0};t&&(i.email=t),n&&(i.password=n);r=await vv(e,Hv(r,i));await e._updateTokensIfNecessary(r,!0)}class Vy{constructor(e,t,n={}){this.isNewUser=e,this.providerId=t,this.profile=n}}class jy extends Vy{constructor(e,t,n,r){super(e,t,n),this.username=r}}class qy extends Vy{constructor(e,t){super(e,"facebook.com",t)}}class By extends jy{constructor(e,t){super(e,"github.com",t,"string"==typeof(null==t?void 0:t.login)?null==t?void 0:t.login:null)}}class Ky extends Vy{constructor(e,t){super(e,"google.com",t)}}class $y extends jy{constructor(e,t,n){super(e,"twitter.com",t,n)}}function zy(e){var{user:t,_tokenResponse:n}=e;return t.isAnonymous&&!n?{providerId:null,isNewUser:!1,profile:null}:function(e){if(!e)return null;var t=e["providerId"],n=e.rawUserInfo?JSON.parse(e.rawUserInfo):{},r=e.isNewUser||"identitytoolkit#SignupNewUserResponse"===e.kind;if(!t&&null!=e&&e.idToken){var i=null===(i=null===(i=mv(e.idToken))||void 0===i?void 0:i.firebase)||void 0===i?void 0:i.sign_in_provider;if(i){i="anonymous"!==i&&"custom"!==i?i:null;return new Vy(r,i)}}if(!t)return null;switch(t){case"facebook.com":return new qy(r,n);case"github.com":return new By(r,n);case"google.com":return new Ky(r,n);case"twitter.com":return new $y(r,n,e.screenName||null);case"custom":case"anonymous":return new Vy(r,null);default:return new Vy(r,t,n)}}(n)}class Wy{constructor(e,t){this.type=e,this.credential=t}static _fromIdtoken(e){return new Wy("enroll",e)}static _fromMfaPendingCredential(e){return new Wy("signin",e)}toJSON(){return{multiFactorSession:{["enroll"===this.type?"idToken":"pendingCredential"]:this.credential}}}static fromJSON(e){var t;if(null!=e&&e.multiFactorSession){if(null!==(t=e.multiFactorSession)&&void 0!==t&&t.pendingCredential)return Wy._fromMfaPendingCredential(e.multiFactorSession.pendingCredential);if(null!==(t=e.multiFactorSession)&&void 0!==t&&t.idToken)return Wy._fromIdtoken(e.multiFactorSession.idToken)}return null}}class Gy{constructor(e,t,n){this.session=e,this.hints=t,this.signInResolver=n}static _fromError(e,i){const s=qv(e),o=i.customData._serverResponse;var t=(o.mfaInfo||[]).map(e=>Cy._fromServerResponse(s,e));Hm(o.mfaPendingCredential,s,"internal-error");const a=Wy._fromMfaPendingCredential(o.mfaPendingCredential);return new Gy(a,t,async e=>{var t=await e._process(s,a);delete o.mfaInfo,delete o.mfaPendingCredential;var n=Object.assign(Object.assign({},o),{idToken:t.idToken,refreshToken:t.refreshToken});switch(i.operationType){case"signIn":var r=await fy._fromIdTokenResponse(s,i.operationType,n);return await s._updateCurrentUser(r.user),r;case"reauthenticate":return Hm(i.user,s,"internal-error"),fy._forOperation(i.user,i.operationType,n);default:Km(s,"internal-error")}})}async resolveSignIn(e){return this.signInResolver(e)}}class Hy{constructor(t){this.user=t,this.enrolledFactors=[],t._onReload(e=>{e.mfaInfo&&(this.enrolledFactors=e.mfaInfo.map(e=>Cy._fromServerResponse(t.auth,e)))})}static _fromUser(e){return new Hy(e)}async getSession(){return Wy._fromIdtoken(await this.user.getIdToken())}async enroll(e,t){const n=e;var r=await this.getSession(),r=await vv(this.user,n._process(this.user.auth,r,t));return await this.user._updateTokensIfNecessary(r),this.user.reload()}async unenroll(e){const t="string"==typeof e?e:e.uid;var n,r=await this.user.getIdToken(),r=await vv(this.user,(n=this.user.auth,e={idToken:r,mfaEnrollmentId:t},cv(n,"POST","/v2/accounts/mfaEnrollment:withdraw",av(n,e))));this.enrolledFactors=this.enrolledFactors.filter(({uid:e})=>e!==t),await this.user._updateTokensIfNecessary(r);try{await this.user.reload()}catch(e){if("auth/user-token-expired"!==(null===e||void 0===e?void 0:e.code))throw e}}}const Qy=new WeakMap;const Yy="__sak";class Jy{constructor(e,t){this.storageRetriever=e,this.type=t}_isAvailable(){try{return this.storage?(this.storage.setItem(Yy,"1"),this.storage.removeItem(Yy),Promise.resolve(!0)):Promise.resolve(!1)}catch(e){return Promise.resolve(!1)}}_set(e,t){return this.storage.setItem(e,JSON.stringify(t)),Promise.resolve()}_get(e){var t=this.storage.getItem(e);return Promise.resolve(t?JSON.parse(t):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}class Xy extends Jy{constructor(){var e;super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(e,t)=>this.onStorageEvent(e,t),this.listeners={},this.localCache={},this.pollTimer=null,this.safariLocalStorageNotSynced=(xv(e=od())||Lv(e))&&function(){try{return!(!window||window===window.top)}catch(e){return!1}}(),this.fallbackToPolling=Fv(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const r of Object.keys(this.listeners)){var t=this.storage.getItem(r),n=this.localCache[r];t!==n&&e(r,n,t)}}onStorageEvent(e,t=!1){if(e.key){const r=e.key;if(t?this.detachListener():this.stopPolling(),this.safariLocalStorageNotSynced){const i=this.storage.getItem(r);if(e.newValue!==i)null!==e.newValue?this.storage.setItem(r,e.newValue):this.storage.removeItem(r);else if(this.localCache[r]===e.newValue&&!t)return}var n=()=>{var e=this.storage.getItem(r);!t&&this.localCache[r]===e||this.notifyListeners(r,e)};const i=this.storage.getItem(r);hd()&&10===document.documentMode&&i!==e.newValue&&e.newValue!==e.oldValue?setTimeout(n,10):n()}else this.forAllChangedKeys((e,t,n)=>{this.notifyListeners(e,n)})}notifyListeners(e,t){this.localCache[e]=t;var n=this.listeners[e];if(n)for(const r of Array.from(n))r(t&&JSON.parse(t))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((e,t,n)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:t,newValue:n}),!0)})},1e3)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,t){0===Object.keys(this.listeners).length&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),0===this.listeners[e].size&&delete this.listeners[e]),0===Object.keys(this.listeners).length&&(this.detachListener(),this.stopPolling())}async _set(e,t){await super._set(e,t),this.localCache[e]=JSON.stringify(t)}async _get(e){var t=await super._get(e);return this.localCache[e]=JSON.stringify(t),t}async _remove(e){await super._remove(e),delete this.localCache[e]}}Xy.type="LOCAL";const Zy=Xy;class e_ extends Jy{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(e,t){}_removeListener(e,t){}}e_.type="SESSION";const t_=e_;class n_{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(t){var e=this.receivers.find(e=>e.isListeningto(t));if(e)return e;e=new n_(t);return this.receivers.push(e),e}isListeningto(e){return this.eventTarget===e}async handleEvent(e){const t=e,{eventId:n,eventType:r,data:i}=t.data;var s=this.handlersMap[r];null!=s&&s.size&&(t.ports[0].postMessage({status:"ack",eventId:n,eventType:r}),s=Array.from(s).map(async e=>e(t.origin,i)),s=await Promise.all(s.map(async e=>{try{return{fulfilled:!0,value:await e}}catch(e){return{fulfilled:!1,reason:e}}})),t.ports[0].postMessage({status:"done",eventId:n,eventType:r,response:s}))}_subscribe(e,t){0===Object.keys(this.handlersMap).length&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(t)}_unsubscribe(e,t){this.handlersMap[e]&&t&&this.handlersMap[e].delete(t),t&&0!==this.handlersMap[e].size||delete this.handlersMap[e],0===Object.keys(this.handlersMap).length&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}function r_(e="",t=10){let n="";for(let r=0;r<t;r++)n+=Math.floor(10*Math.random());return e+n}n_.receivers=[];class i_{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,t,o=50){const a="undefined"!=typeof MessageChannel?new MessageChannel:null;if(!a)throw new Error("connection_unavailable");let c,l;return new Promise((n,r)=>{const i=r_("",20);a.port1.start();const s=setTimeout(()=>{r(new Error("unsupported_event"))},o);l={messageChannel:a,onMessage(e){var t=e;if(t.data.eventId===i)switch(t.data.status){case"ack":clearTimeout(s),c=setTimeout(()=>{r(new Error("timeout"))},3e3);break;case"done":clearTimeout(c),n(t.data.response);break;default:clearTimeout(s),clearTimeout(c),r(new Error("invalid_response"))}}},this.handlers.add(l),a.port1.addEventListener("message",l.onMessage),this.target.postMessage({eventType:e,eventId:i,data:t},[a.port2])}).finally(()=>{l&&this.removeMessageHandler(l)})}}function s_(){return window}function o_(){return void 0!==s_().WorkerGlobalScope&&"function"==typeof s_().importScripts}const a_="firebaseLocalStorageDb",c_="firebaseLocalStorage",l_="fbase_key";class u_{constructor(e){this.request=e}toPromise(){return new Promise((e,t)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{t(this.request.error)})})}}function h_(e,t){return e.transaction([c_],t?"readwrite":"readonly").objectStore(c_)}function d_(){const r=indexedDB.open(a_,1);return new Promise((n,t)=>{r.addEventListener("error",()=>{t(r.error)}),r.addEventListener("upgradeneeded",()=>{const e=r.result;try{e.createObjectStore(c_,{keyPath:l_})}catch(e){t(e)}}),r.addEventListener("success",async()=>{const e=r.result;var t;e.objectStoreNames.contains(c_)?n(e):(e.close(),t=indexedDB.deleteDatabase(a_),await new u_(t).toPromise(),n(await d_()))})})}async function f_(e,t,n){var r=h_(e,!0).put({fbase_key:t,value:n});return new u_(r).toPromise()}function p_(e,t){var n=h_(e,!0).delete(t);return new u_(n).toPromise()}class g_{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db||(this.db=await d_(),this.db)}async _withRetries(e){let t=0;for(;;)try{return e(await this._openDb())}catch(e){if(3<t++)throw e;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return o_()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=n_._getInstance(o_()?self:null),this.receiver._subscribe("keyChanged",async(e,t)=>{const n=await this._poll();return{keyProcessed:n.includes(t.key)}}),this.receiver._subscribe("ping",async(e,t)=>["keyChanged"])}async initializeSender(){var e,t,n;this.activeServiceWorker=await async function(){if(null===navigator||void 0===navigator||!navigator.serviceWorker)return null;try{return(await navigator.serviceWorker.ready).active}catch(e){return null}}(),this.activeServiceWorker&&(this.sender=new i_(this.activeServiceWorker),(n=await this.sender._send("ping",{},800))&&null!==(e=n[0])&&void 0!==e&&e.fulfilled&&null!==(t=n[0])&&void 0!==t&&t.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0))}async notifyServiceWorker(e){var t;if(this.sender&&this.activeServiceWorker&&((null===(t=null===navigator||void 0===navigator?void 0:navigator.serviceWorker)||void 0===t?void 0:t.controller)||null)===this.activeServiceWorker)try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch(e){}}async _isAvailable(){try{if(!indexedDB)return!1;var e=await d_();return await f_(e,Yy,"1"),await p_(e,Yy),!0}catch(e){}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(t,n){return this._withPendingWrite(async()=>(await this._withRetries(e=>f_(e,t,n)),this.localCache[t]=n,this.notifyServiceWorker(t)))}async _get(t){var e=await this._withRetries(e=>async function(e,t){var n=h_(e,!1).get(t);return void 0===(n=await new u_(n).toPromise())?null:n.value}(e,t));return this.localCache[t]=e}async _remove(t){return this._withPendingWrite(async()=>(await this._withRetries(e=>p_(e,t)),delete this.localCache[t],this.notifyServiceWorker(t)))}async _poll(){var e,t,n=await this._withRetries(e=>{var t=h_(e,!1).getAll();return new u_(t).toPromise()});if(!n)return[];if(0!==this.pendingWrites)return[];const r=[],i=new Set;for({fbase_key:e,value:t}of n)i.add(e),JSON.stringify(this.localCache[e])!==JSON.stringify(t)&&(this.notifyListeners(e,t),r.push(e));for(const s of Object.keys(this.localCache))this.localCache[s]&&!i.has(s)&&(this.notifyListeners(s,null),r.push(s));return r}notifyListeners(e,t){this.localCache[e]=t;var n=this.listeners[e];if(n)for(const r of Array.from(n))r(t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),800)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,t){0===Object.keys(this.listeners).length&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),0===this.listeners[e].size&&delete this.listeners[e]),0===Object.keys(this.listeners).length&&this.stopPolling()}}g_.type="LOCAL";const m_=g_;function v_(i){return new Promise((e,n)=>{const t=document.createElement("script");var r;t.setAttribute("src",i),t.onload=e,t.onerror=e=>{const t=$m("internal-error");t.customData=e,n(t)},t.type="text/javascript",t.charset="UTF-8",(null!==(r=null===(r=document.getElementsByTagName("head"))||void 0===r?void 0:r[0])&&void 0!==r?r:document).appendChild(t)})}function y_(e){return`__${e}${Math.floor(1e6*Math.random())}`}class __{constructor(e){this.auth=e,this.counter=1e12,this._widgets=new Map}render(e,t){var n=this.counter;return this._widgets.set(n,new w_(e,this.auth.name,t||{})),this.counter++,n}reset(e){var t,n=e||1e12;null===(t=this._widgets.get(n))||void 0===t||t.delete(),this._widgets.delete(n)}getResponse(e){var t;return(null===(t=this._widgets.get(e||1e12))||void 0===t?void 0:t.getResponse())||""}async execute(e){var t;return null===(t=this._widgets.get(e||1e12))||void 0===t||t.execute(),""}}class w_{constructor(e,t,n){this.params=n,this.timerId=null,this.deleted=!1,this.responseToken=null,this.clickHandler=()=>{this.execute()};var r="string"==typeof e?document.getElementById(e):e;Hm(r,"argument-error",{appName:t}),this.container=r,this.isVisible="invisible"!==this.params.size,this.isVisible?this.execute():this.container.addEventListener("click",this.clickHandler)}getResponse(){return this.checkIfDeleted(),this.responseToken}delete(){this.checkIfDeleted(),this.deleted=!0,this.timerId&&(clearTimeout(this.timerId),this.timerId=null),this.container.removeEventListener("click",this.clickHandler)}execute(){this.checkIfDeleted(),this.timerId||(this.timerId=window.setTimeout(()=>{this.responseToken=function(e){const t=[],n="1234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ";for(let r=0;r<e;r++)t.push(n.charAt(Math.floor(Math.random()*n.length)));return t.join("")}(50);const{callback:e,"expired-callback":t}=this.params;if(e)try{e(this.responseToken)}catch(e){}this.timerId=window.setTimeout(()=>{if(this.timerId=null,this.responseToken=null,t)try{t()}catch(e){}this.isVisible&&this.execute()},6e4)},500))}checkIfDeleted(){if(this.deleted)throw new Error("reCAPTCHA mock was already deleted!")}}const b_=y_("rcb"),I_=new nv(3e4,6e4);class T_{constructor(){var e;this.hostLanguage="",this.counter=0,this.librarySeparatelyLoaded=!(null===(e=s_().grecaptcha)||void 0===e||!e.render)}load(s,o=""){var e;return Hm((e=o).length<=6&&/^\s*[a-zA-Z0-9\-]*\s*$/.test(e),s,"argument-error"),this.shouldResolveImmediately(o)?Promise.resolve(s_().grecaptcha):new Promise((t,n)=>{const i=s_().setTimeout(()=>{n($m(s,"network-request-failed"))},I_.get());s_()[b_]=()=>{s_().clearTimeout(i),delete s_()[b_];const e=s_().grecaptcha;if(e){const r=e.render;e.render=(e,t)=>{var n=r(e,t);return this.counter++,n},this.hostLanguage=o,t(e)}else n($m(s,"internal-error"))},v_(`https://www.google.com/recaptcha/api.js??${Ad({onload:b_,render:"explicit",hl:o})}`).catch(()=>{clearTimeout(i),n($m(s,"internal-error"))})})}clearedOneInstance(){this.counter--}shouldResolveImmediately(e){var t;return!(null===(t=s_().grecaptcha)||void 0===t||!t.render)&&(e===this.hostLanguage||0<this.counter||this.librarySeparatelyLoaded)}}class E_{async load(e){return new __(e)}clearedOneInstance(){}}const S_="recaptcha",k_={theme:"light",type:"image"};class C_{constructor(e,t=Object.assign({},k_),n){this.parameters=t,this.type=S_,this.destroyed=!1,this.widgetId=null,this.tokenChangeListeners=new Set,this.renderPromise=null,this.recaptcha=null,this.auth=qv(n),this.isInvisible="invisible"===this.parameters.size,Hm("undefined"!=typeof document,this.auth,"operation-not-supported-in-this-environment");var r="string"==typeof e?document.getElementById(e):e;Hm(r,this.auth,"argument-error"),this.container=r,this.parameters.callback=this.makeTokenCallback(this.parameters.callback),this._recaptchaLoader=new(this.auth.settings.appVerificationDisabledForTesting?E_:T_),this.validateStartingState()}async verify(){this.assertNotDestroyed();const e=await this.render(),r=this.getAssertedRecaptcha();var t=r.getResponse(e);return t||new Promise(t=>{const n=e=>{e&&(this.tokenChangeListeners.delete(n),t(e))};this.tokenChangeListeners.add(n),this.isInvisible&&r.execute(e)})}render(){try{this.assertNotDestroyed()}catch(e){return Promise.reject(e)}return this.renderPromise||(this.renderPromise=this.makeRenderPromise().catch(e=>{throw this.renderPromise=null,e}),this.renderPromise)}_reset(){this.assertNotDestroyed(),null!==this.widgetId&&this.getAssertedRecaptcha().reset(this.widgetId)}clear(){this.assertNotDestroyed(),this.destroyed=!0,this._recaptchaLoader.clearedOneInstance(),this.isInvisible||this.container.childNodes.forEach(e=>{this.container.removeChild(e)})}validateStartingState(){Hm(!this.parameters.sitekey,this.auth,"argument-error"),Hm(this.isInvisible||!this.container.hasChildNodes(),this.auth,"argument-error"),Hm("undefined"!=typeof document,this.auth,"operation-not-supported-in-this-environment")}makeTokenCallback(n){return t=>{if(this.tokenChangeListeners.forEach(e=>e(t)),"function"==typeof n)n(t);else if("string"==typeof n){const e=s_()[n];"function"==typeof e&&e(t)}}}assertNotDestroyed(){Hm(!this.destroyed,this.auth,"internal-error")}async makeRenderPromise(){if(await this.init(),!this.widgetId){let e=this.container;var t;this.isInvisible||(t=document.createElement("div"),e.appendChild(t),e=t),this.widgetId=this.getAssertedRecaptcha().render(e,this.parameters)}return this.widgetId}async init(){Hm(ev()&&!o_(),this.auth,"internal-error"),await function(){let t=null;return new Promise(e=>{"complete"!==document.readyState?(t=()=>e(),window.addEventListener("load",t)):e()}).catch(e=>{throw t&&window.removeEventListener("load",t),e})}(),this.recaptcha=await this._recaptchaLoader.load(this.auth,this.auth.languageCode||void 0);var e=await((await cv(this.auth,"GET","/v1/recaptchaParams")).recaptchaSiteKey||"");Hm(e,this.auth,"internal-error"),this.parameters.sitekey=e}getAssertedRecaptcha(){return Hm(this.recaptcha,this.auth,"internal-error"),this.recaptcha}}class A_{constructor(e,t){this.verificationId=e,this.onConfirmation=t}confirm(e){var t=ey._fromVerification(this.verificationId,e);return this.onConfirmation(t)}}async function N_(t,n,r){var i,s,o,a,c,l,u=await r.verify();try{Hm("string"==typeof u,t,"argument-error"),Hm(r.type===S_,t,"argument-error");let e;if(e="string"==typeof n?{phoneNumber:n}:n,"session"in e){var h=e.session;if("phoneNumber"in e)return Hm("enroll"===h.type,t,"internal-error"),(c=t,l={idToken:h.credential,phoneEnrollmentInfo:{phoneNumber:e.phoneNumber,recaptchaToken:u}},await cv(c,"POST","/v2/accounts/mfaEnrollment:start",av(c,l))).phoneSessionInfo.sessionInfo;Hm("signin"===h.type,t,"internal-error");var d=(null===(i=e.multiFactorHint)||void 0===i?void 0:i.uid)||e.multiFactorUid;return Hm(d,t,"missing-multi-factor-info"),(a={mfaPendingCredential:h.credential,mfaEnrollmentId:d,phoneSignInInfo:{recaptchaToken:u}},await cv(t,"POST","/v2/accounts/mfaSignIn:start",av(t,a))).phoneResponseInfo.sessionInfo}var f=(s=t,o={phoneNumber:e.phoneNumber,recaptchaToken:u},await cv(s,"POST","/v1/accounts:sendVerificationCode",av(s,o)))["sessionInfo"];return f}finally{r._reset()}}class x_{constructor(e){this.providerId=x_.PROVIDER_ID,this.auth=qv(e)}verifyPhoneNumber(e,t){return N_(this.auth,e,Wd(t))}static credential(e,t){return ey._fromVerification(e,t)}static credentialFromResult(e){var t=e;return x_.credentialFromTaggedObject(t)}static credentialFromError(e){return x_.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;var{phoneNumber:t,temporaryProof:n}=e;return t&&n?ey._fromTokenResponse(t,n):null}}function R_(e,t){return t?Xm(t):(Hm(e._popupRedirectResolver,e,"argument-error"),e._popupRedirectResolver)}x_.PROVIDER_ID="phone",x_.PHONE_SIGN_IN_METHOD="phone";class P_ extends Wv{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return Jv(e,this._buildIdpRequest())}_linkToIdToken(e,t){return Jv(e,this._buildIdpRequest(t))}_getReauthenticationResolver(e){return Jv(e,this._buildIdpRequest())}_buildIdpRequest(e){const t={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(t.idToken=e),t}}function D_(e){return Iy(e.auth,new P_(e),e.bypassAuthState)}function O_(e){var{auth:t,user:n}=e;return Hm(n,t,"internal-error"),by(n,new P_(e),e.bypassAuthState)}async function M_(e){var{auth:t,user:n}=e;return Hm(n,t,"internal-error"),_y(n,new P_(e),e.bypassAuthState)}class L_{constructor(e,t,n,r,i=!1){this.auth=e,this.resolver=n,this.user=r,this.bypassAuthState=i,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(t)?t:[t]}execute(){return new Promise(async(e,t)=>{this.pendingPromise={resolve:e,reject:t};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(e){this.reject(e)}})}async onAuthEvent(e){var{urlResponse:t,sessionId:n,postBody:r,tenantId:i,error:s,type:o}=e;if(s)this.reject(s);else{r={auth:this.auth,requestUri:t,sessionId:n,tenantId:i||void 0,postBody:r||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(o)(r))}catch(e){this.reject(e)}}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return D_;case"linkViaPopup":case"linkViaRedirect":return M_;case"reauthViaPopup":case"reauthViaRedirect":return O_;default:Km(this.auth,"internal-error")}}resolve(e){Ym(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){Ym(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}const F_=new nv(2e3,1e4);class U_ extends L_{constructor(e,t,n,r,i){super(e,t,r,i),this.provider=n,this.authWindow=null,this.pollId=null,U_.currentPopupAction&&U_.currentPopupAction.cancel(),U_.currentPopupAction=this}async executeNotNull(){var e=await this.execute();return Hm(e,this.auth,"internal-error"),e}async onExecution(){Ym(1===this.filter.length,"Popup operations only handle one event");var e=r_();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch(e=>{this.reject(e)}),this.resolver._isIframeWebStorageSupported(this.auth,e=>{e||this.reject($m(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){var e;return(null===(e=this.authWindow)||void 0===e?void 0:e.associatedEvent)||null}cancel(){this.reject($m(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,U_.currentPopupAction=null}pollUserCancellation(){const t=()=>{var e;null!==(e=null===(e=this.authWindow)||void 0===e?void 0:e.window)&&void 0!==e&&e.closed?this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject($m(this.auth,"popup-closed-by-user"))},2e3):this.pollId=window.setTimeout(t,F_.get())};t()}}U_.currentPopupAction=null;const V_="pendingRedirect",j_=new Map;class q_ extends L_{constructor(e,t,n=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],t,void 0,n),this.eventId=null}async execute(){let t=j_.get(this.auth._key());if(!t){try{const e=await async function(e,t){const n=z_(t),r=$_(e);if(!await r._isAvailable())return!1;var i="true"===await r._get(n);return await r._remove(n),i}(this.resolver,this.auth)?await super.execute():null;t=()=>Promise.resolve(e)}catch(e){t=()=>Promise.reject(e)}j_.set(this.auth._key(),t)}return this.bypassAuthState||j_.set(this.auth._key(),()=>Promise.resolve(null)),t()}async onAuthEvent(e){if("signInViaRedirect"===e.type)return super.onAuthEvent(e);if("unknown"!==e.type){if(e.eventId){var t=await this.auth._redirectUserForId(e.eventId);if(t)return this.user=t,super.onAuthEvent(e);this.resolve(null)}}else this.resolve(null)}async onExecution(){}cleanUp(){}}async function B_(e,t){return $_(e)._set(z_(t),"true")}function K_(e,t){j_.set(e._key(),t)}function $_(e){return Xm(e._redirectPersistence)}function z_(e){return kv(V_,e.config.apiKey,e.name)}function W_(e,t,n){return async function(e,t,n){var r=qv(e);Wm(e,t,ry);const i=R_(r,n);return await B_(i,r),i._openRedirect(r,t,"signInViaRedirect")}(e,t,n)}function G_(e,t,n){return async function(e,t,n){var r=Wd(e);Wm(r.auth,t,ry);const i=R_(r.auth,n);await B_(i,r.auth);var s=await Y_(r);return i._openRedirect(r.auth,t,"reauthViaRedirect",s)}(e,t,n)}function H_(e,t,n){return async function(e,t,n){var r=Wd(e);Wm(r.auth,t,ry);const i=R_(r.auth,n);await wy(!1,r,t.providerId),await B_(i,r.auth);var s=await Y_(r);return i._openRedirect(r.auth,t,"linkViaRedirect",s)}(e,t,n)}async function Q_(e,t,n=!1){const r=qv(e);var i=R_(r,t);const s=new q_(r,i,n),o=await s.execute();return o&&!n&&(delete o.user._redirectEventId,await r._persistUserIfCurrent(o.user),await r._setRedirectUser(null,t)),o}async function Y_(e){var t=r_(`${e.uid}:::`);return e._redirectEventId=t,await e.auth._setRedirectUser(e),await e.auth._persistUserIfCurrent(e),t}class J_{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(t){if(this.hasEventBeenHandled(t))return!1;let n=!1;return this.consumers.forEach(e=>{this.isEventForConsumer(t,e)&&(n=!0,this.sendToConsumer(t,e),this.saveEventToCache(t))}),this.hasHandledPotentialRedirect||!function(e){switch(e.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return Z_(e);default:return!1}}(t)||(this.hasHandledPotentialRedirect=!0,n||(this.queuedRedirectEvent=t,n=!0)),n}sendToConsumer(e,t){var n;e.error&&!Z_(e)?(n=(null===(n=e.error.code)||void 0===n?void 0:n.split("auth/")[1])||"internal-error",t.onError($m(this.auth,n))):t.onAuthEvent(e)}isEventForConsumer(e,t){var n=null===t.eventId||!!e.eventId&&e.eventId===t.eventId;return t.filter.includes(e.type)&&n}hasEventBeenHandled(e){return 6e5<=Date.now()-this.lastProcessedEventTime&&this.cachedEventUids.clear(),this.cachedEventUids.has(X_(e))}saveEventToCache(e){this.cachedEventUids.add(X_(e)),this.lastProcessedEventTime=Date.now()}}function X_(e){return[e.type,e.eventId,e.sessionId,e.tenantId].filter(e=>e).join("-")}function Z_({type:e,error:t}){return"unknown"===e&&"auth/no-auth-event"===(null==t?void 0:t.code)}async function ew(e,t={}){return cv(e,"GET","/v1/projects",t)}const tw=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,nw=/^https?/;async function rw(e){if(!e.config.emulator){var t=(await ew(e))["authorizedDomains"];for(const n of t)try{if(function(e){const t=Zm(),{protocol:n,hostname:r}=new URL(t);if(e.startsWith("chrome-extension://")){var i=new URL(e);return""===i.hostname&&""===r?"chrome-extension:"===n&&e.replace("chrome-extension://","")===t.replace("chrome-extension://",""):"chrome-extension:"===n&&i.hostname===r}if(!nw.test(n))return!1;if(tw.test(e))return r===e;const s=e.replace(/\./g,"\\."),o=new RegExp("^(.+\\."+s+"|"+s+")$","i");return o.test(r)}(n))return}catch(e){}Km(e,"unauthorized-domain")}}const iw=new nv(3e4,6e4);function sw(){const t=s_().___jsl;if(null!==t&&void 0!==t&&t.H)for(const n of Object.keys(t.H))if(t.H[n].r=t.H[n].r||[],t.H[n].L=t.H[n].L||[],t.H[n].r=[...t.H[n].L],t.CP)for(let e=0;e<t.CP.length;e++)t.CP[e]=null}let ow=null;function aw(e){var i;return ow=ow||(i=e,new Promise((e,t)=>{function n(){sw(),gapi.load("gapi.iframes",{callback:()=>{e(gapi.iframes.getContext())},ontimeout:()=>{sw(),t($m(i,"network-request-failed"))},timeout:iw.get()})}if(null!==(r=null===(r=s_().gapi)||void 0===r?void 0:r.iframes)&&void 0!==r&&r.Iframe)e(gapi.iframes.getContext());else{if(null===(r=s_().gapi)||void 0===r||!r.load){var r=y_("iframefcb");return s_()[r]=()=>{gapi.load?n():t($m(i,"network-request-failed"))},v_(`https://apis.google.com/js/api.js?onload=${r}`).catch(e=>t(e))}n()}}).catch(e=>{throw ow=null,e})),ow}const cw=new nv(5e3,15e3),lw="__/auth/iframe",uw="emulator/auth/iframe",hw={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},dw=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);async function fw(o){const e=await aw(o);var t=s_().gapi;return Hm(t,o,"internal-error"),e.open({where:document.body,url:function(e){var t=e.config;Hm(t.authDomain,e,"auth-domain-config-required");var n=t.emulator?rv(t,uw):`https://${e.config.authDomain}/${lw}`;const r={apiKey:t.apiKey,appName:e.name,v:Ff};(t=dw.get(e.config.apiHost))&&(r.eid=t);const i=e._getFrameworks();return i.length&&(r.fw=i.join(",")),`${n}?${Ad(r).slice(1)}`}(o),messageHandlersFilter:t.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:hw,dontclear:!0},s=>new Promise(async(e,t)=>{await s.restyle({setHideOnLeave:!1});const n=$m(o,"network-request-failed"),r=s_().setTimeout(()=>{t(n)},cw.get());function i(){s_().clearTimeout(r),e(s)}s.ping(i).then(i,()=>{t(n)})}))}const pw={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"};class gw{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch(e){}}}function mw(e,t,n,r=500,i=600){var s=Math.max((window.screen.availHeight-i)/2,0).toString(),o=Math.max((window.screen.availWidth-r)/2,0).toString();let a="";const c=Object.assign(Object.assign({},pw),{width:r.toString(),height:i.toString(),top:s,left:o});s=od().toLowerCase();n&&(a=Rv(s)?"_blank":n),Nv(s)&&(t=t||"http://localhost",c.scrollbars="yes");var l,o=Object.entries(c).reduce((e,[t,n])=>`${e}${t}=${n},`,"");if([n=od()]=[s],Lv(n)&&null!==(l=window.navigator)&&void 0!==l&&l.standalone&&"_self"!==a)return function(e,t){const n=document.createElement("a");n.href=e,n.target=t;const r=document.createEvent("MouseEvent");r.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),n.dispatchEvent(r)}(t||"",a),new gw(null);const u=window.open(t||"",a,o);Hm(u,e,"popup-blocked");try{u.focus()}catch(e){}return new gw(u)}const vw="__/auth/handler",yw="emulator/auth/handler";function _w(e,t,n,r,i,s){Hm(e.config.authDomain,e,"auth-domain-config-required"),Hm(e.config.apiKey,e,"invalid-api-key");const o={apiKey:e.config.apiKey,appName:e.name,authType:n,redirectUrl:r,v:Ff,eventId:i};if(t instanceof ry){t.setDefaultLanguage(e.languageCode),o.providerId=t.providerId||"",Ed(t.getCustomParameters())||(o.customParameters=JSON.stringify(t.getCustomParameters()));for(var[a,c]of Object.entries(s||{}))o[a]=c}if(t instanceof iy){const u=t.getScopes().filter(e=>""!==e);0<u.length&&(o.scopes=u.join(","))}e.tenantId&&(o.tid=e.tenantId);const l=o;for(const h of Object.keys(l))void 0===l[h]&&delete l[h];return`${e=[e["config"]][0],e.emulator?rv(e,yw):`https://${e.authDomain}/${vw}`}?${Ad(l).slice(1)}`}const ww="webStorageSupport";const bw=class{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=t_,this._completeRedirectFn=Q_,this._overrideRedirectResult=K_}async _openPopup(e,t,n,r){var i;return Ym(null===(i=this.eventManagers[e._key()])||void 0===i?void 0:i.manager,"_initialize() not called before _openPopup()"),mw(e,_w(e,t,n,Zm(),r),r_())}async _openRedirect(e,t,n,r){return await this._originValidation(e),r=_w(e,t,n,Zm(),r),s_().location.href=r,new Promise(()=>{})}_initialize(e){const t=e._key();if(this.eventManagers[t]){const{manager:r,promise:n}=this.eventManagers[t];return r?Promise.resolve(r):(Ym(n,"If manager is not set, promise should be"),n)}const n=this.initAndGetManager(e);return this.eventManagers[t]={promise:n},n.catch(()=>{delete this.eventManagers[t]}),n}async initAndGetManager(t){const e=await fw(t),n=new J_(t);return e.register("authEvent",e=>{return Hm(null==e?void 0:e.authEvent,t,"invalid-auth-event"),{status:n.onEvent(e.authEvent)?"ACK":"ERROR"}},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[t._key()]={manager:n},this.iframes[t._key()]=e,n}_isIframeWebStorageSupported(n,r){const e=this.iframes[n._key()];e.send(ww,{type:ww},e=>{var t=null===(t=null==e?void 0:e[0])||void 0===t?void 0:t[ww];void 0!==t&&r(!!t),Km(n,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){var t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=rw(e)),this.originValidationPromises[t]}get _shouldInitProactively(){return Fv()||xv()||Lv()}};class Iw extends class{constructor(e){this.factorId=e}_process(e,t,n){switch(t.type){case"enroll":return this._finalizeEnroll(e,t.credential,n);case"signin":return this._finalizeSignIn(e,t.credential);default:return Qm("unexpected MultiFactorSessionType")}}}{constructor(e){super("phone"),this.credential=e}static _fromCredential(e){return new Iw(e)}_finalizeEnroll(e,t,n){return e=e,n={idToken:t,displayName:n,phoneVerificationInfo:this.credential._makeVerificationRequest()},cv(e,"POST","/v2/accounts/mfaEnrollment:finalize",av(e,n))}_finalizeSignIn(e,t){return e=e,t={mfaPendingCredential:t,phoneVerificationInfo:this.credential._makeVerificationRequest()},cv(e,"POST","/v2/accounts/mfaSignIn:finalize",av(e,t))}}class Tw{constructor(){}static assertion(e){return Iw._fromCredential(e)}}Tw.FACTOR_ID="phone";var Ew,Sw="@firebase/auth";class kw{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){var e;return this.assertAuthConfigured(),(null===(e=this.auth.currentUser)||void 0===e?void 0:e.uid)||null}async getToken(e){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(e)}:null}addAuthTokenListener(t){var e;this.assertAuthConfigured(),this.internalListeners.has(t)||(e=this.auth.onIdTokenChanged(e=>{t((null===e||void 0===e?void 0:e.stsTokenManager.accessToken)||null)}),this.internalListeners.set(t,e),this.updateProactiveRefresh())}removeAuthTokenListener(e){this.assertAuthConfigured();const t=this.internalListeners.get(e);t&&(this.internalListeners.delete(e),t(),this.updateProactiveRefresh())}assertAuthConfigured(){Hm(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){0<this.internalListeners.size?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}function Cw(){return window}Ew="Browser",Df(new Gd("auth",(e,{options:r})=>{var t=e.getProvider("app").getImmediate(),n=e.getProvider("heartbeat");const{apiKey:i,authDomain:s}=t.options;return((e,t)=>{Hm(i&&!i.includes(":"),"invalid-api-key",{appName:e.name}),Hm(!(null!==s&&void 0!==s&&s.includes(":")),"argument-error",{appName:e.name});var n={apiKey:i,authDomain:s,clientPlatform:Ew,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:Uv(Ew)},n=new jv(e,t,n);return function(e,t){const n=(null==t?void 0:t.persistence)||[];var r=(Array.isArray(n)?n:[n]).map(Xm);null!=t&&t.errorMap&&e._updateErrorMap(t.errorMap),e._initializeWithPersistence(r,null==t?void 0:t.popupRedirectResolver)}(n,r),n})(t,n)},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,t,n)=>{const r=e.getProvider("auth-internal");r.initialize()})),Df(new Gd("auth-internal",e=>{var t=qv(e.getProvider("auth").getImmediate());return e=t,new kw(e)},"PRIVATE").setInstantiationMode("EXPLICIT")),qf(Sw,"0.20.5",function(e){switch(e){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";default:return}}(Ew)),qf(Sw,"0.20.5","esm2017");async function Aw(e,t,n){var r=Cw()["BuildInfo"];Ym(t.sessionId,"AuthEvent did not contain a session ID");var i=await async function(e){const t=function(e){if(Ym(/[0-9a-zA-Z]+/.test(e),"Can only convert alpha-numeric strings"),"undefined"!=typeof TextEncoder)return(new TextEncoder).encode(e);const t=new ArrayBuffer(e.length),n=new Uint8Array(t);for(let r=0;r<e.length;r++)n[r]=e.charCodeAt(r);return n}(e),n=await crypto.subtle.digest("SHA-256",t),r=Array.from(new Uint8Array(n));return r.map(e=>e.toString(16).padStart(2,"0")).join("")}(t.sessionId);const s={};return Lv()?s.ibi=r.packageName:Dv()?s.apn=r.packageName:Km(e,"operation-not-supported-in-this-environment"),r.displayName&&(s.appDisplayName=r.displayName),s.sessionId=i,_w(e,n,t.type,void 0,null!==(i=t.eventId)&&void 0!==i?i:void 0,s)}function Nw(r){const i=Cw()["cordova"];return new Promise(n=>{i.plugins.browsertab.isAvailable(e=>{let t=null;e?i.plugins.browsertab.openUrl(r):t=i.InAppBrowser.open(r,(e=od(),/(iPad|iPhone|iPod).*OS 7_\d/i.test(e)||/(iPad|iPhone|iPod).*OS 8_\d/i.test(e)?"_blank":"_system"),"location=yes"),n(t)})})}const xw=20;class Rw extends J_{constructor(){super(...arguments),this.passiveListeners=new Set,this.initPromise=new Promise(e=>{this.resolveInialized=e})}addPassiveListener(e){this.passiveListeners.add(e)}removePassiveListener(e){this.passiveListeners.delete(e)}resetRedirect(){this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1}onEvent(t){return this.resolveInialized(),this.passiveListeners.forEach(e=>e(t)),super.onEvent(t)}async initialized(){await this.initPromise}}function Pw(e,t,n=null){return{type:t,eventId:n,urlResponse:null,sessionId:function(){const e=[],t="1234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ";for(let r=0;r<xw;r++){var n=Math.floor(Math.random()*t.length);e.push(t.charAt(n))}return e.join("")}(),postBody:null,tenantId:e.tenantId,error:$m(e,"no-auth-event")}}async function Dw(e){var t=await Mw()._get(Lw(e));return t&&await Mw()._remove(Lw(e)),t}function Ow(e,t){var n,r,i;const s=(n=Fw(t=t),o=n.link?decodeURIComponent(n.link):void 0,r=Fw(o).link,i=n.deep_link_id?decodeURIComponent(n.deep_link_id):void 0,(n=Fw(i).link)||i||r||o||t);if(s.includes("/__/auth/callback")){var o=Fw(s),o=o.firebaseError?function(e){try{return JSON.parse(e)}catch(e){return null}}(decodeURIComponent(o.firebaseError)):null,o=null===(o=null===(o=null==o?void 0:o.code)||void 0===o?void 0:o.split("auth/"))||void 0===o?void 0:o[1],o=o?$m(o):null;return o?{type:e.type,eventId:e.eventId,tenantId:e.tenantId,error:o,urlResponse:null,sessionId:null,postBody:null}:{type:e.type,eventId:e.eventId,tenantId:e.tenantId,sessionId:e.sessionId,urlResponse:s,postBody:null}}return null}function Mw(){return Xm(Zy)}function Lw(e){return kv("authEvent",e.config.apiKey,e.name)}function Fw(e){if(null==e||!e.includes("?"))return{};const[,...t]=e.split("?");return Nd(t.join("?"))}const Uw=class{constructor(){this._redirectPersistence=t_,this._shouldInitProactively=!0,this.eventManagers=new Map,this.originValidationPromises={},this._completeRedirectFn=Q_,this._overrideRedirectResult=K_}async _initialize(e){var t=e._key();let n=this.eventManagers.get(t);return n||(n=new Rw(e),this.eventManagers.set(t,n),this.attachCallbackListeners(e,n)),n}_openPopup(e){Km(e,"operation-not-supported-in-this-environment")}async _openRedirect(e,t,n,r){var i,s;i=e,a=Cw(),Hm("function"==typeof(null===(s=null==a?void 0:a.universalLinks)||void 0===s?void 0:s.subscribe),i,"invalid-cordova-configuration",{missingPlugin:"cordova-universal-links-plugin-fix"}),Hm(void 0!==(null===(s=null==a?void 0:a.BuildInfo)||void 0===s?void 0:s.packageName),i,"invalid-cordova-configuration",{missingPlugin:"cordova-plugin-buildInfo"}),Hm("function"==typeof(null===(s=null===(s=null===(s=null==a?void 0:a.cordova)||void 0===s?void 0:s.plugins)||void 0===s?void 0:s.browsertab)||void 0===s?void 0:s.openUrl),i,"invalid-cordova-configuration",{missingPlugin:"cordova-plugin-browsertab"}),Hm("function"==typeof(null===(s=null===(s=null===(s=null==a?void 0:a.cordova)||void 0===s?void 0:s.plugins)||void 0===s?void 0:s.browsertab)||void 0===s?void 0:s.isAvailable),i,"invalid-cordova-configuration",{missingPlugin:"cordova-plugin-browsertab"}),Hm("function"==typeof(null===(a=null===(a=null==a?void 0:a.cordova)||void 0===a?void 0:a.InAppBrowser)||void 0===a?void 0:a.open),i,"invalid-cordova-configuration",{missingPlugin:"cordova-plugin-inappbrowser"});const o=await this._initialize(e);await o.initialized(),o.resetRedirect(),j_.clear(),await this._originValidation(e);var a=Pw(e,n,r);n=e,r=a,await Mw()._set(Lw(n),r);a=await Nw(await Aw(e,a,t));return async function(o,a,c){const l=Cw()["cordova"];let u=()=>{};try{await new Promise((n,e)=>{let t=null;function r(){var e;n();const t=null===(e=l.plugins.browsertab)||void 0===e?void 0:e.close;"function"==typeof t&&t(),"function"==typeof(null==c?void 0:c.close)&&c.close()}function i(){t=t||window.setTimeout(()=>{e($m(o,"redirect-cancelled-by-user"))},2e3)}function s(){"visible"===(null===document||void 0===document?void 0:document.visibilityState)&&i()}a.addPassiveListener(r),document.addEventListener("resume",i,!1),Dv()&&document.addEventListener("visibilitychange",s,!1),u=()=>{a.removePassiveListener(r),document.removeEventListener("resume",i,!1),document.removeEventListener("visibilitychange",s,!1),t&&window.clearTimeout(t)}})}finally{u()}}(e,o,a)}_isIframeWebStorageSupported(e,t){throw new Error("Method not implemented.")}_originValidation(e){var t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=async function(e){var t=Cw()["BuildInfo"];const n={};Lv()?n.iosBundleId=t.packageName:Dv()?n.androidPackageName=t.packageName:Km(e,"operation-not-supported-in-this-environment"),await ew(e,n)}(e)),this.originValidationPromises[t]}attachCallbackListeners(r,i){const{universalLinks:e,handleOpenURL:t,BuildInfo:n}=Cw(),s=setTimeout(async()=>{await Dw(r),i.onEvent(Vw())},500),o=async e=>{clearTimeout(s);var t=await Dw(r);let n=null;t&&null!=e&&e.url&&(n=Ow(t,e.url)),i.onEvent(n||Vw())};void 0!==e&&"function"==typeof e.subscribe&&e.subscribe(null,o);const a=t,c=`${n.packageName.toLowerCase()}://`;Cw().handleOpenURL=async e=>{if(e.toLowerCase().startsWith(c)&&o({url:e}),"function"==typeof a)try{a(e)}catch(e){console.error(e)}}}};function Vw(){return{type:"unknown",eventId:null,sessionId:null,urlResponse:null,postBody:null,tenantId:null,error:$m("no-auth-event")}}var jw;function qw(){var e;return(null===(e=null===self||void 0===self?void 0:self.location)||void 0===e?void 0:e.protocol)||null}function Bw(e=od()){return!("file:"!==qw()&&"ionic:"!==qw()&&"capacitor:"!==qw()||!e.toLowerCase().match(/iphone|ipad|ipod|android/))}function Kw(e=od()){return hd()&&11===(null===document||void 0===document?void 0:document.documentMode)||([e=od()]=[e],/Edge\/\d+/.test(e))}function $w(){try{const t=self.localStorage;var e=r_();if(t)return t.setItem(e,"1"),t.removeItem(e),!Kw()||fd()}catch(e){return zw()&&fd()}return!1}function zw(){return"undefined"!=typeof global&&"WorkerGlobalScope"in global&&"importScripts"in global}function Ww(){return("http:"===qw()||"https:"===qw()||ld()||Bw())&&!(ud()||cd())&&$w()&&!zw()}function Gw(){return Bw()&&"undefined"!=typeof document}const Hw={LOCAL:"local",NONE:"none",SESSION:"session"},Qw=Hm,Yw="persistence";async function Jw(e){await e._initializationPromise;const t=Xw();var n=kv(Yw,e.config.apiKey,e.name);t&&t.setItem(n,e._getPersistence())}function Xw(){var e;try{return(null===(e="undefined"!=typeof window?window:null)?void 0:e.sessionStorage)||null}catch(e){return null}}const Zw=Hm;class eb{constructor(){this.browserResolver=Xm(bw),this.cordovaResolver=Xm(Uw),this.underlyingResolver=null,this._redirectPersistence=t_,this._completeRedirectFn=Q_,this._overrideRedirectResult=K_}async _initialize(e){return await this.selectUnderlyingResolver(),this.assertedUnderlyingResolver._initialize(e)}async _openPopup(e,t,n,r){return await this.selectUnderlyingResolver(),this.assertedUnderlyingResolver._openPopup(e,t,n,r)}async _openRedirect(e,t,n,r){return await this.selectUnderlyingResolver(),this.assertedUnderlyingResolver._openRedirect(e,t,n,r)}_isIframeWebStorageSupported(e,t){this.assertedUnderlyingResolver._isIframeWebStorageSupported(e,t)}_originValidation(e){return this.assertedUnderlyingResolver._originValidation(e)}get _shouldInitProactively(){return Gw()||this.browserResolver._shouldInitProactively}get assertedUnderlyingResolver(){return Zw(this.underlyingResolver,"internal-error"),this.underlyingResolver}async selectUnderlyingResolver(){var e;this.underlyingResolver||(e=await(!!Gw()&&new Promise(e=>{const t=setTimeout(()=>{e(!1)},1e3);document.addEventListener("deviceready",()=>{clearTimeout(t),e(!0)})})),this.underlyingResolver=e?this.cordovaResolver:this.browserResolver)}}function tb(e){return e.unwrap()}function nb(e,t){var n,r,i,s=null===(r=t.customData)||void 0===r?void 0:r._tokenResponse;if("auth/multi-factor-auth-required"===(null===t||void 0===t?void 0:t.code)){const a=t;a.resolver=new ob(e,(n=t,i=Wd(e),Hm((o=n).customData.operationType,i,"argument-error"),Hm(null===(r=o.customData._serverResponse)||void 0===r?void 0:r.mfaPendingCredential,i,"argument-error"),Gy._fromError(i,o)))}else if(s){var o=rb(t);const c=t;o&&(c.credential=o,c.tenantId=s.tenantId||void 0,c.email=s.email||void 0,c.phoneNumber=s.phoneNumber||void 0)}}function rb(e){var t=(e instanceof md?e.customData:e)["_tokenResponse"];if(!t)return null;if(!(e instanceof md)&&"temporaryProof"in t&&"phoneNumber"in t)return x_.credentialFromResult(e);const n=t.providerId;if(!n||n===Mm.PASSWORD)return null;let r;switch(n){case Mm.GOOGLE:r=ay;break;case Mm.FACEBOOK:r=oy;break;case Mm.GITHUB:r=cy;break;case Mm.TWITTER:r=hy;break;default:var{oauthIdToken:i,oauthAccessToken:s,oauthTokenSecret:o,pendingToken:a,nonce:c}=t;return s||o||i||a?a?n.startsWith("saml.")?ly._create(n,a):Xv._fromParams({providerId:n,signInMethod:n,pendingToken:a,idToken:i,accessToken:s}):new sy(n).credential({idToken:i,accessToken:s,rawNonce:c}):null}return e instanceof md?r.credentialFromError(e):r.credentialFromResult(e)}function ib(t,e){return e.catch(e=>{throw e instanceof md&&nb(t,e),e}).then(e=>{var t=e.operationType,n=e.user;return{operationType:t,credential:rb(e),additionalUserInfo:zy(e),user:ab.getOrCreate(n)}})}async function sb(t,e){const n=await e;return{verificationId:n.verificationId,confirm:e=>ib(t,n.confirm(e))}}class ob{constructor(e,t){this.resolver=t,this.auth=e.wrapped()}get session(){return this.resolver.session}get hints(){return this.resolver.hints}resolveSignIn(e){return ib(tb(this.auth),this.resolver.resolveSignIn(e))}}class ab{constructor(e){var t;this._delegate=e,this.multiFactor=(t=Wd(e),Qy.has(t)||Qy.set(t,Hy._fromUser(t)),Qy.get(t))}static getOrCreate(e){return ab.USER_MAP.has(e)||ab.USER_MAP.set(e,new ab(e)),ab.USER_MAP.get(e)}delete(){return this._delegate.delete()}reload(){return this._delegate.reload()}toJSON(){return this._delegate.toJSON()}getIdTokenResult(e){return this._delegate.getIdTokenResult(e)}getIdToken(e){return this._delegate.getIdToken(e)}linkAndRetrieveDataWithCredential(e){return this.linkWithCredential(e)}async linkWithCredential(e){return ib(this.auth,Ey(this._delegate,e))}async linkWithPhoneNumber(e,t){return sb(this.auth,async function(e,t,n){const r=Wd(e);await wy(!1,r,"phone");var i=await N_(r.auth,t,Wd(n));return new A_(i,e=>Ey(r,e))}(this._delegate,e,t))}async linkWithPopup(e){return ib(this.auth,async function(e,t,n){var r=Wd(e);Wm(r.auth,t,ry);var i=R_(r.auth,n);const s=new U_(r.auth,"linkViaPopup",t,i,r);return s.executeNotNull()}(this._delegate,e,eb))}async linkWithRedirect(e){return await Jw(qv(this.auth)),H_(this._delegate,e,eb)}reauthenticateAndRetrieveDataWithCredential(e){return this.reauthenticateWithCredential(e)}async reauthenticateWithCredential(e){return ib(this.auth,Sy(this._delegate,e))}reauthenticateWithPhoneNumber(e,t){return sb(this.auth,async function(e,t,n){const r=Wd(e);var i=await N_(r.auth,t,Wd(n));return new A_(i,e=>Sy(r,e))}(this._delegate,e,t))}reauthenticateWithPopup(e){return ib(this.auth,async function(e,t,n){var r=Wd(e);Wm(r.auth,t,ry);var i=R_(r.auth,n);const s=new U_(r.auth,"reauthViaPopup",t,i,r);return s.executeNotNull()}(this._delegate,e,eb))}async reauthenticateWithRedirect(e){return await Jw(qv(this.auth)),G_(this._delegate,e,eb)}sendEmailVerification(e){return My(this._delegate,e)}async unlink(e){return await yy(this._delegate,e),this}updateEmail(e){return Uy(Wd(this._delegate),e,null)}updatePassword(e){return Uy(Wd(this._delegate),null,e)}updatePhoneNumber(e){return async function(e,t){await _y(Wd(e),t)}(this._delegate,e)}updateProfile(e){return Fy(this._delegate,e)}verifyBeforeUpdateEmail(e,t){return Ly(this._delegate,e,t)}get emailVerified(){return this._delegate.emailVerified}get isAnonymous(){return this._delegate.isAnonymous}get metadata(){return this._delegate.metadata}get phoneNumber(){return this._delegate.phoneNumber}get providerData(){return this._delegate.providerData}get refreshToken(){return this._delegate.refreshToken}get tenantId(){return this._delegate.tenantId}get displayName(){return this._delegate.displayName}get email(){return this._delegate.email}get photoURL(){return this._delegate.photoURL}get providerId(){return this._delegate.providerId}get uid(){return this._delegate.uid}get auth(){return this._delegate.auth}}ab.USER_MAP=new WeakMap;const cb=Hm;class lb{constructor(e,t){if(this.app=e,t.isInitialized())return this._delegate=t.getImmediate(),void this.linkUnderlyingAuth();var n=e.options["apiKey"];cb(n,"invalid-api-key",{appName:e.name}),cb(n,"invalid-api-key",{appName:e.name});var r="undefined"!=typeof window?eb:void 0;this._delegate=t.initialize({options:{persistence:function(e,t){const n=function(e,t){const n=Xw();if(!n)return[];var r=kv(Yw,e,t);switch(n.getItem(r)){case Hw.NONE:return[Sv];case Hw.LOCAL:return[m_,t_];case Hw.SESSION:return[t_];default:return[]}}(e,t);"undefined"==typeof self||n.includes(m_)||n.push(m_);if("undefined"!=typeof window)for(const r of[Zy,t_])n.includes(r)||n.push(r);n.includes(Sv)||n.push(Sv);return n}(n,e.name),popupRedirectResolver:r}}),this._delegate._updateErrorMap(Um),this.linkUnderlyingAuth()}get emulatorConfig(){return this._delegate.emulatorConfig}get currentUser(){return this._delegate.currentUser?ab.getOrCreate(this._delegate.currentUser):null}get languageCode(){return this._delegate.languageCode}set languageCode(e){this._delegate.languageCode=e}get settings(){return this._delegate.settings}get tenantId(){return this._delegate.tenantId}set tenantId(e){this._delegate.tenantId=e}useDeviceLanguage(){this._delegate.useDeviceLanguage()}signOut(){return this._delegate.signOut()}useEmulator(e,t){Kv(this._delegate,e,t)}applyActionCode(e){return Ry(this._delegate,e)}checkActionCode(e){return Py(this._delegate,e)}confirmPasswordReset(e,t){return async function(e,t,n){await Gv(Wd(e),{oobCode:t,newPassword:n})}(this._delegate,e,t)}async createUserWithEmailAndPassword(e,t){return ib(this._delegate,async function(e,t,n){const r=qv(e);var i=await dy(r,{returnSecureToken:!0,email:t,password:n}),i=await fy._fromIdTokenResponse(r,"signIn",i);return await r._updateCurrentUser(i.user),i}(this._delegate,e,t))}fetchProvidersForEmail(e){return this.fetchSignInMethodsForEmail(e)}fetchSignInMethodsForEmail(e){return Oy(this._delegate,e)}isSignInWithEmailLink(e){return this._delegate,e=e,"EMAIL_SIGNIN"===(null==(t=ty.parseLink(e))?void 0:t.operation);var t}async getRedirectResult(){cb(Ww(),this._delegate,"operation-not-supported-in-this-environment");var e,t,n=(e=this._delegate,t=eb,await qv(e)._initializationPromise,await Q_(e,t,!1));return n?ib(this._delegate,Promise.resolve(n)):{credential:null,user:null}}addFrameworkForLogging(e){qv(this._delegate)._logFramework(e)}onAuthStateChanged(e,t,n){var{next:r,error:i,complete:s}=ub(e,t,n);return this._delegate.onAuthStateChanged(r,i,s)}onIdTokenChanged(e,t,n){var{next:r,error:i,complete:s}=ub(e,t,n);return this._delegate.onIdTokenChanged(r,i,s)}sendSignInLinkToEmail(e,t){return Dy(this._delegate,e,t)}sendPasswordResetEmail(e,t){return xy(this._delegate,e,t||void 0)}async setPersistence(e){var t,n;t=this._delegate,n=e,Qw(Object.values(Hw).includes(n),t,"invalid-persistence-type"),ud()?Qw(n!==Hw.SESSION,t,"unsupported-persistence-type"):cd()?Qw(n===Hw.NONE,t,"unsupported-persistence-type"):zw()?Qw(n===Hw.NONE||n===Hw.LOCAL&&fd(),t,"unsupported-persistence-type"):Qw(n===Hw.NONE||$w(),t,"unsupported-persistence-type");let r;switch(e){case Hw.SESSION:r=t_;break;case Hw.LOCAL:var i=await Xm(m_)._isAvailable();r=i?m_:Zy;break;case Hw.NONE:r=Sv;break;default:return Km("argument-error",{appName:this._delegate.name})}return this._delegate.setPersistence(r)}signInAndRetrieveDataWithCredential(e){return this.signInWithCredential(e)}signInAnonymously(){return ib(this._delegate,async function(e){const t=qv(e);if(await t._initializationPromise,null!==(n=t.currentUser)&&void 0!==n&&n.isAnonymous)return new fy({user:t.currentUser,providerId:null,operationType:"signIn"});var n=await dy(t,{returnSecureToken:!0}),n=await fy._fromIdTokenResponse(t,"signIn",n,!0);return await t._updateCurrentUser(n.user),n}(this._delegate))}signInWithCredential(e){return ib(this._delegate,Ty(this._delegate,e))}signInWithCustomToken(e){return ib(this._delegate,ky(this._delegate,e))}signInWithEmailAndPassword(e,t){return ib(this._delegate,(n=this._delegate,e=e,t=t,Ty(Wd(n),ny.credential(e,t))));var n}signInWithEmailLink(e,t){return ib(this._delegate,async function(e,t,n){var r=Wd(e),i=ny.credentialWithLink(t,n||Zm());return Hm(i._tenantId===(r.tenantId||null),r,"tenant-id-mismatch"),Ty(r,i)}(this._delegate,e,t))}signInWithPhoneNumber(e,t){return sb(this._delegate,async function(e,t,n){const r=qv(e);var i=await N_(r,t,Wd(n));return new A_(i,e=>Ty(r,e))}(this._delegate,e,t))}async signInWithPopup(e){return cb(Ww(),this._delegate,"operation-not-supported-in-this-environment"),ib(this._delegate,async function(e,t,n){var r=qv(e);Wm(e,t,ry);var i=R_(r,n);const s=new U_(r,"signInViaPopup",t,i);return s.executeNotNull()}(this._delegate,e,eb))}async signInWithRedirect(e){return cb(Ww(),this._delegate,"operation-not-supported-in-this-environment"),await Jw(this._delegate),W_(this._delegate,e,eb)}updateCurrentUser(e){return this._delegate.updateCurrentUser(e)}verifyPasswordResetCode(e){return async function(e,t){var n=(await Py(Wd(e),t))["data"];return n.email}(this._delegate,e)}unwrap(){return this._delegate}_delete(){return this._delegate._delete()}linkUnderlyingAuth(){this._delegate.wrapped=()=>this}}function ub(e,t,n){let r=e;"function"!=typeof e&&({next:r,error:t,complete:n}=e);const i=r;return{next:e=>i(e&&ab.getOrCreate(e)),error:t,complete:n}}lb.Persistence=Hw;class hb{constructor(){this.providerId="phone",this._delegate=new x_(tb(op.auth()))}static credential(e,t){return x_.credential(e,t)}verifyPhoneNumber(e,t){return this._delegate.verifyPhoneNumber(e,t)}unwrap(){return this._delegate}}hb.PHONE_SIGN_IN_METHOD=x_.PHONE_SIGN_IN_METHOD,hb.PROVIDER_ID=x_.PROVIDER_ID;const db=Hm;class fb{constructor(e,t,n=op.app()){var r;db(null===(r=n.options)||void 0===r?void 0:r.apiKey,"invalid-api-key",{appName:n.name}),this._delegate=new C_(e,t,n.auth()),this.type=this._delegate.type}clear(){this._delegate.clear()}render(){return this._delegate.render()}verify(){return this._delegate.verify()}}(jw=op).INTERNAL.registerComponent(new Gd("auth-compat",e=>{var t=e.getProvider("app-compat").getImmediate(),n=e.getProvider("auth");return new lb(t,n)},"PUBLIC").setServiceProps({ActionCodeInfo:{Operation:{EMAIL_SIGNIN:Lm.EMAIL_SIGNIN,PASSWORD_RESET:Lm.PASSWORD_RESET,RECOVER_EMAIL:Lm.RECOVER_EMAIL,REVERT_SECOND_FACTOR_ADDITION:Lm.REVERT_SECOND_FACTOR_ADDITION,VERIFY_AND_CHANGE_EMAIL:Lm.VERIFY_AND_CHANGE_EMAIL,VERIFY_EMAIL:Lm.VERIFY_EMAIL}},EmailAuthProvider:ny,FacebookAuthProvider:oy,GithubAuthProvider:cy,GoogleAuthProvider:ay,OAuthProvider:sy,SAMLAuthProvider:uy,PhoneAuthProvider:hb,PhoneMultiFactorGenerator:Tw,RecaptchaVerifier:fb,TwitterAuthProvider:hy,Auth:lb,AuthCredential:Wv,Error:md}).setInstantiationMode("LAZY").setMultipleInstances(!1)),jw.registerVersion("@firebase/auth-compat","0.2.18");const pb="@firebase/database";let gb="";function mb(e){gb=e}class vb{constructor(e){this.domStorage_=e,this.prefix_="firebase:"}set(e,t){null==t?this.domStorage_.removeItem(this.prefixedName_(e)):this.domStorage_.setItem(this.prefixedName_(e),wd(t))}get(e){var t=this.domStorage_.getItem(this.prefixedName_(e));return null==t?null:_d(t)}remove(e){this.domStorage_.removeItem(this.prefixedName_(e))}prefixedName_(e){return this.prefix_+e}toString(){return this.domStorage_.toString()}}class yb{constructor(){this.cache_={},this.isInMemoryStorage=!0}set(e,t){null==t?delete this.cache_[e]:this.cache_[e]=t}get(e){return Id(this.cache_,e)?this.cache_[e]:null}remove(e){delete this.cache_[e]}}var _b,wb,bb,Ib,Tb,Eb,yt=function(e){try{if("undefined"!=typeof window&&void 0!==window[e]){const t=window[e];return t.setItem("firebase:sentinel","cache"),t.removeItem("firebase:sentinel"),new vb(t)}}catch(e){}return new yb};function Sb(e){var t=function(t){const n=[];let r=0;for(let o=0;o<t.length;o++){let e=t.charCodeAt(o);var i,s;55296<=e&&e<=56319&&(i=e-55296,o++,Jh(o<t.length,"Surrogate pair missing trail surrogate."),s=t.charCodeAt(o)-56320,e=65536+(i<<10)+s),e<128?n[r++]=e:(e<2048?n[r++]=e>>6|192:(e<65536?n[r++]=e>>12|224:(n[r++]=e>>18|240,n[r++]=e>>12&63|128),n[r++]=e>>6&63|128),n[r++]=63&e|128)}return n}(e);const n=new Rd;return n.update(t),t=n.digest(),ed.encodeByteArray(t)}const kb=yt("localStorage"),Cb=yt("sessionStorage"),Ab=new nf("@firebase/database"),Nb=function(){let e=1;return function(){return e++}}(),xb=function(...e){let t="";for(let r=0;r<e.length;r++){var n=e[r];Array.isArray(n)||n&&"object"==typeof n&&"number"==typeof n.length?t+=xb.apply(null,n):t+="object"==typeof n?wd(n):n,t+=" "}return t};let Rb=null,Pb=!0;function Db(t){return function(...e){jb(t,...e)}}function Ob(...e){var t="FIREBASE INTERNAL ERROR: "+xb(...e);Ab.error(t)}function Mb(e,t){return e===t?0:e<t?-1:1}function Lb(e,t){if(t&&e in t)return t[e];throw new Error("Missing required key ("+e+") in object: "+wd(t))}function Fb(e){if("object"!=typeof e||null===e)return wd(e);const t=[];for(const r in e)t.push(r);t.sort();let n="{";for(let i=0;i<t.length;i++)0!==i&&(n+=","),n+=wd(t[i]),n+=":",n+=Fb(e[t[i]]);return n+="}",n}function Ub(e,t){var n=e.length;if(n<=t)return[e];const r=[];for(let i=0;i<n;i+=t)i+t>n?r.push(e.substring(i,n)):r.push(e.substring(i,i+t));return r}const Vb=function(e,t){Jh(!t||!0===e||!1===e,"Can't turn on custom loggers persistently."),!0===e?(Ab.logLevel=$h.VERBOSE,Rb=Ab.log.bind(Ab),t&&Cb.set("logging_enabled",!0)):"function"==typeof e?Rb=e:(Rb=null,Cb.remove("logging_enabled"))},jb=function(...e){var t;!0===Pb&&(Pb=!1,null===Rb&&!0===Cb.get("logging_enabled")&&Vb(!0)),Rb&&(t=xb.apply(null,e),Rb(t))},qb=function(...e){var t=`FIREBASE FATAL ERROR: ${xb(...e)}`;throw Ab.error(t),new Error(t)},Bb=function(...e){var t="FIREBASE WARNING: "+xb(...e);Ab.warn(t)},Kb=function(){"undefined"!=typeof window&&window.location&&window.location.protocol&&-1!==window.location.protocol.indexOf("https:")&&Bb("Insecure Firebase access from a secure page. Please use https in calls to new Firebase().")},$b=function(e){return"number"==typeof e&&(e!=e||e===Number.POSITIVE_INFINITY||e===Number.NEGATIVE_INFINITY)},zb="[MIN_NAME]",Wb="[MAX_NAME]",Gb=function(e,t){if(e===t)return 0;if(e===zb||t===Wb)return-1;if(t===zb||e===Wb)return 1;var n=e0(e),r=e0(t);return null!==n?null!==r?n-r==0?e.length-t.length:n-r:-1:null===r&&e<t?-1:1};function Hb(e,t){for(const n in e)e.hasOwnProperty(n)&&t(n,e[n])}function Qb(e){Jh(!$b(e),"Invalid JSON number");let t,n,r,i,s;0===e?(n=0,r=0,t=1/e==-1/0?1:0):(t=e<0,e=Math.abs(e),r=e>=Math.pow(2,-1022)?(i=Math.min(Math.floor(Math.log(e)/Math.LN2),1023),n=i+1023,Math.round(e*Math.pow(2,52-i)-Math.pow(2,52))):(n=0,Math.round(e/Math.pow(2,-1074))));const o=[];for(s=52;s;--s)o.push(r%2?1:0),r=Math.floor(r/2);for(s=11;s;--s)o.push(n%2?1:0),n=Math.floor(n/2);o.push(t?1:0),o.reverse();const a=o.join("");let c="";for(s=0;s<64;s+=8){let e=parseInt(a.substr(s,8),2).toString(16);1===e.length&&(e="0"+e),c+=e}return c.toLowerCase()}function Yb(e,t){const n=setTimeout(e,t);return"object"==typeof n&&n.unref&&n.unref(),n}const Jb=new RegExp("^-?(0*)\\d{1,10}$"),Xb=-2147483648,Zb=2147483647,e0=function(e){if(Jb.test(e)){var t=Number(e);if(t>=Xb&&t<=Zb)return t}return null},t0=function(e){try{e()}catch(t){setTimeout(()=>{var e=t.stack||"";throw Bb("Exception was thrown by user callback.",e),t},Math.floor(0))}};class n0{constructor(e,t){this.appName_=e,this.appCheckProvider=t,this.appCheck=null==t?void 0:t.getImmediate({optional:!0}),this.appCheck||null!=t&&t.get().then(e=>this.appCheck=e)}getToken(n){return this.appCheck?this.appCheck.getToken(n):new Promise((e,t)=>{setTimeout(()=>{this.appCheck?this.getToken(n).then(e,t):e(null)},0)})}addTokenChangeListener(t){var e;null!==(e=this.appCheckProvider)&&void 0!==e&&e.get().then(e=>e.addTokenListener(t))}notifyForInvalidToken(){Bb(`Provided AppCheck credentials for the app named "${this.appName_}" `+"are invalid. This usually indicates your app was not initialized correctly.")}}class r0{constructor(e,t,n){this.appName_=e,this.firebaseOptions_=t,this.authProvider_=n,this.auth_=null,this.auth_=n.getImmediate({optional:!0}),this.auth_||n.onInit(e=>this.auth_=e)}getToken(n){return this.auth_?this.auth_.getToken(n).catch(e=>e&&"auth/token-not-initialized"===e.code?(jb("Got auth/token-not-initialized error.  Treating as null token."),null):Promise.reject(e)):new Promise((e,t)=>{setTimeout(()=>{this.auth_?this.getToken(n).then(e,t):e(null)},0)})}addTokenChangeListener(t){this.auth_?this.auth_.addAuthTokenListener(t):this.authProvider_.get().then(e=>e.addAuthTokenListener(t))}removeTokenChangeListener(t){this.authProvider_.get().then(e=>e.removeAuthTokenListener(t))}notifyForInvalidToken(){let e='Provided authentication credentials for the app named "'+this.appName_+'" are invalid. This usually indicates your app was not initialized correctly. ';"credential"in this.firebaseOptions_?e+='Make sure the "credential" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':"serviceAccount"in this.firebaseOptions_?e+='Make sure the "serviceAccount" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':e+='Make sure the "apiKey" and "databaseURL" properties provided to initializeApp() match the values provided for your app at https://console.firebase.google.com/.',Bb(e)}}class i0{constructor(e){this.accessToken=e}getToken(e){return Promise.resolve({accessToken:this.accessToken})}addTokenChangeListener(e){e(this.accessToken)}removeTokenChangeListener(e){}notifyForInvalidToken(){}}i0.OWNER="owner";const s0=/(console\.firebase|firebase-console-\w+\.corp|firebase\.corp)\.google\.com/,o0="websocket",a0="long_polling";class c0{constructor(e,t,n,r,i=!1,s="",o=!1){this.secure=t,this.namespace=n,this.webSocketOnly=r,this.nodeAdmin=i,this.persistenceKey=s,this.includeNamespaceInQueryParams=o,this._host=e.toLowerCase(),this._domain=this._host.substr(this._host.indexOf(".")+1),this.internalHost=kb.get("host:"+e)||this._host}isCacheableHost(){return"s-"===this.internalHost.substr(0,2)}isCustomHost(){return"firebaseio.com"!==this._domain&&"firebaseio-demo.com"!==this._domain}get host(){return this._host}set host(e){e!==this.internalHost&&(this.internalHost=e,this.isCacheableHost()&&kb.set("host:"+this._host,this.internalHost))}toString(){let e=this.toURLString();return this.persistenceKey&&(e+="<"+this.persistenceKey+">"),e}toURLString(){var e=this.secure?"https://":"http://",t=this.includeNamespaceInQueryParams?`?ns=${this.namespace}`:"";return`${e}${this.host}/${t}`}}function l0(e,t,n){Jh("string"==typeof t,"typeof type must == string"),Jh("object"==typeof n,"typeof params must == object");let r;if(t===o0)r=(e.secure?"wss://":"ws://")+e.internalHost+"/.ws?";else{if(t!==a0)throw new Error("Unknown connection type: "+t);r=(e.secure?"https://":"http://")+e.internalHost+"/.lp?"}((t=e).host!==t.internalHost||t.isCustomHost()||t.includeNamespaceInQueryParams)&&(n.ns=e.namespace);const i=[];return Hb(n,(e,t)=>{i.push(e+"="+t)}),r+i.join("&")}class u0{constructor(){this.counters_={}}incrementCounter(e,t=1){Id(this.counters_,e)||(this.counters_[e]=0),this.counters_[e]+=t}get(){return rd(void 0,this.counters_)}}const h0={},d0={};function f0(e){var t=e.toString();return h0[t]||(h0[t]=new u0),h0[t]}class p0{constructor(e){this.onMessage_=e,this.pendingResponses=[],this.currentResponseNum=0,this.closeAfterResponse=-1,this.onClose=null}closeAfter(e,t){this.closeAfterResponse=e,this.onClose=t,this.closeAfterResponse<this.currentResponseNum&&(this.onClose(),this.onClose=null)}handleResponse(e,t){for(this.pendingResponses[e]=t;this.pendingResponses[this.currentResponseNum];){const n=this.pendingResponses[this.currentResponseNum];delete this.pendingResponses[this.currentResponseNum];for(let e=0;e<n.length;++e)n[e]&&t0(()=>{this.onMessage_(n[e])});if(this.currentResponseNum===this.closeAfterResponse){this.onClose&&(this.onClose(),this.onClose=null);break}this.currentResponseNum++}}}class g0{constructor(e,t,n,r,i,s,o){this.connId=e,this.repoInfo=t,this.applicationId=n,this.appCheckToken=r,this.authToken=i,this.transportSessionId=s,this.lastSessionId=o,this.bytesSent=0,this.bytesReceived=0,this.everConnected_=!1,this.log_=Db(e),this.stats_=f0(t),this.urlFn=e=>(this.appCheckToken&&(e.ac=this.appCheckToken),l0(t,a0,e))}open(e,t){this.curSegmentNum=0,this.onDisconnect_=t,this.myPacketOrderer=new p0(e),this.isClosed_=!1,this.connectTimeoutTimer_=setTimeout(()=>{this.log_("Timed out trying to connect."),this.onClosed_(),this.connectTimeoutTimer_=null},Math.floor(3e4)),function(t){if("complete"===document.readyState)t();else{let e=!1;const n=function(){document.body?e||(e=!0,t()):setTimeout(n,Math.floor(10))};document.addEventListener?(document.addEventListener("DOMContentLoaded",n,!1),window.addEventListener("load",n,!1)):document.attachEvent&&(document.attachEvent("onreadystatechange",()=>{"complete"===document.readyState&&n()}),window.attachEvent("onload",n))}}(()=>{if(!this.isClosed_){this.scriptTagHolder=new m0((...e)=>{var[t,n,r]=e;if(this.incrementIncomingBytes_(e),this.scriptTagHolder)if(this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null),this.everConnected_=!0,"start"===t)this.id=n,this.password=r;else{if("close"!==t)throw new Error("Unrecognized command received: "+t);n?(this.scriptTagHolder.sendNewPolls=!1,this.myPacketOrderer.closeAfter(n,()=>{this.onClosed_()})):this.onClosed_()}},(...e)=>{var[t,n]=e;this.incrementIncomingBytes_(e),this.myPacketOrderer.handleResponse(t,n)},()=>{this.onClosed_()},this.urlFn);const t={start:"t"};t.ser=Math.floor(1e8*Math.random()),this.scriptTagHolder.uniqueCallbackIdentifier&&(t.cb=this.scriptTagHolder.uniqueCallbackIdentifier),t.v="5",this.transportSessionId&&(t.s=this.transportSessionId),this.lastSessionId&&(t.ls=this.lastSessionId),this.applicationId&&(t.p=this.applicationId),this.appCheckToken&&(t.ac=this.appCheckToken),"undefined"!=typeof location&&location.hostname&&s0.test(location.hostname)&&(t.r="f");var e=this.urlFn(t);this.log_("Connecting via long-poll to "+e),this.scriptTagHolder.addTag(e,()=>{})}})}start(){this.scriptTagHolder.startLongPoll(this.id,this.password),this.addDisconnectPingFrame(this.id,this.password)}static forceAllow(){g0.forceAllow_=!0}static forceDisallow(){g0.forceDisallow_=!0}static isAvailable(){return!!g0.forceAllow_||!(g0.forceDisallow_||"undefined"==typeof document||null==document.createElement||"object"==typeof window&&window.chrome&&window.chrome.extension&&!/^chrome/.test(window.location.href)||"object"==typeof Windows&&"object"==typeof Windows.UI)}markConnectionHealthy(){}shutdown_(){this.isClosed_=!0,this.scriptTagHolder&&(this.scriptTagHolder.close(),this.scriptTagHolder=null),this.myDisconnFrame&&(document.body.removeChild(this.myDisconnFrame),this.myDisconnFrame=null),this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null)}onClosed_(){this.isClosed_||(this.log_("Longpoll is closing itself"),this.shutdown_(),this.onDisconnect_&&(this.onDisconnect_(this.everConnected_),this.onDisconnect_=null))}close(){this.isClosed_||(this.log_("Longpoll is being closed."),this.shutdown_())}send(e){var t=wd(e);this.bytesSent+=t.length,this.stats_.incrementCounter("bytes_sent",t.length);var t=Qh(t),n=Ub(t,1840);for(let r=0;r<n.length;r++)this.scriptTagHolder.enqueueSegment(this.curSegmentNum,n.length,n[r]),this.curSegmentNum++}addDisconnectPingFrame(e,t){this.myDisconnFrame=document.createElement("iframe");const n={dframe:"t"};n.id=e,n.pw=t,this.myDisconnFrame.src=this.urlFn(n),this.myDisconnFrame.style.display="none",document.body.appendChild(this.myDisconnFrame)}incrementIncomingBytes_(e){var t=wd(e).length;this.bytesReceived+=t,this.stats_.incrementCounter("bytes_received",t)}}class m0{constructor(t,n,e,r){this.onDisconnect=e,this.urlFn=r,this.outstandingRequests=new Set,this.pendingSegs=[],this.currentSerial=Math.floor(1e8*Math.random()),this.sendNewPolls=!0;{this.uniqueCallbackIdentifier=Nb(),window["pLPCommand"+this.uniqueCallbackIdentifier]=t,window["pRTLPCB"+this.uniqueCallbackIdentifier]=n,this.myIFrame=m0.createIFrame_();let e="";this.myIFrame.src&&"javascript:"===this.myIFrame.src.substr(0,"javascript:".length)&&(i=document.domain,e='<script>document.domain="'+i+'";<\/script>');var i="<html><body>"+e+"</body></html>";try{this.myIFrame.doc.open(),this.myIFrame.doc.write(i),this.myIFrame.doc.close()}catch(e){jb("frame writing exception"),e.stack&&jb(e.stack),jb(e)}}}static createIFrame_(){const t=document.createElement("iframe");if(t.style.display="none",!document.body)throw"Document body has not initialized. Wait to initialize Firebase until after the document is ready.";document.body.appendChild(t);try{t.contentWindow.document||jb("No IE domain setting required")}catch(e){var n=document.domain;t.src="javascript:void((function(){document.open();document.domain='"+n+"';document.close();})())"}return t.contentDocument?t.doc=t.contentDocument:t.contentWindow?t.doc=t.contentWindow.document:t.document&&(t.doc=t.document),t}close(){this.alive=!1,this.myIFrame&&(this.myIFrame.doc.body.innerHTML="",setTimeout(()=>{null!==this.myIFrame&&(document.body.removeChild(this.myIFrame),this.myIFrame=null)},Math.floor(0)));const e=this.onDisconnect;e&&(this.onDisconnect=null,e())}startLongPoll(e,t){for(this.myID=e,this.myPW=t,this.alive=!0;this.newRequest_(););}newRequest_(){if(this.alive&&this.sendNewPolls&&this.outstandingRequests.size<(0<this.pendingSegs.length?2:1)){this.currentSerial++;const i={};i.id=this.myID,i.pw=this.myPW,i.ser=this.currentSerial;var n=this.urlFn(i);let e="",t=0;for(;0<this.pendingSegs.length;){if(!(this.pendingSegs[0].d.length+30+e.length<=1870))break;var r=this.pendingSegs.shift();e=e+"&seg"+t+"="+r.seg+"&ts"+t+"="+r.ts+"&d"+t+"="+r.d,t++}return n+=e,this.addLongPollTag_(n,this.currentSerial),!0}return!1}enqueueSegment(e,t,n){this.pendingSegs.push({seg:e,ts:t,d:n}),this.alive&&this.newRequest_()}addLongPollTag_(e,t){this.outstandingRequests.add(t);const n=()=>{this.outstandingRequests.delete(t),this.newRequest_()},r=setTimeout(n,Math.floor(25e3));this.addTag(e,()=>{clearTimeout(r),n()})}addTag(e,n){setTimeout(()=>{try{if(!this.sendNewPolls)return;const t=this.myIFrame.doc.createElement("script");t.type="text/javascript",t.async=!0,t.src=e,t.onload=t.onreadystatechange=function(){var e=t.readyState;e&&"loaded"!==e&&"complete"!==e||(t.onload=t.onreadystatechange=null,t.parentNode&&t.parentNode.removeChild(t),n())},t.onerror=()=>{jb("Long-poll script failed to load: "+e),this.sendNewPolls=!1,this.close()},this.myIFrame.doc.body.appendChild(t)}catch(e){}},Math.floor(1))}}let v0=null;"undefined"!=typeof MozWebSocket?v0=MozWebSocket:"undefined"!=typeof WebSocket&&(v0=WebSocket);class y0{constructor(e,t,n,r,i,s,o){this.connId=e,this.applicationId=n,this.appCheckToken=r,this.authToken=i,this.keepaliveTimer=null,this.frames=null,this.totalFrames=0,this.bytesSent=0,this.bytesReceived=0,this.log_=Db(this.connId),this.stats_=f0(t),this.connURL=y0.connectionURL_(t,s,o,r,n),this.nodeAdmin=t.nodeAdmin}static connectionURL_(e,t,n,r,i){const s={v:"5"};return"undefined"!=typeof location&&location.hostname&&s0.test(location.hostname)&&(s.r="f"),t&&(s.s=t),n&&(s.ls=n),r&&(s.ac=r),i&&(s.p=i),l0(e,o0,s)}open(e,t){this.onDisconnect=t,this.onMessage=e,this.log_("Websocket connecting to "+this.connURL),this.everConnected_=!1,kb.set("previous_websocket_failure",!0);try{dd(),this.mySock=new v0(this.connURL,[],void 0)}catch(e){this.log_("Error instantiating WebSocket.");var n=e.message||e.data;return n&&this.log_(n),void this.onClosed_()}this.mySock.onopen=()=>{this.log_("Websocket connected."),this.everConnected_=!0},this.mySock.onclose=()=>{this.log_("Websocket connection was disconnected."),this.mySock=null,this.onClosed_()},this.mySock.onmessage=e=>{this.handleIncomingFrame(e)},this.mySock.onerror=e=>{this.log_("WebSocket error.  Closing connection.");var t=e.message||e.data;t&&this.log_(t),this.onClosed_()}}start(){}static forceDisallow(){y0.forceDisallow_=!0}static isAvailable(){let e=!1;var t;return"undefined"==typeof navigator||!navigator.userAgent||(t=navigator.userAgent.match(/Android ([0-9]{0,}\.[0-9]{0,})/))&&1<t.length&&parseFloat(t[1])<4.4&&(e=!0),!e&&null!==v0&&!y0.forceDisallow_}static previouslyFailed(){return kb.isInMemoryStorage||!0===kb.get("previous_websocket_failure")}markConnectionHealthy(){kb.remove("previous_websocket_failure")}appendFrame_(e){var t;this.frames.push(e),this.frames.length===this.totalFrames&&(t=this.frames.join(""),this.frames=null,t=_d(t),this.onMessage(t))}handleNewFrameCount_(e){this.totalFrames=e,this.frames=[]}extractFrameCount_(e){if(Jh(null===this.frames,"We already have a frame buffer"),e.length<=6){var t=Number(e);if(!isNaN(t))return this.handleNewFrameCount_(t),null}return this.handleNewFrameCount_(1),e}handleIncomingFrame(e){var t;null!==this.mySock&&(t=e.data,this.bytesReceived+=t.length,this.stats_.incrementCounter("bytes_received",t.length),this.resetKeepAlive(),null!==this.frames?this.appendFrame_(t):null!==(t=this.extractFrameCount_(t))&&this.appendFrame_(t))}send(e){this.resetKeepAlive();var t=wd(e);this.bytesSent+=t.length,this.stats_.incrementCounter("bytes_sent",t.length);var n=Ub(t,16384);1<n.length&&this.sendString_(String(n.length));for(let r=0;r<n.length;r++)this.sendString_(n[r])}shutdown_(){this.isClosed_=!0,this.keepaliveTimer&&(clearInterval(this.keepaliveTimer),this.keepaliveTimer=null),this.mySock&&(this.mySock.close(),this.mySock=null)}onClosed_(){this.isClosed_||(this.log_("WebSocket is closing itself"),this.shutdown_(),this.onDisconnect&&(this.onDisconnect(this.everConnected_),this.onDisconnect=null))}close(){this.isClosed_||(this.log_("WebSocket is being closed"),this.shutdown_())}resetKeepAlive(){clearInterval(this.keepaliveTimer),this.keepaliveTimer=setInterval(()=>{this.mySock&&this.sendString_("0"),this.resetKeepAlive()},Math.floor(45e3))}sendString_(e){try{this.mySock.send(e)}catch(e){this.log_("Exception thrown from WebSocket.send():",e.message||e.data,"Closing connection."),setTimeout(this.onClosed_.bind(this),0)}}}y0.responsesRequiredToBeHealthy=2,y0.healthyTimeout=3e4;class _0{constructor(e){this.initTransports_(e)}static get ALL_TRANSPORTS(){return[g0,y0]}static get IS_TRANSPORT_INITIALIZED(){return this.globalTransportInitialized_}initTransports_(e){var t=y0&&y0.isAvailable();let n=t&&!y0.previouslyFailed();if(e.webSocketOnly&&(t||Bb("wss:// URL used, but browser isn't known to support websockets.  Trying anyway."),n=!0),n)this.transports_=[y0];else{const r=this.transports_=[];for(const i of _0.ALL_TRANSPORTS)i&&i.isAvailable()&&r.push(i);_0.globalTransportInitialized_=!0}}initialTransport(){if(0<this.transports_.length)return this.transports_[0];throw new Error("No transports available")}upgradeTransport(){return 1<this.transports_.length?this.transports_[1]:null}}_0.globalTransportInitialized_=!1;class w0{constructor(e,t,n,r,i,s,o,a,c,l){this.id=e,this.repoInfo_=t,this.applicationId_=n,this.appCheckToken_=r,this.authToken_=i,this.onMessage_=s,this.onReady_=o,this.onDisconnect_=a,this.onKill_=c,this.lastSessionId=l,this.connectionCount=0,this.pendingDataMessages=[],this.state_=0,this.log_=Db("c:"+this.id+":"),this.transportManager_=new _0(t),this.log_("Connection created"),this.start_()}start_(){const e=this.transportManager_.initialTransport();this.conn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,null,this.lastSessionId),this.primaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;const t=this.connReceiver_(this.conn_),n=this.disconnReceiver_(this.conn_);this.tx_=this.conn_,this.rx_=this.conn_,this.secondaryConn_=null,this.isHealthy_=!1,setTimeout(()=>{this.conn_&&this.conn_.open(t,n)},Math.floor(0));var r=e.healthyTimeout||0;0<r&&(this.healthyTimeout_=Yb(()=>{this.healthyTimeout_=null,this.isHealthy_||(this.conn_&&102400<this.conn_.bytesReceived?(this.log_("Connection exceeded healthy timeout but has received "+this.conn_.bytesReceived+" bytes.  Marking connection healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()):this.conn_&&10240<this.conn_.bytesSent?this.log_("Connection exceeded healthy timeout but has sent "+this.conn_.bytesSent+" bytes.  Leaving connection alive."):(this.log_("Closing unhealthy connection after timeout."),this.close()))},Math.floor(r)))}nextTransportId_(){return"c:"+this.id+":"+this.connectionCount++}disconnReceiver_(t){return e=>{t===this.conn_?this.onConnectionLost_(e):t===this.secondaryConn_?(this.log_("Secondary connection lost."),this.onSecondaryConnectionLost_()):this.log_("closing an old connection")}}connReceiver_(t){return e=>{2!==this.state_&&(t===this.rx_?this.onPrimaryMessageReceived_(e):t===this.secondaryConn_?this.onSecondaryMessageReceived_(e):this.log_("message on old connection"))}}sendRequest(e){this.sendData_({t:"d",d:e})}tryCleanupConnection(){this.tx_===this.secondaryConn_&&this.rx_===this.secondaryConn_&&(this.log_("cleaning up and promoting a connection: "+this.secondaryConn_.connId),this.conn_=this.secondaryConn_,this.secondaryConn_=null)}onSecondaryControl_(e){var t;"t"in e&&("a"===(t=e.t)?this.upgradeIfSecondaryHealthy_():"r"===t?(this.log_("Got a reset on secondary, closing it"),this.secondaryConn_.close(),this.tx_!==this.secondaryConn_&&this.rx_!==this.secondaryConn_||this.close()):"o"===t&&(this.log_("got pong on secondary."),this.secondaryResponsesRequired_--,this.upgradeIfSecondaryHealthy_()))}onSecondaryMessageReceived_(e){var t=Lb("t",e),n=Lb("d",e);if("c"===t)this.onSecondaryControl_(n);else{if("d"!==t)throw new Error("Unknown protocol layer: "+t);this.pendingDataMessages.push(n)}}upgradeIfSecondaryHealthy_(){this.secondaryResponsesRequired_<=0?(this.log_("Secondary connection is healthy."),this.isHealthy_=!0,this.secondaryConn_.markConnectionHealthy(),this.proceedWithUpgrade_()):(this.log_("sending ping on secondary."),this.secondaryConn_.send({t:"c",d:{t:"p",d:{}}}))}proceedWithUpgrade_(){this.secondaryConn_.start(),this.log_("sending client ack on secondary"),this.secondaryConn_.send({t:"c",d:{t:"a",d:{}}}),this.log_("Ending transmission on primary"),this.conn_.send({t:"c",d:{t:"n",d:{}}}),this.tx_=this.secondaryConn_,this.tryCleanupConnection()}onPrimaryMessageReceived_(e){var t=Lb("t",e),n=Lb("d",e);"c"===t?this.onControl_(n):"d"===t&&this.onDataMessage_(n)}onDataMessage_(e){this.onPrimaryResponse_(),this.onMessage_(e)}onPrimaryResponse_(){this.isHealthy_||(this.primaryResponsesRequired_--,this.primaryResponsesRequired_<=0&&(this.log_("Primary connection is healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()))}onControl_(e){var t=Lb("t",e);if("d"in e){var n=e.d;if("h"===t)this.onHandshake_(n);else if("n"===t){this.log_("recvd end transmission on primary"),this.rx_=this.secondaryConn_;for(let e=0;e<this.pendingDataMessages.length;++e)this.onDataMessage_(this.pendingDataMessages[e]);this.pendingDataMessages=[],this.tryCleanupConnection()}else"s"===t?this.onConnectionShutdown_(n):"r"===t?this.onReset_(n):"e"===t?Ob("Server Error: "+n):"o"===t?(this.log_("got pong on primary."),this.onPrimaryResponse_(),this.sendPingOnPrimaryIfNecessary_()):Ob("Unknown control packet command: "+t)}}onHandshake_(e){var t=e.ts,n=e.v,r=e.h;this.sessionId=e.s,this.repoInfo_.host=r,0===this.state_&&(this.conn_.start(),this.onConnectionEstablished_(this.conn_,t),"5"!==n&&Bb("Protocol version mismatch detected"),this.tryStartUpgrade_())}tryStartUpgrade_(){var e=this.transportManager_.upgradeTransport();e&&this.startUpgrade_(e)}startUpgrade_(e){this.secondaryConn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,this.sessionId),this.secondaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;var t=this.connReceiver_(this.secondaryConn_),n=this.disconnReceiver_(this.secondaryConn_);this.secondaryConn_.open(t,n),Yb(()=>{this.secondaryConn_&&(this.log_("Timed out trying to upgrade."),this.secondaryConn_.close())},Math.floor(6e4))}onReset_(e){this.log_("Reset packet received.  New host: "+e),this.repoInfo_.host=e,1===this.state_?this.close():(this.closeConnections_(),this.start_())}onConnectionEstablished_(e,t){this.log_("Realtime connection established."),this.conn_=e,this.state_=1,this.onReady_&&(this.onReady_(t,this.sessionId),this.onReady_=null),0===this.primaryResponsesRequired_?(this.log_("Primary connection is healthy."),this.isHealthy_=!0):Yb(()=>{this.sendPingOnPrimaryIfNecessary_()},Math.floor(5e3))}sendPingOnPrimaryIfNecessary_(){this.isHealthy_||1!==this.state_||(this.log_("sending ping on primary."),this.sendData_({t:"c",d:{t:"p",d:{}}}))}onSecondaryConnectionLost_(){var e=this.secondaryConn_;this.secondaryConn_=null,this.tx_!==e&&this.rx_!==e||this.close()}onConnectionLost_(e){this.conn_=null,e||0!==this.state_?1===this.state_&&this.log_("Realtime connection lost."):(this.log_("Realtime connection failed."),this.repoInfo_.isCacheableHost()&&(kb.remove("host:"+this.repoInfo_.host),this.repoInfo_.internalHost=this.repoInfo_.host)),this.close()}onConnectionShutdown_(e){this.log_("Connection shutdown command received. Shutting down..."),this.onKill_&&(this.onKill_(e),this.onKill_=null),this.onDisconnect_=null,this.close()}sendData_(e){if(1!==this.state_)throw"Connection is not connected";this.tx_.send(e)}close(){2!==this.state_&&(this.log_("Closing realtime connection."),this.state_=2,this.closeConnections_(),this.onDisconnect_&&(this.onDisconnect_(),this.onDisconnect_=null))}closeConnections_(){this.log_("Shutting down all connections"),this.conn_&&(this.conn_.close(),this.conn_=null),this.secondaryConn_&&(this.secondaryConn_.close(),this.secondaryConn_=null),this.healthyTimeout_&&(clearTimeout(this.healthyTimeout_),this.healthyTimeout_=null)}}class b0{put(e,t,n,r){}merge(e,t,n,r){}refreshAuthToken(e){}refreshAppCheckToken(e){}onDisconnectPut(e,t,n){}onDisconnectMerge(e,t,n){}onDisconnectCancel(e,t){}reportStats(e){}}class I0{constructor(e){this.allowedEvents_=e,this.listeners_={},Jh(Array.isArray(e)&&0<e.length,"Requires a non-empty array")}trigger(t,...n){if(Array.isArray(this.listeners_[t])){const r=[...this.listeners_[t]];for(let e=0;e<r.length;e++)r[e].callback.apply(r[e].context,n)}}on(e,t,n){this.validateEventType_(e),this.listeners_[e]=this.listeners_[e]||[],this.listeners_[e].push({callback:t,context:n});var r=this.getInitialEvent(e);r&&t.apply(n,r)}off(e,t,n){this.validateEventType_(e);const r=this.listeners_[e]||[];for(let i=0;i<r.length;i++)if(r[i].callback===t&&(!n||n===r[i].context))return void r.splice(i,1)}validateEventType_(t){Jh(this.allowedEvents_.find(e=>e===t),"Unknown event: "+t)}}class T0 extends I0{constructor(){super(["online"]),this.online_=!0,"undefined"==typeof window||void 0===window.addEventListener||ad()||(window.addEventListener("online",()=>{this.online_||(this.online_=!0,this.trigger("online",!0))},!1),window.addEventListener("offline",()=>{this.online_&&(this.online_=!1,this.trigger("online",!1))},!1))}static getInstance(){return new T0}getInitialEvent(e){return Jh("online"===e,"Unknown event type: "+e),[this.online_]}currentlyOnline(){return this.online_}}class E0{constructor(n,e){if(void 0===e){this.pieces_=n.split("/");let e=0;for(let t=0;t<this.pieces_.length;t++)0<this.pieces_[t].length&&(this.pieces_[e]=this.pieces_[t],e++);this.pieces_.length=e,this.pieceNum_=0}else this.pieces_=n,this.pieceNum_=e}toString(){let e="";for(let t=this.pieceNum_;t<this.pieces_.length;t++)""!==this.pieces_[t]&&(e+="/"+this.pieces_[t]);return e||"/"}}function S0(){return new E0("")}function k0(e){return e.pieceNum_>=e.pieces_.length?null:e.pieces_[e.pieceNum_]}function C0(e){return e.pieces_.length-e.pieceNum_}function A0(e){let t=e.pieceNum_;return t<e.pieces_.length&&t++,new E0(e.pieces_,t)}function N0(e){return e.pieceNum_<e.pieces_.length?e.pieces_[e.pieces_.length-1]:null}function x0(e,t=0){return e.pieces_.slice(e.pieceNum_+t)}function R0(e){if(e.pieceNum_>=e.pieces_.length)return null;const t=[];for(let n=e.pieceNum_;n<e.pieces_.length-1;n++)t.push(e.pieces_[n]);return new E0(t,0)}function P0(e,t){const n=[];for(let i=e.pieceNum_;i<e.pieces_.length;i++)n.push(e.pieces_[i]);if(t instanceof E0)for(let e=t.pieceNum_;e<t.pieces_.length;e++)n.push(t.pieces_[e]);else{var r=t.split("/");for(let e=0;e<r.length;e++)0<r[e].length&&n.push(r[e])}return new E0(n,0)}function D0(e){return e.pieceNum_>=e.pieces_.length}function O0(e,t){var n=k0(e),r=k0(t);if(null===n)return t;if(n===r)return O0(A0(e),A0(t));throw new Error("INTERNAL ERROR: innerPath ("+t+") is not within outerPath ("+e+")")}function M0(e,t){var n=x0(e,0),r=x0(t,0);for(let s=0;s<n.length&&s<r.length;s++){var i=Gb(n[s],r[s]);if(0!==i)return i}return n.length===r.length?0:n.length<r.length?-1:1}function L0(e,t){if(C0(e)!==C0(t))return!1;for(let n=e.pieceNum_,r=t.pieceNum_;n<=e.pieces_.length;n++,r++)if(e.pieces_[n]!==t.pieces_[r])return!1;return!0}function F0(e,t){let n=e.pieceNum_,r=t.pieceNum_;if(C0(e)>C0(t))return!1;for(;n<e.pieces_.length;){if(e.pieces_[n]!==t.pieces_[r])return!1;++n,++r}return!0}class U0{constructor(e,t){this.errorPrefix_=t,this.parts_=x0(e,0),this.byteLength_=Math.max(1,this.parts_.length);for(let n=0;n<this.parts_.length;n++)this.byteLength_+=jd(this.parts_[n]);V0(this)}}function V0(e){if(768<e.byteLength_)throw new Error(e.errorPrefix_+"has a key path longer than 768 bytes ("+e.byteLength_+").");if(32<e.parts_.length)throw new Error(e.errorPrefix_+"path specified exceeds the maximum depth that can be written (32) or object contains a cycle "+j0(e))}function j0(e){return 0===e.parts_.length?"":"in property '"+e.parts_.join(".")+"'"}class q0 extends I0{constructor(){super(["visible"]);let t,e;"undefined"!=typeof document&&void 0!==document.addEventListener&&(void 0!==document.hidden?(e="visibilitychange",t="hidden"):void 0!==document.mozHidden?(e="mozvisibilitychange",t="mozHidden"):void 0!==document.msHidden?(e="msvisibilitychange",t="msHidden"):void 0!==document.webkitHidden&&(e="webkitvisibilitychange",t="webkitHidden")),this.visible_=!0,e&&document.addEventListener(e,()=>{var e=!document[t];e!==this.visible_&&(this.visible_=e,this.trigger("visible",e))},!1)}static getInstance(){return new q0}getInitialEvent(e){return Jh("visible"===e,"Unknown event type: "+e),[this.visible_]}}class B0 extends b0{constructor(e,t,n,r,i,s,o,a){if(super(),this.repoInfo_=e,this.applicationId_=t,this.onDataUpdate_=n,this.onConnectStatus_=r,this.onServerInfoUpdate_=i,this.authTokenProvider_=s,this.appCheckTokenProvider_=o,this.authOverride_=a,this.id=B0.nextPersistentConnectionId_++,this.log_=Db("p:"+this.id+":"),this.interruptReasons_={},this.listens=new Map,this.outstandingPuts_=[],this.outstandingGets_=[],this.outstandingPutCount_=0,this.outstandingGetCount_=0,this.onDisconnectRequestQueue_=[],this.connected_=!1,this.reconnectDelay_=1e3,this.maxReconnectDelay_=3e5,this.securityDebugCallback_=null,this.lastSessionId=null,this.establishConnectionTimer_=null,this.visible_=!1,this.requestCBHash_={},this.requestNumber_=0,this.realtime_=null,this.authToken_=null,this.appCheckToken_=null,this.forceTokenRefresh_=!1,this.invalidAuthTokenCount_=0,this.invalidAppCheckTokenCount_=0,this.firstConnection_=!0,this.lastConnectionAttemptTime_=null,this.lastConnectionEstablishedTime_=null,a&&!dd())throw new Error("Auth override specified in options, but not supported on non Node.js platforms");q0.getInstance().on("visible",this.onVisible_,this),-1===e.host.indexOf("fblocal")&&T0.getInstance().on("online",this.onOnline_,this)}sendRequest(e,t,n){var r=++this.requestNumber_,i={r:r,a:e,b:t};this.log_(wd(i)),Jh(this.connected_,"sendRequest call when we're not connected not allowed."),this.realtime_.sendRequest(i),n&&(this.requestCBHash_[r]=n)}get(e){this.initConnection_();const n=new id;var t={p:e._path.toString(),q:e._queryObject};this.outstandingGets_.push({action:"g",request:t,onComplete:e=>{var t=e.d;"ok"===e.s?n.resolve(t):n.reject(t)}}),this.outstandingGetCount_++;t=this.outstandingGets_.length-1;return this.connected_&&this.sendGet_(t),n.promise}listen(e,t,n,r){this.initConnection_();var i=e._queryIdentifier,s=e._path.toString();this.log_("Listen called for "+s+" "+i),this.listens.has(s)||this.listens.set(s,new Map),Jh(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"listen() called for non-default but complete query"),Jh(!this.listens.get(s).has(i),"listen() called twice for same path/queryId.");var o={onComplete:r,hashFn:t,query:e,tag:n};this.listens.get(s).set(i,o),this.connected_&&this.sendListen_(o)}sendGet_(t){const n=this.outstandingGets_[t];this.sendRequest("g",n.request,e=>{delete this.outstandingGets_[t],this.outstandingGetCount_--,0===this.outstandingGetCount_&&(this.outstandingGets_=[]),n.onComplete&&n.onComplete(e)})}sendListen_(r){const i=r.query,s=i._path.toString(),o=i._queryIdentifier;this.log_("Listen on "+s+" for "+o);const e={p:s};r.tag&&(e.q=i._queryObject,e.t=r.tag),e.h=r.hashFn(),this.sendRequest("q",e,e=>{var t=e.d,n=e.s;B0.warnOnListenWarnings_(t,i),(this.listens.get(s)&&this.listens.get(s).get(o))===r&&(this.log_("listen response",e),"ok"!==n&&this.removeListen_(s,o),r.onComplete&&r.onComplete(n,t))})}static warnOnListenWarnings_(e,t){if(e&&"object"==typeof e&&Id(e,"w")){const i=Td(e,"w");var n,r;Array.isArray(i)&&~i.indexOf("no_index")&&(n='".indexOn": "'+t._queryParams.getIndex().toString()+'"',r=t._path.toString(),Bb("Using an unspecified index. Your data will be downloaded and "+`filtered on the client. Consider adding ${n} at `+`${r} to your security rules for better performance.`))}}refreshAuthToken(e){this.authToken_=e,this.log_("Auth token refreshed"),this.authToken_?this.tryAuth():this.connected_&&this.sendRequest("unauth",{},()=>{}),this.reduceReconnectDelayIfAdminCredential_(e)}reduceReconnectDelayIfAdminCredential_(e){var t;(e&&40===e.length||(e=e,"object"==typeof(t=bd(e).claims)&&!0===t.admin))&&(this.log_("Admin auth credential detected.  Reducing max reconnect time."),this.maxReconnectDelay_=3e4)}refreshAppCheckToken(e){this.appCheckToken_=e,this.log_("App check token refreshed"),this.appCheckToken_?this.tryAppCheck():this.connected_&&this.sendRequest("unappeck",{},()=>{})}tryAuth(){if(this.connected_&&this.authToken_){const r=this.authToken_;var e=function(e){const t=bd(e),n=t.claims;return!!n&&"object"==typeof n&&n.hasOwnProperty("iat")}(r)?"auth":"gauth";const t={cred:r};null===this.authOverride_?t.noauth=!0:"object"==typeof this.authOverride_&&(t.authvar=this.authOverride_),this.sendRequest(e,t,e=>{var t=e.s,n=e.d||"error";this.authToken_===r&&("ok"===t?this.invalidAuthTokenCount_=0:this.onAuthRevoked_(t,n))})}}tryAppCheck(){this.connected_&&this.appCheckToken_&&this.sendRequest("appcheck",{token:this.appCheckToken_},e=>{var t=e.s,n=e.d||"error";"ok"===t?this.invalidAppCheckTokenCount_=0:this.onAppCheckRevoked_(t,n)})}unlisten(e,t){var n=e._path.toString(),r=e._queryIdentifier;this.log_("Unlisten called for "+n+" "+r),Jh(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"unlisten() called for non-default but complete query"),this.removeListen_(n,r)&&this.connected_&&this.sendUnlisten_(n,r,e._queryObject,t)}sendUnlisten_(e,t,n,r){this.log_("Unlisten on "+e+" for "+t);const i={p:e};r&&(i.q=n,i.t=r),this.sendRequest("n",i)}onDisconnectPut(e,t,n){this.initConnection_(),this.connected_?this.sendOnDisconnect_("o",e,t,n):this.onDisconnectRequestQueue_.push({pathString:e,action:"o",data:t,onComplete:n})}onDisconnectMerge(e,t,n){this.initConnection_(),this.connected_?this.sendOnDisconnect_("om",e,t,n):this.onDisconnectRequestQueue_.push({pathString:e,action:"om",data:t,onComplete:n})}onDisconnectCancel(e,t){this.initConnection_(),this.connected_?this.sendOnDisconnect_("oc",e,null,t):this.onDisconnectRequestQueue_.push({pathString:e,action:"oc",data:null,onComplete:t})}sendOnDisconnect_(e,t,n,r){var i={p:t,d:n};this.log_("onDisconnect "+e,i),this.sendRequest(e,i,e=>{r&&setTimeout(()=>{r(e.s,e.d)},Math.floor(0))})}put(e,t,n,r){this.putInternal("p",e,t,n,r)}merge(e,t,n,r){this.putInternal("m",e,t,n,r)}putInternal(e,t,n,r,i){this.initConnection_();const s={p:t,d:n};void 0!==i&&(s.h=i),this.outstandingPuts_.push({action:e,request:s,onComplete:r}),this.outstandingPutCount_++;var o=this.outstandingPuts_.length-1;this.connected_?this.sendPut_(o):this.log_("Buffering put: "+t)}sendPut_(t){const n=this.outstandingPuts_[t].action;var e=this.outstandingPuts_[t].request;const r=this.outstandingPuts_[t].onComplete;this.outstandingPuts_[t].queued=this.connected_,this.sendRequest(n,e,e=>{this.log_(n+" response",e),delete this.outstandingPuts_[t],this.outstandingPutCount_--,0===this.outstandingPutCount_&&(this.outstandingPuts_=[]),r&&r(e.s,e.d)})}reportStats(e){var t;this.connected_&&(this.log_("reportStats",t={c:e}),this.sendRequest("s",t,e=>{var t;"ok"!==e.s&&(t=e.d,this.log_("reportStats","Error sending stats: "+t))}))}onDataMessage_(e){if("r"in e){this.log_("from server: "+wd(e));var t=e.r;const n=this.requestCBHash_[t];n&&(delete this.requestCBHash_[t],n(e.b))}else{if("error"in e)throw"A server-side error has occurred: "+e.error;"a"in e&&this.onDataPush_(e.a,e.b)}}onDataPush_(e,t){this.log_("handleServerMessage",e,t),"d"===e?this.onDataUpdate_(t.p,t.d,!1,t.t):"m"===e?this.onDataUpdate_(t.p,t.d,!0,t.t):"c"===e?this.onListenRevoked_(t.p,t.q):"ac"===e?this.onAuthRevoked_(t.s,t.d):"apc"===e?this.onAppCheckRevoked_(t.s,t.d):"sd"===e?this.onSecurityDebugPacket_(t):Ob("Unrecognized action received from server: "+wd(e)+"\nAre you using the latest client?")}onReady_(e,t){this.log_("connection ready"),this.connected_=!0,this.lastConnectionEstablishedTime_=(new Date).getTime(),this.handleTimestamp_(e),this.lastSessionId=t,this.firstConnection_&&this.sendConnectStats_(),this.restoreState_(),this.firstConnection_=!1,this.onConnectStatus_(!0)}scheduleConnect_(e){Jh(!this.realtime_,"Scheduling a connect when we're already connected/ing?"),this.establishConnectionTimer_&&clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=setTimeout(()=>{this.establishConnectionTimer_=null,this.establishConnection_()},Math.floor(e))}initConnection_(){!this.realtime_&&this.firstConnection_&&this.scheduleConnect_(0)}onVisible_(e){e&&!this.visible_&&this.reconnectDelay_===this.maxReconnectDelay_&&(this.log_("Window became visible.  Reducing delay."),this.reconnectDelay_=1e3,this.realtime_||this.scheduleConnect_(0)),this.visible_=e}onOnline_(e){e?(this.log_("Browser went online."),this.reconnectDelay_=1e3,this.realtime_||this.scheduleConnect_(0)):(this.log_("Browser went offline.  Killing connection."),this.realtime_&&this.realtime_.close())}onRealtimeDisconnect_(){var e;this.log_("data client disconnected"),this.connected_=!1,this.realtime_=null,this.cancelSentTransactions_(),this.requestCBHash_={},this.shouldReconnect_()&&(this.visible_?this.lastConnectionEstablishedTime_&&(3e4<(new Date).getTime()-this.lastConnectionEstablishedTime_&&(this.reconnectDelay_=1e3),this.lastConnectionEstablishedTime_=null):(this.log_("Window isn't visible.  Delaying reconnect."),this.reconnectDelay_=this.maxReconnectDelay_,this.lastConnectionAttemptTime_=(new Date).getTime()),e=(new Date).getTime()-this.lastConnectionAttemptTime_,e=Math.max(0,this.reconnectDelay_-e),e=Math.random()*e,this.log_("Trying to reconnect in "+e+"ms"),this.scheduleConnect_(e),this.reconnectDelay_=Math.min(this.maxReconnectDelay_,1.3*this.reconnectDelay_)),this.onConnectStatus_(!1)}async establishConnection_(){if(this.shouldReconnect_()){this.log_("Making a connection attempt"),this.lastConnectionAttemptTime_=(new Date).getTime(),this.lastConnectionEstablishedTime_=null;var e=this.onDataMessage_.bind(this),r=this.onReady_.bind(this);const u=this.onRealtimeDisconnect_.bind(this);var i=this.id+":"+B0.nextConnectionId_++,s=this.lastSessionId;let t=!1,n=null;var o=function(){n?n.close():(t=!0,u())};this.realtime_={close:o,sendRequest:function(e){Jh(n,"sendRequest call when we're not connected not allowed."),n.sendRequest(e)}};var a=this.forceTokenRefresh_;this.forceTokenRefresh_=!1;try{var[c,l]=await Promise.all([this.authTokenProvider_.getToken(a),this.appCheckTokenProvider_.getToken(a)]);t?jb("getToken() completed but was canceled"):(jb("getToken() completed. Creating connection."),this.authToken_=c&&c.accessToken,this.appCheckToken_=l&&l.token,n=new w0(i,this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,e,r,u,e=>{Bb(e+" ("+this.repoInfo_.toString()+")"),this.interrupt("server_kill")},s))}catch(e){this.log_("Failed to get token: "+e),t||(this.repoInfo_.nodeAdmin&&Bb(e),o())}}}interrupt(e){jb("Interrupting connection for reason: "+e),this.interruptReasons_[e]=!0,this.realtime_?this.realtime_.close():(this.establishConnectionTimer_&&(clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=null),this.connected_&&this.onRealtimeDisconnect_())}resume(e){jb("Resuming connection for reason: "+e),delete this.interruptReasons_[e],Ed(this.interruptReasons_)&&(this.reconnectDelay_=1e3,this.realtime_||this.scheduleConnect_(0))}handleTimestamp_(e){var t=e-(new Date).getTime();this.onServerInfoUpdate_({serverTimeOffset:t})}cancelSentTransactions_(){for(let e=0;e<this.outstandingPuts_.length;e++){const t=this.outstandingPuts_[e];t&&"h"in t.request&&t.queued&&(t.onComplete&&t.onComplete("disconnect"),delete this.outstandingPuts_[e],this.outstandingPutCount_--)}0===this.outstandingPutCount_&&(this.outstandingPuts_=[])}onListenRevoked_(e,t){let n;n=t?t.map(e=>Fb(e)).join("$"):"default";const r=this.removeListen_(e,n);r&&r.onComplete&&r.onComplete("permission_denied")}removeListen_(e,t){var n=new E0(e).toString();let r;if(this.listens.has(n)){const i=this.listens.get(n);r=i.get(t),i.delete(t),0===i.size&&this.listens.delete(n)}else r=void 0;return r}onAuthRevoked_(e,t){jb("Auth token revoked: "+e+"/"+t),this.authToken_=null,this.forceTokenRefresh_=!0,this.realtime_.close(),"invalid_token"!==e&&"permission_denied"!==e||(this.invalidAuthTokenCount_++,3<=this.invalidAuthTokenCount_&&(this.reconnectDelay_=3e4,this.authTokenProvider_.notifyForInvalidToken()))}onAppCheckRevoked_(e,t){jb("App check token revoked: "+e+"/"+t),this.appCheckToken_=null,this.forceTokenRefresh_=!0,"invalid_token"!==e&&"permission_denied"!==e||(this.invalidAppCheckTokenCount_++,3<=this.invalidAppCheckTokenCount_&&this.appCheckTokenProvider_.notifyForInvalidToken())}onSecurityDebugPacket_(e){this.securityDebugCallback_?this.securityDebugCallback_(e):"msg"in e&&console.log("FIREBASE: "+e.msg.replace("\n","\nFIREBASE: "))}restoreState_(){this.tryAuth(),this.tryAppCheck();for(const t of this.listens.values())for(const n of t.values())this.sendListen_(n);for(let r=0;r<this.outstandingPuts_.length;r++)this.outstandingPuts_[r]&&this.sendPut_(r);for(;this.onDisconnectRequestQueue_.length;){var e=this.onDisconnectRequestQueue_.shift();this.sendOnDisconnect_(e.action,e.pathString,e.data,e.onComplete)}for(let i=0;i<this.outstandingGets_.length;i++)this.outstandingGets_[i]&&this.sendGet_(i)}sendConnectStats_(){const e={};e["sdk.js."+gb.replace(/\./g,"-")]=1,ad()?e["framework.cordova"]=1:ud()&&(e["framework.reactnative"]=1),this.reportStats(e)}shouldReconnect_(){var e=T0.getInstance().currentlyOnline();return Ed(this.interruptReasons_)&&e}}B0.nextPersistentConnectionId_=0,B0.nextConnectionId_=0;class K0{constructor(e,t){this.name=e,this.node=t}static Wrap(e,t){return new K0(e,t)}}class $0{getCompare(){return this.compare.bind(this)}indexedValueChanged(e,t){var n=new K0(zb,e),r=new K0(zb,t);return 0!==this.compare(n,r)}minPost(){return K0.MIN}}let z0;class W0 extends $0{static get __EMPTY_NODE(){return z0}static set __EMPTY_NODE(e){z0=e}compare(e,t){return Gb(e.name,t.name)}isDefinedOn(e){throw Xh("KeyIndex.isDefinedOn not expected to be called.")}indexedValueChanged(e,t){return!1}minPost(){return K0.MIN}maxPost(){return new K0(Wb,z0)}makePost(e,t){return Jh("string"==typeof e,"KeyIndex indexValue must always be a string."),new K0(e,z0)}toString(){return".key"}}const G0=new W0;class H0{constructor(e,t,n,r,i=null){this.isReverse_=r,this.resultGenerator_=i,this.nodeStack_=[];let s=1;for(;!e.isEmpty();)if(s=t?n(e.key,t):1,r&&(s*=-1),s<0)e=this.isReverse_?e.left:e.right;else{if(0===s){this.nodeStack_.push(e);break}this.nodeStack_.push(e),e=this.isReverse_?e.right:e.left}}getNext(){if(0===this.nodeStack_.length)return null;let e=this.nodeStack_.pop(),t;if(t=this.resultGenerator_?this.resultGenerator_(e.key,e.value):{key:e.key,value:e.value},this.isReverse_)for(e=e.left;!e.isEmpty();)this.nodeStack_.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack_.push(e),e=e.left;return t}hasNext(){return 0<this.nodeStack_.length}peek(){if(0===this.nodeStack_.length)return null;var e=this.nodeStack_[this.nodeStack_.length-1];return this.resultGenerator_?this.resultGenerator_(e.key,e.value):{key:e.key,value:e.value}}}class Q0{constructor(e,t,n,r,i){this.key=e,this.value=t,this.color=null!=n?n:Q0.RED,this.left=null!=r?r:Y0.EMPTY_NODE,this.right=null!=i?i:Y0.EMPTY_NODE}copy(e,t,n,r,i){return new Q0(null!=e?e:this.key,null!=t?t:this.value,null!=n?n:this.color,null!=r?r:this.left,null!=i?i:this.right)}count(){return this.left.count()+1+this.right.count()}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||!!e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min_(){return this.left.isEmpty()?this:this.left.min_()}minKey(){return this.min_().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,n){let r=this;var i=n(e,r.key);return r=i<0?r.copy(null,null,null,r.left.insert(e,t,n),null):0===i?r.copy(null,t,null,null,null):r.copy(null,null,null,null,r.right.insert(e,t,n)),r.fixUp_()}removeMin_(){if(this.left.isEmpty())return Y0.EMPTY_NODE;let e=this;return e.left.isRed_()||e.left.left.isRed_()||(e=e.moveRedLeft_()),e=e.copy(null,null,null,e.left.removeMin_(),null),e.fixUp_()}remove(e,t){let n,r;if(n=this,t(e,n.key)<0)n.left.isEmpty()||n.left.isRed_()||n.left.left.isRed_()||(n=n.moveRedLeft_()),n=n.copy(null,null,null,n.left.remove(e,t),null);else{if(n.left.isRed_()&&(n=n.rotateRight_()),n.right.isEmpty()||n.right.isRed_()||n.right.left.isRed_()||(n=n.moveRedRight_()),0===t(e,n.key)){if(n.right.isEmpty())return Y0.EMPTY_NODE;r=n.right.min_(),n=n.copy(r.key,r.value,null,null,n.right.removeMin_())}n=n.copy(null,null,null,null,n.right.remove(e,t))}return n.fixUp_()}isRed_(){return this.color}fixUp_(){let e=this;return e.right.isRed_()&&!e.left.isRed_()&&(e=e.rotateLeft_()),e.left.isRed_()&&e.left.left.isRed_()&&(e=e.rotateRight_()),e.left.isRed_()&&e.right.isRed_()&&(e=e.colorFlip_()),e}moveRedLeft_(){let e=this.colorFlip_();return e.right.left.isRed_()&&(e=e.copy(null,null,null,null,e.right.rotateRight_()),e=e.rotateLeft_(),e=e.colorFlip_()),e}moveRedRight_(){let e=this.colorFlip_();return e.left.left.isRed_()&&(e=e.rotateRight_(),e=e.colorFlip_()),e}rotateLeft_(){var e=this.copy(null,null,Q0.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight_(){var e=this.copy(null,null,Q0.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip_(){var e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth_(){var e=this.check_();return Math.pow(2,e)<=this.count()+1}check_(){if(this.isRed_()&&this.left.isRed_())throw new Error("Red node has red child("+this.key+","+this.value+")");if(this.right.isRed_())throw new Error("Right child of ("+this.key+","+this.value+") is red");var e=this.left.check_();if(e!==this.right.check_())throw new Error("Black depths differ");return e+(this.isRed_()?0:1)}}Q0.RED=!0,Q0.BLACK=!1;class Y0{constructor(e,t=Y0.EMPTY_NODE){this.comparator_=e,this.root_=t}insert(e,t){return new Y0(this.comparator_,this.root_.insert(e,t,this.comparator_).copy(null,null,Q0.BLACK,null,null))}remove(e){return new Y0(this.comparator_,this.root_.remove(e,this.comparator_).copy(null,null,Q0.BLACK,null,null))}get(e){var t;let n=this.root_;for(;!n.isEmpty();){if(0===(t=this.comparator_(e,n.key)))return n.value;t<0?n=n.left:0<t&&(n=n.right)}return null}getPredecessorKey(e){let t,n=this.root_,r=null;for(;!n.isEmpty();){if(0===(t=this.comparator_(e,n.key))){if(n.left.isEmpty())return r?r.key:null;for(n=n.left;!n.right.isEmpty();)n=n.right;return n.key}t<0?n=n.left:0<t&&(r=n,n=n.right)}throw new Error("Attempted to find predecessor key for a nonexistent key.  What gives?")}isEmpty(){return this.root_.isEmpty()}count(){return this.root_.count()}minKey(){return this.root_.minKey()}maxKey(){return this.root_.maxKey()}inorderTraversal(e){return this.root_.inorderTraversal(e)}reverseTraversal(e){return this.root_.reverseTraversal(e)}getIterator(e){return new H0(this.root_,null,this.comparator_,!1,e)}getIteratorFrom(e,t){return new H0(this.root_,e,this.comparator_,!1,t)}getReverseIteratorFrom(e,t){return new H0(this.root_,e,this.comparator_,!0,t)}getReverseIterator(e){return new H0(this.root_,null,this.comparator_,!0,e)}}function J0(e,t){return Gb(e.name,t.name)}function X0(e,t){return Gb(e,t)}Y0.EMPTY_NODE=new class{copy(e,t,n,r,i){return this}insert(e,t,n){return new Q0(e,t,null)}remove(e,t){return this}count(){return 0}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}check_(){return 0}isRed_(){return!1}};let Z0;function eI(e){return"number"==typeof e?"number:"+Qb(e):"string:"+e}function tI(e){var t;e.isLeafNode()?(t=e.val(),Jh("string"==typeof t||"number"==typeof t||"object"==typeof t&&Id(t,".sv"),"Priority must be a string or number.")):Jh(e===Z0||e.isEmpty(),"priority of unexpected type."),Jh(e===Z0||e.getPriority().isEmpty(),"Priority nodes can't have a priority of their own.")}let nI;class rI{constructor(e,t=rI.__childrenNodeConstructor.EMPTY_NODE){this.value_=e,this.priorityNode_=t,this.lazyHash_=null,Jh(void 0!==this.value_&&null!==this.value_,"LeafNode shouldn't be created with null/undefined value."),tI(this.priorityNode_)}static set __childrenNodeConstructor(e){nI=e}static get __childrenNodeConstructor(){return nI}isLeafNode(){return!0}getPriority(){return this.priorityNode_}updatePriority(e){return new rI(this.value_,e)}getImmediateChild(e){return".priority"===e?this.priorityNode_:rI.__childrenNodeConstructor.EMPTY_NODE}getChild(e){return D0(e)?this:".priority"===k0(e)?this.priorityNode_:rI.__childrenNodeConstructor.EMPTY_NODE}hasChild(){return!1}getPredecessorChildName(e,t){return null}updateImmediateChild(e,t){return".priority"===e?this.updatePriority(t):t.isEmpty()&&".priority"!==e?this:rI.__childrenNodeConstructor.EMPTY_NODE.updateImmediateChild(e,t).updatePriority(this.priorityNode_)}updateChild(e,t){var n=k0(e);return null===n?t:t.isEmpty()&&".priority"!==n?this:(Jh(".priority"!==n||1===C0(e),".priority must be the last token in a path"),this.updateImmediateChild(n,rI.__childrenNodeConstructor.EMPTY_NODE.updateChild(A0(e),t)))}isEmpty(){return!1}numChildren(){return 0}forEachChild(e,t){return!1}val(e){return e&&!this.getPriority().isEmpty()?{".value":this.getValue(),".priority":this.getPriority().val()}:this.getValue()}hash(){if(null===this.lazyHash_){let e="";this.priorityNode_.isEmpty()||(e+="priority:"+eI(this.priorityNode_.val())+":");var t=typeof this.value_;e+=t+":",e+="number"==t?Qb(this.value_):this.value_,this.lazyHash_=Sb(e)}return this.lazyHash_}getValue(){return this.value_}compareTo(e){return e===rI.__childrenNodeConstructor.EMPTY_NODE?1:e instanceof rI.__childrenNodeConstructor?-1:(Jh(e.isLeafNode(),"Unknown node type"),this.compareToLeafNode_(e))}compareToLeafNode_(e){var t=typeof e.value_,n=typeof this.value_,r=rI.VALUE_TYPE_ORDER.indexOf(t),i=rI.VALUE_TYPE_ORDER.indexOf(n);return Jh(0<=r,"Unknown leaf type: "+t),Jh(0<=i,"Unknown leaf type: "+n),r===i?"object"==n?0:this.value_<e.value_?-1:this.value_===e.value_?0:1:i-r}withIndex(){return this}isIndexed(){return!0}equals(e){return e===this||!!e.isLeafNode()&&(this.value_===e.value_&&this.priorityNode_.equals(e.priorityNode_))}}rI.VALUE_TYPE_ORDER=["object","boolean","number","string"];let iI,sI;const oI=new class extends $0{compare(e,t){const n=e.node.getPriority();var r=t.node.getPriority(),r=n.compareTo(r);return 0===r?Gb(e.name,t.name):r}isDefinedOn(e){return!e.getPriority().isEmpty()}indexedValueChanged(e,t){return!e.getPriority().equals(t.getPriority())}minPost(){return K0.MIN}maxPost(){return new K0(Wb,new rI("[PRIORITY-POST]",sI))}makePost(e,t){var n=iI(e);return new K0(t,new rI("[PRIORITY-POST]",n))}toString(){return".priority"}},aI=Math.log(2);class cI{constructor(e){var t;this.count=(t=e+1,parseInt(Math.log(t)/aI,10)),this.current_=this.count-1;var n,r=(n=this.count,parseInt(Array(n+1).join("1"),2));this.bits_=e+1&r}nextBitIsOne(){var e=!(this.bits_&1<<this.current_);return this.current_--,e}}function lI(c,e,l,t){c.sort(e);const u=function(e,t){var n=t-e;let r,i;if(0==n)return null;if(1==n)return r=c[e],i=l?l(r):r,new Q0(i,r.node,Q0.BLACK,null,null);var s=parseInt(n/2,10)+e,o=u(e,s),n=u(s+1,t);return r=c[s],i=l?l(r):r,new Q0(i,r.node,Q0.BLACK,o,n)};var n=function(e){let s=null,o=null,a=c.length;function t(e,t){var n=a-e,r=a;a-=e;var i=u(1+n,r),r=c[n],n=l?l(r):r;!function(e){if(s){s.left=e;s=e}else{o=e;s=e}}(new Q0(n,r.node,t,null,i))}for(let i=0;i<e.count;++i){var n=e.nextBitIsOne(),r=Math.pow(2,e.count-(i+1));n?t(r,Q0.BLACK):(t(r,Q0.BLACK),t(r,Q0.RED))}return o}(new cI(c.length));return new Y0(t||e,n)}let uI;const hI={};class dI{constructor(e,t){this.indexes_=e,this.indexSet_=t}static get Default(){return Jh((hI,oI),"ChildrenNode.ts has not been loaded"),uI=uI||new dI({".priority":hI},{".priority":oI}),uI}get(e){var t=Td(this.indexes_,e);if(!t)throw new Error("No index defined for "+e);return t instanceof Y0?t:null}hasIndex(e){return Id(this.indexSet_,e.toString())}addIndex(e,t){Jh(e!==G0,"KeyIndex always exists and isn't meant to be added to the IndexMap.");const n=[];let r=!1;const i=t.getIterator(K0.Wrap);let s=i.getNext();for(;s;)r=r||e.isDefinedOn(s.node),n.push(s),s=i.getNext();let o;o=r?lI(n,e.getCompare()):hI;var a=e.toString();const c=Object.assign({},this.indexSet_);c[a]=e;const l=Object.assign({},this.indexes_);return l[a]=o,new dI(l,c)}addToIndexes(o,a){var e=Sd(this.indexes_,(t,e)=>{const n=Td(this.indexSet_,e);if(Jh(n,"Missing index implementation for "+e),t===hI){if(n.isDefinedOn(o.node)){const i=[],s=a.getIterator(K0.Wrap);let e=s.getNext();for(;e;)e.name!==o.name&&i.push(e),e=s.getNext();return i.push(o),lI(i,n.getCompare())}return hI}{var r=a.get(o.name);let e=t;return r&&(e=e.remove(new K0(o.name,r))),e.insert(o,o.node)}});return new dI(e,this.indexSet_)}removeFromIndexes(n,r){var e=Sd(this.indexes_,e=>{if(e===hI)return e;var t=r.get(n.name);return t?e.remove(new K0(n.name,t)):e});return new dI(e,this.indexSet_)}}let fI;class pI{constructor(e,t,n){this.children_=e,this.priorityNode_=t,this.indexMap_=n,this.lazyHash_=null,this.priorityNode_&&tI(this.priorityNode_),this.children_.isEmpty()&&Jh(!this.priorityNode_||this.priorityNode_.isEmpty(),"An empty node cannot have a priority")}static get EMPTY_NODE(){return fI=fI||new pI(new Y0(X0),null,dI.Default)}isLeafNode(){return!1}getPriority(){return this.priorityNode_||fI}updatePriority(e){return this.children_.isEmpty()?this:new pI(this.children_,e,this.indexMap_)}getImmediateChild(e){if(".priority"===e)return this.getPriority();var t=this.children_.get(e);return null===t?fI:t}getChild(e){var t=k0(e);return null===t?this:this.getImmediateChild(t).getChild(A0(e))}hasChild(e){return null!==this.children_.get(e)}updateImmediateChild(n,r){if(Jh(r,"We should always be passing snapshot nodes"),".priority"===n)return this.updatePriority(r);{var i=new K0(n,r);let e,t;t=r.isEmpty()?(e=this.children_.remove(n),this.indexMap_.removeFromIndexes(i,this.children_)):(e=this.children_.insert(n,r),this.indexMap_.addToIndexes(i,this.children_));i=e.isEmpty()?fI:this.priorityNode_;return new pI(e,i,t)}}updateChild(e,t){var n=k0(e);if(null===n)return t;Jh(".priority"!==k0(e)||1===C0(e),".priority must be the last token in a path");var r=this.getImmediateChild(n).updateChild(A0(e),t);return this.updateImmediateChild(n,r)}isEmpty(){return this.children_.isEmpty()}numChildren(){return this.children_.count()}val(n){if(this.isEmpty())return null;const r={};let i=0,s=0,o=!0;if(this.forEachChild(oI,(e,t)=>{r[e]=t.val(n),i++,o&&pI.INTEGER_REGEXP_.test(e)?s=Math.max(s,Number(e)):o=!1}),!n&&o&&s<2*i){const e=[];for(const t in r)e[t]=r[t];return e}return n&&!this.getPriority().isEmpty()&&(r[".priority"]=this.getPriority().val()),r}hash(){if(null===this.lazyHash_){let r="";this.getPriority().isEmpty()||(r+="priority:"+eI(this.getPriority().val())+":"),this.forEachChild(oI,(e,t)=>{var n=t.hash();""!==n&&(r+=":"+e+":"+n)}),this.lazyHash_=""===r?"":Sb(r)}return this.lazyHash_}getPredecessorChildName(e,t,n){const r=this.resolveIndex_(n);if(r){var i=r.getPredecessorKey(new K0(e,t));return i?i.name:null}return this.children_.getPredecessorKey(e)}getFirstChildName(e){const t=this.resolveIndex_(e);if(t){var n=t.minKey();return n&&n.name}return this.children_.minKey()}getFirstChild(e){var t=this.getFirstChildName(e);return t?new K0(t,this.children_.get(t)):null}getLastChildName(e){const t=this.resolveIndex_(e);if(t){var n=t.maxKey();return n&&n.name}return this.children_.maxKey()}getLastChild(e){var t=this.getLastChildName(e);return t?new K0(t,this.children_.get(t)):null}forEachChild(e,t){const n=this.resolveIndex_(e);return n?n.inorderTraversal(e=>t(e.name,e.node)):this.children_.inorderTraversal(t)}getIterator(e){return this.getIteratorFrom(e.minPost(),e)}getIteratorFrom(t,n){const e=this.resolveIndex_(n);if(e)return e.getIteratorFrom(t,e=>e);{const r=this.children_.getIteratorFrom(t.name,K0.Wrap);let e=r.peek();for(;null!=e&&n.compare(e,t)<0;)r.getNext(),e=r.peek();return r}}getReverseIterator(e){return this.getReverseIteratorFrom(e.maxPost(),e)}getReverseIteratorFrom(t,n){const e=this.resolveIndex_(n);if(e)return e.getReverseIteratorFrom(t,e=>e);{const r=this.children_.getReverseIteratorFrom(t.name,K0.Wrap);let e=r.peek();for(;null!=e&&0<n.compare(e,t);)r.getNext(),e=r.peek();return r}}compareTo(e){return this.isEmpty()?e.isEmpty()?0:-1:e.isLeafNode()||e.isEmpty()?1:e===mI?-1:0}withIndex(e){if(e===G0||this.indexMap_.hasIndex(e))return this;var t=this.indexMap_.addIndex(e,this.children_);return new pI(this.children_,this.priorityNode_,t)}isIndexed(e){return e===G0||this.indexMap_.hasIndex(e)}equals(e){if(e===this)return!0;if(e.isLeafNode())return!1;{const n=e;if(this.getPriority().equals(n.getPriority())){if(this.children_.count()!==n.children_.count())return!1;{const r=this.getIterator(oI),i=n.getIterator(oI);let e=r.getNext(),t=i.getNext();for(;e&&t;){if(e.name!==t.name||!e.node.equals(t.node))return!1;e=r.getNext(),t=i.getNext()}return null===e&&null===t}}return!1}}resolveIndex_(e){return e===G0?null:this.indexMap_.get(e.toString())}}pI.INTEGER_REGEXP_=/^(0|[1-9]\d*)$/;class gI extends pI{constructor(){super(new Y0(X0),pI.EMPTY_NODE,dI.Default)}compareTo(e){return e===this?0:1}equals(e){return e===this}getPriority(){return this}getImmediateChild(e){return pI.EMPTY_NODE}isEmpty(){return!1}}const mI=new gI;Object.defineProperties(K0,{MIN:{value:new K0(zb,pI.EMPTY_NODE)},MAX:{value:new K0(Wb,mI)}}),W0.__EMPTY_NODE=pI.EMPTY_NODE,rI.__childrenNodeConstructor=pI,_b=mI,Z0=_b,wb=mI,sI=wb;const vI=!0;function yI(i,e=null){if(null===i)return pI.EMPTY_NODE;if("object"==typeof i&&".priority"in i&&(e=i[".priority"]),Jh(null===e||"string"==typeof e||"number"==typeof e||"object"==typeof e&&".sv"in e,"Invalid priority type found: "+typeof e),"object"!=typeof(i="object"==typeof i&&".value"in i&&null!==i[".value"]?i[".value"]:i)||".sv"in i){var t=i;return new rI(t,yI(e))}if(i instanceof Array||!vI){let r=pI.EMPTY_NODE;return Hb(i,(e,t)=>{if(Id(i,e)&&"."!==e.substring(0,1)){const n=yI(t);!n.isLeafNode()&&n.isEmpty()||(r=r.updateImmediateChild(e,n))}}),r.updatePriority(yI(e))}{const s=[];let r=!1;if(Hb(i,(e,t)=>{if("."!==e.substring(0,1)){const n=yI(t);n.isEmpty()||(r=r||!n.getPriority().isEmpty(),s.push(new K0(e,n)))}}),0===s.length)return pI.EMPTY_NODE;var n=lI(s,J0,e=>e.name,X0);if(r){t=lI(s,oI.getCompare());return new pI(n,yI(e),new dI({".priority":t},{".priority":oI}))}return new pI(n,yI(e),dI.Default)}}iI=yI;class _I extends $0{constructor(e){super(),this.indexPath_=e,Jh(!D0(e)&&".priority"!==k0(e),"Can't create PathIndex with empty path or .priority key")}extractChild(e){return e.getChild(this.indexPath_)}isDefinedOn(e){return!e.getChild(this.indexPath_).isEmpty()}compare(e,t){const n=this.extractChild(e.node);var r=this.extractChild(t.node),r=n.compareTo(r);return 0===r?Gb(e.name,t.name):r}makePost(e,t){var n=yI(e),n=pI.EMPTY_NODE.updateChild(this.indexPath_,n);return new K0(t,n)}maxPost(){var e=pI.EMPTY_NODE.updateChild(this.indexPath_,mI);return new K0(Wb,e)}toString(){return x0(this.indexPath_,0).join("/")}}function wI(e){if(e===""+Zb)return EI;var t=e0(e);if(null!=t)return""+(t+1);const n=new Array(e.length);for(let i=0;i<n.length;i++)n[i]=e.charAt(i);if(n.length<kI)return n.push(EI),n.join("");let r=n.length-1;for(;0<=r&&n[r]===SI;)r--;return-1===r?Wb:(t=n[r],t=TI.charAt(TI.indexOf(t)+1),n[r]=t,n.slice(0,r+1).join(""))}function bI(e){if(e===""+Xb)return zb;var t=e0(e);if(null!=t)return""+(t-1);const n=new Array(e.length);for(let r=0;r<n.length;r++)n[r]=e.charAt(r);return n[n.length-1]===EI?1===n.length?""+Zb:(delete n[n.length-1],n.join("")):(n[n.length-1]=TI.charAt(TI.indexOf(n[n.length-1])-1),n.join("")+SI.repeat(kI-n.length))}const II=new class extends $0{compare(e,t){var n=e.node.compareTo(t.node);return 0===n?Gb(e.name,t.name):n}isDefinedOn(e){return!0}indexedValueChanged(e,t){return!e.equals(t)}minPost(){return K0.MIN}maxPost(){return K0.MAX}makePost(e,t){var n=yI(e);return new K0(t,n)}toString(){return".value"}},TI="-0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ_abcdefghijklmnopqrstuvwxyz",EI="-",SI="z",kI=786,CI=function(){let s=0;const o=[];return function(e){var t=e===s;s=e;let n;const r=new Array(8);for(n=7;0<=n;n--)r[n]=TI.charAt(e%64),e=Math.floor(e/64);Jh(0===e,"Cannot push at time == 0");let i=r.join("");if(t){for(n=11;0<=n&&63===o[n];n--)o[n]=0;o[n]++}else for(n=0;n<12;n++)o[n]=Math.floor(64*Math.random());for(n=0;n<12;n++)i+=TI.charAt(o[n]);return Jh(20===i.length,"nextPushId: Length should be 20."),i}}();function AI(e){return{type:"value",snapshotNode:e}}function NI(e,t){return{type:"child_added",snapshotNode:t,childName:e}}function xI(e,t){return{type:"child_removed",snapshotNode:t,childName:e}}function RI(e,t,n){return{type:"child_changed",snapshotNode:t,childName:e,oldSnap:n}}class PI{constructor(e){this.index_=e}updateChild(e,t,n,r,i,s){Jh(e.isIndexed(this.index_),"A node must be indexed if only a child is updated");const o=e.getImmediateChild(t);return o.getChild(r).equals(n.getChild(r))&&o.isEmpty()===n.isEmpty()?e:(null!=s&&(n.isEmpty()?e.hasChild(t)?s.trackChildChange(xI(t,o)):Jh(e.isLeafNode(),"A child remove without an old child only makes sense on a leaf node"):o.isEmpty()?s.trackChildChange(NI(t,n)):s.trackChildChange(RI(t,n,o))),e.isLeafNode()&&n.isEmpty()?e:e.updateImmediateChild(t,n).withIndex(this.index_))}updateFullNode(r,n,i){return null!=i&&(r.isLeafNode()||r.forEachChild(oI,(e,t)=>{n.hasChild(e)||i.trackChildChange(xI(e,t))}),n.isLeafNode()||n.forEachChild(oI,(e,t)=>{if(r.hasChild(e)){const n=r.getImmediateChild(e);n.equals(t)||i.trackChildChange(RI(e,t,n))}else i.trackChildChange(NI(e,t))})),n.withIndex(this.index_)}updatePriority(e,t){return e.isEmpty()?pI.EMPTY_NODE:e.updatePriority(t)}filtersNodes(){return!1}getIndexedFilter(){return this}getIndex(){return this.index_}}class DI{constructor(e){this.indexedFilter_=new PI(e.getIndex()),this.index_=e.getIndex(),this.startPost_=DI.getStartPost_(e),this.endPost_=DI.getEndPost_(e)}getStartPost(){return this.startPost_}getEndPost(){return this.endPost_}matches(e){return this.index_.compare(this.getStartPost(),e)<=0&&this.index_.compare(e,this.getEndPost())<=0}updateChild(e,t,n,r,i,s){return this.matches(new K0(t,n))||(n=pI.EMPTY_NODE),this.indexedFilter_.updateChild(e,t,n,r,i,s)}updateFullNode(e,t,n){let r=(t=t.isLeafNode()?pI.EMPTY_NODE:t).withIndex(this.index_);r=r.updatePriority(pI.EMPTY_NODE);const i=this;return t.forEachChild(oI,(e,t)=>{i.matches(new K0(e,t))||(r=r.updateImmediateChild(e,pI.EMPTY_NODE))}),this.indexedFilter_.updateFullNode(e,r,n)}updatePriority(e,t){return e}filtersNodes(){return!0}getIndexedFilter(){return this.indexedFilter_}getIndex(){return this.index_}static getStartPost_(e){if(e.hasStart()){var t=e.getIndexStartName();return e.getIndex().makePost(e.getIndexStartValue(),t)}return e.getIndex().minPost()}static getEndPost_(e){if(e.hasEnd()){var t=e.getIndexEndName();return e.getIndex().makePost(e.getIndexEndValue(),t)}return e.getIndex().maxPost()}}class OI{constructor(e){this.rangedFilter_=new DI(e),this.index_=e.getIndex(),this.limit_=e.getLimit(),this.reverse_=!e.isViewFromLeft()}updateChild(e,t,n,r,i,s){return this.rangedFilter_.matches(new K0(t,n))||(n=pI.EMPTY_NODE),e.getImmediateChild(t).equals(n)?e:e.numChildren()<this.limit_?this.rangedFilter_.getIndexedFilter().updateChild(e,t,n,r,i,s):this.fullLimitUpdateChild_(e,t,n,i,s)}updateFullNode(e,o,t){let a;if(o.isLeafNode()||o.isEmpty())a=pI.EMPTY_NODE.withIndex(this.index_);else if(2*this.limit_<o.numChildren()&&o.isIndexed(this.index_)){a=pI.EMPTY_NODE.withIndex(this.index_);let t;t=this.reverse_?o.getReverseIteratorFrom(this.rangedFilter_.getEndPost(),this.index_):o.getIteratorFrom(this.rangedFilter_.getStartPost(),this.index_);let n=0;for(;t.hasNext()&&n<this.limit_;){var r=t.getNext();let e;if(e=this.reverse_?this.index_.compare(this.rangedFilter_.getStartPost(),r)<=0:this.index_.compare(r,this.rangedFilter_.getEndPost())<=0,!e)break;a=a.updateImmediateChild(r.name,r.node),n++}}else{a=o.withIndex(this.index_),a=a.updatePriority(pI.EMPTY_NODE);let e,t,n,r;if(this.reverse_){r=a.getReverseIterator(this.index_),e=this.rangedFilter_.getEndPost(),t=this.rangedFilter_.getStartPost();const l=this.index_.getCompare();n=(e,t)=>l(t,e)}else r=a.getIterator(this.index_),e=this.rangedFilter_.getStartPost(),t=this.rangedFilter_.getEndPost(),n=this.index_.getCompare();let i=0,s=!1;for(;r.hasNext();){var c=r.getNext();!s&&n(e,c)<=0&&(s=!0),s&&i<this.limit_&&n(c,t)<=0?i++:a=a.updateImmediateChild(c.name,pI.EMPTY_NODE)}}return this.rangedFilter_.getIndexedFilter().updateFullNode(e,a,t)}updatePriority(e,t){return e}filtersNodes(){return!0}getIndexedFilter(){return this.rangedFilter_.getIndexedFilter()}getIndex(){return this.index_}fullLimitUpdateChild_(e,t,n,r,i){let s;if(this.reverse_){const d=this.index_.getCompare();s=(e,t)=>d(t,e)}else s=this.index_.getCompare();const o=e;Jh(o.numChildren()===this.limit_,"");var a=new K0(t,n),c=this.reverse_?o.getFirstChild(this.index_):o.getLastChild(this.index_),l=this.rangedFilter_.matches(a);if(o.hasChild(t)){var u=o.getImmediateChild(t);let e=r.getChildAfterChild(this.index_,c,this.reverse_);for(;null!=e&&(e.name===t||o.hasChild(e.name));)e=r.getChildAfterChild(this.index_,e,this.reverse_);var h=null==e?1:s(e,a);if(l&&!n.isEmpty()&&0<=h)return null!=i&&i.trackChildChange(RI(t,n,u)),o.updateImmediateChild(t,n);{null!=i&&i.trackChildChange(xI(t,u));const f=o.updateImmediateChild(t,pI.EMPTY_NODE);return null!=e&&this.rangedFilter_.matches(e)?(null!=i&&i.trackChildChange(NI(e.name,e.node)),f.updateImmediateChild(e.name,e.node)):f}}return!n.isEmpty()&&l&&0<=s(c,a)?(null!=i&&(i.trackChildChange(xI(c.name,c.node)),i.trackChildChange(NI(t,n))),o.updateImmediateChild(t,n).updateImmediateChild(c.name,pI.EMPTY_NODE)):e}}class MI{constructor(){this.limitSet_=!1,this.startSet_=!1,this.startNameSet_=!1,this.startAfterSet_=!1,this.endSet_=!1,this.endNameSet_=!1,this.endBeforeSet_=!1,this.limit_=0,this.viewFrom_="",this.indexStartValue_=null,this.indexStartName_="",this.indexEndValue_=null,this.indexEndName_="",this.index_=oI}hasStart(){return this.startSet_}hasStartAfter(){return this.startAfterSet_}hasEndBefore(){return this.endBeforeSet_}isViewFromLeft(){return""===this.viewFrom_?this.startSet_:"l"===this.viewFrom_}getIndexStartValue(){return Jh(this.startSet_,"Only valid if start has been set"),this.indexStartValue_}getIndexStartName(){return Jh(this.startSet_,"Only valid if start has been set"),this.startNameSet_?this.indexStartName_:zb}hasEnd(){return this.endSet_}getIndexEndValue(){return Jh(this.endSet_,"Only valid if end has been set"),this.indexEndValue_}getIndexEndName(){return Jh(this.endSet_,"Only valid if end has been set"),this.endNameSet_?this.indexEndName_:Wb}hasLimit(){return this.limitSet_}hasAnchoredLimit(){return this.limitSet_&&""!==this.viewFrom_}getLimit(){return Jh(this.limitSet_,"Only valid if limit has been set"),this.limit_}getIndex(){return this.index_}loadsAllData(){return!(this.startSet_||this.endSet_||this.limitSet_)}isDefault(){return this.loadsAllData()&&this.index_===oI}copy(){const e=new MI;return e.limitSet_=this.limitSet_,e.limit_=this.limit_,e.startSet_=this.startSet_,e.indexStartValue_=this.indexStartValue_,e.startNameSet_=this.startNameSet_,e.indexStartName_=this.indexStartName_,e.endSet_=this.endSet_,e.indexEndValue_=this.indexEndValue_,e.endNameSet_=this.endNameSet_,e.indexEndName_=this.indexEndName_,e.index_=this.index_,e.viewFrom_=this.viewFrom_,e}}function LI(e,t,n){const r=e.copy();return r.startSet_=!0,void 0===t&&(t=null),r.indexStartValue_=t,null!=n?(r.startNameSet_=!0,r.indexStartName_=n):(r.startNameSet_=!1,r.indexStartName_=""),r}function FI(e,t,n){const r=e.copy();return r.endSet_=!0,void 0===t&&(t=null),r.indexEndValue_=t,void 0!==n?(r.endNameSet_=!0,r.indexEndName_=n):(r.endNameSet_=!1,r.indexEndName_=""),r}function UI(e,t){const n=e.copy();return n.index_=t,n}function VI(e){const t={};if(e.isDefault())return t;let n;return n=e.index_===oI?"$priority":e.index_===II?"$value":e.index_===G0?"$key":(Jh(e.index_ instanceof _I,"Unrecognized index type!"),e.index_.toString()),t.orderBy=wd(n),e.startSet_&&(t.startAt=wd(e.indexStartValue_),e.startNameSet_&&(t.startAt+=","+wd(e.indexStartName_))),e.endSet_&&(t.endAt=wd(e.indexEndValue_),e.endNameSet_&&(t.endAt+=","+wd(e.indexEndName_))),e.limitSet_&&(e.isViewFromLeft()?t.limitToFirst=e.limit_:t.limitToLast=e.limit_),t}function jI(t){const n={};if(t.startSet_&&(n.sp=t.indexStartValue_,t.startNameSet_&&(n.sn=t.indexStartName_)),t.endSet_&&(n.ep=t.indexEndValue_,t.endNameSet_&&(n.en=t.indexEndName_)),t.limitSet_){n.l=t.limit_;let e=t.viewFrom_;""===e&&(e=t.isViewFromLeft()?"l":"r"),n.vf=e}return t.index_!==oI&&(n.i=t.index_.toString()),n}class qI extends b0{constructor(e,t,n,r){super(),this.repoInfo_=e,this.onDataUpdate_=t,this.authTokenProvider_=n,this.appCheckTokenProvider_=r,this.log_=Db("p:rest:"),this.listens_={}}reportStats(e){throw new Error("Method not implemented.")}static getListenId_(e,t){return void 0!==t?"tag$"+t:(Jh(e._queryParams.isDefault(),"should have a tag if it's not a default query."),e._path.toString())}listen(e,t,r,i){const s=e._path.toString();this.log_("Listen called for "+s+" "+e._queryIdentifier);const o=qI.getListenId_(e,r),a={};this.listens_[o]=a;var n=VI(e._queryParams);this.restRequest_(s+".json",n,(t,e)=>{let n=e;if(null===(t=404===t?n=null:t)&&this.onDataUpdate_(s,n,!1,r),Td(this.listens_,o)===a){let e;e=t?401===t?"permission_denied":"rest_error:"+t:"ok",i(e,null)}})}unlisten(e,t){var n=qI.getListenId_(e,t);delete this.listens_[n]}get(e){var t=VI(e._queryParams);const r=e._path.toString(),i=new id;return this.restRequest_(r+".json",t,(e,t)=>{let n=t;null===(e=404===e?n=null:e)?(this.onDataUpdate_(r,n,!1,null),i.resolve(n)):i.reject(new Error(n))}),i.promise}refreshAuthToken(e){}restRequest_(i,s={},o){return s.format="export",Promise.all([this.authTokenProvider_.getToken(!1),this.appCheckTokenProvider_.getToken(!1)]).then(([e,t])=>{e&&e.accessToken&&(s.auth=e.accessToken),t&&t.token&&(s.ac=t.token);const n=(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host+i+"?ns="+this.repoInfo_.namespace+Ad(s);this.log_("Sending REST request for "+n);const r=new XMLHttpRequest;r.onreadystatechange=()=>{if(o&&4===r.readyState){this.log_("REST Response for "+n+" received. status:",r.status,"response:",r.responseText);let e=null;if(200<=r.status&&r.status<300){try{e=_d(r.responseText)}catch(e){Bb("Failed to parse JSON response for "+n+": "+r.responseText)}o(null,e)}else 401!==r.status&&404!==r.status&&Bb("Got unsuccessful REST response for "+n+" Status: "+r.status),o(r.status);o=null}},r.open("GET",n,!0),r.send()})}}class BI{constructor(){this.rootNode_=pI.EMPTY_NODE}getNode(e){return this.rootNode_.getChild(e)}updateSnapshot(e,t){this.rootNode_=this.rootNode_.updateChild(e,t)}}function KI(){return{value:null,children:new Map}}function $I(e,t,n){var r;D0(t)?(e.value=n,e.children.clear()):null!==e.value?e.value=e.value.updateChild(t,n):(r=k0(t),e.children.has(r)||e.children.set(r,KI()),$I(e.children.get(r),t=A0(t),n))}function zI(e,n,r){var i;null!==e.value?r(n,e.value):(i=(e,t)=>{zI(t,new E0(n.toString()+"/"+e),r)},e.children.forEach((e,t)=>{i(t,e)}))}class WI{constructor(e){this.collection_=e,this.last_=null}get(){var e=this.collection_.get();const n=Object.assign({},e);return this.last_&&Hb(this.last_,(e,t)=>{n[e]=n[e]-t}),this.last_=e,n}}class GI{constructor(e,t){this.server_=t,this.statsToReport_={},this.statsListener_=new WI(e);var n=1e4+2e4*Math.random();Yb(this.reportStats_.bind(this),Math.floor(n))}reportStats_(){var e=this.statsListener_.get();const n={};let r=!1;Hb(e,(e,t)=>{0<t&&Id(this.statsToReport_,e)&&(n[e]=t,r=!0)}),r&&this.server_.reportStats(n),Yb(this.reportStats_.bind(this),Math.floor(2*Math.random()*3e5))}}function HI(){return{fromUser:!0,fromServer:!1,queryId:null,tagged:!1}}function QI(){return{fromUser:!1,fromServer:!0,queryId:null,tagged:!1}}function YI(e){return{fromUser:!1,fromServer:!0,queryId:e,tagged:!0}}(W=bb=bb||{})[W.OVERWRITE=0]="OVERWRITE",W[W.MERGE=1]="MERGE",W[W.ACK_USER_WRITE=2]="ACK_USER_WRITE",W[W.LISTEN_COMPLETE=3]="LISTEN_COMPLETE";class JI{constructor(e,t,n){this.path=e,this.affectedTree=t,this.revert=n,this.type=bb.ACK_USER_WRITE,this.source=HI()}operationForChild(e){if(D0(this.path)){if(null!=this.affectedTree.value)return Jh(this.affectedTree.children.isEmpty(),"affectedTree should not have overlapping affected paths."),this;var t=this.affectedTree.subtree(new E0(e));return new JI(S0(),t,this.revert)}return Jh(k0(this.path)===e,"operationForChild called for unrelated child."),new JI(A0(this.path),this.affectedTree,this.revert)}}class XI{constructor(e,t){this.source=e,this.path=t,this.type=bb.LISTEN_COMPLETE}operationForChild(e){return D0(this.path)?new XI(this.source,S0()):new XI(this.source,A0(this.path))}}class ZI{constructor(e,t,n){this.source=e,this.path=t,this.snap=n,this.type=bb.OVERWRITE}operationForChild(e){return D0(this.path)?new ZI(this.source,S0(),this.snap.getImmediateChild(e)):new ZI(this.source,A0(this.path),this.snap)}}class eT{constructor(e,t,n){this.source=e,this.path=t,this.children=n,this.type=bb.MERGE}operationForChild(e){if(D0(this.path)){const t=this.children.subtree(new E0(e));return t.isEmpty()?null:t.value?new ZI(this.source,S0(),t.value):new eT(this.source,S0(),t)}return Jh(k0(this.path)===e,"Can't get a merge for a child not on the path of the operation"),new eT(this.source,A0(this.path),this.children)}toString(){return"Operation("+this.path+": "+this.source.toString()+" merge: "+this.children.toString()+")"}}class tT{constructor(e,t,n){this.node_=e,this.fullyInitialized_=t,this.filtered_=n}isFullyInitialized(){return this.fullyInitialized_}isFiltered(){return this.filtered_}isCompleteForPath(e){if(D0(e))return this.isFullyInitialized()&&!this.filtered_;var t=k0(e);return this.isCompleteForChild(t)}isCompleteForChild(e){return this.isFullyInitialized()&&!this.filtered_||this.node_.hasChild(e)}getNode(){return this.node_}}class nT{constructor(e){this.query_=e,this.index_=this.query_._queryParams.getIndex()}}function rT(n,e,t,r){var i=[];const s=[];return e.forEach(e=>{var t;"child_changed"===e.type&&n.index_.indexedValueChanged(e.oldSnap,e.snapshotNode)&&s.push((t=e.childName,{type:"child_moved",snapshotNode:e.snapshotNode,childName:t}))}),iT(n,i,"child_removed",e,r,t),iT(n,i,"child_added",e,r,t),iT(n,i,"child_moved",s,r,t),iT(n,i,"child_changed",e,r,t),iT(n,i,"value",e,r,t),i}function iT(s,o,t,e,a,c){const n=e.filter(e=>e.type===t);n.sort((e,t)=>function(e,t,n){if(null==t.childName||null==n.childName)throw Xh("Should only compare child_ events.");var r=new K0(t.childName,t.snapshotNode),i=new K0(n.childName,n.snapshotNode);return e.index_.compare(r,i)}(s,e,t)),n.forEach(t=>{const n=(e=s,i=c,"value"===(r=t).type||"child_removed"===r.type||(r.prevName=i.getPredecessorChildName(r.childName,r.snapshotNode,e.index_)),r);var e,r,i;a.forEach(e=>{e.respondsTo(t.type)&&o.push(e.createEvent(n,s.query_))})})}function sT(e,t){return{eventCache:e,serverCache:t}}function oT(e,t,n,r){return sT(new tT(t,n,r),e.serverCache)}function aT(e,t,n,r){return sT(e.eventCache,new tT(t,n,r))}function cT(e){return e.eventCache.isFullyInitialized()?e.eventCache.getNode():null}function lT(e){return e.serverCache.isFullyInitialized()?e.serverCache.getNode():null}let uT;class hT{constructor(e,t=(uT=uT||new Y0(Mb),uT)){this.value=e,this.children=t}static fromObject(e){let n=new hT(null);return Hb(e,(e,t)=>{n=n.set(new E0(e),t)}),n}isEmpty(){return null===this.value&&this.children.isEmpty()}findRootMostMatchingPathAndValue(e,t){if(null!=this.value&&t(this.value))return{path:S0(),value:this.value};if(D0(e))return null;{var n=k0(e);const i=this.children.get(n);if(null===i)return null;var r=i.findRootMostMatchingPathAndValue(A0(e),t);return null==r?null:{path:P0(new E0(n),r.path),value:r.value}}}findRootMostValueAndPath(e){return this.findRootMostMatchingPathAndValue(e,()=>!0)}subtree(e){if(D0(e))return this;{var t=k0(e);const n=this.children.get(t);return null!==n?n.subtree(A0(e)):new hT(null)}}set(e,t){if(D0(e))return new hT(t,this.children);{var n=k0(e);const i=this.children.get(n)||new hT(null);var r=i.set(A0(e),t),r=this.children.insert(n,r);return new hT(this.value,r)}}remove(t){if(D0(t))return this.children.isEmpty()?new hT(null):new hT(null,this.children);{var n=k0(t);const r=this.children.get(n);if(r){const i=r.remove(A0(t));let e;return e=i.isEmpty()?this.children.remove(n):this.children.insert(n,i),null===this.value&&e.isEmpty()?new hT(null):new hT(this.value,e)}return this}}get(e){if(D0(e))return this.value;{var t=k0(e);const n=this.children.get(t);return n?n.get(A0(e)):null}}setTree(t,n){if(D0(t))return n;{var r=k0(t);const i=this.children.get(r)||new hT(null),s=i.setTree(A0(t),n);let e;return e=s.isEmpty()?this.children.remove(r):this.children.insert(r,s),new hT(this.value,e)}}fold(e){return this.fold_(S0(),e)}fold_(n,r){const i={};return this.children.inorderTraversal((e,t)=>{i[e]=t.fold_(P0(n,e),r)}),r(n,this.value,i)}findOnPath(e,t){return this.findOnPath_(e,S0(),t)}findOnPath_(e,t,n){var r=!!this.value&&n(t,this.value);if(r)return r;if(D0(e))return null;{r=k0(e);const i=this.children.get(r);return i?i.findOnPath_(A0(e),P0(t,r),n):null}}foreachOnPath(e,t){return this.foreachOnPath_(e,S0(),t)}foreachOnPath_(e,t,n){if(D0(e))return this;{this.value&&n(t,this.value);var r=k0(e);const i=this.children.get(r);return i?i.foreachOnPath_(A0(e),P0(t,r),n):new hT(null)}}foreach(e){this.foreach_(S0(),e)}foreach_(n,r){this.children.inorderTraversal((e,t)=>{t.foreach_(P0(n,e),r)}),this.value&&r(n,this.value)}foreachChild(n){this.children.inorderTraversal((e,t)=>{t.value&&n(e,t.value)})}}class dT{constructor(e){this.writeTree_=e}static empty(){return new dT(new hT(null))}}function fT(t,n,r){if(D0(n))return new dT(new hT(r));var i=t.writeTree_.findRootMostValueAndPath(n);if(null!=i){var s=i.path;let e=i.value;i=O0(s,n);return e=e.updateChild(i,r),new dT(t.writeTree_.set(s,e))}s=new hT(r),s=t.writeTree_.setTree(n,s);return new dT(s)}function pT(e,n,t){let r=e;return Hb(t,(e,t)=>{r=fT(r,P0(n,e),t)}),r}function gT(e,t){if(D0(t))return dT.empty();var n=e.writeTree_.setTree(t,new hT(null));return new dT(n)}function mT(e,t){return null!=vT(e,t)}function vT(e,t){var n=e.writeTree_.findRootMostValueAndPath(t);return null!=n?e.writeTree_.get(n.path).getChild(O0(n.path,t)):null}function yT(e){const n=[],t=e.writeTree_.value;return null!=t?t.isLeafNode()||t.forEachChild(oI,(e,t)=>{n.push(new K0(e,t))}):e.writeTree_.children.inorderTraversal((e,t)=>{null!=t.value&&n.push(new K0(e,t.value))}),n}function _T(e,t){if(D0(t))return e;var n=vT(e,t);return null!=n?new dT(new hT(n)):new dT(e.writeTree_.subtree(t))}function wT(e){return e.writeTree_.isEmpty()}function bT(e,t){return function r(i,e,s){{if(null!=e.value)return s.updateChild(i,e.value);{let n=null;return e.children.inorderTraversal((e,t)=>{".priority"===e?(Jh(null!==t.value,"Priority writes must always be leaf nodes"),n=t.value):s=r(P0(i,e),t,s)}),s=!s.getChild(i).isEmpty()&&null!==n?s.updateChild(P0(i,".priority"),n):s}}}(S0(),e.writeTree_,t)}function IT(e,t){return OT(t,e)}function TT(t,n){var e,r=t.allWrites.findIndex(e=>e.writeId===n);Jh(0<=r,"removeWrite called with nonexistent writeId.");const i=t.allWrites[r];t.allWrites.splice(r,1);let s=i.visible,o=!1,a=t.allWrites.length-1;for(;s&&0<=a;){var c=t.allWrites[a];c.visible&&(a>=r&&function(e,t){{if(e.snap)return F0(e.path,t);for(const n in e.children)if(e.children.hasOwnProperty(n)&&F0(P0(e.path,n),t))return!0;return!1}}(c,i.path)?s=!1:F0(i.path,c.path)&&(o=!0)),a--}return!!s&&(o?((e=t).visibleWrites=ST(e.allWrites,ET,S0()),0<e.allWrites.length?e.lastWriteId=e.allWrites[e.allWrites.length-1].writeId:e.lastWriteId=-1):i.snap?t.visibleWrites=gT(t.visibleWrites,i.path):Hb(i.children,e=>{t.visibleWrites=gT(t.visibleWrites,P0(i.path,e))}),!0)}function ET(e){return e.visible}function ST(e,t,n){let r=dT.empty();for(let s=0;s<e.length;++s){const o=e[s];if(t(o)){var i=o.path;let e;if(o.snap)F0(n,i)?(e=O0(n,i),r=fT(r,e,o.snap)):F0(i,n)&&(e=O0(i,n),r=fT(r,S0(),o.snap.getChild(e)));else{if(!o.children)throw Xh("WriteRecord should have .snap or .children");if(F0(n,i))e=O0(n,i),r=pT(r,e,o.children);else if(F0(i,n))if(e=O0(i,n),D0(e))r=pT(r,S0(),o.children);else{const a=Td(o.children,k0(e));a&&(i=a.getChild(A0(e)),r=fT(r,S0(),i))}}}}return r}function kT(e,t,n,r,i){if(r||i){var s=_T(e.visibleWrites,t);if(!i&&wT(s))return n;if(i||null!=n||mT(s,S0()))return bT(ST(e.allWrites,function(e){return(e.visible||i)&&(!r||!~r.indexOf(e.writeId))&&(F0(e.path,t)||F0(t,e.path))},t),n||pI.EMPTY_NODE);return null}s=vT(e.visibleWrites,t);if(null!=s)return s;s=_T(e.visibleWrites,t);return wT(s)?n:null!=n||mT(s,S0())?bT(s,n||pI.EMPTY_NODE):null}function CT(e,t,n,r){return kT(e.writeTree,e.treePath,t,n,r)}function AT(e,t){return function(e,t,n){let r=pI.EMPTY_NODE;const i=vT(e.visibleWrites,t);if(i)return i.isLeafNode()||i.forEachChild(oI,(e,t)=>{r=r.updateImmediateChild(e,t)}),r;if(n){const s=_T(e.visibleWrites,t);return n.forEachChild(oI,(e,t)=>{var n=bT(_T(s,new E0(e)),t);r=r.updateImmediateChild(e,n)}),yT(s).forEach(e=>{r=r.updateImmediateChild(e.name,e.node)}),r}return yT(_T(e.visibleWrites,t)).forEach(e=>{r=r.updateImmediateChild(e.name,e.node)}),r}(e.writeTree,e.treePath,t)}function NT(e,t,n,r){return function(e,t,n,r,i){Jh(r||i,"Either existingEventSnap or existingServerSnap must exist");var s=P0(t,n);return mT(e.visibleWrites,s)?null:wT(s=_T(e.visibleWrites,s))?i.getChild(n):bT(s,i.getChild(n))}(e.writeTree,e.treePath,t,n,r)}function xT(e,t){return n=e.writeTree,t=P0(e.treePath,t),vT(n.visibleWrites,t);var n}function RT(e,t,n,r,i,s){return function(e,t,n,r,i,s,o){let a;var c=_T(e.visibleWrites,t),l=vT(c,S0());if(null!=l)a=l;else{if(null==n)return[];a=bT(c,n)}if(a=a.withIndex(o),a.isEmpty()||a.isLeafNode())return[];{const u=[],h=o.getCompare(),d=s?a.getReverseIteratorFrom(r,o):a.getIteratorFrom(r,o);let e=d.getNext();for(;e&&u.length<i;)0!==h(e,r)&&u.push(e),e=d.getNext();return u}}(e.writeTree,e.treePath,t,n,r,i,s)}function PT(e,t,n){return r=e.writeTree,e=e.treePath,n=n,i=P0(e,t=t),null!=(s=vT(r.visibleWrites,i))?s:n.isCompleteForChild(t)?bT(_T(r.visibleWrites,i),n.getNode().getImmediateChild(t)):null;var r,i,s}function DT(e,t){return OT(P0(e.treePath,t),e.writeTree)}function OT(e,t){return{treePath:e,writeTree:t}}class MT{constructor(){this.changeMap=new Map}trackChildChange(e){var t=e.type,n=e.childName;Jh("child_added"===t||"child_changed"===t||"child_removed"===t,"Only child changes supported for tracking"),Jh(".priority"!==n,"Only non-priority child changes can be tracked.");var r=this.changeMap.get(n);if(r){var i=r.type;if("child_added"===t&&"child_removed"===i)this.changeMap.set(n,RI(n,e.snapshotNode,r.snapshotNode));else if("child_removed"===t&&"child_added"===i)this.changeMap.delete(n);else if("child_removed"===t&&"child_changed"===i)this.changeMap.set(n,xI(n,r.oldSnap));else if("child_changed"===t&&"child_added"===i)this.changeMap.set(n,NI(n,e.snapshotNode));else{if("child_changed"!==t||"child_changed"!==i)throw Xh("Illegal combination of changes: "+e+" occurred after "+r);this.changeMap.set(n,RI(n,e.snapshotNode,r.oldSnap))}}else this.changeMap.set(n,e)}getChanges(){return Array.from(this.changeMap.values())}}const LT=new class{getCompleteChild(e){return null}getChildAfterChild(e,t,n){return null}};class FT{constructor(e,t,n=null){this.writes_=e,this.viewCache_=t,this.optCompleteServerCache_=n}getCompleteChild(e){const t=this.viewCache_.eventCache;if(t.isCompleteForChild(e))return t.getNode().getImmediateChild(e);var n=null!=this.optCompleteServerCache_?new tT(this.optCompleteServerCache_,!0,!1):this.viewCache_.serverCache;return PT(this.writes_,e,n)}getChildAfterChild(e,t,n){var r=null!=this.optCompleteServerCache_?this.optCompleteServerCache_:lT(this.viewCache_),r=RT(this.writes_,r,t,1,n,e);return 0===r.length?null:r[0]}}function UT(e,t,n,r,i){const s=new MT;let o,a;if(n.type===bb.OVERWRITE){var c=n;o=c.source.fromUser?qT(e,t,c.path,c.snap,r,i,s):(Jh(c.source.fromServer,"Unknown source."),a=c.source.tagged||t.serverCache.isFiltered()&&!D0(c.path),jT(e,t,c.path,c.snap,r,i,a,s))}else if(n.type===bb.MERGE){c=n;o=c.source.fromUser?function(r,i,s,e,o,a,c){let l=i;return e.foreach((e,t)=>{var n=P0(s,e);BT(i,k0(n))&&(l=qT(r,l,n,t,o,a,c))}),e.foreach((e,t)=>{var n=P0(s,e);BT(i,k0(n))||(l=qT(r,l,n,t,o,a,c))}),l}(e,t,c.path,c.children,r,i,s):(Jh(c.source.fromServer,"Unknown source."),a=c.source.tagged||t.serverCache.isFiltered(),$T(e,t,c.path,c.children,r,i,a,s))}else if(n.type===bb.ACK_USER_WRITE){var l=n;o=l.revert?function(n,r,i,s,e,o){let a;{if(null!=xT(s,i))return r;{var c=new FT(s,r,e);const u=r.eventCache.getNode();let t;if(D0(i)||".priority"===k0(i)){let e;e=r.serverCache.isFullyInitialized()?CT(s,lT(r)):(l=r.serverCache.getNode(),Jh(l instanceof pI,"serverChildren would be complete if leaf node"),AT(s,l)),e=e,t=n.filter.updateFullNode(u,e,o)}else{var l=k0(i);let e=PT(s,l,r.serverCache);null==e&&r.serverCache.isCompleteForChild(l)&&(e=u.getImmediateChild(l)),t=null!=e?n.filter.updateChild(u,l,e,A0(i),c,o):r.eventCache.getNode().hasChild(l)?n.filter.updateChild(u,l,pI.EMPTY_NODE,A0(i),c,o):u,t.isEmpty()&&r.serverCache.isFullyInitialized()&&(a=CT(s,lT(r)),a.isLeafNode()&&(t=n.filter.updateFullNode(t,a,o)))}return a=r.serverCache.isFullyInitialized()||null!=xT(s,S0()),oT(r,t,a,n.filter.filtersNodes())}}}(e,t,l.path,r,i,s):function(e,t,i,n,s,o,a){if(null!=xT(s,i))return t;const c=t.serverCache.isFiltered(),l=t.serverCache;{if(null!=n.value){if(D0(i)&&l.isFullyInitialized()||l.isCompleteForPath(i))return jT(e,t,i,l.getNode().getChild(i),s,o,c,a);if(D0(i)){let n=new hT(null);return l.getNode().forEachChild(G0,(e,t)=>{n=n.set(new E0(e),t)}),$T(e,t,i,n,s,o,c,a)}return t}{let r=new hT(null);return n.foreach((e,t)=>{var n=P0(i,e);l.isCompleteForPath(n)&&(r=r.set(e,l.getNode().getChild(n)))}),$T(e,t,i,r,s,o,c,a)}}}(e,t,l.path,l.affectedTree,r,i,s)}else{if(n.type!==bb.LISTEN_COMPLETE)throw Xh("Unknown operation type: "+n.type);o=function(e,t,n,r,i){const s=t.serverCache,o=aT(t,s.getNode(),s.isFullyInitialized()||D0(n),s.isFiltered());return VT(e,o,n,r,LT,i)}(e,t,n.path,r,s)}l=s.getChanges();return function(e,t,n){const r=t.eventCache;if(r.isFullyInitialized()){var i=r.getNode().isLeafNode()||r.getNode().isEmpty();const s=cT(e);(0<n.length||!e.eventCache.isFullyInitialized()||i&&!r.getNode().equals(s)||!r.getNode().getPriority().equals(s.getPriority()))&&n.push(AI(cT(t)))}}(t,o,l),{viewCache:o,changes:l}}function VT(r,i,s,o,a,c){const l=i.eventCache;if(null!=xT(o,s))return i;{let t,n;if(D0(s)){var e;Jh(i.serverCache.isFullyInitialized(),"If change path is empty, we must have complete server data"),t=i.serverCache.isFiltered()?(e=AT(o,(e=lT(i))instanceof pI?e:pI.EMPTY_NODE),r.filter.updateFullNode(i.eventCache.getNode(),e,c)):(u=CT(o,lT(i)),r.filter.updateFullNode(i.eventCache.getNode(),u,c))}else{var u=k0(s);if(".priority"===u){Jh(1===C0(s),"Can't have a priority with additional path components");var h=l.getNode();n=i.serverCache.getNode();var d=NT(o,s,h,n);t=null!=d?r.filter.updatePriority(h,d):l.getNode()}else{h=A0(s);let e;e=l.isCompleteForChild(u)?(n=i.serverCache.getNode(),null!=(d=NT(o,s,l.getNode(),n))?l.getNode().getImmediateChild(u).updateChild(h,d):l.getNode().getImmediateChild(u)):PT(o,u,i.serverCache),t=null!=e?r.filter.updateChild(l.getNode(),u,e,h,a,c):l.getNode()}}return oT(i,t,l.isFullyInitialized()||D0(s),r.filter.filtersNodes())}}function jT(e,t,n,r,i,s,o,a){const c=t.serverCache;let l;const u=o?e.filter:e.filter.getIndexedFilter();if(D0(n))l=u.updateFullNode(c.getNode(),r,null);else if(u.filtersNodes()&&!c.isFiltered()){var h=c.getNode().updateChild(n,r);l=u.updateFullNode(c.getNode(),h,null)}else{var d=k0(n);if(!c.isCompleteForPath(n)&&1<C0(n))return t;var f=A0(n);const p=c.getNode().getImmediateChild(d);h=p.updateChild(f,r);l=".priority"===d?u.updatePriority(c.getNode(),h):u.updateChild(c.getNode(),d,h,f,LT,null)}f=aT(t,l,c.isFullyInitialized()||D0(n),u.filtersNodes());return VT(e,f,n,i,new FT(i,f,s),a)}function qT(t,n,r,i,e,s,o){const a=n.eventCache;let c,l;const u=new FT(e,n,s);if(D0(r))l=t.filter.updateFullNode(n.eventCache.getNode(),i,o),c=oT(n,l,!0,t.filter.filtersNodes());else{var h=k0(r);if(".priority"===h)l=t.filter.updatePriority(n.eventCache.getNode(),i),c=oT(n,l,a.isFullyInitialized(),a.isFiltered());else{var d=A0(r);const f=a.getNode().getImmediateChild(h);let e;if(D0(d))e=i;else{const p=u.getCompleteChild(h);e=null!=p?".priority"===N0(d)&&p.getChild(R0(d)).isEmpty()?p:p.updateChild(d,i):pI.EMPTY_NODE}c=f.equals(e)?n:oT(n,t.filter.updateChild(a.getNode(),h,e,d,u,o),a.isFullyInitialized(),t.filter.filtersNodes())}}return c}function BT(e,t){return e.eventCache.isCompleteForChild(t)}function KT(e,n,t){return t.foreach((e,t)=>{n=n.updateChild(e,t)}),n}function $T(r,i,e,t,s,o,a,c){if(i.serverCache.getNode().isEmpty()&&!i.serverCache.isFullyInitialized())return i;let l=i,n;n=D0(e)?t:new hT(null).setTree(e,t);const u=i.serverCache.getNode();return n.children.inorderTraversal((e,t)=>{var n;u.hasChild(e)&&(n=KT(0,i.serverCache.getNode().getImmediateChild(e),t),l=jT(r,l,new E0(e),n,s,o,a,c))}),n.children.inorderTraversal((e,t)=>{var n=!i.serverCache.isCompleteForChild(e)&&void 0===t.value;u.hasChild(e)||n||(n=KT(0,i.serverCache.getNode().getImmediateChild(e),t),l=jT(r,l,new E0(e),n,s,o,a,c))}),l}class zT{constructor(e,t){this.query_=e,this.eventRegistrations_=[];const n=this.query_._queryParams,r=new PI(n.getIndex()),i=(e=n).loadsAllData()?new PI(e.getIndex()):new(e.hasLimit()?OI:DI)(e);this.processor_={filter:i};const s=t.serverCache,o=t.eventCache;var a=r.updateFullNode(pI.EMPTY_NODE,s.getNode(),null),c=i.updateFullNode(pI.EMPTY_NODE,o.getNode(),null),a=new tT(a,s.isFullyInitialized(),r.filtersNodes()),c=new tT(c,o.isFullyInitialized(),i.filtersNodes());this.viewCache_=sT(c,a),this.eventGenerator_=new nT(this.query_)}get query(){return this.query_}}function WT(e){return 0===e.eventRegistrations_.length}function GT(n,r,i){const s=[];if(i){Jh(null==r,"A cancel should cancel all event registrations.");const o=n.query._path;n.eventRegistrations_.forEach(e=>{var t=e.createCancelEvent(i,o);t&&s.push(t)})}if(r){let e=[];for(let t=0;t<n.eventRegistrations_.length;++t){const a=n.eventRegistrations_[t];if(a.matches(r)){if(r.hasAnyCallback()){e=e.concat(n.eventRegistrations_.slice(t+1));break}}else e.push(a)}n.eventRegistrations_=e}else n.eventRegistrations_=[];return s}function HT(e,t,n,r){t.type===bb.MERGE&&null!==t.source.queryId&&(Jh(lT(e.viewCache_),"We should always have a full cache before handling merges"),Jh(cT(e.viewCache_),"Missing event cache, even though we have a server cache"));const i=e.viewCache_,s=UT(e.processor_,i,t,n,r);return n=e.processor_,r=s.viewCache,Jh(r.eventCache.getNode().isIndexed(n.filter.getIndex()),"Event snap not indexed"),Jh(r.serverCache.getNode().isIndexed(n.filter.getIndex()),"Server snap not indexed"),Jh(s.viewCache.serverCache.isFullyInitialized()||!i.serverCache.isFullyInitialized(),"Once a server snap is complete, it should never go back"),e.viewCache_=s.viewCache,QT(e,s.changes,s.viewCache.eventCache.getNode(),null)}function QT(e,t,n,r){var i=r?[r]:e.eventRegistrations_;return rT(e.eventGenerator_,t,n,i)}let YT;class JT{constructor(){this.views=new Map}}function XT(t,n,r,i){var e=n.source.queryId;if(null!==e){e=t.views.get(e);return Jh(null!=e,"SyncTree gave us an op for an invalid query."),HT(e,n,r,i)}{let e=[];for(const s of t.views.values())e=e.concat(HT(s,n,r,i));return e}}function ZT(e,n,r,i,s){var o=n._queryIdentifier,o=e.views.get(o);if(o)return o;{let e=CT(r,s?i:null),t=!1;t=!!e||(e=i instanceof pI?AT(r,i):pI.EMPTY_NODE,!1);o=sT(new tT(e,t,!1),new tT(i,s,!1));return new zT(n,o)}}function eE(e,t,n,r,i,s){var o=ZT(e,t,r,i,s);return e.views.has(t._queryIdentifier)||e.views.set(t._queryIdentifier,o),o.eventRegistrations_.push(n),function(e,t){const n=e.viewCache_.eventCache,r=[];if(!n.getNode().isLeafNode()){const i=n.getNode();i.forEachChild(oI,(e,t)=>{r.push(NI(e,t))})}return n.isFullyInitialized()&&r.push(AI(n.getNode())),QT(e,r,n.getNode(),t)}(o,n)}function tE(e,t,n,r){var i=t._queryIdentifier;const s=[];let o=[];var a=oE(e);if("default"===i)for(var[c,l]of e.views.entries())o=o.concat(GT(l,n,r)),WT(l)&&(e.views.delete(c),l.query._queryParams.loadsAllData()||s.push(l.query));else{const u=e.views.get(i);u&&(o=o.concat(GT(u,n,r)),WT(u)&&(e.views.delete(i),u.query._queryParams.loadsAllData()||s.push(u.query)))}return a&&!oE(e)&&s.push((Jh(YT,"Reference.ts has not been loaded"),new YT(t._repo,t._path))),{removed:s,events:o}}function nE(e){const t=[];for(const n of e.views.values())n.query._queryParams.loadsAllData()||t.push(n);return t}function rE(e,t){let n=null;for(const r of e.views.values())n=n||function(e,t){const n=lT(e.viewCache_);return n&&(e.query._queryParams.loadsAllData()||!D0(t)&&!n.getImmediateChild(k0(t)).isEmpty())?n.getChild(t):null}(r,t);return n}function iE(e,t){const n=t._queryParams;if(n.loadsAllData())return aE(e);var r=t._queryIdentifier;return e.views.get(r)}function sE(e,t){return null!=iE(e,t)}function oE(e){return null!=aE(e)}function aE(e){for(const t of e.views.values())if(t.query._queryParams.loadsAllData())return t;return null}let cE;let lE=1;class uE{constructor(e){this.listenProvider_=e,this.syncPointTree_=new hT(null),this.pendingWriteTree_={visibleWrites:dT.empty(),allWrites:[],lastWriteId:-1},this.tagToQueryMap=new Map,this.queryToTagMap=new Map}}function hE(e,t,n,r,i){var s,o,a,c;return s=e.pendingWriteTree_,o=t,a=n,c=r,r=i,Jh(c>s.lastWriteId,"Stacking an older write on top of newer ones"),s.allWrites.push({path:o,snap:a,writeId:c,visible:r=void 0===r?!0:r}),r&&(s.visibleWrites=fT(s.visibleWrites,o,a)),s.lastWriteId=c,i?bE(e,new ZI(HI(),t,n)):[]}function dE(e,t,n,r){var i,s,o;i=e.pendingWriteTree_,s=t,o=n,r=r,Jh(r>i.lastWriteId,"Stacking an older merge on top of newer ones"),i.allWrites.push({path:s,children:o,writeId:r,visible:!0}),i.visibleWrites=pT(i.visibleWrites,s,o),i.lastWriteId=r;var a=hT.fromObject(n);return bE(e,new eT(HI(),t,a))}function fE(e,t,n=!1){var r=function(e,t){for(let r=0;r<e.allWrites.length;r++){var n=e.allWrites[r];if(n.writeId===t)return n}return null}(e.pendingWriteTree_,t);if(TT(e.pendingWriteTree_,t)){let t=new hT(null);return null!=r.snap?t=t.set(S0(),!0):Hb(r.children,e=>{t=t.set(new E0(e),!0)}),bE(e,new JI(r.path,t,n))}return[]}function pE(e,t,n){return bE(e,new ZI(QI(),t,n))}function gE(n,e,t,r){var i=e._path,s=n.syncPointTree_.get(i);let o=[];if(s&&("default"===e._queryIdentifier||sE(s,e))){var a=tE(s,e,t,r);0===s.views.size&&(n.syncPointTree_=n.syncPointTree_.remove(i));const h=a.removed;o=a.events;s=-1!==h.findIndex(e=>e._queryParams.loadsAllData()),a=n.syncPointTree_.findOnPath(i,(e,t)=>oE(t));if(s&&!a){const d=n.syncPointTree_.subtree(i);if(!d.isEmpty()){var c=d.fold((e,t,r)=>{if(t&&oE(t))return[aE(t)];{let n=[];return t&&(n=nE(t)),Hb(r,(e,t)=>{n=n.concat(t)}),n}});for(let e=0;e<c.length;++e){var l=c[e],u=l.query,l=TE(n,l);n.listenProvider_.startListening(NE(u),EE(n,u),l.hashFn,l.onComplete)}}}!a&&0<h.length&&!r&&(s?n.listenProvider_.stopListening(NE(e),null):h.forEach(e=>{var t=n.queryToTagMap.get(SE(e));n.listenProvider_.stopListening(NE(e),t)})),function(e,t){for(let i=0;i<t.length;++i){const s=t[i];var n,r;s._queryParams.loadsAllData()||(n=SE(s),r=e.queryToTagMap.get(n),e.queryToTagMap.delete(n),e.tagToQueryMap.delete(r))}}(n,h)}return o}function mE(e,t,n,r){var i=kE(e,r);if(null==i)return[];var s=CE(i),o=s.path,i=s.queryId,s=O0(o,t);return AE(e,o,new ZI(YI(i),s,n))}function vE(e,t){const r=e._path;let i=null,s=!1;t.syncPointTree_.foreachOnPath(r,(e,t)=>{var n=O0(e,r);i=i||rE(t,n),s=s||oE(t)});let n=t.syncPointTree_.get(r);n?(s=s||oE(n),i=i||rE(n,S0())):(n=new JT,t.syncPointTree_=t.syncPointTree_.set(r,n));let o;if(null!=i)o=!0;else{o=!1,i=pI.EMPTY_NODE;const u=t.syncPointTree_.subtree(r);u.foreachChild((e,t)=>{var n=rE(t,S0());n&&(i=i.updateImmediateChild(e,n))})}var a,c=sE(n,e);c||e._queryParams.loadsAllData()||(l=SE(e),Jh(!t.queryToTagMap.has(l),"View does not exist, but we have a tag"),a=lE++,t.queryToTagMap.set(l,a),t.tagToQueryMap.set(a,l));var l=IT(t.pendingWriteTree_,r);return{syncPoint:n,writesCache:l,serverCache:i,serverCacheComplete:o,foundAncestorDefaultView:s,viewAlreadyExists:c}}function yE(e,t,n){var{syncPoint:r,serverCache:i,writesCache:s,serverCacheComplete:o,viewAlreadyExists:a,foundAncestorDefaultView:c}=vE(t,e);let l=eE(r,t,n,s,i,o);return a||c||(r=iE(r,t),l=l.concat(function(t,e,n){const r=e._path,i=EE(t,e),s=TE(t,n),o=t.listenProvider_.startListening(NE(e),i,s.hashFn,s.onComplete),a=t.syncPointTree_.subtree(r);if(i)Jh(!oE(a.value),"If we're adding a query, it shouldn't be shadowed");else{var c=a.fold((e,t,r)=>{if(!D0(e)&&t&&oE(t))return[aE(t).query];{let n=[];return t&&(n=n.concat(nE(t).map(e=>e.query))),Hb(r,(e,t)=>{n=n.concat(t)}),n}});for(let e=0;e<c.length;++e){var l=c[e];t.listenProvider_.stopListening(NE(l),EE(t,l))}}return o}(e,t,r))),l}function _E(e,r,t){var n=e.pendingWriteTree_,i=e.syncPointTree_.findOnPath(r,(e,t)=>{var n=rE(t,O0(e,r));if(n)return n});return kT(n,r,i,t,!0)}function wE(e,t){const r=t._path;let i=null;e.syncPointTree_.foreachOnPath(r,(e,t)=>{var n=O0(e,r);i=i||rE(t,n)});let n=e.syncPointTree_.get(r);n?i=i||rE(n,S0()):(n=new JT,e.syncPointTree_=e.syncPointTree_.set(r,n));var s=null!=i;const o=s?new tT(i,!0,!1):null;var a=IT(e.pendingWriteTree_,t._path);return cT(ZT(n,t,a,s?o.getNode():pI.EMPTY_NODE,s).viewCache_)}function bE(e,t){return function t(n,r,i,s){{if(D0(n.path))return IE(n,r,i,s);{const o=r.get(S0());null==i&&null!=o&&(i=rE(o,S0()));let e=[];const a=k0(n.path),c=n.operationForChild(a),l=r.children.get(a);if(l&&c){const u=i?i.getImmediateChild(a):null,h=DT(s,a);e=e.concat(t(c,l,u,h))}return o&&(e=e.concat(XT(o,n,s,i))),e}}}(t,e.syncPointTree_,null,IT(e.pendingWriteTree_,S0()))}function IE(s,e,o,a){var t=e.get(S0());null==o&&null!=t&&(o=rE(t,S0()));let c=[];return e.children.inorderTraversal((e,t)=>{var n=o?o.getImmediateChild(e):null,r=DT(a,e),i=s.operationForChild(e);i&&(c=c.concat(IE(i,t,n,r)))}),t&&(c=c.concat(XT(t,s,a,o))),c}function TE(i,t){const s=t.query,o=EE(i,s);return{hashFn:()=>{const e=t.viewCache_.serverCache.getNode()||pI.EMPTY_NODE;return e.hash()},onComplete:e=>{if("ok"===e)return o?function(e,t,n){if(s=kE(e,n)){var r=CE(s),i=r.path,s=r.queryId,r=O0(i,t);return AE(e,i,new XI(YI(s),r))}return[]}(i,s._path,o):(t=i,n=s._path,bE(t,new XI(QI(),n)));var t,n,r=function(e,t){let n="Unknown Error";"too_big"===e?n="The data requested exceeds the maximum size that can be accessed with a single request.":"permission_denied"===e?n="Client doesn't have permission to access the desired data.":"unavailable"===e&&(n="The service is unavailable");const r=new Error(e+" at "+t._path.toString()+": "+n);return r.code=e.toUpperCase(),r}(e,s);return gE(i,s,null,r)}}}function EE(e,t){var n=SE(t);return e.queryToTagMap.get(n)}function SE(e){return e._path.toString()+"$"+e._queryIdentifier}function kE(e,t){return e.tagToQueryMap.get(t)}function CE(e){var t=e.indexOf("$");return Jh(-1!==t&&t<e.length-1,"Bad queryKey."),{queryId:e.substr(t+1),path:new E0(e.substr(0,t))}}function AE(e,t,n){var r=e.syncPointTree_.get(t);return Jh(r,"Missing sync point for query tag that we're tracking"),XT(r,n,IT(e.pendingWriteTree_,t),null)}function NE(e){return e._queryParams.loadsAllData()&&!e._queryParams.isDefault()?(Jh(cE,"Reference.ts has not been loaded"),new cE(e._repo,e._path)):e}class xE{constructor(e){this.node_=e}getImmediateChild(e){var t=this.node_.getImmediateChild(e);return new xE(t)}node(){return this.node_}}class RE{constructor(e,t){this.syncTree_=e,this.path_=t}getImmediateChild(e){var t=P0(this.path_,e);return new RE(this.syncTree_,t)}node(){return _E(this.syncTree_,this.path_)}}function PE(e){return(e=e||{}).timestamp=e.timestamp||(new Date).getTime(),e}function DE(e,t,n){return e&&"object"==typeof e?(Jh(".sv"in e,"Unexpected leaf node or priority contents"),"string"==typeof e[".sv"]?OE(e[".sv"],t,n):"object"==typeof e[".sv"]?ME(e[".sv"],t):void Jh(!1,"Unexpected server value: "+JSON.stringify(e,null,2))):e}const OE=function(e,t,n){if("timestamp"===e)return n.timestamp;Jh(!1,"Unexpected server value: "+e)},ME=function(e,t,n){e.hasOwnProperty("increment")||Jh(!1,"Unexpected server value: "+JSON.stringify(e,null,2));var r=e.increment;"number"!=typeof r&&Jh(!1,"Unexpected increment value: "+r);const i=t.node();if(Jh(null!==i&&void 0!==i,"Expected ChildrenNode.EMPTY_NODE for nulls"),!i.isLeafNode())return r;const s=i;var o=s.getValue();return"number"!=typeof o?r:o+r},LE=function(e,t,n,r){return UE(t,new RE(n,e),r)},FE=function(e,t,n){return UE(e,new xE(t),n)};function UE(e,r,i){var t=e.getPriority().val(),n=DE(t,r.getImmediateChild(".priority"),i);let s;if(e.isLeafNode()){const o=e;t=DE(o.getValue(),r,i);return t!==o.getValue()||n!==o.getPriority().val()?new rI(t,yI(n)):e}{const a=e;return s=a,n!==a.getPriority().val()&&(s=s.updatePriority(new rI(n))),a.forEachChild(oI,(e,t)=>{var n=UE(t,r.getImmediateChild(e),i);n!==t&&(s=s.updateImmediateChild(e,n))}),s}}class VE{constructor(e="",t=null,n={children:{},childCount:0}){this.name=e,this.parent=t,this.node=n}}function jE(e,t){let n=t instanceof E0?t:new E0(t),r=e,i=k0(n);for(;null!==i;){var s=Td(r.node.children,i)||{children:{},childCount:0};r=new VE(i,r,s),n=A0(n),i=k0(n)}return r}function qE(e){return e.node.value}function BE(e,t){e.node.value=t,WE(e)}function KE(e){return 0<e.node.childCount}function $E(n,r){Hb(n.node.children,(e,t)=>{r(new VE(e,n,t))})}function zE(e){return new E0(null===e.parent?e.name:zE(e.parent)+"/"+e.name)}function WE(e){var t,n,r,i;null!==e.parent&&(t=e.parent,n=e.name,r=function(e){return void 0===qE(e)&&!KE(e)}(e=e),i=Id(t.node.children,n),r&&i?(delete t.node.children[n],t.node.childCount--,WE(t)):r||i||(t.node.children[n]=e.node,t.node.childCount++,WE(t)))}function GE(e,t,n,r){r&&void 0===t||oS(Ld(e,"value"),t,n)}function HE(e,t,r,n){if(!n||void 0!==t){const i=Ld(e,"values");if(!t||"object"!=typeof t||Array.isArray(t))throw new Error(i+" must be an object containing the children to replace.");const s=[];Hb(t,(e,t)=>{const n=new E0(e);if(oS(i,t,P0(r,n)),".priority"===N0(n)&&!sS(t))throw new Error(i+"contains an invalid value for '"+n.toString()+"', which must be a valid Firebase priority (a string, finite number, server value, or null).");s.push(n)}),function(t,n){let r,i;for(r=0;r<n.length;r++){i=n[r];var s=x0(i);for(let e=0;e<s.length;e++)if((".priority"!==s[e]||e!==s.length-1)&&!nS(s[e]))throw new Error(t+"contains an invalid key ("+s[e]+") in path "+i.toString()+'. Keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]"')}n.sort(M0);let e=null;for(r=0;r<n.length;r++){if(i=n[r],null!==e&&F0(e,i))throw new Error(t+"contains a path "+e.toString()+" that is ancestor of another path "+i.toString());e=i}}(i,s)}}function QE(e,t,n){if(!n||void 0!==t){if($b(t))throw new Error(Ld(e,"priority")+"is "+t.toString()+", but must be a valid Firebase priority (a string, finite number, server value, or null).");if(!sS(t))throw new Error(Ld(e,"priority")+"must be a valid Firebase priority (a string, finite number, server value, or null).")}}function YE(e,t,n,r){if(!(r&&void 0===n||nS(n)))throw new Error(Ld(e,t)+'was an invalid key = "'+n+'".  Firebase keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]").')}function JE(e,t,n,r){n=n&&n.replace(/^\/*\.info(\/|$)/,"/"),aS(e,t,n,r)}function XE(e,t){if(".info"===k0(t))throw new Error(e+" failed = Can't modify data under /.info/")}const ZE=/[\[\].#$\/\u0000-\u001F\u007F]/,eS=/[\[\].#$\u0000-\u001F\u007F]/,tS=10485760,nS=function(e){return"string"==typeof e&&0!==e.length&&!ZE.test(e)},rS=function(e){return"string"==typeof e&&0!==e.length&&!eS.test(e)},iS=function(e){return e=e&&e.replace(/^\/*\.info(\/|$)/,"/"),rS(e)},sS=function(e){return null===e||"string"==typeof e||"number"==typeof e&&!$b(e)||e&&"object"==typeof e&&Id(e,".sv")},oS=function(o,e,t){const a=t instanceof E0?new U0(t,o):t;if(void 0===e)throw new Error(o+"contains undefined "+j0(a));if("function"==typeof e)throw new Error(o+"contains a function "+j0(a)+" with contents = "+e.toString());if($b(e))throw new Error(o+"contains "+e.toString()+" "+j0(a));if("string"==typeof e&&e.length>tS/3&&jd(e)>tS)throw new Error(o+"contains a string greater than "+tS+" utf8 bytes "+j0(a)+" ('"+e.substring(0,50)+"...')");if(e&&"object"==typeof e){let i=!1,s=!1;if(Hb(e,(e,t)=>{if(".value"===e)i=!0;else if(".priority"!==e&&".sv"!==e&&(s=!0,!nS(e)))throw new Error(o+" contains an invalid key ("+e+") "+j0(a)+'.  Keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]"');var n,r;n=a,e=e,0<n.parts_.length&&(n.byteLength_+=1),n.parts_.push(e),n.byteLength_+=jd(e),V0(n),oS(o,t,a),t=a,r=t.parts_.pop(),t.byteLength_-=jd(r),0<t.parts_.length&&--t.byteLength_}),i&&s)throw new Error(o+' contains ".value" child '+j0(a)+" in addition to actual children.")}},aS=function(e,t,n,r){if(!(r&&void 0===n||rS(n)))throw new Error(Ld(e,t)+'was an invalid path = "'+n+'". Paths must be non-empty strings and can\'t contain ".", "#", "$", "[", or "]"')},cS=function(e,t){var n=t.path.toString();if("string"!=typeof t.repoInfo.host||0===t.repoInfo.host.length||!nS(t.repoInfo.namespace)&&"localhost"!==t.repoInfo.host.split(":")[0]||0!==n.length&&!iS(n))throw new Error(Ld(e,"url")+'must be a valid firebase URL and the path can\'t contain ".", "#", "$", "[", or "]".')};class lS{constructor(){this.eventLists_=[],this.recursionDepth_=0}}function uS(e,t){let n=null;for(let i=0;i<t.length;i++){const s=t[i];var r=s.getPath();null===n||L0(r,n.path)||(e.eventLists_.push(n),n=null),null===n&&(n={events:[],path:r}),n.events.push(s)}n&&e.eventLists_.push(n)}function hS(e,t,n){uS(e,n),fS(e,e=>L0(e,t))}function dS(e,t,n){uS(e,n),fS(e,e=>F0(e,t)||F0(t,e))}function fS(e,t){e.recursionDepth_++;let n=!0;for(let i=0;i<e.eventLists_.length;i++){var r=e.eventLists_[i];r&&(t(r.path)?(function(e){for(let n=0;n<e.events.length;n++){const r=e.events[n];var t;null!==r&&(e.events[n]=null,t=r.getEventRunner(),Rb&&jb("event: "+r.toString()),t0(t))}}(e.eventLists_[i]),e.eventLists_[i]=null):n=!1)}n&&(e.eventLists_=[]),e.recursionDepth_--}const pS="repo_interrupt",gS=25;class mS{constructor(e,t,n,r){this.repoInfo_=e,this.forceRestClient_=t,this.authTokenProvider_=n,this.appCheckProvider_=r,this.dataUpdateCount=0,this.statsListener_=null,this.eventQueue_=new lS,this.nextWriteId_=1,this.interceptServerDataCallback_=null,this.onDisconnect_=KI(),this.transactionQueueTree_=new VE,this.persistentConnection_=null,this.key=this.repoInfo_.toURLString()}toString(){return(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host}}function vS(o,e,t){if(o.stats_=f0(o.repoInfo_),o.forceRestClient_||function(){const e="object"==typeof window&&window.navigator&&window.navigator.userAgent||"";return 0<=e.search(/googlebot|google webmaster tools|bingbot|yahoo! slurp|baiduspider|yandexbot|duckduckbot/i)}())o.server_=new qI(o.repoInfo_,(e,t,n,r)=>{wS(o,e,t,n,r)},o.authTokenProvider_,o.appCheckProvider_),setTimeout(()=>bS(o,!0),0);else{if(null!=t){if("object"!=typeof t)throw new Error("Only objects are supported for option databaseAuthVariableOverride");try{wd(t)}catch(e){throw new Error("Invalid authOverride provided: "+e)}}o.persistentConnection_=new B0(o.repoInfo_,e,(e,t,n,r)=>{wS(o,e,t,n,r)},e=>{bS(o,e)},e=>{var n;n=o,Hb(e,(e,t)=>{IS(n,e,t)})},o.authTokenProvider_,o.appCheckProvider_,t),o.server_=o.persistentConnection_}var n;o.authTokenProvider_.addTokenChangeListener(e=>{o.server_.refreshAuthToken(e)}),o.appCheckProvider_.addTokenChangeListener(e=>{o.server_.refreshAppCheckToken(e.token)}),o.statsReporter_=(e=o.repoInfo_,t=()=>new GI(o.stats_,o.server_),n=e.toString(),d0[n]||(d0[n]=t()),d0[n]),o.infoData_=new BI,o.infoSyncTree_=new uE({startListening:(e,t,n,r)=>{let i=[];const s=o.infoData_.getNode(e._path);return s.isEmpty()||(i=pE(o.infoSyncTree_,e._path,s),setTimeout(()=>{r("ok")},0)),i},stopListening:()=>{}}),IS(o,"connected",!1),o.serverSyncTree_=new uE({startListening:(r,e,t,i)=>(o.server_.listen(r,t,e,(e,t)=>{var n=i(e,t);dS(o.eventQueue_,r._path,n)}),[]),stopListening:(e,t)=>{o.server_.unlisten(e,t)}})}function yS(e){const t=e.infoData_.getNode(new E0(".info/serverTimeOffset"));var n=t.val()||0;return(new Date).getTime()+n}function _S(e){return PE({timestamp:yS(e)})}function wS(e,t,n,r,i){e.dataUpdateCount++;var s,o,a=new E0(t);n=e.interceptServerDataCallback_?e.interceptServerDataCallback_(t,n):n;let c=[];c=i?r?(s=Sd(n,e=>yI(e)),function(e,t,n,r){if(a=kE(e,r)){var i=CE(a),s=i.path,o=i.queryId,a=O0(s,t),i=hT.fromObject(n);return AE(e,s,new eT(YI(o),a,i))}return[]}(e.serverSyncTree_,a,s,i)):(s=yI(n),mE(e.serverSyncTree_,a,s,i)):r?(o=Sd(n,e=>yI(e)),t=e.serverSyncTree_,i=a,r=o,o=hT.fromObject(r),bE(t,new eT(QI(),i,o))):(o=yI(n),pE(e.serverSyncTree_,a,o));let l=a;0<c.length&&(l=OS(e,a)),dS(e.eventQueue_,l,c)}function bS(e,t){IS(e,"connected",t),!1===t&&function(r){xS(r,"onDisconnectEvents");const i=_S(r),s=KI();zI(r.onDisconnect_,S0(),(e,t)=>{var n=LE(e,t,r.serverSyncTree_,i);$I(s,e,n)});let o=[];zI(s,S0(),(e,t)=>{o=o.concat(pE(r.serverSyncTree_,e,t));var n=US(r,e);OS(r,n)}),r.onDisconnect_=KI(),dS(r.eventQueue_,S0(),o)}(e)}function IS(e,t,n){var r=new E0("/.info/"+t),i=yI(n);e.infoData_.updateSnapshot(r,i);i=pE(e.infoSyncTree_,r,i);dS(e.eventQueue_,r,i)}function TS(e){return e.nextWriteId_++}function ES(r,i){var e=wE(r.serverSyncTree_,i);return null!=e?Promise.resolve(e):r.server_.get(i).then(e=>{var t,n=yI(e).withIndex(i._queryParams.getIndex());return i._queryParams.loadsAllData()?pE(r.serverSyncTree_,i._path,n):(t=function(e,t){const{syncPoint:n,serverCache:r,writesCache:i,serverCacheComplete:s}=vE(t,e);var o=ZT(n,t,i,r,s);return n.views.has(t._queryIdentifier)||n.views.set(t._queryIdentifier,o),t._queryParams.loadsAllData()?null:EE(e,t)}(r.serverSyncTree_,i),mE(r.serverSyncTree_,i._path,n,t)),0<gE(r.serverSyncTree_,i,null).length&&xS(r,"unexpected cancel events in repoGetValue"),n},e=>(xS(r,"get for query "+wd(i)+" failed: "+e),Promise.reject(new Error(e))))}function SS(r,i,e,t,s){xS(r,"set",{path:i.toString(),value:e,priority:t});var n=_S(r);const o=yI(e,t);var a=_E(r.serverSyncTree_,i),n=FE(o,a,n);const c=TS(r);n=hE(r.serverSyncTree_,i,n,c,!0);uS(r.eventQueue_,n),r.server_.put(i.toString(),o.val(!0),(e,t)=>{var n="ok"===e;n||Bb("set at "+i+" failed: "+e);n=fE(r.serverSyncTree_,c,!n);dS(r.eventQueue_,i,n),RS(0,s,e,t)});n=US(r,i);OS(r,n),dS(r.eventQueue_,n,[])}function kS(n,r,i){n.server_.onDisconnectCancel(r.toString(),(e,t)=>{"ok"===e&&!function e(n,t){if(D0(t))return n.value=null,n.children.clear(),!0;if(null!==n.value){if(n.value.isLeafNode())return!1;{const i=n.value;return n.value=null,i.forEachChild(oI,(e,t)=>{$I(n,new E0(e),t)}),e(n,t)}}if(0<n.children.size){var r=k0(t);return t=A0(t),n.children.has(r)&&e(n.children.get(r),t)&&n.children.delete(r),0===n.children.size}return!0}(n.onDisconnect_,r),RS(0,i,e,t)})}function CS(n,r,e,i){const s=yI(e);n.server_.onDisconnectPut(r.toString(),s.val(!0),(e,t)=>{"ok"===e&&$I(n.onDisconnect_,r,s),RS(0,i,e,t)})}function AS(e,t,n){let r;r=".info"===k0(t._path)?gE(e.infoSyncTree_,t,n):gE(e.serverSyncTree_,t,n),hS(e.eventQueue_,t._path,r)}function NS(e){e.persistentConnection_&&e.persistentConnection_.interrupt(pS)}function xS(e,...t){let n="";e.persistentConnection_&&(n=e.persistentConnection_.id+":"),jb(n,...t)}function RS(e,r,i,s){r&&t0(()=>{if("ok"===i)r(null);else{var t=(i||"error").toUpperCase();let e=t;s&&(e+=": "+s);const n=new Error(e);n.code=t,r(n)}})}function PS(e,t,n){return _E(e.serverSyncTree_,t,n)||pI.EMPTY_NODE}function DS(t,e=t.transactionQueueTree_){if(e||FS(t,e),qE(e)){const n=LS(t,e);Jh(0<n.length,"Sending zero length transaction queue"),n.every(e=>0===e.status)&&function(i,s,o){const e=o.map(e=>e.currentWriteId),t=PS(i,s,e);let n=t;var r=t.hash();for(let u=0;u<o.length;u++){const h=o[u];Jh(0===h.status,"tryToSendTransactionQueue_: items in queue should all be run."),h.status=1,h.retryCount++;var a=O0(s,h.path);n=n.updateChild(a,h.currentOutputSnapshotRaw)}const c=n.val(!0),l=s;i.server_.put(l.toString(),c,t=>{xS(i,"transaction put response",{path:l.toString(),status:t});let n=[];if("ok"===t){const r=[];for(let e=0;e<o.length;e++)o[e].status=2,n=n.concat(fE(i.serverSyncTree_,o[e].currentWriteId)),o[e].onComplete&&r.push(()=>o[e].onComplete(null,!0,o[e].currentOutputSnapshotResolved)),o[e].unwatcher();FS(i,jE(i.transactionQueueTree_,s)),DS(i,i.transactionQueueTree_),dS(i.eventQueue_,s,n);for(let t=0;t<r.length;t++)t0(r[t])}else{if("datastale"===t)for(let e=0;e<o.length;e++)3===o[e].status?o[e].status=4:o[e].status=0;else{Bb("transaction at "+l.toString()+" failed: "+t);for(let e=0;e<o.length;e++)o[e].status=4,o[e].abortReason=t}OS(i,s)}},r)}(t,zE(e),n)}else KE(e)&&$E(e,e=>{DS(t,e)})}function OS(e,t){var n=MS(e,t),r=zE(n);return function(i,s,o){if(0!==s.length){const l=[];let n=[];const t=s.filter(e=>0===e.status),u=t.map(e=>e.currentWriteId);for(let r=0;r<s.length;r++){const h=s[r];var a=O0(o,h.path);let e=!1,t;if(Jh(null!==a,"rerunTransactionsUnderNode_: relativePath should not be null."),4===h.status)e=!0,t=h.abortReason,n=n.concat(fE(i.serverSyncTree_,h.currentWriteId,!0));else if(0===h.status)if(h.retryCount>=gS)e=!0,t="maxretry",n=n.concat(fE(i.serverSyncTree_,h.currentWriteId,!0));else{const d=PS(i,h.path,u);h.currentInputSnapshot=d;var c=s[r].update(d.val());if(void 0!==c){oS("transaction failed: Data returned ",c,h.path);let e=yI(c);"object"==typeof c&&null!=c&&Id(c,".priority")||(e=e.updatePriority(d.getPriority()));a=h.currentWriteId,c=_S(i),c=FE(e,d,c);h.currentOutputSnapshotRaw=e,h.currentOutputSnapshotResolved=c,h.currentWriteId=TS(i),u.splice(u.indexOf(a),1),n=n.concat(hE(i.serverSyncTree_,h.path,c,h.currentWriteId,h.applyLocally)),n=n.concat(fE(i.serverSyncTree_,a,!0))}else e=!0,t="nodata",n=n.concat(fE(i.serverSyncTree_,h.currentWriteId,!0))}dS(i.eventQueue_,o,n),n=[],e&&(s[r].status=2,function(e){setTimeout(e,Math.floor(0))}(s[r].unwatcher),s[r].onComplete&&("nodata"===t?l.push(()=>s[r].onComplete(null,!1,s[r].currentInputSnapshot)):l.push(()=>s[r].onComplete(new Error(t),!1,null))))}FS(i,i.transactionQueueTree_);for(let e=0;e<l.length;e++)t0(l[e]);DS(i,i.transactionQueueTree_)}}(e,LS(e,n),r),r}function MS(e,t){let n,r=e.transactionQueueTree_;for(n=k0(t);null!==n&&void 0===qE(r);)r=jE(r,n),t=A0(t),n=k0(t);return r}function LS(e,t){const n=[];return function t(n,e,r){const i=qE(e);if(i)for(let e=0;e<i.length;e++)r.push(i[e]);$E(e,e=>{t(n,e,r)})}(e,t,n),n.sort((e,t)=>e.order-t.order),n}function FS(t,n){const r=qE(n);if(r){let e=0;for(let t=0;t<r.length;t++)2!==r[t].status&&(r[e]=r[t],e++);r.length=e,BE(n,0<r.length?r:void 0)}$E(n,e=>{FS(t,e)})}function US(t,e){var n=zE(MS(t,e)),r=jE(t.transactionQueueTree_,e);return function(e,t,n){let r=n?e:e.parent;for(;null!==r;){if(t(r))return;r=r.parent}}(r,e=>{VS(t,e)}),VS(t,r),function t(e,n,r,i){r&&!i&&n(e),$E(e,e=>{t(e,n,!0,i)}),r&&i&&n(e)}(r,e=>{VS(t,e)}),n}function VS(i,s){const o=qE(s);if(o){const a=[];let e=[],t=-1;for(let n=0;n<o.length;n++)3===o[n].status||(1===o[n].status?(Jh(t===n-1,"All SENT items should be at beginning of queue."),t=n,o[n].status=3,o[n].abortReason="set"):(Jh(0===o[n].status,"Unexpected transaction status in abort"),o[n].unwatcher(),e=e.concat(fE(i.serverSyncTree_,o[n].currentWriteId,!0)),o[n].onComplete&&a.push(o[n].onComplete.bind(null,new Error("set"),!1,null))));-1===t?BE(s,void 0):o.length=t+1,dS(i.eventQueue_,zE(s),e);for(let r=0;r<a.length;r++)t0(a[r])}}const jS=function(e,t){var n=qS(e),r=n.namespace;"firebase.com"===n.domain&&qb(n.host+" is no longer supported. Please use <YOUR FIREBASE>.firebaseio.com instead"),r&&"undefined"!==r||"localhost"===n.domain||qb("Cannot parse Firebase url. Please use https://<YOUR FIREBASE>.firebaseio.com"),n.secure||Kb();var i="ws"===n.scheme||"wss"===n.scheme;return{repoInfo:new c0(n.host,n.secure,r,i,t,"",r!==n.subdomain),path:new E0(n.pathString)}},qS=function(r){let i="",s="",o="",a="",c="",l=!0,u="https",h=443;if("string"==typeof r){let e=r.indexOf("//");0<=e&&(u=r.substring(0,e-1),r=r.substring(e+2));let t=r.indexOf("/");-1===t&&(t=r.length);let n=r.indexOf("?");-1===n&&(n=r.length),i=r.substring(0,Math.min(t,n)),t<n&&(a=function(e){let t="";var n=e.split("/");for(let r=0;r<n.length;r++)if(0<n[r].length){let e=n[r];try{e=decodeURIComponent(e.replace(/\+/g," "))}catch(e){}t+="/"+e}return t}(r.substring(t,n)));var d,f=function(e){const t={};for(const r of(e="?"===e.charAt(0)?e.substring(1):e).split("&")){var n;0!==r.length&&(2===(n=r.split("=")).length?t[decodeURIComponent(n[0])]=decodeURIComponent(n[1]):Bb(`Invalid query segment '${r}' in query '${e}'`))}return t}(r.substring(Math.min(r.length,n)));e=i.indexOf(":"),0<=e?(l="https"===u||"wss"===u,h=parseInt(i.substring(e+1),10)):e=i.length;const p=i.slice(0,e);"localhost"===p.toLowerCase()?s="localhost":p.split(".").length<=2?s=p:(d=i.indexOf("."),o=i.substring(0,d).toLowerCase(),s=i.substring(d+1),c=o),"ns"in f&&(c=f.ns)}return{host:i,port:h,domain:s,subdomain:o,secure:l,scheme:u,pathString:a,namespace:c}};class BS{constructor(e,t,n,r){this.eventType=e,this.eventRegistration=t,this.snapshot=n,this.prevName=r}getPath(){var e=this.snapshot.ref;return("value"===this.eventType?e:e.parent)._path}getEventType(){return this.eventType}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.getPath().toString()+":"+this.eventType+":"+wd(this.snapshot.exportVal())}}class KS{constructor(e,t,n){this.eventRegistration=e,this.error=t,this.path=n}getPath(){return this.path}getEventType(){return"cancel"}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.path.toString()+":cancel"}}class $S{constructor(e,t){this.snapshotCallback=e,this.cancelCallback=t}onValue(e,t){this.snapshotCallback.call(null,e,t)}onCancel(e){return Jh(this.hasCancelCallback,"Raising a cancel event on a listener with no cancel callback"),this.cancelCallback.call(null,e)}get hasCancelCallback(){return!!this.cancelCallback}matches(e){return this.snapshotCallback===e.snapshotCallback||void 0!==this.snapshotCallback.userCallback&&this.snapshotCallback.userCallback===e.snapshotCallback.userCallback&&this.snapshotCallback.context===e.snapshotCallback.context}}class zS{constructor(e,t){this._repo=e,this._path=t}cancel(){const e=new id;return kS(this._repo,this._path,e.wrapCallback(()=>{})),e.promise}remove(){XE("OnDisconnect.remove",this._path);const e=new id;return CS(this._repo,this._path,null,e.wrapCallback(()=>{})),e.promise}set(e){XE("OnDisconnect.set",this._path),GE("OnDisconnect.set",e,this._path,!1);const t=new id;return CS(this._repo,this._path,e,t.wrapCallback(()=>{})),t.promise}setWithPriority(e,t){XE("OnDisconnect.setWithPriority",this._path),GE("OnDisconnect.setWithPriority",e,this._path,!1),QE("OnDisconnect.setWithPriority",t,!1);const n=new id;return function(n,r,e,t,i){const s=yI(e,t);n.server_.onDisconnectPut(r.toString(),s.val(!0),(e,t)=>{"ok"===e&&$I(n.onDisconnect_,r,s),RS(0,i,e,t)})}(this._repo,this._path,e,t,n.wrapCallback(()=>{})),n.promise}update(e){XE("OnDisconnect.update",this._path),HE("OnDisconnect.update",e,this._path,!1);const t=new id;return function(r,i,n,s){if(Ed(n))return jb("onDisconnect().update() called with empty data.  Don't do anything."),RS(0,s,"ok",void 0);r.server_.onDisconnectMerge(i.toString(),n,(e,t)=>{"ok"===e&&Hb(n,(e,t)=>{var n=yI(t);$I(r.onDisconnect_,P0(i,e),n)}),RS(0,s,e,t)})}(this._repo,this._path,e,t.wrapCallback(()=>{})),t.promise}}class WS{constructor(e,t,n,r){this._repo=e,this._path=t,this._queryParams=n,this._orderByCalled=r}get key(){return D0(this._path)?null:N0(this._path)}get ref(){return new YS(this._repo,this._path)}get _queryIdentifier(){var e=jI(this._queryParams),e=Fb(e);return"{}"===e?"default":e}get _queryObject(){return jI(this._queryParams)}isEqual(e){if(!((e=Wd(e))instanceof WS))return!1;var t=this._repo===e._repo,n=L0(this._path,e._path),r=this._queryIdentifier===e._queryIdentifier;return t&&n&&r}toJSON(){return this.toString()}toString(){return this._repo.toString()+function(e){let t="";for(let n=e.pieceNum_;n<e.pieces_.length;n++)""!==e.pieces_[n]&&(t+="/"+encodeURIComponent(String(e.pieces_[n])));return t||"/"}(this._path)}}function GS(e,t){if(!0===e._orderByCalled)throw new Error(t+": You can't combine multiple orderBy calls.")}function HS(e){let t=null,n=null;if(e.hasStart()&&(t=e.getIndexStartValue()),e.hasEnd()&&(n=e.getIndexEndValue()),e.getIndex()===G0){var r="Query: When ordering by key, you may only pass one argument to startAt(), endAt(), or equalTo().",i="Query: When ordering by key, the argument passed to startAt(), startAfter(), endAt(), endBefore(), or equalTo() must be a string.";if(e.hasStart()){if(e.getIndexStartName()!==zb)throw new Error(r);if("string"!=typeof t)throw new Error(i)}if(e.hasEnd()){if(e.getIndexEndName()!==Wb)throw new Error(r);if("string"!=typeof n)throw new Error(i)}}else if(e.getIndex()===oI){if(null!=t&&!sS(t)||null!=n&&!sS(n))throw new Error("Query: When ordering by priority, the first argument passed to startAt(), startAfter() endAt(), endBefore(), or equalTo() must be a valid priority value (null, a number, or a string).")}else if(Jh(e.getIndex()instanceof _I||e.getIndex()===II,"unknown index type."),null!=t&&"object"==typeof t||null!=n&&"object"==typeof n)throw new Error("Query: First argument passed to startAt(), startAfter(), endAt(), endBefore(), or equalTo() cannot be an object.")}function QS(e){if(e.hasStart()&&e.hasEnd()&&e.hasLimit()&&!e.hasAnchoredLimit())throw new Error("Query: Can't combine startAt(), startAfter(), endAt(), endBefore(), and limit(). Use limitToFirst() or limitToLast() instead.")}class YS extends WS{constructor(e,t){super(e,t,new MI,!1)}get parent(){var e=R0(this._path);return null===e?null:new YS(this._repo,e)}get root(){let e=this;for(;null!==e.parent;)e=e.parent;return e}}class JS{constructor(e,t,n){this._node=e,this.ref=t,this._index=n}get priority(){return this._node.getPriority().val()}get key(){return this.ref.key}get size(){return this._node.numChildren()}child(e){var t=new E0(e),n=ek(this.ref,e);return new JS(this._node.getChild(t),n,oI)}exists(){return!this._node.isEmpty()}exportVal(){return this._node.val(!0)}forEach(n){if(this._node.isLeafNode())return!1;const e=this._node;return!!e.forEachChild(this._index,(e,t)=>n(new JS(t,ek(this.ref,e),oI)))}hasChild(e){var t=new E0(e);return!this._node.getChild(t).isEmpty()}hasChildren(){return!this._node.isLeafNode()&&!this._node.isEmpty()}toJSON(){return this.exportVal()}val(){return this._node.val()}}function XS(e,t){return(e=Wd(e))._checkNotDeleted("ref"),void 0!==t?ek(e._root,t):e._root}function ZS(e,t){(e=Wd(e))._checkNotDeleted("refFromURL");const n=jS(t,e._repo.repoInfo_.nodeAdmin);cS("refFromURL",n);var r=n.repoInfo;return e._repo.repoInfo_.isCustomHost()||r.host===e._repo.repoInfo_.host||qb("refFromURL: Host name does not match the current database: (found "+r.host+" but expected "+e._repo.repoInfo_.host+")"),XS(e,n.path.toString())}function ek(e,t){return(null===k0((e=Wd(e))._path)?JE:aS)("child","path",t,!1),new YS(e._repo,P0(e._path,t))}function tk(e,t){e=Wd(e),XE("set",e._path),GE("set",t,e._path,!1);const n=new id;return SS(e._repo,e._path,t,null,n.wrapCallback(()=>{})),n.promise}function nk(e,t){HE("update",t,e._path,!1);const n=new id;return function(i,s,e,o){xS(i,"update",{path:s.toString(),value:e});let n=!0;const r=_S(i),a={};if(Hb(e,(e,t)=>{n=!1,a[e]=LE(P0(s,e),yI(t),i.serverSyncTree_,r)}),n)jb("update() called with empty data.  Don't do anything."),RS(0,o,"ok",void 0);else{const c=TS(i);var t=dE(i.serverSyncTree_,s,a,c);uS(i.eventQueue_,t),i.server_.merge(s.toString(),e,(e,t)=>{var n="ok"===e;n||Bb("update at "+s+" failed: "+e);var r=fE(i.serverSyncTree_,c,!n),n=0<r.length?OS(i,s):s;dS(i.eventQueue_,n,r),RS(0,o,e,t)}),Hb(e,e=>{var t=US(i,P0(s,e));OS(i,t)}),dS(i.eventQueue_,s,[])}}(e._repo,e._path,t,n.wrapCallback(()=>{})),n.promise}class rk{constructor(e){this.callbackContext=e}respondsTo(e){return"value"===e}createEvent(e,t){var n=t._queryParams.getIndex();return new BS("value",this,new JS(e.snapshotNode,new YS(t._repo,t._path),n))}getEventRunner(e){return"cancel"===e.getEventType()?()=>this.callbackContext.onCancel(e.error):()=>this.callbackContext.onValue(e.snapshot,null)}createCancelEvent(e,t){return this.callbackContext.hasCancelCallback?new KS(this,e,t):null}matches(e){return e instanceof rk&&(!e.callbackContext||!this.callbackContext||e.callbackContext.matches(this.callbackContext))}hasAnyCallback(){return null!==this.callbackContext}}class ik{constructor(e,t){this.eventType=e,this.callbackContext=t}respondsTo(e){let t="children_added"===e?"child_added":e;return t="children_removed"===t?"child_removed":t,this.eventType===t}createCancelEvent(e,t){return this.callbackContext.hasCancelCallback?new KS(this,e,t):null}createEvent(e,t){Jh(null!=e.childName,"Child events should have a childName.");var n=ek(new YS(t._repo,t._path),e.childName),r=t._queryParams.getIndex();return new BS(e.type,this,new JS(e.snapshotNode,n,r),e.prevName)}getEventRunner(e){return"cancel"===e.getEventType()?()=>this.callbackContext.onCancel(e.error):()=>this.callbackContext.onValue(e.snapshot,e.prevName)}matches(e){return e instanceof ik&&(this.eventType===e.eventType&&(!this.callbackContext||!e.callbackContext||this.callbackContext.matches(e.callbackContext)))}hasAnyCallback(){return!!this.callbackContext}}function sk(n,e,t,r,i){let s;if("object"==typeof r&&(s=void 0,i=r),"function"==typeof r&&(s=r),i&&i.onlyOnce){const c=t;var o=(e,t)=>{AS(n._repo,n,a),c(e,t)};o.userCallback=t.userCallback,o.context=t.context,t=o}o=new $S(t,s||void 0);const a="value"===e?new rk(o):new ik(e,o);return function(e,t,n){let r;r=".info"===k0(t._path)?yE(e.infoSyncTree_,t,n):yE(e.serverSyncTree_,t,n),hS(e.eventQueue_,t._path,r)}(n._repo,n,a),()=>AS(n._repo,n,a)}function ok(e,t,n,r){return sk(e,"value",t,n,r)}function ak(e,t,n,r){return sk(e,"child_added",t,n,r)}function ck(e,t,n,r){return sk(e,"child_changed",t,n,r)}function lk(e,t,n,r){return sk(e,"child_moved",t,n,r)}function uk(e,t,n,r){return sk(e,"child_removed",t,n,r)}function hk(e,t,n){let r=null;var i=n?new $S(n):null;"value"===t?r=new rk(i):t&&(r=new ik(t,i)),AS(e._repo,e,r)}class dk{}class fk extends dk{constructor(e,t){super(),this._value=e,this._key=t}_apply(e){GE("endAt",this._value,e._path,!0);var t=FI(e._queryParams,this._value,this._key);if(QS(t),HS(t),e._queryParams.hasEnd())throw new Error("endAt: Starting point was already set (by another call to endAt, endBefore or equalTo).");return new WS(e._repo,e._path,t,e._orderByCalled)}}class pk extends dk{constructor(e,t){super(),this._value=e,this._key=t}_apply(e){GE("endBefore",this._value,e._path,!1);var t=function(e,t,n){let r,i;return i=e.index_===G0?FI(e,t="string"==typeof t?bI(t):t,n):(r=null==n?zb:bI(n),FI(e,t,r)),i.endBeforeSet_=!0,i}(e._queryParams,this._value,this._key);if(QS(t),HS(t),e._queryParams.hasEnd())throw new Error("endBefore: Starting point was already set (by another call to endAt, endBefore or equalTo).");return new WS(e._repo,e._path,t,e._orderByCalled)}}class gk extends dk{constructor(e,t){super(),this._value=e,this._key=t}_apply(e){GE("startAt",this._value,e._path,!0);var t=LI(e._queryParams,this._value,this._key);if(QS(t),HS(t),e._queryParams.hasStart())throw new Error("startAt: Starting point was already set (by another call to startAt, startBefore or equalTo).");return new WS(e._repo,e._path,t,e._orderByCalled)}}class mk extends dk{constructor(e,t){super(),this._value=e,this._key=t}_apply(e){GE("startAfter",this._value,e._path,!1);var t=function(t,n,r){let i;if(t.index_===G0)"string"==typeof n&&(n=wI(n)),i=LI(t,n,r);else{let e;e=null==r?Wb:wI(r),i=LI(t,n,e)}return i.startAfterSet_=!0,i}(e._queryParams,this._value,this._key);if(QS(t),HS(t),e._queryParams.hasStart())throw new Error("startAfter: Starting point was already set (by another call to startAt, startAfter, or equalTo).");return new WS(e._repo,e._path,t,e._orderByCalled)}}class vk extends dk{constructor(e){super(),this._limit=e}_apply(e){if(e._queryParams.hasLimit())throw new Error("limitToFirst: Limit was already set (by another call to limitToFirst or limitToLast).");return new WS(e._repo,e._path,function(e,t){const n=e.copy();return n.limitSet_=!0,n.limit_=t,n.viewFrom_="l",n}(e._queryParams,this._limit),e._orderByCalled)}}class yk extends dk{constructor(e){super(),this._limit=e}_apply(e){if(e._queryParams.hasLimit())throw new Error("limitToLast: Limit was already set (by another call to limitToFirst or limitToLast).");return new WS(e._repo,e._path,function(e,t){const n=e.copy();return n.limitSet_=!0,n.limit_=t,n.viewFrom_="r",n}(e._queryParams,this._limit),e._orderByCalled)}}class _k extends dk{constructor(e){super(),this._path=e}_apply(e){GS(e,"orderByChild");var t=new E0(this._path);if(D0(t))throw new Error("orderByChild: cannot pass in empty path. Use orderByValue() instead.");t=new _I(t),t=UI(e._queryParams,t);return HS(t),new WS(e._repo,e._path,t,!0)}}class wk extends dk{_apply(e){GS(e,"orderByKey");var t=UI(e._queryParams,G0);return HS(t),new WS(e._repo,e._path,t,!0)}}class bk extends dk{_apply(e){GS(e,"orderByPriority");var t=UI(e._queryParams,oI);return HS(t),new WS(e._repo,e._path,t,!0)}}class Ik extends dk{_apply(e){GS(e,"orderByValue");var t=UI(e._queryParams,II);return HS(t),new WS(e._repo,e._path,t,!0)}}class Tk extends dk{constructor(e,t){super(),this._value=e,this._key=t}_apply(e){if(GE("equalTo",this._value,e._path,!1),e._queryParams.hasStart())throw new Error("equalTo: Starting point was already set (by another call to startAt/startAfter or equalTo).");if(e._queryParams.hasEnd())throw new Error("equalTo: Ending point was already set (by another call to endAt/endBefore or equalTo).");return new fk(this._value,this._key)._apply(new gk(this._value,this._key)._apply(e))}}function Ek(e,...t){let n=Wd(e);for(const r of t)n=r._apply(n);return n}Ib=YS,Jh(!YT,"__referenceConstructor has already been defined"),YT=Ib,Tb=YS,Jh(!cE,"__referenceConstructor has already been defined"),cE=Tb;const Sk="FIREBASE_DATABASE_EMULATOR_HOST",kk={};let Ck=!1;function Ak(e,t,n,r,i){let s=r||e.options.databaseURL;void 0===s&&(e.options.projectId||qb("Can't determine Firebase Database URL. Be sure to include  a Project ID when calling firebase.initializeApp()."),jb("Using default host for project ",e.options.projectId),s=`${e.options.projectId}-default-rtdb.firebaseio.com`);let o=jS(s,i),a=o.repoInfo,c,l=void 0;"undefined"!=typeof process&&process.env&&(l=process.env[Sk]),l?(c=!0,s=`http://${l}?ns=${a.namespace}`,o=jS(s,i),a=o.repoInfo):c=!o.repoInfo.secure;var u=i&&c?new i0(i0.OWNER):new r0(e.name,e.options,t);cS("Invalid Firebase Database URL",o),D0(o.path)||qb("Database URL must point to the root of a Firebase Database (not including a child path).");u=function(e,t,n,r){let i=kk[t.name];i||(i={},kk[t.name]=i);var s=i[e.toURLString()];s&&qb("Database initialized multiple times. Please make sure the format of the database URL matches with each database() call.");return s=new mS(e,Ck,n,r),i[e.toURLString()]=s}(a,e,u,new n0(e.name,n));return new Nk(u,e)}class Nk{constructor(e,t){this._repoInternal=e,this.app=t,this.type="database",this._instanceStarted=!1}get _repo(){return this._instanceStarted||(vS(this._repoInternal,this.app.options.appId,this.app.options.databaseAuthVariableOverride),this._instanceStarted=!0),this._repoInternal}get _root(){return this._rootInternal||(this._rootInternal=new YS(this._repo,S0())),this._rootInternal}_delete(){return null!==this._rootInternal&&(function(e,t){const n=kk[t];n&&n[e.key]===e||qb(`Database ${t}(${e.repoInfo_}) has already been deleted.`),NS(e),delete n[e.key]}(this._repo,this.app.name),this._repoInternal=null,this._rootInternal=null),Promise.resolve()}_checkNotDeleted(e){null===this._rootInternal&&qb("Cannot call "+e+" on a deleted database.")}}function xk(){_0.IS_TRANSPORT_INITIALIZED&&Bb("Transport has already been initialized. Please call this function before calling ref or setting up a listener")}function Rk(){xk(),g0.forceDisallow()}function Pk(){xk(),y0.forceDisallow(),g0.forceAllow()}function Dk(e,t,n,r={}){(e=Wd(e))._checkNotDeleted("useEmulator"),e._instanceStarted&&qb("Cannot call useEmulator() after instance has already been initialized.");var i,s=e._repoInternal;let o=void 0;s.repoInfo_.nodeAdmin?(r.mockUserToken&&qb('mockUserToken is not supported by the Admin SDK. For client access with mock users, please use the "firebase" package instead of "firebase-admin".'),o=new i0(i0.OWNER)):r.mockUserToken&&(i="string"==typeof r.mockUserToken?r.mockUserToken:sd(r.mockUserToken,e.app.options.projectId),o=new i0(i)),r=s,e=t,t=n,n=o,r.repoInfo_=new c0(`${e}:${t}`,!1,r.repoInfo_.namespace,r.repoInfo_.webSocketOnly,r.repoInfo_.nodeAdmin,r.repoInfo_.persistenceKey,r.repoInfo_.includeNamespaceInQueryParams),n&&(r.authTokenProvider_=n)}function Ok(e){(e=Wd(e))._checkNotDeleted("goOnline"),(e=e._repo).persistentConnection_&&e.persistentConnection_.resume(pS)}function Mk(e,t){Vb(e,t)}const Lk={".sv":"timestamp"};class Fk{constructor(e,t){this.committed=e,this.snapshot=t}toJSON(){return{committed:this.committed,snapshot:this.snapshot.toJSON()}}}function Uk(i,e,t){if(i=Wd(i),XE("Reference.transaction",i._path),".length"===i.key||".keys"===i.key)throw"Reference.transaction failed: "+i.key+" is a read-only object.";var n=null===(r=null==t?void 0:t.applyLocally)||void 0===r||r;const s=new id;var r=ok(i,()=>{});return function(t,n,e,r,i,s){xS(t,"transaction on "+n);const o={path:n,update:e,onComplete:r,status:null,order:Nb(),applyLocally:s,retryCount:0,unwatcher:i,abortReason:null,currentWriteId:null,currentInputSnapshot:null,currentOutputSnapshotRaw:null,currentOutputSnapshotResolved:null},a=PS(t,n,void 0);o.currentInputSnapshot=a;var c=o.update(a.val());if(void 0===c)o.unwatcher(),o.currentOutputSnapshotRaw=null,o.currentOutputSnapshotResolved=null,o.onComplete&&o.onComplete(null,!1,o.currentInputSnapshot);else{oS("transaction failed: Data returned ",c,o.path),o.status=0;var l=jE(t.transactionQueueTree_,n);const u=qE(l)||[];u.push(o),BE(l,u);let e;if("object"==typeof c&&null!==c&&Id(c,".priority"))e=Td(c,".priority"),Jh(sS(e),"Invalid priority returned by transaction. Priority must be a valid string, finite number, server value, or null.");else{const h=_E(t.serverSyncTree_,n)||pI.EMPTY_NODE;e=h.getPriority().val()}l=_S(t),c=yI(c,e),l=FE(c,a,l);o.currentOutputSnapshotRaw=c,o.currentOutputSnapshotResolved=l,o.currentWriteId=TS(t);l=hE(t.serverSyncTree_,n,l,o.currentWriteId,o.applyLocally);dS(t.eventQueue_,n,l),DS(t,t.transactionQueueTree_)}}(i._repo,i._path,e,(e,t,n)=>{var r;e?s.reject(e):(r=new JS(n,new YS(i._repo,i._path),oI),s.resolve(new Fk(t,r)))},r,n),s.promise}B0.prototype.simpleListen=function(e,t){this.sendRequest("q",{p:e},t)},B0.prototype.echo=function(e,t){this.sendRequest("echo",{d:e},t)},mb(Ff),Df(new Gd("database",(e,{instanceIdentifier:t})=>{return Ak(e.getProvider("app").getImmediate(),e.getProvider("auth-internal"),e.getProvider("app-check-internal"),t)},"PUBLIC").setMultipleInstances(!0)),qf(pb,"0.13.3",Eb),qf(pb,"0.13.3","esm2017");function Vk(e){var t="FIREBASE WARNING: "+e;jk.warn(t)}const jk=new nf("@firebase/database-compat");class qk{constructor(e){this._delegate=e}cancel(t){Md("OnDisconnect.cancel",0,1,arguments.length),Fd("OnDisconnect.cancel","onComplete",t,!0);const e=this._delegate.cancel();return t&&e.then(()=>t(null),e=>t(e)),e}remove(t){Md("OnDisconnect.remove",0,1,arguments.length),Fd("OnDisconnect.remove","onComplete",t,!0);const e=this._delegate.remove();return t&&e.then(()=>t(null),e=>t(e)),e}set(e,t){Md("OnDisconnect.set",1,2,arguments.length),Fd("OnDisconnect.set","onComplete",t,!0);const n=this._delegate.set(e);return t&&n.then(()=>t(null),e=>t(e)),n}setWithPriority(e,t,n){Md("OnDisconnect.setWithPriority",2,3,arguments.length),Fd("OnDisconnect.setWithPriority","onComplete",n,!0);const r=this._delegate.setWithPriority(e,t);return n&&r.then(()=>n(null),e=>n(e)),r}update(t,n){if(Md("OnDisconnect.update",1,2,arguments.length),Array.isArray(t)){const r={};for(let e=0;e<t.length;++e)r[""+e]=t[e];t=r,Vk("Passing an Array to firebase.database.onDisconnect().update() is deprecated. Use set() if you want to overwrite the existing data, or an Object with integer keys if you really do want to only update some of the children.")}Fd("OnDisconnect.update","onComplete",n,!0);const e=this._delegate.update(t);return n&&e.then(()=>n(null),e=>n(e)),e}}class Bk{constructor(e,t){this.committed=e,this.snapshot=t}toJSON(){return Md("TransactionResult.toJSON",0,1,arguments.length),{committed:this.committed,snapshot:this.snapshot.toJSON()}}}class Kk{constructor(e,t){this._database=e,this._delegate=t}val(){return Md("DataSnapshot.val",0,0,arguments.length),this._delegate.val()}exportVal(){return Md("DataSnapshot.exportVal",0,0,arguments.length),this._delegate.exportVal()}toJSON(){return Md("DataSnapshot.toJSON",0,1,arguments.length),this._delegate.toJSON()}exists(){return Md("DataSnapshot.exists",0,0,arguments.length),this._delegate.exists()}child(e){return Md("DataSnapshot.child",0,1,arguments.length),e=String(e),aS("DataSnapshot.child","path",e,!1),new Kk(this._database,this._delegate.child(e))}hasChild(e){return Md("DataSnapshot.hasChild",1,1,arguments.length),aS("DataSnapshot.hasChild","path",e,!1),this._delegate.hasChild(e)}getPriority(){return Md("DataSnapshot.getPriority",0,0,arguments.length),this._delegate.priority}forEach(t){return Md("DataSnapshot.forEach",1,1,arguments.length),Fd("DataSnapshot.forEach","action",t,!1),this._delegate.forEach(e=>t(new Kk(this._database,e)))}hasChildren(){return Md("DataSnapshot.hasChildren",0,0,arguments.length),this._delegate.hasChildren()}get key(){return this._delegate.key}numChildren(){return Md("DataSnapshot.numChildren",0,0,arguments.length),this._delegate.size}getRef(){return Md("DataSnapshot.ref",0,0,arguments.length),new zk(this._database,this._delegate.ref)}get ref(){return this.getRef()}}class $k{constructor(e,t){this.database=e,this._delegate=t}on(e,n,t,r){var i;Md("Query.on",2,4,arguments.length),Fd("Query.on","callback",n,!1);const s=$k.getCancelAndContextArgs_("Query.on",t,r);var o=(e,t)=>{n.call(s.context,new Kk(this.database,e),t)};o.userCallback=n,o.context=s.context;var a=null===(i=s.cancel)||void 0===i?void 0:i.bind(s.context);switch(e){case"value":return ok(this._delegate,o,a),n;case"child_added":return ak(this._delegate,o,a),n;case"child_removed":return uk(this._delegate,o,a),n;case"child_changed":return ck(this._delegate,o,a),n;case"child_moved":return lk(this._delegate,o,a),n;default:throw new Error(Ld("Query.on","eventType")+'must be a valid event type = "value", "child_added", "child_removed", "child_changed", or "child_moved".')}}off(e,t,n){var r;Md("Query.off",0,3,arguments.length),function(e,t,n){if(!n||void 0!==t)switch(t){case"value":case"child_added":case"child_removed":case"child_changed":case"child_moved":break;default:throw new Error(Ld(e,"eventType")+'must be a valid event type = "value", "child_added", "child_removed", "child_changed", or "child_moved".')}}("Query.off",e,!0),Fd("Query.off","callback",t,!0),Ud("Query.off","context",n,!0),t?((r=()=>{}).userCallback=t,r.context=n,hk(this._delegate,e,r)):hk(this._delegate,e)}get(){return ES((t=Wd(t=this._delegate))._repo,t).then(e=>new JS(e,new YS(t._repo,t._path),t._queryParams.getIndex())).then(e=>new Kk(this.database,e));var t}once(e,r,t,n){Md("Query.once",1,4,arguments.length),Fd("Query.once","callback",r,!0);const i=$k.getCancelAndContextArgs_("Query.once",t,n),s=new id;var o=(e,t)=>{var n=new Kk(this.database,e);r&&r.call(i.context,n,t),s.resolve(n)};o.userCallback=r,o.context=i.context;var a=e=>{i.cancel&&i.cancel.call(i.context,e),s.reject(e)};switch(e){case"value":ok(this._delegate,o,a,{onlyOnce:!0});break;case"child_added":ak(this._delegate,o,a,{onlyOnce:!0});break;case"child_removed":uk(this._delegate,o,a,{onlyOnce:!0});break;case"child_changed":ck(this._delegate,o,a,{onlyOnce:!0});break;case"child_moved":lk(this._delegate,o,a,{onlyOnce:!0});break;default:throw new Error(Ld("Query.once","eventType")+'must be a valid event type = "value", "child_added", "child_removed", "child_changed", or "child_moved".')}return s.promise}limitToFirst(e){return Md("Query.limitToFirst",1,1,arguments.length),new $k(this.database,Ek(this._delegate,function(e){if("number"!=typeof e||Math.floor(e)!==e||e<=0)throw new Error("limitToFirst: First argument must be a positive integer.");return new vk(e)}(e)))}limitToLast(e){return Md("Query.limitToLast",1,1,arguments.length),new $k(this.database,Ek(this._delegate,function(e){if("number"!=typeof e||Math.floor(e)!==e||e<=0)throw new Error("limitToLast: First argument must be a positive integer.");return new yk(e)}(e)))}orderByChild(e){return Md("Query.orderByChild",1,1,arguments.length),new $k(this.database,Ek(this._delegate,function(e){if("$key"===e)throw new Error('orderByChild: "$key" is invalid.  Use orderByKey() instead.');if("$priority"===e)throw new Error('orderByChild: "$priority" is invalid.  Use orderByPriority() instead.');if("$value"===e)throw new Error('orderByChild: "$value" is invalid.  Use orderByValue() instead.');return aS("orderByChild","path",e,!1),new _k(e)}(e)))}orderByKey(){return Md("Query.orderByKey",0,0,arguments.length),new $k(this.database,Ek(this._delegate,new wk))}orderByPriority(){return Md("Query.orderByPriority",0,0,arguments.length),new $k(this.database,Ek(this._delegate,new bk))}orderByValue(){return Md("Query.orderByValue",0,0,arguments.length),new $k(this.database,Ek(this._delegate,new Ik))}startAt(e=null,t){return Md("Query.startAt",0,2,arguments.length),new $k(this.database,Ek(this._delegate,([e=null,t]=[e,t],YE("startAt","key",t,!0),new gk(e,t))))}startAfter(e=null,t){return Md("Query.startAfter",0,2,arguments.length),new $k(this.database,Ek(this._delegate,(e=e,t=t,YE("startAfter","key",t,!0),new mk(e,t))))}endAt(e=null,t){return Md("Query.endAt",0,2,arguments.length),new $k(this.database,Ek(this._delegate,(e=e,t=t,YE("endAt","key",t,!0),new fk(e,t))))}endBefore(e=null,t){return Md("Query.endBefore",0,2,arguments.length),new $k(this.database,Ek(this._delegate,(e=e,t=t,YE("endBefore","key",t,!0),new pk(e,t))))}equalTo(e,t){return Md("Query.equalTo",1,2,arguments.length),new $k(this.database,Ek(this._delegate,(e=e,t=t,YE("equalTo","key",t,!0),new Tk(e,t))))}toString(){return Md("Query.toString",0,0,arguments.length),this._delegate.toString()}toJSON(){return Md("Query.toJSON",0,1,arguments.length),this._delegate.toJSON()}isEqual(e){if(Md("Query.isEqual",1,1,arguments.length),e instanceof $k)return this._delegate.isEqual(e._delegate);throw new Error("Query.isEqual failed: First argument must be an instance of firebase.database.Query.")}static getCancelAndContextArgs_(e,t,n){const r={cancel:void 0,context:void 0};if(t&&n)r.cancel=t,Fd(e,"cancel",r.cancel,!0),r.context=n,Ud(e,"context",r.context,!0);else if(t)if("object"==typeof t&&null!==t)r.context=t;else{if("function"!=typeof t)throw new Error(Ld(e,"cancelOrContext")+" must either be a cancel callback or a context object.");r.cancel=t}return r}get ref(){return new zk(this.database,new YS(this._delegate._repo,this._delegate._path))}}class zk extends $k{constructor(e,t){super(e,new WS(t._repo,t._path,new MI,!1)),this.database=e,this._delegate=t}getKey(){return Md("Reference.key",0,0,arguments.length),this._delegate.key}child(e){return Md("Reference.child",1,1,arguments.length),"number"==typeof e&&(e=String(e)),new zk(this.database,ek(this._delegate,e))}getParent(){Md("Reference.parent",0,0,arguments.length);var e=this._delegate.parent;return e?new zk(this.database,e):null}getRoot(){return Md("Reference.root",0,0,arguments.length),new zk(this.database,this._delegate.root)}set(e,t){Md("Reference.set",1,2,arguments.length),Fd("Reference.set","onComplete",t,!0);const n=tk(this._delegate,e);return t&&n.then(()=>t(null),e=>t(e)),n}update(t,n){if(Md("Reference.update",1,2,arguments.length),Array.isArray(t)){const r={};for(let e=0;e<t.length;++e)r[""+e]=t[e];t=r,Vk("Passing an Array to Firebase.update() is deprecated. Use set() if you want to overwrite the existing data, or an Object with integer keys if you really do want to only update some of the children.")}XE("Reference.update",this._delegate._path),Fd("Reference.update","onComplete",n,!0);const e=nk(this._delegate,t);return n&&e.then(()=>n(null),e=>n(e)),e}setWithPriority(e,t,n){Md("Reference.setWithPriority",2,3,arguments.length),Fd("Reference.setWithPriority","onComplete",n,!0);const r=function(e,t,n){if(XE("setWithPriority",e._path),GE("setWithPriority",t,e._path,!1),QE("setWithPriority",n,!1),".length"===e.key||".keys"===e.key)throw"setWithPriority failed: "+e.key+" is a read-only object.";const r=new id;return SS(e._repo,e._path,t,n,r.wrapCallback(()=>{})),r.promise}(this._delegate,e,t);return n&&r.then(()=>n(null),e=>n(e)),r}remove(t){Md("Reference.remove",0,1,arguments.length),Fd("Reference.remove","onComplete",t,!0);const e=(n=this._delegate,XE("remove",n._path),tk(n,null));var n;return t&&e.then(()=>t(null),e=>t(e)),e}transaction(e,t,n){Md("Reference.transaction",1,3,arguments.length),Fd("Reference.transaction","transactionUpdate",e,!1),Fd("Reference.transaction","onComplete",t,!0),function(e,t,n,r){if((!r||void 0!==n)&&"boolean"!=typeof n)throw new Error(Ld(e,t)+"must be a boolean.")}("Reference.transaction","applyLocally",n,!0);const r=Uk(this._delegate,e,{applyLocally:n}).then(e=>new Bk(e.committed,new Kk(this.database,e.snapshot)));return t&&r.then(e=>t(null,e.committed,e.snapshot),e=>t(e,!1,null)),r}setPriority(e,t){Md("Reference.setPriority",1,2,arguments.length),Fd("Reference.setPriority","onComplete",t,!0);const n=function(e,t){e=Wd(e),XE("setPriority",e._path),QE("setPriority",t,!1);const n=new id;return SS(e._repo,P0(e._path,".priority"),t,null,n.wrapCallback(()=>{})),n.promise}(this._delegate,e);return t&&n.then(()=>t(null),e=>t(e)),n}push(e,t){Md("Reference.push",0,2,arguments.length),Fd("Reference.push","onComplete",t,!0);const n=function(e,t){e=Wd(e),XE("push",e._path),GE("push",t,e._path,!0);var n=yS(e._repo),n=CI(n);const r=ek(e,n),i=ek(e,n);let s;return s=null!=t?tk(i,t).then(()=>i):Promise.resolve(i),r.then=s.then.bind(s),r.catch=s.then.bind(s,void 0),r}(this._delegate,e),r=n.then(e=>new zk(this.database,e));t&&r.then(()=>t(null),e=>t(e));const i=new zk(this.database,n);return i.then=r.then.bind(r),i.catch=r.catch.bind(r,void 0),i}onDisconnect(){return XE("Reference.onDisconnect",this._delegate._path),new qk(new zS(this._delegate._repo,this._delegate._path))}get key(){return this.getKey()}get parent(){return this.getParent()}get root(){return this.getRoot()}}class Wk{constructor(e,t){this._delegate=e,this.app=t,this.INTERNAL={delete:()=>this._delegate._delete(),forceWebSockets:Rk,forceLongPolling:Pk}}useEmulator(e,t,n={}){Dk(this._delegate,e,t,n)}ref(e){if(Md("database.ref",0,1,arguments.length),e instanceof zk){var t=ZS(this._delegate,e.toString());return new zk(this,t)}t=XS(this._delegate,e);return new zk(this,t)}refFromURL(e){Md("database.refFromURL",1,1,arguments.length);var t=ZS(this._delegate,e);return new zk(this,t)}goOffline(){var e;Md("database.goOffline",0,0,arguments.length),(e=Wd(e=this._delegate))._checkNotDeleted("goOffline"),NS(e._repo)}goOnline(){return Md("database.goOnline",0,0,arguments.length),Ok(this._delegate)}}Wk.ServerValue={TIMESTAMP:Lk,increment:e=>({".sv":{increment:e}})};var Gk,Hk=Object.freeze({__proto__:null,initStandalone:function({app:e,url:t,version:n,customAuthImpl:r,namespace:i,nodeAdmin:s=!1}){mb(n);const o=new Qd("auth-internal",new Yd("database-standalone"));return o.setComponent(new Gd("auth-internal",()=>r,"PRIVATE")),{instance:new Wk(Ak(e,o,void 0,t,s),e),namespace:i}}});const Qk=Wk.ServerValue;(Gk=op).INTERNAL.registerComponent(new Gd("database-compat",(e,{instanceIdentifier:t})=>{var n=e.getProvider("app-compat").getImmediate(),r=e.getProvider("database").getImmediate({identifier:t});return new Wk(r,n)},"PUBLIC").setServiceProps({Reference:zk,Query:$k,Database:Wk,DataSnapshot:Kk,enableLogging:Mk,INTERNAL:Hk,ServerValue:Qk}).setMultipleInstances(!0)),Gk.registerVersion("@firebase/database-compat","0.2.3");var l="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},Yk={},Jk=l||self;function Xk(){}function Zk(e){var t=typeof e;return"array"==(t="object"!=t?t:e?Array.isArray(e)?"array":t:"null")||"object"==t&&"number"==typeof e.length}function eC(e){var t=typeof e;return"object"==t&&null!=e||"function"==t}var tC="closure_uid_"+(1e9*Math.random()>>>0),nC=0;function rC(e,t,n){return e.call.apply(e.bind,arguments)}function iC(t,n,e){if(!t)throw Error();if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var e=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(e,r),t.apply(n,e)}}return function(){return t.apply(n,arguments)}}function sC(e,t,n){return(sC=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?rC:iC).apply(null,arguments)}function oC(t){var n=Array.prototype.slice.call(arguments,1);return function(){var e=n.slice();return e.push.apply(e,arguments),t.apply(this,e)}}function aC(e,s){function t(){}t.prototype=s.prototype,e.Z=s.prototype,e.prototype=new t,(e.prototype.constructor=e).Vb=function(e,t,n){for(var r=Array(arguments.length-2),i=2;i<arguments.length;i++)r[i-2]=arguments[i];return s.prototype[t].apply(e,r)}}function cC(){this.s=this.s,this.o=this.o}var lC={};cC.prototype.s=!1,cC.prototype.na=function(){var e,t;!this.s&&(this.s=!0,this.M(),0)&&(t=this,e=Object.prototype.hasOwnProperty.call(t,tC)&&t[tC]||(t[tC]=++nC),delete lC[e])},cC.prototype.M=function(){if(this.o)for(;this.o.length;)this.o.shift()()};const uC=Array.prototype.indexOf?function(e,t){return Array.prototype.indexOf.call(e,t,void 0)}:function(e,t){if("string"==typeof e)return"string"!=typeof t||1!=t.length?-1:e.indexOf(t,0);for(let n=0;n<e.length;n++)if(n in e&&e[n]===t)return n;return-1},hC=Array.prototype.forEach?function(e,t,n){Array.prototype.forEach.call(e,t,n)}:function(e,t,n){var r=e.length,i="string"==typeof e?e.split(""):e;for(let s=0;s<r;s++)s in i&&t.call(n,i[s],s,e)};function dC(){return Array.prototype.concat.apply([],arguments)}function fC(t){var n=t.length;if(0<n){const r=Array(n);for(let e=0;e<n;e++)r[e]=t[e];return r}return[]}function pC(e){return/^[\s\xa0]*$/.test(e)}var gC,mC=String.prototype.trim?function(e){return e.trim()}:function(e){return/^[\s\xa0]*([\s\S]*?)[\s\xa0]*$/.exec(e)[1]};function vC(e,t){return-1!=e.indexOf(t)}function yC(e,t){return e<t?-1:t<e?1:0}e:{var _C=Jk.navigator;if(_C){_C=_C.userAgent;if(_C){gC=_C;break e}}gC=""}function wC(e,t,n){for(const r in e)t.call(n,e[r],r,e)}function bC(e){const t={};for(const n in e)t[n]=e[n];return t}var IC="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function TC(t){let n,r;for(let i=1;i<arguments.length;i++){for(n in r=arguments[i])t[n]=r[n];for(let e=0;e<IC.length;e++)n=IC[e],Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}}function EC(e){return EC[" "](e),e}EC[" "]=Xk;var SC,kC=vC(gC,"Opera"),CC=vC(gC,"Trident")||vC(gC,"MSIE"),AC=vC(gC,"Edge"),NC=AC||CC,xC=vC(gC,"Gecko")&&!(vC(gC.toLowerCase(),"webkit")&&!vC(gC,"Edge"))&&!(vC(gC,"Trident")||vC(gC,"MSIE"))&&!vC(gC,"Edge"),RC=vC(gC.toLowerCase(),"webkit")&&!vC(gC,"Edge");function PC(){var e=Jk.document;return e?e.documentMode:void 0}e:{var DC="",OC=(OC=gC,xC?/rv:([^\);]+)(\)|;)/.exec(OC):AC?/Edge\/([\d\.]+)/.exec(OC):CC?/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(OC):RC?/WebKit\/(\S+)/.exec(OC):kC?/(?:Version)[ \/]?(\S+)/.exec(OC):void 0);if(OC&&(DC=OC?OC[1]:""),CC){OC=PC();if(null!=OC&&OC>parseFloat(DC)){SC=String(OC);break e}}SC=DC}var MC={};function LC(){return e=function(){let e=0;var t=mC(String(SC)).split("."),n=mC("9").split("."),r=Math.max(t.length,n.length);for(let o=0;0==e&&o<r;o++)for(var i=t[o]||"",s=n[o]||"";i=/(\d*)(\D*)(.*)/.exec(i)||["","","",""],s=/(\d*)(\D*)(.*)/.exec(s)||["","","",""],(0!=i[0].length||0!=s[0].length)&&(e=yC(0==i[1].length?0:parseInt(i[1],10),0==s[1].length?0:parseInt(s[1],10))||yC(0==i[2].length,0==s[2].length)||yC(i[2],s[2]),i=i[3],s=s[3],0==e););return 0<=e},t=MC,Object.prototype.hasOwnProperty.call(t,9)?t[9]:t[9]=e(9);var e,t}var FC=Jk.document&&CC&&(PC()||parseInt(SC,10))||void 0,UC=function(){if(!Jk.addEventListener||!Object.defineProperty)return!1;var e=!1,t=Object.defineProperty({},"passive",{get:function(){e=!0}});try{Jk.addEventListener("test",Xk,t),Jk.removeEventListener("test",Xk,t)}catch(e){}return e}();function VC(e,t){this.type=e,this.g=this.target=t,this.defaultPrevented=!1}function jC(e,t){if(VC.call(this,e?e.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,e){var n=this.type=e.type,r=e.changedTouches&&e.changedTouches.length?e.changedTouches[0]:null;if(this.target=e.target||e.srcElement,this.g=t,t=e.relatedTarget){if(xC){e:{try{EC(t.nodeName);var i=!0;break e}catch(e){}i=!1}i||(t=null)}}else"mouseover"==n?t=e.fromElement:"mouseout"==n&&(t=e.toElement);this.relatedTarget=t,r?(this.clientX=void 0!==r.clientX?r.clientX:r.pageX,this.clientY=void 0!==r.clientY?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0):(this.clientX=void 0!==e.clientX?e.clientX:e.pageX,this.clientY=void 0!==e.clientY?e.clientY:e.pageY,this.screenX=e.screenX||0,this.screenY=e.screenY||0),this.button=e.button,this.key=e.key||"",this.ctrlKey=e.ctrlKey,this.altKey=e.altKey,this.shiftKey=e.shiftKey,this.metaKey=e.metaKey,this.pointerId=e.pointerId||0,this.pointerType="string"==typeof e.pointerType?e.pointerType:qC[e.pointerType]||"",this.state=e.state,(this.i=e).defaultPrevented&&jC.Z.h.call(this)}}VC.prototype.h=function(){this.defaultPrevented=!0},aC(jC,VC);var qC={2:"touch",3:"pen",4:"mouse"};jC.prototype.h=function(){jC.Z.h.call(this);var e=this.i;e.preventDefault?e.preventDefault():e.returnValue=!1};var BC="closure_listenable_"+(1e6*Math.random()|0),KC=0;function $C(e,t,n,r,i){this.listener=e,this.proxy=null,this.src=t,this.type=n,this.capture=!!r,this.ia=i,this.key=++KC,this.ca=this.fa=!1}function zC(e){e.ca=!0,e.listener=null,e.proxy=null,e.src=null,e.ia=null}function WC(e){this.src=e,this.g={},this.h=0}function GC(e,t){var n,r,i,s=t.type;s in e.g&&(n=e.g[s],(i=0<=(r=uC(n,t)))&&Array.prototype.splice.call(n,r,1),i&&(zC(t),0==e.g[s].length&&(delete e.g[s],e.h--)))}function HC(e,t,n,r){for(var i=0;i<e.length;++i){var s=e[i];if(!s.ca&&s.listener==t&&s.capture==!!n&&s.ia==r)return i}return-1}WC.prototype.add=function(e,t,n,r,i){var s=e.toString();(e=this.g[s])||(e=this.g[s]=[],this.h++);var o=HC(e,t,r,i);return-1<o?(t=e[o],n||(t.fa=!1)):((t=new $C(t,this.src,s,!!r,i)).fa=n,e.push(t)),t};var QC="closure_lm_"+(1e6*Math.random()|0),YC={};function JC(e,t,n,r,i){if(r&&r.once)return function e(t,n,r,i,s){if(Array.isArray(n)){for(var o=0;o<n.length;o++)e(t,n[o],r,i,s);return null}r=iA(r);return t&&t[BC]?t.O(n,r,eC(i)?!!i.capture:!!i,s):XC(t,n,r,!0,i,s)}(e,t,n,r,i);if(Array.isArray(t)){for(var s=0;s<t.length;s++)JC(e,t[s],n,r,i);return null}return n=iA(n),e&&e[BC]?e.N(t,n,eC(r)?!!r.capture:!!r,i):XC(e,t,n,!1,r,i)}function XC(e,t,n,r,i,s){if(!t)throw Error("Invalid event type");var o,a=eC(i)?!!i.capture:!!i,c=nA(e);if(c||(e[QC]=c=new WC(e)),(n=c.add(t,n,r,a,s)).proxy)return n;if(o=tA,r=function e(t){return o.call(e.src,e.listener,t)},(n.proxy=r).src=e,r.listener=n,e.addEventListener)void 0===(i=!UC?a:i)&&(i=!1),e.addEventListener(t.toString(),r,i);else if(e.attachEvent)e.attachEvent(eA(t.toString()),r);else{if(!e.addListener||!e.removeListener)throw Error("addEventListener and attachEvent are unavailable.");e.addListener(r)}return n}function ZC(e){var t,n,r;"number"!=typeof e&&e&&!e.ca&&((t=e.src)&&t[BC]?GC(t.i,e):(n=e.type,r=e.proxy,t.removeEventListener?t.removeEventListener(n,r,e.capture):t.detachEvent?t.detachEvent(eA(n),r):t.addListener&&t.removeListener&&t.removeListener(r),(n=nA(t))?(GC(n,e),0==n.h&&(n.src=null,t[QC]=null)):zC(e)))}function eA(e){return e in YC?YC[e]:YC[e]="on"+e}function tA(e,t){var n,r;return e=!!e.ca||(t=new jC(t,this),n=e.listener,r=e.ia||e.src,e.fa&&ZC(e),n.call(r,t))}function nA(e){return(e=e[QC])instanceof WC?e:null}var rA="__closure_events_fn_"+(1e9*Math.random()>>>0);function iA(t){return"function"==typeof t?t:(t[rA]||(t[rA]=function(e){return t.handleEvent(e)}),t[rA])}function sA(){cC.call(this),this.i=new WC(this),(this.P=this).I=null}function oA(e,t){var n,r=e.I;if(r)for(n=[];r;r=r.I)n.push(r);if(e=e.P,r=t.type||t,"string"==typeof t?t=new VC(t,e):t instanceof VC?t.target=t.target||e:(o=t,TC(t=new VC(r,e),o)),o=!0,n)for(var i=n.length-1;0<=i;i--)var s=t.g=n[i],o=aA(s,r,!0,t)&&o;if(o=aA(s=t.g=e,r,!0,t)&&o,o=aA(s,r,!1,t)&&o,n)for(i=0;i<n.length;i++)o=aA(s=t.g=n[i],r,!1,t)&&o}function aA(e,t,n,r){if(!(t=e.i.g[String(t)]))return!0;t=t.concat();for(var i=!0,s=0;s<t.length;++s){var o,a,c=t[s];c&&!c.ca&&c.capture==n&&(o=c.listener,a=c.ia||c.src,c.fa&&GC(e.i,c),i=!1!==o.call(a,r)&&i)}return i&&!r.defaultPrevented}aC(sA,cC),sA.prototype[BC]=!0,sA.prototype.removeEventListener=function(e,t,n,r){!function e(t,n,r,i,s){if(Array.isArray(n))for(var o=0;o<n.length;o++)e(t,n[o],r,i,s);else i=eC(i)?!!i.capture:!!i,r=iA(r),t&&t[BC]?(t=t.i,(n=String(n).toString())in t.g&&-1<(r=HC(o=t.g[n],r,i,s))&&(zC(o[r]),Array.prototype.splice.call(o,r,1),0==o.length&&(delete t.g[n],t.h--))):(t=t&&nA(t))&&(n=t.g[n.toString()],(r=(t=-1)<(t=n?HC(n,r,i,s):t)?n[t]:null)&&ZC(r))}(this,e,t,n,r)},sA.prototype.M=function(){if(sA.Z.M.call(this),this.i){var e,t=this.i;for(e in t.g){for(var n=t.g[e],r=0;r<n.length;r++)zC(n[r]);delete t.g[e],t.h--}}this.I=null},sA.prototype.N=function(e,t,n,r){return this.i.add(String(e),t,!1,n,r)},sA.prototype.O=function(e,t,n,r){return this.i.add(String(e),t,!0,n,r)};var cA=Jk.JSON.stringify;var lA,uA=new class{constructor(e,t){this.i=e,this.j=t,this.h=0,this.g=null}get(){let e;return 0<this.h?(this.h--,e=this.g,this.g=e.next,e.next=null):e=this.i(),e}}(()=>new hA,e=>e.reset());class hA{constructor(){this.next=this.g=this.h=null}set(e,t){this.h=e,this.g=t,this.next=null}reset(){this.next=this.g=this.h=null}}function dA(e,t){var n;lA||(n=Jk.Promise.resolve(void 0),lA=function(){n.then(gA)}),fA||(lA(),fA=!0),pA.add(e,t)}var fA=!1,pA=new class{constructor(){this.h=this.g=null}add(e,t){const n=uA.get();n.set(e,t),this.h?this.h.next=n:this.g=n,this.h=n}};function gA(){for(var e;e=function(){var e=pA;let t=null;return e.g&&(t=e.g,e.g=e.g.next,e.g||(e.h=null),t.next=null),t}();){try{e.h.call(e.g)}catch(e){!function(e){Jk.setTimeout(()=>{throw e},0)}(e)}var t=uA;t.j(e),t.h<100&&(t.h++,e.next=t.g,t.g=e)}fA=!1}function mA(e,t){sA.call(this),this.h=e||1,this.g=t||Jk,this.j=sC(this.kb,this),this.l=Date.now()}function vA(e){e.da=!1,e.S&&(e.g.clearTimeout(e.S),e.S=null)}function yA(e,t,n){if("function"==typeof e)n&&(e=sC(e,n));else{if(!e||"function"!=typeof e.handleEvent)throw Error("Invalid listener argument");e=sC(e.handleEvent,e)}return 2147483647<Number(t)?-1:Jk.setTimeout(e,t||0)}aC(mA,sA),(We=mA.prototype).da=!1,We.S=null,We.kb=function(){var e;this.da&&(0<(e=Date.now()-this.l)&&e<.8*this.h?this.S=this.g.setTimeout(this.j,this.h-e):(this.S&&(this.g.clearTimeout(this.S),this.S=null),oA(this,"tick"),this.da&&(vA(this),this.start())))},We.start=function(){this.da=!0,this.S||(this.S=this.g.setTimeout(this.j,this.h),this.l=Date.now())},We.M=function(){mA.Z.M.call(this),vA(this),delete this.g};class _A extends cC{constructor(e,t){super(),this.m=e,this.j=t,this.h=null,this.i=!1,this.g=null}l(e){this.h=arguments,this.g?this.i=!0:function e(t){t.g=yA(()=>{t.g=null,t.i&&(t.i=!1,e(t))},t.j);var n=t.h;t.h=null,t.m.apply(null,n)}(this)}M(){super.M(),this.g&&(Jk.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function wA(e){cC.call(this),this.h=e,this.g={}}aC(wA,cC);var bA=[];function IA(e,t,n,r){Array.isArray(n)||(n&&(bA[0]=n.toString()),n=bA);for(var i=0;i<n.length;i++){var s=JC(t,n[i],r||e.handleEvent,!1,e.h||e);if(!s)break;e.g[s.key]=s}}function TA(e){wC(e.g,function(e,t){this.g.hasOwnProperty(t)&&ZC(e)},e),e.g={}}function EA(){this.g=!0}function SA(e,t,n,r){e.info(function(){return"XMLHTTP TEXT ("+t+"): "+function(e,t){if(!e.g)return t;if(!t)return null;try{var n=JSON.parse(t);if(n)for(e=0;e<n.length;e++)if(Array.isArray(n[e])){var r=n[e];if(!(r.length<2)){var i=r[1];if(Array.isArray(i)&&!(i.length<1)){var s=i[0];if("noop"!=s&&"stop"!=s&&"close"!=s)for(var o=1;o<i.length;o++)i[o]=""}}}return cA(n)}catch(e){return t}}(e,n)+(r?" "+r:"")})}wA.prototype.M=function(){wA.Z.M.call(this),TA(this)},wA.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")},EA.prototype.Aa=function(){this.g=!1},EA.prototype.info=function(){};var kA={},CA=null;function AA(){return CA=CA||new sA}function NA(e){VC.call(this,kA.Ma,e)}function xA(){var e=AA();oA(e,new NA(e))}function RA(e,t){VC.call(this,kA.STAT_EVENT,e),this.stat=t}function PA(e){var t=AA();oA(t,new RA(t,e))}function DA(e,t){VC.call(this,kA.Na,e),this.size=t}function OA(e,t){if("function"!=typeof e)throw Error("Fn must not be null and must be a function");return Jk.setTimeout(function(){e()},t)}kA.Ma="serverreachability",aC(NA,VC),kA.STAT_EVENT="statevent",aC(RA,VC),kA.Na="timingevent",aC(DA,VC);c={NO_ERROR:0,lb:1,yb:2,xb:3,sb:4,wb:5,zb:6,Ja:7,TIMEOUT:8,Cb:9},yt={qb:"complete",Mb:"success",Ka:"error",Ja:"abort",Eb:"ready",Fb:"readystatechange",TIMEOUT:"timeout",Ab:"incrementaldata",Db:"progress",tb:"downloadprogress",Ub:"uploadprogress"};function MA(){}function LA(e){return e.h||(e.h=e.i())}function FA(){}MA.prototype.h=null;l={OPEN:"a",pb:"b",Ka:"c",Bb:"d"};function UA(){VC.call(this,"d")}function VA(){VC.call(this,"c")}function jA(){}function qA(e,t,n,r){this.l=e,this.j=t,this.m=n,this.X=r||1,this.V=new wA(this),this.P=$A,this.W=new mA(e=NC?125:void 0),this.H=null,this.i=!1,this.s=this.A=this.v=this.K=this.F=this.Y=this.B=null,this.D=[],this.g=null,this.C=0,this.o=this.u=null,this.N=-1,this.I=!1,this.O=0,this.L=null,this.aa=this.J=this.$=this.U=!1,this.h=new BA}function BA(){this.i=null,this.g="",this.h=!1}aC(UA,VC),aC(VA,VC),aC(jA,MA),jA.prototype.g=function(){return new XMLHttpRequest},jA.prototype.i=function(){return{}};var KA=new jA,$A=45e3,zA={},WA={};function GA(e,t,n){e.K=1,e.v=gN(lN(t)),e.s=n,e.U=!0,HA(e,null)}function HA(e,t){e.F=Date.now(),JA(e),e.A=lN(e.v);var o,a,c,l,u,h,n=e.A,r=e.X;Array.isArray(r)||(r=[String(r)]),AN(n.h,"t",r),e.C=0,n=e.l.H,e.h=new BA,e.g=Ax(e.l,n?t:null,!e.s),0<e.O&&(e.L=new _A(sC(e.Ia,e,e.g),e.O)),IA(e.V,e.g,"readystatechange",e.gb),t=e.H?bC(e.H):{},e.s?(e.u||(e.u="POST"),t["Content-Type"]="application/x-www-form-urlencoded",e.g.ea(e.A,e.u,e.s,t)):(e.u="GET",e.g.ea(e.A,e.u,null,t)),xA(),o=e.j,a=e.u,c=e.A,l=e.m,u=e.X,h=e.s,o.info(function(){if(o.g)if(h)for(var e="",t=h.split("&"),n=0;n<t.length;n++){var r,i,s=t[n].split("=");1<s.length&&(r=s[0],s=s[1],e=2<=(i=r.split("_")).length&&"type"==i[1]?e+(r+"=")+s+"&":e+(r+"=redacted&"))}else e=null;else e=h;return"XMLHTTP REQ ("+l+") [attempt "+u+"]: "+a+"\n"+c+"\n"+e})}function QA(e){return e.g&&("GET"==e.u&&2!=e.K&&e.l.Ba)}function YA(e,t,n){let r=!0,i;for(;!e.I&&e.C<n.length;){if(i=(o=n,c=a=void 0,a=(s=e).C,-1==(c=o.indexOf("\n",a))?WA:(a=Number(o.substring(a,c)),isNaN(a)?zA:(c+=1)+a>o.length?WA:(o=o.substr(c,a),s.C=c+a,o))),i==WA){4==t&&(e.o=4,PA(14),r=!1),SA(e.j,e.m,null,"[Incomplete Response]");break}if(i==zA){e.o=4,PA(15),SA(e.j,e.m,n,"[Invalid Chunk]"),r=!1;break}SA(e.j,e.m,i,null),nN(e,i)}var s,o,a,c;QA(e)&&i!=WA&&i!=zA&&(e.h.g="",e.C=0),4!=t||0!=n.length||e.h.h||(e.o=1,PA(16),r=!1),e.i=e.i&&r,r?0<n.length&&!e.aa&&(e.aa=!0,(t=e.l).g==e&&t.$&&!t.L&&(t.h.info("Great, no buffering proxy detected. Bytes received: "+n.length),wx(t),t.L=!0,PA(11))):(SA(e.j,e.m,n,"[Invalid Chunked Response]"),tN(e),eN(e))}function JA(e){e.Y=Date.now()+e.P,XA(e,e.P)}function XA(e,t){if(null!=e.B)throw Error("WatchDog timer not null");e.B=OA(sC(e.eb,e),t)}function ZA(e){e.B&&(Jk.clearTimeout(e.B),e.B=null)}function eN(e){0==e.l.G||e.I||Tx(e.l,e)}function tN(e){ZA(e);var t=e.L;t&&"function"==typeof t.na&&t.na(),e.L=null,vA(e.W),TA(e.V),e.g&&(t=e.g,e.g=null,t.abort(),t.na())}function nN(e,t){try{var n=e.l;if(0!=n.G&&(n.g==e||MN(n.i,e)))if(n.I=e.N,!e.J&&MN(n.i,e)&&3==n.G){try{var r=n.Ca.g.parse(t)}catch(e){r=null}if(Array.isArray(r)&&3==r.length){var i=r;if(0==i[0]){e:if(!n.u){if(n.g){if(!(n.g.F+3e3<e.F))break e;Ix(n),hx(n)}_x(n),PA(18)}}else n.ta=i[1],0<n.ta-n.U&&i[2]<37500&&n.N&&0==n.A&&!n.v&&(n.v=OA(sC(n.ab,n),6e3));if(ON(n.i)<=1&&n.ka){try{n.ka()}catch(e){}n.ka=void 0}}else Sx(n,11)}else if(!e.J&&n.g!=e||Ix(n),!pC(t))for(i=n.Ca.g.parse(t),t=0;t<i.length;t++){var s=i[t];if(n.U=s[0],s=s[1],2==n.G)if("c"==s[0]){n.J=s[1],n.la=s[2];var o=s[3];null!=o&&(n.ma=o,n.h.info("VER="+n.ma));var a=s[4];null!=a&&(n.za=a,n.h.info("SVER="+n.za));var c,l,u,h=s[5];null!=h&&"number"==typeof h&&0<h&&(r=1.5*h,n.K=r,n.h.info("backChannelRequestTimeoutMs_="+r)),r=n;const g=e.g;g&&(!(c=g.g?g.g.getResponseHeader("X-Client-Wire-Protocol"):null)||!(l=r.i).g&&(vC(c,"spdy")||vC(c,"quic")||vC(c,"h2"))&&(l.j=l.l,l.g=new Set,l.h&&(LN(l,l.h),l.h=null)),!r.D||(u=g.g?g.g.getResponseHeader("X-HTTP-Session-Id"):null)&&(r.sa=u,pN(r.F,r.D,u))),n.G=3,n.j&&n.j.xa(),n.$&&(n.O=Date.now()-e.F,n.h.info("Handshake RTT: "+n.O+"ms"));var d,f,p=e;(r=n).oa=Cx(r,r.H?r.la:null,r.W),p.J?(FN(r.i,p),d=p,(f=r.K)&&d.setTimeout(f),d.B&&(ZA(d),JA(d)),r.g=p):yx(r),0<n.l.length&&px(n)}else"stop"!=s[0]&&"close"!=s[0]||Sx(n,7);else 3==n.G&&("stop"==s[0]||"close"==s[0]?"stop"==s[0]?Sx(n,7):ux(n):"noop"!=s[0]&&n.j&&n.j.wa(s),n.A=0)}xA()}catch(e){}}function rN(e,t){if(e.forEach&&"function"==typeof e.forEach)e.forEach(t,void 0);else if(Zk(e)||"string"==typeof e)hC(e,t,void 0);else{if(e.T&&"function"==typeof e.T)var n=e.T();else if(e.R&&"function"==typeof e.R)n=void 0;else if(Zk(e)||"string"==typeof e)for(var n=[],r=e.length,i=0;i<r;i++)n.push(i);else for(i in n=[],r=0,e)n[r++]=i;for(var i=(r=function(e){if(e.R&&"function"==typeof e.R)return e.R();if("string"==typeof e)return e.split("");if(Zk(e)){for(var t=[],n=e.length,r=0;r<n;r++)t.push(e[r]);return t}for(r in t=[],n=0,e)t[n++]=e[r];return t}(e)).length,s=0;s<i;s++)t.call(void 0,r[s],n&&n[s],e)}}function iN(e,t){this.h={},this.g=[],this.i=0;var n=arguments.length;if(1<n){if(n%2)throw Error("Uneven number of arguments");for(var r=0;r<n;r+=2)this.set(arguments[r],arguments[r+1])}else if(e)if(e instanceof iN)for(n=e.T(),r=0;r<n.length;r++)this.set(n[r],e.get(n[r]));else for(r in e)this.set(r,e[r])}function sN(e){if(e.i!=e.g.length){for(var t=0,n=0;t<e.g.length;){var r=e.g[t];oN(e.h,r)&&(e.g[n++]=r),t++}e.g.length=n}if(e.i!=e.g.length){for(var i={},n=t=0;t<e.g.length;)oN(i,r=e.g[t])||(i[e.g[n++]=r]=1),t++;e.g.length=n}}function oN(e,t){return Object.prototype.hasOwnProperty.call(e,t)}(We=qA.prototype).setTimeout=function(e){this.P=e},We.gb=function(e){e=e.target;const t=this.L;t&&3==sx(e)?t.l():this.Ia(e)},We.Ia=function(e){try{if(e==this.g)e:{var t=sx(this.g),n=this.g.Da();this.g.ba();if(!(t<3)&&(3!=t||NC||this.g&&(this.h.h||this.g.ga()||ox(this.g)))){this.I||4!=t||7==n||xA(),ZA(this);var r=this.g.ba();this.N=r;t:if(QA(this)){var i=ox(this.g);e="";var s=i.length,o=4==sx(this.g);if(!this.h.i){if("undefined"==typeof TextDecoder){tN(this),eN(this);var a="";break t}this.h.i=new Jk.TextDecoder}for(n=0;n<s;n++)this.h.h=!0,e+=this.h.i.decode(i[n],{stream:o&&n==s-1});i.splice(0,s),this.h.g+=e,this.C=0,a=this.h.g}else a=this.g.ga();if(this.i=200==r,h=this.j,d=this.u,f=this.A,p=this.m,g=this.X,m=t,v=r,h.info(function(){return"XMLHTTP RESP ("+p+") [ attempt "+g+"]: "+d+"\n"+f+"\n"+m+" "+v}),this.i){if(this.$&&!this.J){t:{if(this.g){var c,l=this.g;if((c=l.g?l.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!pC(c)){var u=c;break t}}u=null}if(!(r=u)){this.i=!1,this.o=3,PA(12),tN(this),eN(this);break e}SA(this.j,this.m,r,"Initial handshake response via X-HTTP-Initial-Response"),this.J=!0,nN(this,r)}this.U?(YA(this,t,a),NC&&this.i&&3==t&&(IA(this.V,this.W,"tick",this.fb),this.W.start())):(SA(this.j,this.m,a,null),nN(this,a)),4==t&&tN(this),this.i&&!this.I&&(4==t?Tx(this.l,this):(this.i=!1,JA(this)))}else 400==r&&0<a.indexOf("Unknown SID")?(this.o=3,PA(12)):(this.o=0,PA(13)),tN(this),eN(this)}}}catch(e){}var h,d,f,p,g,m,v},We.fb=function(){var e,t;this.g&&(e=sx(this.g),t=this.g.ga(),this.C<t.length&&(ZA(this),YA(this,e,t),this.i&&4!=e&&JA(this)))},We.cancel=function(){this.I=!0,tN(this)},We.eb=function(){this.B=null;var e,t,n=Date.now();0<=n-this.Y?(e=this.j,t=this.A,e.info(function(){return"TIMEOUT: "+t}),2!=this.K&&(xA(),PA(17)),tN(this),this.o=2,eN(this)):XA(this,this.Y-n)},(We=iN.prototype).R=function(){sN(this);for(var e=[],t=0;t<this.g.length;t++)e.push(this.h[this.g[t]]);return e},We.T=function(){return sN(this),this.g.concat()},We.get=function(e,t){return oN(this.h,e)?this.h[e]:t},We.set=function(e,t){oN(this.h,e)||(this.i++,this.g.push(e)),this.h[e]=t},We.forEach=function(e,t){for(var n=this.T(),r=0;r<n.length;r++){var i=n[r],s=this.get(i);e.call(t,s,i,this)}};var aN=/^(?:([^:/?#.]+):)?(?:\/\/(?:([^\\/?#]*)@)?([^\\/?#]*?)(?::([0-9]+))?(?=[\\/?#]|$))?([^?#]+)?(?:\?([^#]*))?(?:#([\s\S]*))?$/;function cN(e,t){var n;this.i=this.s=this.j="",this.m=null,this.o=this.l="",this.g=!1,e instanceof cN?(this.g=void 0!==t?t:e.g,uN(this,e.j),this.s=e.s,hN(this,e.i),dN(this,e.m),this.l=e.l,t=e.h,(n=new EN).i=t.i,t.g&&(n.g=new iN(t.g),n.h=t.h),fN(this,n),this.o=e.o):e&&(n=String(e).match(aN))?(this.g=!!t,uN(this,n[1]||"",!0),this.s=mN(n[2]||""),hN(this,n[3]||"",!0),dN(this,n[4]),this.l=mN(n[5]||"",!0),fN(this,n[6]||"",!0),this.o=mN(n[7]||"")):(this.g=!!t,this.h=new EN(null,this.g))}function lN(e){return new cN(e)}function uN(e,t,n){e.j=n?mN(t,!0):t,e.j&&(e.j=e.j.replace(/:$/,""))}function hN(e,t,n){e.i=n?mN(t,!0):t}function dN(e,t){if(t){if(t=Number(t),isNaN(t)||t<0)throw Error("Bad port number "+t);e.m=t}else e.m=null}function fN(e,t,n){var r,i;t instanceof EN?(e.h=t,r=e.h,(i=e.g)&&!r.j&&(SN(r),r.i=null,r.g.forEach(function(e,t){var n=t.toLowerCase();t!=n&&(kN(this,t),AN(this,n,e))},r)),r.j=i):(n||(t=vN(t,IN)),e.h=new EN(t,e.g))}function pN(e,t,n){e.h.set(t,n)}function gN(e){return pN(e,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),e}function mN(e,t){return e?t?decodeURI(e.replace(/%25/g,"%2525")):decodeURIComponent(e):""}function vN(e,t,n){return"string"==typeof e?(e=encodeURI(e).replace(t,yN),e=n?e.replace(/%25([0-9a-fA-F]{2})/g,"%$1"):e):null}function yN(e){return"%"+((e=e.charCodeAt(0))>>4&15).toString(16)+(15&e).toString(16)}cN.prototype.toString=function(){var e=[],t=this.j;t&&e.push(vN(t,_N,!0),":");var n=this.i;return!n&&"file"!=t||(e.push("//"),(t=this.s)&&e.push(vN(t,_N,!0),"@"),e.push(encodeURIComponent(String(n)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(n=this.m)&&e.push(":",String(n))),(n=this.l)&&(this.i&&"/"!=n.charAt(0)&&e.push("/"),e.push(vN(n,"/"==n.charAt(0)?bN:wN,!0))),(n=this.h.toString())&&e.push("?",n),(n=this.o)&&e.push("#",vN(n,TN)),e.join("")};var _N=/[#\/\?@]/g,wN=/[#\?:]/g,bN=/[#\?]/g,IN=/[#\?@]/g,TN=/#/g;function EN(e,t){this.h=this.g=null,this.i=e||null,this.j=!!t}function SN(n){n.g||(n.g=new iN,n.h=0,n.i&&function(e,t){if(e){e=e.split("&");for(var n=0;n<e.length;n++){var r,i=e[n].indexOf("="),s=null;0<=i?(r=e[n].substring(0,i),s=e[n].substring(i+1)):r=e[n],t(r,s?decodeURIComponent(s.replace(/\+/g," ")):"")}}}(n.i,function(e,t){n.add(decodeURIComponent(e.replace(/\+/g," ")),t)}))}function kN(e,t){SN(e),t=NN(e,t),oN(e.g.h,t)&&(e.i=null,e.h-=e.g.get(t).length,oN((e=e.g).h,t)&&(delete e.h[t],e.i--,e.g.length>2*e.i&&sN(e)))}function CN(e,t){return SN(e),t=NN(e,t),oN(e.g.h,t)}function AN(e,t,n){kN(e,t),0<n.length&&(e.i=null,e.g.set(NN(e,t),fC(n)),e.h+=n.length)}function NN(e,t){return t=String(t),t=e.j?t.toLowerCase():t}(We=EN.prototype).add=function(e,t){SN(this),this.i=null,e=NN(this,e);var n=this.g.get(e);return n||this.g.set(e,n=[]),n.push(t),this.h+=1,this},We.forEach=function(n,r){SN(this),this.g.forEach(function(e,t){hC(e,function(e){n.call(r,e,t,this)},this)},this)},We.T=function(){SN(this);for(var e=this.g.R(),t=this.g.T(),n=[],r=0;r<t.length;r++)for(var i=e[r],s=0;s<i.length;s++)n.push(t[r]);return n},We.R=function(e){SN(this);var t=[];if("string"==typeof e)CN(this,e)&&(t=dC(t,this.g.get(NN(this,e))));else{e=this.g.R();for(var n=0;n<e.length;n++)t=dC(t,e[n])}return t},We.set=function(e,t){return SN(this),this.i=null,CN(this,e=NN(this,e))&&(this.h-=this.g.get(e).length),this.g.set(e,[t]),this.h+=1,this},We.get=function(e,t){return e&&0<(e=this.R(e)).length?String(e[0]):t},We.toString=function(){if(this.i)return this.i;if(!this.g)return"";for(var e=[],t=this.g.T(),n=0;n<t.length;n++)for(var r=t[n],i=encodeURIComponent(String(r)),r=this.R(r),s=0;s<r.length;s++){var o=i;""!==r[s]&&(o+="="+encodeURIComponent(String(r[s]))),e.push(o)}return this.i=e.join("&")};var xN=class{constructor(e,t){this.h=e,this.g=t}};function RN(e){this.l=e||10,e=Jk.PerformanceNavigationTiming?0<(e=Jk.performance.getEntriesByType("navigation")).length&&("hq"==e[0].nextHopProtocol||"h2"==e[0].nextHopProtocol):!!(Jk.g&&Jk.g.Ea&&Jk.g.Ea()&&Jk.g.Ea().Zb),this.j=e?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}var PN;function DN(e){return e.h||e.g&&e.g.size>=e.j}function ON(e){return e.h?1:e.g?e.g.size:0}function MN(e,t){return e.h?e.h==t:e.g&&e.g.has(t)}function LN(e,t){e.g?e.g.add(t):e.h=t}function FN(e,t){e.h&&e.h==t?e.h=null:e.g&&e.g.has(t)&&e.g.delete(t)}function UN(t){if(null!=t.h)return t.i.concat(t.h.D);if(null==t.g||0===t.g.size)return fC(t.i);{let e=t.i;for(const n of t.g.values())e=e.concat(n.D);return e}}function VN(){}function jN(){this.g=new VN}function qN(e,t,n,r,i){try{t.onload=null,t.onerror=null,t.onabort=null,t.ontimeout=null,i(r)}catch(e){}}function BN(e){this.l=e.$b||null,this.j=e.ib||!1}function KN(e,t){sA.call(this),this.D=e,this.u=t,this.m=void 0,this.readyState=$N,this.status=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.v=new Headers,this.h=null,this.C="GET",this.B="",this.g=!1,this.A=this.j=this.l=null}RN.prototype.cancel=function(){if(this.i=UN(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&0!==this.g.size){for(const e of this.g.values())e.cancel();this.g.clear()}},VN.prototype.stringify=function(e){return Jk.JSON.stringify(e,void 0)},VN.prototype.parse=function(e){return Jk.JSON.parse(e,void 0)},aC(BN,MA),BN.prototype.g=function(){return new KN(this.l,this.j)},BN.prototype.i=(PN={},function(){return PN}),aC(KN,sA);var $N=0;function zN(e){e.j.read().then(e.Sa.bind(e)).catch(e.ha.bind(e))}function WN(e){e.readyState=4,e.l=null,e.j=null,e.A=null,GN(e)}function GN(e){e.onreadystatechange&&e.onreadystatechange.call(e)}(We=KN.prototype).open=function(e,t){if(this.readyState!=$N)throw this.abort(),Error("Error reopening a connection");this.C=e,this.B=t,this.readyState=1,GN(this)},We.send=function(e){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");this.g=!0;const t={headers:this.v,method:this.C,credentials:this.m,cache:void 0};e&&(t.body=e),(this.D||Jk).fetch(new Request(this.B,t)).then(this.Va.bind(this),this.ha.bind(this))},We.abort=function(){this.response=this.responseText="",this.v=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted."),1<=this.readyState&&this.g&&4!=this.readyState&&(this.g=!1,WN(this)),this.readyState=$N},We.Va=function(e){if(this.g&&(this.l=e,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=e.headers,this.readyState=2,GN(this)),this.g&&(this.readyState=3,GN(this),this.g)))if("arraybuffer"===this.responseType)e.arrayBuffer().then(this.Ta.bind(this),this.ha.bind(this));else if(void 0!==Jk.ReadableStream&&"body"in e){if(this.j=e.body.getReader(),this.u){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.A=new TextDecoder;zN(this)}else e.text().then(this.Ua.bind(this),this.ha.bind(this))},We.Sa=function(e){var t;this.g&&(this.u&&e.value?this.response.push(e.value):this.u||(t=e.value||new Uint8Array(0),(t=this.A.decode(t,{stream:!e.done}))&&(this.response=this.responseText+=t)),(e.done?WN:GN)(this),3==this.readyState&&zN(this))},We.Ua=function(e){this.g&&(this.response=this.responseText=e,WN(this))},We.Ta=function(e){this.g&&(this.response=e,WN(this))},We.ha=function(){this.g&&WN(this)},We.setRequestHeader=function(e,t){this.v.append(e,t)},We.getResponseHeader=function(e){return this.h&&this.h.get(e.toLowerCase())||""},We.getAllResponseHeaders=function(){if(!this.h)return"";const e=[],t=this.h.entries();for(var n=t.next();!n.done;)n=n.value,e.push(n[0]+": "+n[1]),n=t.next();return e.join("\r\n")},Object.defineProperty(KN.prototype,"withCredentials",{get:function(){return"include"===this.m},set:function(e){this.m=e?"include":"same-origin"}});var HN=Jk.JSON.parse;function QN(e){sA.call(this),this.headers=new iN,this.u=e||null,this.h=!1,this.C=this.g=null,this.H="",this.m=0,this.j="",this.l=this.F=this.v=this.D=!1,this.B=0,this.A=null,this.J=YN,this.K=this.L=!1}aC(QN,sA);var YN="",JN=/^https?$/i,XN=["POST","PUT"];function ZN(e){return"content-type"==e.toLowerCase()}function ex(e,t){e.h=!1,e.g&&(e.l=!0,e.g.abort(),e.l=!1),e.j=t,e.m=5,tx(e),rx(e)}function tx(e){e.D||(e.D=!0,oA(e,"complete"),oA(e,"error"))}function nx(e){if(e.h&&void 0!==Yk&&(!e.C[1]||4!=sx(e)||2!=e.ba()))if(e.v&&4==sx(e))yA(e.Fa,0,e);else if(oA(e,"readystatechange"),4==sx(e)){e.h=!1;try{var t,n,r,i,s=e.ba();e:switch(s){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var o=!0;break e;default:o=!1}if((t=o)||((n=0===s)&&(!(i=String(e.H).match(aN)[1]||null)&&Jk.self&&Jk.self.location&&(i=(r=Jk.self.location.protocol).substr(0,r.length-1)),n=!JN.test(i?i.toLowerCase():"")),t=n),t)oA(e,"complete"),oA(e,"success");else{e.m=6;try{var a=2<sx(e)?e.g.statusText:""}catch(e){a=""}e.j=a+" ["+e.ba()+"]",tx(e)}}finally{rx(e)}}}function rx(e,t){if(e.g){ix(e);const n=e.g,r=e.C[0]?Xk:null;e.g=null,e.C=null,t||oA(e,"ready");try{n.onreadystatechange=r}catch(e){}}}function ix(e){e.g&&e.K&&(e.g.ontimeout=null),e.A&&(Jk.clearTimeout(e.A),e.A=null)}function sx(e){return e.g?e.g.readyState:0}function ox(e){try{if(!e.g)return null;if("response"in e.g)return e.g.response;switch(e.J){case YN:case"text":return e.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in e.g)return e.g.mozResponseArrayBuffer}return null}catch(e){return null}}function ax(e,t,n){e:{for(r in n){var r=!1;break e}r=!0}r||(n=function(e){let n="";return wC(e,function(e,t){n+=t,n+=":",n+=e,n+="\r\n"}),n}(n),"string"==typeof e?null!=n&&encodeURIComponent(String(n)):pN(e,t,n))}function cx(e,t,n){return n&&n.internalChannelParams&&n.internalChannelParams[e]||t}function lx(e){this.za=0,this.l=[],this.h=new EA,this.la=this.oa=this.F=this.W=this.g=this.sa=this.D=this.aa=this.o=this.P=this.s=null,this.Za=this.V=0,this.Xa=cx("failFast",!1,e),this.N=this.v=this.u=this.m=this.j=null,this.X=!0,this.I=this.ta=this.U=-1,this.Y=this.A=this.C=0,this.Pa=cx("baseRetryDelayMs",5e3,e),this.$a=cx("retryDelaySeedMs",1e4,e),this.Ya=cx("forwardChannelMaxRetries",2,e),this.ra=cx("forwardChannelRequestTimeoutMs",2e4,e),this.qa=e&&e.xmlHttpFactory||void 0,this.Ba=e&&e.Yb||!1,this.K=void 0,this.H=e&&e.supportsCrossDomainXhr||!1,this.J="",this.i=new RN(e&&e.concurrentRequestLimit),this.Ca=new jN,this.ja=e&&e.fastHandshake||!1,this.Ra=e&&e.Wb||!1,e&&e.Aa&&this.h.Aa(),e&&e.forceLongPolling&&(this.X=!1),this.$=!this.ja&&this.X&&e&&e.detectBufferingProxy||!1,this.ka=void 0,this.O=0,this.L=!1,this.B=null,this.Wa=!e||!1!==e.Xb}function ux(e){var t,n;dx(e),3==e.G&&(t=e.V++,pN(n=lN(e.F),"SID",e.J),pN(n,"RID",t),pN(n,"TYPE","terminate"),mx(e,n),(t=new qA(e,e.h,t,void 0)).K=2,t.v=gN(lN(n)),n=!1,!(n=Jk.navigator&&Jk.navigator.sendBeacon?Jk.navigator.sendBeacon(t.v.toString(),""):n)&&Jk.Image&&((new Image).src=t.v,n=!0),n||(t.g=Ax(t.l,null),t.g.ea(t.v)),t.F=Date.now(),JA(t)),kx(e)}function hx(e){e.g&&(wx(e),e.g.cancel(),e.g=null)}function dx(e){hx(e),e.u&&(Jk.clearTimeout(e.u),e.u=null),Ix(e),e.i.cancel(),e.m&&("number"==typeof e.m&&Jk.clearTimeout(e.m),e.m=null)}function fx(e,t){e.l.push(new xN(e.Za++,t)),3==e.G&&px(e)}function px(e){DN(e.i)||e.m||(e.m=!0,dA(e.Ha,e),e.C=0)}function gx(e,t){var n=t?t.m:e.V++,r=lN(e.F);pN(r,"SID",e.J),pN(r,"RID",n),pN(r,"AID",e.U),mx(e,r),e.o&&e.s&&ax(r,e.o,e.s),n=new qA(e,e.h,n,e.C+1),null===e.o&&(n.H=e.s),t&&(e.l=t.D.concat(e.l)),t=vx(e,n,1e3),n.setTimeout(Math.round(.5*e.ra)+Math.round(.5*e.ra*Math.random())),LN(e.i,n),GA(n,r,t)}function mx(e,n){e.j&&rN({},function(e,t){pN(n,t,e)})}function vx(e,t,r){r=Math.min(e.l.length,r);var i=e.j?sC(e.j.Oa,e.j,e):null;e:{var s=e.l;let n=-1;for(;;){const c=["count="+r];-1==n?0<r?(n=s[0].h,c.push("ofs="+n)):n=0:c.push("ofs="+n);let e=!0;for(let t=0;t<r;t++){var o=s[t].h,a=s[t].g;if((o-=n)<0)n=Math.max(0,s[t].h-100),e=!1;else try{!function(e,r,t){const i=t||"";try{rN(e,function(e,t){let n=e;eC(e)&&(n=cA(e)),r.push(i+t+"="+encodeURIComponent(n))})}catch(e){throw r.push(i+"type="+encodeURIComponent("_badmap")),e}}(a,c,"req"+o+"_")}catch(e){i&&i(a)}}if(e){i=c.join("&");break e}}}return e=e.l.splice(0,r),t.D=e,i}function yx(e){e.g||e.u||(e.Y=1,dA(e.Ga,e),e.A=0)}function _x(e){return!(e.g||e.u||3<=e.A)&&(e.Y++,e.u=OA(sC(e.Ga,e),Ex(e,e.A)),e.A++,1)}function wx(e){null!=e.B&&(Jk.clearTimeout(e.B),e.B=null)}function bx(e){e.g=new qA(e,e.h,"rpc",e.Y),null===e.o&&(e.g.H=e.s),e.g.O=0;var t=lN(e.oa);pN(t,"RID","rpc"),pN(t,"SID",e.J),pN(t,"CI",e.N?"0":"1"),pN(t,"AID",e.U),mx(e,t),pN(t,"TYPE","xmlhttp"),e.o&&e.s&&ax(t,e.o,e.s),e.K&&e.g.setTimeout(e.K);var n=e.g;e=e.la,n.K=1,n.v=gN(lN(t)),n.s=null,n.U=!0,HA(n,e)}function Ix(e){null!=e.v&&(Jk.clearTimeout(e.v),e.v=null)}function Tx(e,t){var n,r,i,s=null;if(e.g==t){Ix(e),wx(e),e.g=null;var o=2}else{if(!MN(e.i,t))return;s=t.D,FN(e.i,t),o=1}if(e.I=t.N,0!=e.G)if(t.i)1==o?(s=t.s?t.s.length:0,t=Date.now()-t.F,n=e.C,oA(o=AA(),new DA(o,s)),px(e)):yx(e);else if(3==(n=t.o)||0==n&&0<e.I||(1!=o||(i=t,ON((r=e).i)>=r.i.j-(r.m?1:0)||(r.m?(r.l=i.D.concat(r.l),0):1==r.G||2==r.G||r.C>=(r.Xa?0:r.Ya)||(r.m=OA(sC(r.Ha,r,i),Ex(r,r.C)),r.C++,0))))&&(2!=o||!_x(e)))switch(s&&0<s.length&&(t=e.i,t.i=t.i.concat(s)),n){case 1:Sx(e,5);break;case 4:Sx(e,10);break;case 3:Sx(e,6);break;default:Sx(e,2)}}function Ex(e,t){let n=e.Pa+Math.floor(Math.random()*e.$a);return e.j||(n*=2),n*t}function Sx(e,t){var n,r;e.h.info("Error code "+t),2==t?(n=null,e.j&&(n=null),r=sC(e.jb,e),n||(n=new cN("//www.google.com/images/cleardot.gif"),Jk.location&&"http"==Jk.location.protocol||uN(n,"https"),gN(n)),function(e,t){var n=new EA;if(Jk.Image){const r=new Image;r.onload=oC(qN,n,r,"TestLoadImage: loaded",!0,t),r.onerror=oC(qN,n,r,"TestLoadImage: error",!1,t),r.onabort=oC(qN,n,r,"TestLoadImage: abort",!1,t),r.ontimeout=oC(qN,n,r,"TestLoadImage: timeout",!1,t),Jk.setTimeout(function(){r.ontimeout&&r.ontimeout()},1e4),r.src=e}else t(!1)}(n.toString(),r)):PA(2),e.G=0,e.j&&e.j.va(t),kx(e),dx(e)}function kx(e){e.G=0,e.I=-1,e.j&&(0==UN(e.i).length&&0==e.l.length||(e.i.i.length=0,fC(e.l),e.l.length=0),e.j.ua())}function Cx(e,t,n){let r=(a=n)instanceof cN?lN(a):new cN(a,void 0);var i,s,o,a,c;return""!=r.i?(t&&hN(r,t+"."+r.i),dN(r,r.m)):(c=Jk.location,r=(i=c.protocol,s=t?t+"."+c.hostname:c.hostname,o=+c.port,a=n,c=new cN(null,void 0),i&&uN(c,i),s&&hN(c,s),o&&dN(c,o),a&&(c.l=a),c)),e.aa&&wC(e.aa,function(e,t){pN(r,t,e)}),t=e.D,n=e.sa,t&&n&&pN(r,t,n),pN(r,"VER",e.ma),mx(e,r),r}function Ax(e,t,n){if(t&&!e.H)throw Error("Can't create secondary domain capable XhrIo object.");return(t=n&&e.Ba&&!e.qa?new QN(new BN({ib:!0})):new QN(e.qa)).L=e.H,t}function Nx(){}function xx(){if(CC&&!(10<=Number(FC)))throw Error("Environmental error: no available transport.")}function Rx(e,t){sA.call(this),this.g=new lx(t),this.l=e,this.h=t&&t.messageUrlParams||null,e=t&&t.messageHeaders||null,t&&t.clientProtocolHeaderRequired&&(e?e["X-Client-Protocol"]="webchannel":e={"X-Client-Protocol":"webchannel"}),this.g.s=e,e=t&&t.initMessageHeaders||null,t&&t.messageContentType&&(e?e["X-WebChannel-Content-Type"]=t.messageContentType:e={"X-WebChannel-Content-Type":t.messageContentType}),t&&t.ya&&(e?e["X-WebChannel-Client-Profile"]=t.ya:e={"X-WebChannel-Client-Profile":t.ya}),this.g.P=e,(e=t&&t.httpHeadersOverwriteParam)&&!pC(e)&&(this.g.o=e),this.A=t&&t.supportsCrossDomainXhr||!1,this.v=t&&t.sendRawJson||!1,(t=t&&t.httpSessionIdParam)&&!pC(t)&&(this.g.D=t,null!==(e=this.h)&&t in e&&(t in(e=this.h)&&delete e[t])),this.j=new Ox(this)}function Px(e){UA.call(this);var t=e.__sm__;if(t){e:{for(const n in t){e=n;break e}e=void 0}(this.i=e)&&(e=this.i,t=null!==t&&e in t?t[e]:void 0),this.data=t}else this.data=e}function Dx(){VA.call(this),this.status=1}function Ox(e){this.g=e}(We=QN.prototype).ea=function(e,t,n,r){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.H+"; newUri="+e);t=t?t.toUpperCase():"GET",this.H=e,this.j="",this.m=0,this.D=!1,this.h=!0,this.g=(this.u||KA).g(),this.C=this.u?LA(this.u):LA(KA),this.g.onreadystatechange=sC(this.Fa,this);try{this.F=!0,this.g.open(t,String(e),!0),this.F=!1}catch(e){return void ex(this,e)}e=n||"";const i=new iN(this.headers);r&&rN(r,function(e,t){i.set(t,e)}),r=function(t){e:{var n=ZN,r=t.length,i="string"==typeof t?t.split(""):t;for(let e=0;e<r;e++)if(e in i&&n.call(void 0,i[e],e,t)){n=e;break e}n=-1}return n<0?null:"string"==typeof t?t.charAt(n):t[n]}(i.T()),n=Jk.FormData&&e instanceof Jk.FormData,0<=uC(XN,t)&&!r&&!n&&i.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8"),i.forEach(function(e,t){this.g.setRequestHeader(t,e)},this),this.J&&(this.g.responseType=this.J),"withCredentials"in this.g&&this.g.withCredentials!==this.L&&(this.g.withCredentials=this.L);try{ix(this),0<this.B&&((this.K=(s=this.g,CC&&LC()&&"number"==typeof s.timeout&&void 0!==s.ontimeout))?(this.g.timeout=this.B,this.g.ontimeout=sC(this.pa,this)):this.A=yA(this.pa,this.B,this)),this.v=!0,this.g.send(e),this.v=!1}catch(e){ex(this,e)}var s},We.pa=function(){void 0!==Yk&&this.g&&(this.j="Timed out after "+this.B+"ms, aborting",this.m=8,oA(this,"timeout"),this.abort(8))},We.abort=function(e){this.g&&this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1,this.m=e||7,oA(this,"complete"),oA(this,"abort"),rx(this))},We.M=function(){this.g&&(this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1),rx(this,!0)),QN.Z.M.call(this)},We.Fa=function(){this.s||(this.F||this.v||this.l?nx(this):this.cb())},We.cb=function(){nx(this)},We.ba=function(){try{return 2<sx(this)?this.g.status:-1}catch(e){return-1}},We.ga=function(){try{return this.g?this.g.responseText:""}catch(e){return""}},We.Qa=function(e){if(this.g){var t=this.g.responseText;return e&&0==t.indexOf(e)&&(t=t.substring(e.length)),HN(t)}},We.Da=function(){return this.m},We.La=function(){return"string"==typeof this.j?this.j:String(this.j)},(We=lx.prototype).ma=8,We.G=1,We.hb=function(e){try{this.h.info("Origin Trials invoked: "+e)}catch(e){}},We.Ha=function(t){if(this.m)if(this.m=null,1==this.G){if(!t){this.V=Math.floor(1e5*Math.random()),t=this.V++;const s=new qA(this,this.h,t,void 0);let e=this.s;if(this.P&&(e?(e=bC(e),TC(e,this.P)):e=this.P),null===this.o&&(s.H=e),this.ja)e:{for(var n=0,r=0;r<this.l.length;r++){var i=this.l[r];if("__data__"in i.g&&"string"==typeof(i=i.g.__data__)?i=i.length:i=void 0,void 0===i)break;if(4096<(n+=i)){n=r;break e}if(4096===n||r===this.l.length-1){n=r+1;break e}}n=1e3}else n=1e3;n=vx(this,s,n),pN(r=lN(this.F),"RID",t),pN(r,"CVER",22),this.D&&pN(r,"X-HTTP-Session-Id",this.D),mx(this,r),this.o&&e&&ax(r,this.o,e),LN(this.i,s),this.Ra&&pN(r,"TYPE","init"),this.ja?(pN(r,"$req",n),pN(r,"SID","null"),s.$=!0,GA(s,r,null)):GA(s,r,n),this.G=2}}else 3==this.G&&(t?gx(this,t):0==this.l.length||DN(this.i)||gx(this))},We.Ga=function(){var e;this.u=null,bx(this),this.$&&!(this.L||null==this.g||this.O<=0)&&(e=2*this.O,this.h.info("BP detection timer enabled: "+e),this.B=OA(sC(this.bb,this),e))},We.bb=function(){this.B&&(this.B=null,this.h.info("BP detection timeout reached."),this.h.info("Buffering proxy detected and switch to long-polling!"),this.N=!1,this.L=!0,PA(10),hx(this),bx(this))},We.ab=function(){null!=this.v&&(this.v=null,hx(this),_x(this),PA(19))},We.jb=function(e){e?(this.h.info("Successfully pinged google.com"),PA(2)):(this.h.info("Failed to ping google.com"),PA(1))},(We=Nx.prototype).xa=function(){},We.wa=function(){},We.va=function(){},We.ua=function(){},We.Oa=function(){},xx.prototype.g=function(e,t){return new Rx(e,t)},aC(Rx,sA),Rx.prototype.m=function(){this.g.j=this.j,this.A&&(this.g.H=!0);var e=this.g,t=this.l,n=this.h||void 0;e.Wa&&(e.h.info("Origin Trials enabled."),dA(sC(e.hb,e,t))),PA(0),e.W=t,e.aa=n||{},e.N=e.X,e.F=Cx(e,null,e.W),px(e)},Rx.prototype.close=function(){ux(this.g)},Rx.prototype.u=function(e){var t;"string"==typeof e?((t={}).__data__=e,fx(this.g,t)):this.v?((t={}).__data__=cA(e),fx(this.g,t)):fx(this.g,e)},Rx.prototype.M=function(){this.g.j=null,delete this.j,ux(this.g),delete this.g,Rx.Z.M.call(this)},aC(Px,UA),aC(Dx,VA),aC(Ox,Nx),Ox.prototype.xa=function(){oA(this.g,"a")},Ox.prototype.wa=function(e){oA(this.g,new Px(e))},Ox.prototype.va=function(e){oA(this.g,new Dx)},Ox.prototype.ua=function(){oA(this.g,"b")},xx.prototype.createWebChannel=xx.prototype.g,Rx.prototype.send=Rx.prototype.u,Rx.prototype.open=Rx.prototype.m,c.NO_ERROR=0,c.TIMEOUT=8,c.HTTP_ERROR=6,yt.COMPLETE="complete",(FA.EventType=l).OPEN="a",l.CLOSE="b",l.ERROR="c",l.MESSAGE="d",sA.prototype.listen=sA.prototype.N,QN.prototype.listenOnce=QN.prototype.O,QN.prototype.getLastError=QN.prototype.La,QN.prototype.getLastErrorCode=QN.prototype.Da,QN.prototype.getStatus=QN.prototype.ba,QN.prototype.getResponseJson=QN.prototype.Qa,QN.prototype.getResponseText=QN.prototype.ga,QN.prototype.send=QN.prototype.ea;var Mx,Lx=AA,Fx=c,Ux=yt,Vx=kA,jx=10,qx=11,Bx=BN,Kx=FA,$x=QN;const zx="@firebase/firestore";class Wx{constructor(e){this.uid=e}isAuthenticated(){return null!=this.uid}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}Wx.UNAUTHENTICATED=new Wx(null),Wx.GOOGLE_CREDENTIALS=new Wx("google-credentials-uid"),Wx.FIRST_PARTY=new Wx("first-party-uid"),Wx.MOCK_USER=new Wx("mock-user");let Gx="9.9.1";const Hx=new nf("@firebase/firestore");function Qx(){return Hx.logLevel}function Yx(e,...t){var n;Hx.logLevel<=$h.DEBUG&&(n=t.map(Zx),Hx.debug(`Firestore (${Gx}): ${e}`,...n))}function Jx(e,...t){var n;Hx.logLevel<=$h.ERROR&&(n=t.map(Zx),Hx.error(`Firestore (${Gx}): ${e}`,...n))}function Xx(e,...t){var n;Hx.logLevel<=$h.WARN&&(n=t.map(Zx),Hx.warn(`Firestore (${Gx}): ${e}`,...n))}function Zx(t){if("string"==typeof t)return t;try{return JSON.stringify(t)}catch(e){return t}}function eR(e="Unexpected state"){var t=`FIRESTORE (${Gx}) INTERNAL ASSERTION FAILED: `+e;throw Jx(t),new Error(t)}function tR(e){e||eR()}const nR={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class rR extends md{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}class iR{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}}class sR{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class oR{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(Wx.UNAUTHENTICATED))}shutdown(){}}class aR{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}}class cR{constructor(e){this.t=e,this.currentUser=Wx.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(t,n){let r=this.i;const i=e=>this.i!==r?(r=this.i,n(e)):Promise.resolve();let s=new iR;this.o=()=>{this.i++,this.currentUser=this.u(),s.resolve(),s=new iR,t.enqueueRetryable(()=>i(this.currentUser))};const o=()=>{const e=s;t.enqueueRetryable(async()=>{await e.promise,await i(this.currentUser)})},a=e=>{Yx("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=e,this.auth.addAuthTokenListener(this.o),o()};this.t.onInit(e=>a(e)),setTimeout(()=>{var e;this.auth||((e=this.t.getImmediate({optional:!0}))?a(e):(Yx("FirebaseAuthCredentialsProvider","Auth not yet detected"),s.resolve(),s=new iR))},0),o()}getToken(){const t=this.i,e=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(e).then(e=>this.i!==t?(Yx("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):e?(tR("string"==typeof e.accessToken),new sR(e.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.auth.removeAuthTokenListener(this.o)}u(){var e=this.auth&&this.auth.getUid();return tR(null===e||"string"==typeof e),new Wx(e)}}class lR{constructor(e,t,n){this.type="FirstParty",this.user=Wx.FIRST_PARTY,this.headers=new Map,this.headers.set("X-Goog-AuthUser",t);var r=e.auth.getAuthHeaderValueForFirstParty([]);r&&this.headers.set("Authorization",r),n&&this.headers.set("X-Goog-Iam-Authorization-Token",n)}}class uR{constructor(e,t,n){this.h=e,this.l=t,this.m=n}getToken(){return Promise.resolve(new lR(this.h,this.l,this.m))}start(e,t){e.enqueueRetryable(()=>t(Wx.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class hR{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&0<e.length&&this.headers.set("x-firebase-appcheck",this.value)}}class dR{constructor(e){this.g=e,this.forceRefresh=!1,this.appCheck=null,this.p=null}start(t,n){const r=e=>{null!=e.error&&Yx("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${e.error.message}`);var t=e.token!==this.p;return this.p=e.token,Yx("FirebaseAppCheckTokenProvider",`Received ${t?"new":"existing"} token.`),t?n(e.token):Promise.resolve()};this.o=e=>{t.enqueueRetryable(()=>r(e))};const i=e=>{Yx("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=e,this.appCheck.addTokenListener(this.o)};this.g.onInit(e=>i(e)),setTimeout(()=>{var e;this.appCheck||((e=this.g.getImmediate({optional:!0}))?i(e):Yx("FirebaseAppCheckTokenProvider","AppCheck not yet detected"))},0)}getToken(){var e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(e=>e?(tR("string"==typeof e.token),this.p=e.token,new hR(e.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.appCheck.removeTokenListener(this.o)}}class fR{static I(){var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",n=Math.floor(256/t.length)*t.length;let r="";for(;r.length<20;){var i=function(t){const n="undefined"!=typeof self&&(self.crypto||self.msCrypto),r=new Uint8Array(t);if(n&&"function"==typeof n.getRandomValues)n.getRandomValues(r);else for(let e=0;e<t;e++)r[e]=Math.floor(256*Math.random());return r}(40);for(let e=0;e<i.length;++e)r.length<20&&i[e]<n&&(r+=t.charAt(i[e]%t.length))}return r}}function pR(e,t){return e<t?-1:t<e?1:0}function gR(e,n,r){return e.length===n.length&&e.every((e,t)=>r(e,n[t]))}function mR(e){return e+"\0"}class vR{constructor(e,t){if(this.seconds=e,(this.nanoseconds=t)<0)throw new rR(nR.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(1e9<=t)throw new rR(nR.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<-62135596800)throw new rR(nR.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(253402300800<=e)throw new rR(nR.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}static now(){return vR.fromMillis(Date.now())}static fromDate(e){return vR.fromMillis(e.getTime())}static fromMillis(e){var t=Math.floor(e/1e3),n=Math.floor(1e6*(e-1e3*t));return new vR(t,n)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(e){return this.seconds===e.seconds?pR(this.nanoseconds,e.nanoseconds):pR(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){var e=this.seconds- -62135596800;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}class yR{constructor(e){this.timestamp=e}static fromTimestamp(e){return new yR(e)}static min(){return new yR(new vR(0,0))}static max(){return new yR(new vR(253402300799,999999999))}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}class _R{constructor(e,t,n){void 0===t?t=0:t>e.length&&eR(),void 0===n?n=e.length-t:n>e.length-t&&eR(),this.segments=e,this.offset=t,this.len=n}get length(){return this.len}isEqual(e){return 0===_R.comparator(this,e)}child(e){const t=this.segments.slice(this.offset,this.limit());return e instanceof _R?e.forEach(e=>{t.push(e)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return this.construct(this.segments,this.offset+(e=void 0===e?1:e),this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return 0===this.length}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,n=this.limit();t<n;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){const n=Math.min(e.length,t.length);for(let r=0;r<n;r++){const n=e.get(r),i=t.get(r);if(n<i)return-1;if(n>i)return 1}return e.length<t.length?-1:e.length>t.length?1:0}}class wR extends _R{construct(e,t,n){return new wR(e,t,n)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}static fromString(...e){const t=[];for(const n of e){if(0<=n.indexOf("//"))throw new rR(nR.INVALID_ARGUMENT,`Invalid segment (${n}). Paths must not contain // in them.`);t.push(...n.split("/").filter(e=>0<e.length))}return new wR(t)}static emptyPath(){return new wR([])}}const bR=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class IR extends _R{construct(e,t,n){return new IR(e,t,n)}static isValidIdentifier(e){return bR.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),e=!IR.isValidIdentifier(e)?"`"+e+"`":e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return 1===this.length&&"__name__"===this.get(0)}static keyField(){return new IR(["__name__"])}static fromServerFormat(e){const t=[];let n="",r=0;var i=()=>{if(0===n.length)throw new rR(nR.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(n),n=""};let s=!1;for(;r<e.length;){const t=e[r];if("\\"===t){if(r+1===e.length)throw new rR(nR.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const t=e[r+1];if("\\"!==t&&"."!==t&&"`"!==t)throw new rR(nR.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);n+=t,r+=2}else"`"===t?s=!s:"."!==t||s?n+=t:i(),r++}if(i(),s)throw new rR(nR.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new IR(t)}static emptyPath(){return new IR([])}}class TR{constructor(e){this.path=e}static fromPath(e){return new TR(wR.fromString(e))}static fromName(e){return new TR(wR.fromString(e).popFirst(5))}static empty(){return new TR(wR.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return 2<=this.path.length&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return null!==e&&0===wR.comparator(this.path,e.path)}toString(){return this.path.toString()}static comparator(e,t){return wR.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new TR(new wR(e.slice()))}}class ER{constructor(e,t,n,r){this.indexId=e,this.collectionGroup=t,this.fields=n,this.indexState=r}}function SR(e){return e.fields.find(e=>2===e.kind)}function kR(e){return e.fields.filter(e=>2!==e.kind)}ER.UNKNOWN_ID=-1;class CR{constructor(e,t){this.fieldPath=e,this.kind=t}}class AR{constructor(e,t){this.sequenceNumber=e,this.offset=t}static empty(){return new AR(0,RR.min())}}function NR(e,t){var n=e.toTimestamp().seconds,r=e.toTimestamp().nanoseconds+1,r=yR.fromTimestamp(1e9===r?new vR(n+1,0):new vR(n,r));return new RR(r,TR.empty(),t)}function xR(e){return new RR(e.readTime,e.key,-1)}class RR{constructor(e,t,n){this.readTime=e,this.documentKey=t,this.largestBatchId=n}static min(){return new RR(yR.min(),TR.empty(),-1)}static max(){return new RR(yR.max(),TR.empty(),-1)}}function PR(e,t){let n=e.readTime.compareTo(t.readTime);return 0!==n?n:(n=TR.comparator(e.documentKey,t.documentKey),0!==n?n:pR(e.largestBatchId,t.largestBatchId))}const DR="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class OR{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}async function MR(e){if(e.code!==nR.FAILED_PRECONDITION||e.message!==DR)throw e;Yx("LocalStore","Unexpectedly lost primary lease")}class LR{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(e=>{this.isDone=!0,this.result=e,this.nextCallback&&this.nextCallback(e)},e=>{this.isDone=!0,this.error=e,this.catchCallback&&this.catchCallback(e)})}catch(e){return this.next(void 0,e)}next(r,i){return this.callbackAttached&&eR(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(i,this.error):this.wrapSuccess(r,this.result):new LR((t,n)=>{this.nextCallback=e=>{this.wrapSuccess(r,e).next(t,n)},this.catchCallback=e=>{this.wrapFailure(i,e).next(t,n)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{var t=e();return t instanceof LR?t:LR.resolve(t)}catch(e){return LR.reject(e)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):LR.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):LR.reject(t)}static resolve(n){return new LR((e,t)=>{e(n)})}static reject(n){return new LR((e,t)=>{t(n)})}static waitFor(e){return new LR((t,n)=>{let r=0,i=0,s=!1;e.forEach(e=>{++r,e.next(()=>{++i,s&&i===r&&t()},e=>n(e))}),s=!0,i===r&&t()})}static or(e){let t=LR.resolve(!1);for(const n of e)t=t.next(e=>e?LR.resolve(e):n());return t}static forEach(e,n){const r=[];return e.forEach((e,t)=>{r.push(n.call(this,e,t))}),this.waitFor(r)}static mapArray(a,c){return new LR((t,n)=>{const r=a.length,i=new Array(r);let s=0;for(let e=0;e<r;e++){const o=e;c(a[o]).next(e=>{i[o]=e,++s,s===r&&t(i)},e=>n(e))}})}static doWhile(r,i){return new LR((e,t)=>{const n=()=>{!0===r()?i().next(()=>{n()},t):e()};n()})}}class FR{constructor(n,e){this.action=n,this.transaction=e,this.aborted=!1,this.T=new iR,this.transaction.oncomplete=()=>{this.T.resolve()},this.transaction.onabort=()=>{e.error?this.T.reject(new jR(n,e.error)):this.T.resolve()},this.transaction.onerror=e=>{var t=zR(e.target.error);this.T.reject(new jR(n,t))}}static open(e,t,n,r){try{return new FR(t,e.transaction(r,n))}catch(e){throw new jR(t,e)}}get A(){return this.T.promise}abort(e){e&&this.T.reject(e),this.aborted||(Yx("SimpleDb","Aborting transaction:",e?e.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}R(){const e=this.transaction;this.aborted||"function"!=typeof e.commit||e.commit()}store(e){var t=this.transaction.objectStore(e);return new BR(t)}}class UR{constructor(e,t,n){this.name=e,this.version=t,this.P=n,12.2===UR.v(od())&&Jx("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}static delete(e){return Yx("SimpleDb","Removing database:",e),KR(window.indexedDB.deleteDatabase(e)).toPromise()}static V(){if(!fd())return!1;if(UR.S())return!0;const e=od(),t=UR.v(e),n=0<t&&t<10,r=UR.D(e),i=0<r&&r<4.5;return!(0<e.indexOf("MSIE ")||0<e.indexOf("Trident/")||0<e.indexOf("Edge/")||n||i)}static S(){var e;return"undefined"!=typeof process&&"YES"===(null===(e=process.env)||void 0===e?void 0:e.C)}static N(e,t){return e.store(t)}static v(e){const t=e.match(/i(?:phone|pad|pod) os ([\d_]+)/i),n=t?t[1].split("_").slice(0,2).join("."):"-1";return Number(n)}static D(e){const t=e.match(/Android ([\d.]+)/i),n=t?t[1].split(".").slice(0,2).join("."):"-1";return Number(n)}async k(s){return this.db||(Yx("SimpleDb","Opening database:",this.name),this.db=await new Promise((n,r)=>{const i=indexedDB.open(this.name,this.version);i.onsuccess=e=>{var t=e.target.result;n(t)},i.onblocked=()=>{r(new jR(s,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},i.onerror=e=>{var t=e.target.error;"VersionError"===t.name?r(new rR(nR.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):"InvalidStateError"===t.name?r(new rR(nR.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+t)):r(new jR(s,t))},i.onupgradeneeded=e=>{Yx("SimpleDb",'Database "'+this.name+'" requires upgrade from version:',e.oldVersion);var t=e.target.result;this.P.O(t,i.transaction,e.oldVersion,this.version).next(()=>{Yx("SimpleDb","Database upgrade to version "+this.version+" complete")})}})),this.M&&(this.db.onversionchange=e=>this.M(e)),this.db}F(t){this.M=t,this.db&&(this.db.onversionchange=e=>t(e))}async runTransaction(e,t,n,r){var i="readonly"===t;let s=0;for(;;){++s;try{this.db=await this.k(e);const t=FR.open(this.db,e,i?"readonly":"readwrite",n),s=r(t).next(e=>(t.R(),e)).catch(e=>(t.abort(e),LR.reject(e))).toPromise();return s.catch(()=>{}),await t.A,s}catch(e){const t=e,n="FirebaseError"!==t.name&&s<3;if(Yx("SimpleDb","Transaction failed with error:",t.message,"Retrying:",n),this.close(),!n)return Promise.reject(t)}}}close(){this.db&&this.db.close(),this.db=void 0}}class VR{constructor(e){this.$=e,this.B=!1,this.L=null}get isDone(){return this.B}get U(){return this.L}set cursor(e){this.$=e}done(){this.B=!0}q(e){this.L=e}delete(){return KR(this.$.delete())}}class jR extends rR{constructor(e,t){super(nR.UNAVAILABLE,`IndexedDB transaction '${e}' failed: ${t}`),this.name="IndexedDbTransactionError"}}function qR(e){return"IndexedDbTransactionError"===e.name}class BR{constructor(e){this.store=e}put(e,t){let n;return n=void 0!==t?(Yx("SimpleDb","PUT",this.store.name,e,t),this.store.put(t,e)):(Yx("SimpleDb","PUT",this.store.name,"<auto-key>",e),this.store.put(e)),KR(n)}add(e){return Yx("SimpleDb","ADD",this.store.name,e,e),KR(this.store.add(e))}get(t){return KR(this.store.get(t)).next(e=>(Yx("SimpleDb","GET",this.store.name,t,e=void 0===e?null:e),e))}delete(e){return Yx("SimpleDb","DELETE",this.store.name,e),KR(this.store.delete(e))}count(){return Yx("SimpleDb","COUNT",this.store.name),KR(this.store.count())}K(e,n){var t=this.options(e,n);if(t.index||"function"!=typeof this.store.getAll){const e=this.cursor(t),n=[];return this.G(e,(e,t)=>{n.push(t)}).next(()=>n)}{const e=this.store.getAll(t.range);return new LR((t,n)=>{e.onerror=e=>{n(e.target.error)},e.onsuccess=e=>{t(e.target.result)}})}}j(e,t){const r=this.store.getAll(e,null===t?void 0:t);return new LR((t,n)=>{r.onerror=e=>{n(e.target.error)},r.onsuccess=e=>{t(e.target.result)}})}W(e,t){Yx("SimpleDb","DELETE ALL",this.store.name);const n=this.options(e,t);n.H=!1;var r=this.cursor(n);return this.G(r,(e,t,n)=>n.delete())}J(e,t){let n;t?n=e:(n={},t=e);var r=this.cursor(n);return this.G(r,t)}Y(i){const e=this.cursor({});return new LR((n,r)=>{e.onerror=e=>{var t=zR(e.target.error);r(t)},e.onsuccess=e=>{const t=e.target.result;t?i(t.primaryKey,t.value).next(e=>{e?t.continue():n()}):n()}})}G(e,s){const o=[];return new LR((i,t)=>{e.onerror=e=>{t(e.target.error)},e.onsuccess=e=>{const t=e.target.result;if(t){const n=new VR(t),r=s(t.primaryKey,t.value,n);if(r instanceof LR){const e=r.catch(e=>(n.done(),LR.reject(e)));o.push(e)}n.isDone?i():null===n.U?t.continue():t.continue(n.U)}else i()}}).next(()=>LR.waitFor(o))}options(e,t){let n;return void 0!==e&&("string"==typeof e?n=e:t=e),{index:n,range:t}}cursor(e){let t="next";if(e.reverse&&(t="prev"),e.index){const n=this.store.index(e.index);return e.H?n.openKeyCursor(e.range,t):n.openCursor(e.range,t)}return this.store.openCursor(e.range,t)}}function KR(e){return new LR((n,r)=>{e.onsuccess=e=>{var t=e.target.result;n(t)},e.onerror=e=>{var t=zR(e.target.error);r(t)}})}let $R=!1;function zR(e){const t=UR.v(od());if(12.2<=t&&t<13){const t="An internal error was encountered in the Indexed Database server";if(0<=e.message.indexOf(t)){const e=new rR("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${t}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return $R||($R=!0,setTimeout(()=>{throw e},0)),e}}return e}class WR{constructor(e,t){this.asyncQueue=e,this.X=t,this.task=null}start(){}stop(){this.task&&(this.task.cancel(),this.task=null)}get started(){return null!==this.task}Z(e){Yx("IndexBackiller",`Scheduled in ${e}ms`),this.task=this.asyncQueue.enqueueAfterDelay("index_backfill",e,async()=>{this.task=null;try{Yx("IndexBackiller",`Documents written: ${await this.X.tt()}`)}catch(e){qR(e)?Yx("IndexBackiller","Ignoring IndexedDB error during index backfill: ",e):await MR(e)}await this.Z(1)})}}class GR{constructor(e,t){this.localStore=e,this.persistence=t}async tt(t=50){return this.persistence.runTransaction("Backfill Indexes","readwrite-primary",e=>this.et(e,t))}et(e,t){const n=new Set;let r=t,i=!0;return LR.doWhile(()=>!0===i&&0<r,()=>this.localStore.indexManager.getNextCollectionGroupToUpdate(e).next(t=>null===t||n.has(t)?void(i=!1):(Yx("IndexBackiller",`Processing collection: ${t}`),this.nt(e,t,r).next(e=>{r-=e,n.add(t)})))).next(()=>t-r)}nt(r,i,e){return this.localStore.indexManager.getMinOffsetFromCollectionGroup(r,i).next(n=>this.localStore.localDocuments.getNextDocuments(r,i,n,e).next(e=>{const t=e.changes;return this.localStore.indexManager.updateIndexEntries(r,t).next(()=>this.st(n,e)).next(e=>(Yx("IndexBackiller",`Updating offset: ${e}`),this.localStore.indexManager.updateCollectionGroup(r,i,e))).next(()=>t.size)}))}st(e,t){let r=e;return t.changes.forEach((e,t)=>{var n=xR(t);0<PR(n,r)&&(r=n)}),new RR(r.readTime,r.documentKey,Math.max(t.batchId,e.largestBatchId))}}class HR{constructor(e,t){this.previousValue=e,t&&(t.sequenceNumberHandler=e=>this.it(e),this.rt=e=>t.writeSequenceNumber(e))}it(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){var e=++this.previousValue;return this.rt&&this.rt(e),e}}function QR(e){let t=0;for(const n in e)Object.prototype.hasOwnProperty.call(e,n)&&t++;return t}function YR(e,t){for(const n in e)Object.prototype.hasOwnProperty.call(e,n)&&t(n,e[n])}function JR(e){for(const t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}HR.ot=-1;class XR{constructor(e,t){this.comparator=e,this.root=t||eP.EMPTY}insert(e,t){return new XR(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,eP.BLACK,null,null))}remove(e){return new XR(this.comparator,this.root.remove(e,this.comparator).copy(null,null,eP.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){var n=this.comparator(e,t.key);if(0===n)return t.value;n<0?t=t.left:0<n&&(t=t.right)}return null}indexOf(e){let t=0,n=this.root;for(;!n.isEmpty();){var r=this.comparator(e,n.key);if(0===r)return t+n.left.size;n=r<0?n.left:(t+=n.left.size+1,n.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(n){this.inorderTraversal((e,t)=>(n(e,t),!1))}toString(){const n=[];return this.inorderTraversal((e,t)=>(n.push(`${e}:${t}`),!1)),`{${n.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new ZR(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new ZR(this.root,e,this.comparator,!1)}getReverseIterator(){return new ZR(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new ZR(this.root,e,this.comparator,!0)}}class ZR{constructor(e,t,n,r){this.isReverse=r,this.nodeStack=[];let i=1;for(;!e.isEmpty();)if(i=t?n(e.key,t):1,t&&r&&(i*=-1),i<0)e=this.isReverse?e.left:e.right;else{if(0===i){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();var t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return 0<this.nodeStack.length}peek(){if(0===this.nodeStack.length)return null;var e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class eP{constructor(e,t,n,r,i){this.key=e,this.value=t,this.color=null!=n?n:eP.RED,this.left=null!=r?r:eP.EMPTY,this.right=null!=i?i:eP.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,n,r,i){return new eP(null!=e?e:this.key,null!=t?t:this.value,null!=n?n:this.color,null!=r?r:this.left,null!=i?i:this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,n){let r=this;var i=n(e,r.key);return r=i<0?r.copy(null,null,null,r.left.insert(e,t,n),null):0===i?r.copy(null,t,null,null,null):r.copy(null,null,null,null,r.right.insert(e,t,n)),r.fixUp()}removeMin(){if(this.left.isEmpty())return eP.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let n,r=this;if(t(e,r.key)<0)r.left.isEmpty()||r.left.isRed()||r.left.left.isRed()||(r=r.moveRedLeft()),r=r.copy(null,null,null,r.left.remove(e,t),null);else{if(r.left.isRed()&&(r=r.rotateRight()),r.right.isEmpty()||r.right.isRed()||r.right.left.isRed()||(r=r.moveRedRight()),0===t(e,r.key)){if(r.right.isEmpty())return eP.EMPTY;n=r.right.min(),r=r.copy(n.key,n.value,null,null,r.right.removeMin())}r=r.copy(null,null,null,null,r.right.remove(e,t))}return r.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){var e=this.copy(null,null,eP.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){var e=this.copy(null,null,eP.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){var e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){var e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw eR();if(this.right.isRed())throw eR();var e=this.left.check();if(e!==this.right.check())throw eR();return e+(this.isRed()?0:1)}}eP.EMPTY=null,eP.RED=!0,eP.BLACK=!1,eP.EMPTY=new class{constructor(){this.size=0}get key(){throw eR()}get value(){throw eR()}get color(){throw eR()}get left(){throw eR()}get right(){throw eR()}copy(e,t,n,r,i){return this}insert(e,t,n){return new eP(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class tP{constructor(e){this.comparator=e,this.data=new XR(this.comparator)}has(e){return null!==this.data.get(e)}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(n){this.data.inorderTraversal((e,t)=>(n(e),!1))}forEachInRange(e,t){const n=this.data.getIteratorFrom(e[0]);for(;n.hasNext();){var r=n.getNext();if(0<=this.comparator(r.key,e[1]))return;t(r.key)}}forEachWhile(e,t){let n;for(n=void 0!==t?this.data.getIteratorFrom(t):this.data.getIterator();n.hasNext();)if(!e(n.getNext().key))return}firstAfterOrEqual(e){const t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new nP(this.data.getIterator())}getIteratorFrom(e){return new nP(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(e=>{t=t.add(e)}),t}isEqual(e){if(!(e instanceof tP))return!1;if(this.size!==e.size)return!1;const t=this.data.getIterator(),n=e.data.getIterator();for(;t.hasNext();){const e=t.getNext().key,r=n.getNext().key;if(0!==this.comparator(e,r))return!1}return!0}toArray(){const t=[];return this.forEach(e=>{t.push(e)}),t}toString(){const t=[];return this.forEach(e=>t.push(e)),"SortedSet("+t.toString()+")"}copy(e){const t=new tP(this.comparator);return t.data=e,t}}class nP{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}function rP(e){return e.hasNext()?e.getNext():void 0}class iP{constructor(e){(this.fields=e).sort(IR.comparator)}static empty(){return new iP([])}unionWith(e){let t=new tP(IR.comparator);for(const e of this.fields)t=t.add(e);for(const n of e)t=t.add(n);return new iP(t.toArray())}covers(e){for(const t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return gR(this.fields,e.fields,(e,t)=>e.isEqual(t))}}class sP{constructor(e){this.binaryString=e}static fromBase64String(e){var t=atob(e);return new sP(t)}static fromUint8Array(e){var t=function(e){let t="";for(let n=0;n<e.length;++n)t+=String.fromCharCode(e[n]);return t}(e);return new sP(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return e=this.binaryString,btoa(e);var e}toUint8Array(){return function(e){const t=new Uint8Array(e.length);for(let n=0;n<e.length;n++)t[n]=e.charCodeAt(n);return t}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return pR(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}sP.EMPTY_BYTE_STRING=new sP("");const oP=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function aP(t){if(tR(!!t),"string"!=typeof t)return{seconds:cP(t.seconds),nanos:cP(t.nanos)};{let e=0;var n=oP.exec(t);tR(!!n),n[1]&&(n=((n=n[1])+"000000000").substr(0,9),e=Number(n));const r=new Date(t);return{seconds:Math.floor(r.getTime()/1e3),nanos:e}}}function cP(e){return"number"==typeof e?e:"string"==typeof e?Number(e):0}function lP(e){return"string"==typeof e?sP.fromBase64String(e):sP.fromUint8Array(e)}function uP(e){var t;return"server_timestamp"===(null===(t=((null===(t=null==e?void 0:e.mapValue)||void 0===t?void 0:t.fields)||{}).__type__)||void 0===t?void 0:t.stringValue)}function hP(e){var t=aP(e.mapValue.fields.__local_write_time__.timestampValue);return new vR(t.seconds,t.nanos)}class dP{constructor(e,t,n,r,i,s,o,a){this.databaseId=e,this.appId=t,this.persistenceKey=n,this.host=r,this.ssl=i,this.forceLongPolling=s,this.autoDetectLongPolling=o,this.useFetchStreams=a}}class fP{constructor(e,t){this.projectId=e,this.database=t||"(default)"}static empty(){return new fP("","")}get isDefaultDatabase(){return"(default)"===this.database}isEqual(e){return e instanceof fP&&e.projectId===this.projectId&&e.database===this.database}}function pP(e){return null==e}function gP(e){return 0===e&&1/e==-1/0}function mP(e){return"number"==typeof e&&Number.isInteger(e)&&!gP(e)&&e<=Number.MAX_SAFE_INTEGER&&e>=Number.MIN_SAFE_INTEGER}const vP={mapValue:{fields:{__type__:{stringValue:"__max__"}}}},yP={nullValue:"NULL_VALUE"};function _P(e){return"nullValue"in e?0:"booleanValue"in e?1:"integerValue"in e||"doubleValue"in e?2:"timestampValue"in e?3:"stringValue"in e?5:"bytesValue"in e?6:"referenceValue"in e?7:"geoPointValue"in e?8:"arrayValue"in e?9:"mapValue"in e?uP(e)?4:PP(e)?9007199254740991:10:eR()}function wP(r,i){if(r===i)return!0;var e,t,n=_P(r);if(n!==_P(i))return!1;switch(n){case 0:case 9007199254740991:return!0;case 1:return r.booleanValue===i.booleanValue;case 4:return hP(r).isEqual(hP(i));case 3:return function(e){if("string"==typeof r.timestampValue&&"string"==typeof e.timestampValue&&r.timestampValue.length===e.timestampValue.length)return r.timestampValue===e.timestampValue;var t=aP(r.timestampValue),n=aP(e.timestampValue);return t.seconds===n.seconds&&t.nanos===n.nanos}(i);case 5:return r.stringValue===i.stringValue;case 6:return t=i,lP(r.bytesValue).isEqual(lP(t.bytesValue));case 7:return r.referenceValue===i.referenceValue;case 8:return e=i,cP((t=r).geoPointValue.latitude)===cP(e.geoPointValue.latitude)&&cP(t.geoPointValue.longitude)===cP(e.geoPointValue.longitude);case 2:return function(e,t){if("integerValue"in e&&"integerValue"in t)return cP(e.integerValue)===cP(t.integerValue);if("doubleValue"in e&&"doubleValue"in t){var n=cP(e.doubleValue),r=cP(t.doubleValue);return n===r?gP(n)===gP(r):isNaN(n)&&isNaN(r)}return!1}(r,i);case 9:return gR(r.arrayValue.values||[],i.arrayValue.values||[],wP);case 10:return function(e){const t=e.mapValue.fields||{},n=i.mapValue.fields||{};if(QR(t)!==QR(n))return!1;for(const e in t)if(t.hasOwnProperty(e)&&(void 0===n[e]||!wP(t[e],n[e])))return!1;return!0}(r);default:return eR()}}function bP(e,t){return void 0!==(e.values||[]).find(e=>wP(e,t))}function IP(e,t){if(e===t)return 0;var n,r,i,s,o=_P(e),a=_P(t);if(o!==a)return pR(o,a);switch(o){case 0:case 9007199254740991:return 0;case 1:return pR(e.booleanValue,t.booleanValue);case 2:return r=t,i=cP(e.integerValue||e.doubleValue),s=cP(r.integerValue||r.doubleValue),i<s?-1:s<i?1:i===s?0:isNaN(i)?isNaN(s)?0:-1:1;case 3:return TP(e.timestampValue,t.timestampValue);case 4:return TP(hP(e),hP(t));case 5:return pR(e.stringValue,t.stringValue);case 6:return function(e,t){const n=lP(e),r=lP(t);return n.compareTo(r)}(e.bytesValue,t.bytesValue);case 7:return function(e,t){var n=e.split("/"),r=t.split("/");for(let i=0;i<n.length&&i<r.length;i++){const t=pR(n[i],r[i]);if(0!==t)return t}return pR(n.length,r.length)}(e.referenceValue,t.referenceValue);case 8:return n=e.geoPointValue,r=t.geoPointValue,0!==(s=pR(cP(n.latitude),cP(r.latitude)))?s:pR(cP(n.longitude),cP(r.longitude));case 9:return function(e,t){var n=e.values||[],r=t.values||[];for(let i=0;i<n.length&&i<r.length;++i){const t=IP(n[i],r[i]);if(t)return t}return pR(n.length,r.length)}(e.arrayValue,t.arrayValue);case 10:return function(e,t){if(e===vP.mapValue&&t===vP.mapValue)return 0;if(e===vP.mapValue)return 1;if(t===vP.mapValue)return-1;const n=e.fields||{},r=Object.keys(n),i=t.fields||{},s=Object.keys(i);r.sort(),s.sort();for(let a=0;a<r.length&&a<s.length;++a){const t=pR(r[a],s[a]);if(0!==t)return t;var o=IP(n[r[a]],i[s[a]]);if(0!==o)return o}return pR(r.length,s.length)}(e.mapValue,t.mapValue);default:throw eR()}}function TP(e,t){if("string"==typeof e&&"string"==typeof t&&e.length===t.length)return pR(e,t);var n=aP(e),r=aP(t),i=pR(n.seconds,r.seconds);return 0!==i?i:pR(n.nanos,r.nanos)}function EP(e){return function s(e){return"nullValue"in e?"null":"booleanValue"in e?""+e.booleanValue:"integerValue"in e?""+e.integerValue:"doubleValue"in e?""+e.doubleValue:"timestampValue"in e?function(e){const t=aP(e);return`time(${t.seconds},${t.nanos})`}(e.timestampValue):"stringValue"in e?e.stringValue:"bytesValue"in e?lP(e.bytesValue).toBase64():"referenceValue"in e?(t=e.referenceValue,TR.fromName(t).toString()):"geoPointValue"in e?`geo(${(t=e.geoPointValue).latitude},${t.longitude})`:"arrayValue"in e?function(e){let t="[",n=!0;for(const r of e.values||[])n?n=!1:t+=",",t+=s(r);return t+"]"}(e.arrayValue):"mapValue"in e?function(e){const t=Object.keys(e.fields||{}).sort();let n="{",r=!0;for(const i of t)r?r=!1:n+=",",n+=`${i}:${s(e.fields[i])}`;return n+"}"}(e.mapValue):eR();var t}(e)}function SP(e,t){return{referenceValue:`projects/${e.projectId}/databases/${e.database}/documents/${t.path.canonicalString()}`}}function kP(e){return e&&"integerValue"in e}function CP(e){return!!e&&"arrayValue"in e}function AP(e){return e&&"nullValue"in e}function NP(e){return e&&"doubleValue"in e&&isNaN(Number(e.doubleValue))}function xP(e){return e&&"mapValue"in e}function RP(t){if(t.geoPointValue)return{geoPointValue:Object.assign({},t.geoPointValue)};if(t.timestampValue&&"object"==typeof t.timestampValue)return{timestampValue:Object.assign({},t.timestampValue)};if(t.mapValue){const n={mapValue:{fields:{}}};return YR(t.mapValue.fields,(e,t)=>n.mapValue.fields[e]=RP(t)),n}if(t.arrayValue){const r={arrayValue:{values:[]}};for(let e=0;e<(t.arrayValue.values||[]).length;++e)r.arrayValue.values[e]=RP(t.arrayValue.values[e]);return r}return Object.assign({},t)}function PP(e){return"__max__"===(((e.mapValue||{}).fields||{}).__type__||{}).stringValue}function DP(e,t){var n=IP(e.value,t.value);return 0!==n?n:e.inclusive&&!t.inclusive?-1:!e.inclusive&&t.inclusive?1:0}function OP(e,t){var n=IP(e.value,t.value);return 0!==n?n:e.inclusive&&!t.inclusive?1:!e.inclusive&&t.inclusive?-1:0}class MP{constructor(e){this.value=e}static empty(){return new MP({mapValue:{}})}field(n){if(n.isEmpty())return this.value;{let e=this.value;for(let t=0;t<n.length-1;++t)if(e=(e.mapValue.fields||{})[n.get(t)],!xP(e))return null;return e=(e.mapValue.fields||{})[n.lastSegment()],e||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=RP(t)}setAll(e){let n=IR.emptyPath(),r={},i=[];e.forEach((e,t)=>{if(!n.isImmediateParentOf(t)){const e=this.getFieldsMap(n);this.applyChanges(e,r,i),r={},i=[],n=t.popLast()}e?r[t.lastSegment()]=RP(e):i.push(t.lastSegment())});var t=this.getFieldsMap(n);this.applyChanges(t,r,i)}delete(e){const t=this.field(e.popLast());xP(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return wP(this.value,e.value)}getFieldsMap(t){let n=this.value;n.mapValue.fields||(n.mapValue={fields:{}});for(let r=0;r<t.length;++r){let e=n.mapValue.fields[t.get(r)];xP(e)&&e.mapValue.fields||(e={mapValue:{fields:{}}},n.mapValue.fields[t.get(r)]=e),n=e}return n.mapValue.fields}applyChanges(n,e,t){YR(e,(e,t)=>n[e]=t);for(const e of t)delete n[e]}clone(){return new MP(RP(this.value))}}class LP{constructor(e,t,n,r,i,s){this.key=e,this.documentType=t,this.version=n,this.readTime=r,this.data=i,this.documentState=s}static newInvalidDocument(e){return new LP(e,0,yR.min(),yR.min(),MP.empty(),0)}static newFoundDocument(e,t,n){return new LP(e,1,t,yR.min(),n,0)}static newNoDocument(e,t){return new LP(e,2,t,yR.min(),MP.empty(),0)}static newUnknownDocument(e,t){return new LP(e,3,t,yR.min(),MP.empty(),2)}convertToFoundDocument(e,t){return this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=MP.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=MP.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=yR.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return 1===this.documentState}get hasCommittedMutations(){return 2===this.documentState}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return 0!==this.documentType}isFoundDocument(){return 1===this.documentType}isNoDocument(){return 2===this.documentType}isUnknownDocument(){return 3===this.documentType}isEqual(e){return e instanceof LP&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new LP(this.key,this.documentType,this.version,this.readTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}class FP{constructor(e,t=null,n=[],r=[],i=null,s=null,o=null){this.path=e,this.collectionGroup=t,this.orderBy=n,this.filters=r,this.limit=i,this.startAt=s,this.endAt=o,this.ut=null}}function UP(e,t=null,n=[],r=[],i=null,s=null,o=null){return new FP(e,t,n,r,i,s,o)}function VP(e){const t=e;if(null===t.ut){let e=t.path.canonicalString();null!==t.collectionGroup&&(e+="|cg:"+t.collectionGroup),e+="|f:",e+=t.filters.map(e=>{return(t=e).field.canonicalString()+t.op.toString()+EP(t.value);var t}).join(","),e+="|ob:",e+=t.orderBy.map(e=>function(e){return e.field.canonicalString()+e.dir}(e)).join(","),pP(t.limit)||(e+="|l:",e+=t.limit),t.startAt&&(e+="|lb:",e+=t.startAt.inclusive?"b:":"a:",e+=t.startAt.position.map(e=>EP(e)).join(",")),t.endAt&&(e+="|ub:",e+=t.endAt.inclusive?"a:":"b:",e+=t.endAt.position.map(e=>EP(e)).join(",")),t.ut=e}return t.ut}function jP(e,t){if(e.limit!==t.limit)return!1;if(e.orderBy.length!==t.orderBy.length)return!1;for(let o=0;o<e.orderBy.length;o++)if(n=e.orderBy[o],r=t.orderBy[o],n.dir!==r.dir||!n.field.isEqual(r.field))return!1;var n,r,i,s;if(e.filters.length!==t.filters.length)return!1;for(let a=0;a<e.filters.length;a++)if(i=e.filters[a],s=t.filters[a],i.op!==s.op||!i.field.isEqual(s.field)||!wP(i.value,s.value))return!1;return e.collectionGroup===t.collectionGroup&&!!e.path.isEqual(t.path)&&!!rD(e.startAt,t.startAt)&&rD(e.endAt,t.endAt)}function qP(e){return TR.isDocumentKey(e.path)&&null===e.collectionGroup&&0===e.filters.length}function BP(e,t){return e.filters.filter(e=>e instanceof zP&&e.field.isEqual(t))}function KP(t,n,r){let i=yP,s=!0;for(const r of BP(t,n)){let e=yP,t=!0;switch(r.op){case"<":case"<=":e="nullValue"in(o=r.value)?yP:"booleanValue"in o?{booleanValue:!1}:"integerValue"in o||"doubleValue"in o?{doubleValue:NaN}:"timestampValue"in o?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"stringValue"in o?{stringValue:""}:"bytesValue"in o?{bytesValue:""}:"referenceValue"in o?SP(fP.empty(),TR.empty()):"geoPointValue"in o?{geoPointValue:{latitude:-90,longitude:-180}}:"arrayValue"in o?{arrayValue:{}}:"mapValue"in o?{mapValue:{}}:eR();break;case"==":case"in":case">=":e=r.value;break;case">":e=r.value,t=!1;break;case"!=":case"not-in":e=yP}DP({value:i,inclusive:s},{value:e,inclusive:t})<0&&(i=e,s=t)}var o;if(null!==r)for(let e=0;e<t.orderBy.length;++e)if(t.orderBy[e].field.isEqual(n)){const t=r.position[e];DP({value:i,inclusive:s},{value:t,inclusive:r.inclusive})<0&&(i=t,s=r.inclusive);break}return{value:i,inclusive:s}}function $P(t,n,r){let i=vP,s=!0;for(const r of BP(t,n)){let e=vP,t=!0;switch(r.op){case">=":case">":e="nullValue"in(o=r.value)?{booleanValue:!1}:"booleanValue"in o?{doubleValue:NaN}:"integerValue"in o||"doubleValue"in o?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"timestampValue"in o?{stringValue:""}:"stringValue"in o?{bytesValue:""}:"bytesValue"in o?SP(fP.empty(),TR.empty()):"referenceValue"in o?{geoPointValue:{latitude:-90,longitude:-180}}:"geoPointValue"in o?{arrayValue:{}}:"arrayValue"in o?{mapValue:{}}:"mapValue"in o?vP:eR(),t=!1;break;case"==":case"in":case"<=":e=r.value;break;case"<":e=r.value,t=!1;break;case"!=":case"not-in":e=vP}0<OP({value:i,inclusive:s},{value:e,inclusive:t})&&(i=e,s=t)}var o;if(null!==r)for(let e=0;e<t.orderBy.length;++e)if(t.orderBy[e].field.isEqual(n)){const t=r.position[e];0<OP({value:i,inclusive:s},{value:t,inclusive:r.inclusive})&&(i=t,s=r.inclusive);break}return{value:i,inclusive:s}}class zP extends class{}{constructor(e,t,n){super(),this.field=e,this.op=t,this.value=n}static create(e,t,n){return e.isKeyField()?"in"===t||"not-in"===t?this.ct(e,t,n):new WP(e,t,n):"array-contains"===t?new YP(e,n):"in"===t?new JP(e,n):"not-in"===t?new XP(e,n):"array-contains-any"===t?new ZP(e,n):new zP(e,t,n)}static ct(e,t,n){return new("in"===t?GP:HP)(e,n)}matches(e){var t=e.data.field(this.field);return"!="===this.op?null!==t&&this.at(IP(t,this.value)):null!==t&&_P(this.value)===_P(t)&&this.at(IP(t,this.value))}at(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return 0===e;case"!=":return 0!==e;case">":return 0<e;case">=":return 0<=e;default:return eR()}}ht(){return 0<=["<","<=",">",">=","!=","not-in"].indexOf(this.op)}}class WP extends zP{constructor(e,t,n){super(e,t,n),this.key=TR.fromName(n.referenceValue)}matches(e){var t=TR.comparator(e.key,this.key);return this.at(t)}}class GP extends zP{constructor(e,t){super(e,"in",t),this.keys=QP(0,t)}matches(t){return this.keys.some(e=>e.isEqual(t.key))}}class HP extends zP{constructor(e,t){super(e,"not-in",t),this.keys=QP(0,t)}matches(t){return!this.keys.some(e=>e.isEqual(t.key))}}function QP(e,t){var n;return((null===(n=t.arrayValue)||void 0===n?void 0:n.values)||[]).map(e=>TR.fromName(e.referenceValue))}class YP extends zP{constructor(e,t){super(e,"array-contains",t)}matches(e){var t=e.data.field(this.field);return CP(t)&&bP(t.arrayValue,this.value)}}class JP extends zP{constructor(e,t){super(e,"in",t)}matches(e){var t=e.data.field(this.field);return null!==t&&bP(this.value.arrayValue,t)}}class XP extends zP{constructor(e,t){super(e,"not-in",t)}matches(e){if(bP(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;var t=e.data.field(this.field);return null!==t&&!bP(this.value.arrayValue,t)}}class ZP extends zP{constructor(e,t){super(e,"array-contains-any",t)}matches(e){const t=e.data.field(this.field);return!(!CP(t)||!t.arrayValue.values)&&t.arrayValue.values.some(e=>bP(this.value.arrayValue,e))}}class eD{constructor(e,t){this.position=e,this.inclusive=t}}class tD{constructor(e,t="asc"){this.field=e,this.dir=t}}function nD(e,t,n){let r=0;for(let i=0;i<e.position.length;i++){const s=t[i],o=e.position[i];if(r=s.field.isKeyField()?TR.comparator(TR.fromName(o.referenceValue),n.key):IP(o,n.data.field(s.field)),"desc"===s.dir&&(r*=-1),0!==r)break}return r}function rD(e,t){if(null===e)return null===t;if(null===t)return!1;if(e.inclusive!==t.inclusive||e.position.length!==t.position.length)return!1;for(let n=0;n<e.position.length;n++)if(!wP(e.position[n],t.position[n]))return!1;return!0}class iD{constructor(e,t=null,n=[],r=[],i=null,s="F",o=null,a=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=n,this.filters=r,this.limit=i,this.limitType=s,this.startAt=o,this.endAt=a,this.lt=null,this.ft=null,this.startAt,this.endAt}}function sD(e,t,n,r,i,s,o,a){return new iD(e,t,n,r,i,s,o,a)}function oD(e){return new iD(e)}function aD(e){return 0<e.explicitOrderBy.length?e.explicitOrderBy[0].field:null}function cD(e){for(const t of e.filters)if(t.ht())return t.field;return null}function lD(e){return null!==e.collectionGroup}function uD(t){const n=t;if(null===n.lt){n.lt=[];const t=cD(n),e=aD(n);if(null!==t&&null===e)t.isKeyField()||n.lt.push(new tD(t)),n.lt.push(new tD(IR.keyField(),"asc"));else{let e=!1;for(const r of n.explicitOrderBy)n.lt.push(r),r.field.isKeyField()&&(e=!0);if(!e){const t=0<n.explicitOrderBy.length?n.explicitOrderBy[n.explicitOrderBy.length-1].dir:"asc";n.lt.push(new tD(IR.keyField(),t))}}}return n.lt}function hD(e){const t=e;if(!t.ft)if("F"===t.limitType)t.ft=UP(t.path,t.collectionGroup,uD(t),t.filters,t.limit,t.startAt,t.endAt);else{const e=[];for(const i of uD(t)){const t="desc"===i.dir?"asc":"desc";e.push(new tD(i.field,t))}var n=t.endAt?new eD(t.endAt.position,t.endAt.inclusive):null,r=t.startAt?new eD(t.startAt.position,t.startAt.inclusive):null;t.ft=UP(t.path,t.collectionGroup,e,t.filters,t.limit,n,r)}return t.ft}function dD(e,t,n){return new iD(e.path,e.collectionGroup,e.explicitOrderBy.slice(),e.filters.slice(),t,n,e.startAt,e.endAt)}function fD(e,t){return jP(hD(e),hD(t))&&e.limitType===t.limitType}function pD(e){return`${VP(hD(e))}|lt:${e.limitType}`}function gD(e){return`Query(target=${function(e){let t=e.path.canonicalString();return null!==e.collectionGroup&&(t+=" collectionGroup="+e.collectionGroup),0<e.filters.length&&(t+=`, filters: [${e.filters.map(e=>{return`${(t=e).field.canonicalString()} ${t.op} ${EP(t.value)}`;var t}).join(", ")}]`),pP(e.limit)||(t+=", limit: "+e.limit),0<e.orderBy.length&&(t+=`, orderBy: [${e.orderBy.map(e=>function(e){return`${e.field.canonicalString()} (${e.dir})`}(e)).join(", ")}]`),e.startAt&&(t+=", startAt: ",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(e=>EP(e)).join(",")),e.endAt&&(t+=", endAt: ",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(e=>EP(e)).join(",")),`Target(${t})`}(hD(e))}; limitType=${e.limitType})`}function mD(n,e){return e.isFoundDocument()&&(i=n,o=(s=e).key.path,null!==i.collectionGroup?s.key.hasCollectionId(i.collectionGroup)&&i.path.isPrefixOf(o):TR.isDocumentKey(i.path)?i.path.isEqual(o):i.path.isImmediateParentOf(o))&&function(e){for(const t of n.explicitOrderBy)if(!t.field.isKeyField()&&null===e.data.field(t.field))return;return 1}(e)&&function(e){for(const t of n.filters)if(!t.matches(e))return;return 1}(e)&&(i=e,(!(e=n).startAt||(t=e.startAt,r=nD(t,uD(e),i),t.inclusive?r<=0:r<0))&&(!e.endAt||(t=e.endAt,r=nD(t,uD(e),i),t.inclusive?0<=r:0<r)));var t,r,i,s,o}function vD(e){return e.collectionGroup||(e.path.length%2==1?e.path.lastSegment():e.path.get(e.path.length-2))}function yD(i){return(e,t)=>{let n=!1;for(const r of uD(i)){const i=function(e,i,t){var n=e.field.isKeyField()?TR.comparator(i.key,t.key):function(e,t){var n=i.data.field(e),r=t.data.field(e);return null!==n&&null!==r?IP(n,r):eR()}(e.field,t);switch(e.dir){case"asc":return n;case"desc":return-1*n;default:return eR()}}(r,e,t);if(0!==i)return i;n=n||r.field.isKeyField()}return 0}}function _D(e,t){if(e.dt){if(isNaN(t))return{doubleValue:"NaN"};if(t===1/0)return{doubleValue:"Infinity"};if(t===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:gP(t)?"-0":t}}function wD(e){return{integerValue:""+e}}function bD(e,t){return mP(t)?wD(t):_D(e,t)}class ID{constructor(){this._=void 0}}function TD(e,t){return e instanceof ND?kP(n=t)||n&&"doubleValue"in n?t:{integerValue:0}:null;var n}class ED extends ID{}class SD extends ID{constructor(e){super(),this.elements=e}}function kD(e,t){const n=RD(t);for(const t of e.elements)n.some(e=>wP(e,t))||n.push(t);return{arrayValue:{values:n}}}class CD extends ID{constructor(e){super(),this.elements=e}}function AD(e,t){let n=RD(t);for(const t of e.elements)n=n.filter(e=>!wP(e,t));return{arrayValue:{values:n}}}class ND extends ID{constructor(e,t){super(),this.wt=e,this._t=t}}function xD(e){return cP(e.integerValue||e.doubleValue)}function RD(e){return CP(e)&&e.arrayValue.values?e.arrayValue.values.slice():[]}class PD{constructor(e,t){this.field=e,this.transform=t}}class DD{constructor(e,t){this.version=e,this.transformResults=t}}class OD{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new OD}static exists(e){return new OD(void 0,e)}static updateTime(e){return new OD(e)}get isNone(){return void 0===this.updateTime&&void 0===this.exists}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function MD(e,t){return void 0!==e.updateTime?t.isFoundDocument()&&t.version.isEqual(e.updateTime):void 0===e.exists||e.exists===t.isFoundDocument()}class LD{}function FD(e,n){if(!e.hasLocalMutations||n&&0===n.fields.length)return null;if(null===n)return e.isNoDocument()?new WD(e.key,OD.none()):new qD(e.key,e.data,OD.none());{const i=e.data,s=MP.empty();let t=new tP(IR.comparator);for(var r of n.fields)if(!t.has(r)){let e=i.field(r);null===e&&1<r.length&&(r=r.popLast(),e=i.field(r)),null===e?s.delete(r):s.set(r,e),t=t.add(r)}return new BD(e.key,s,new iP(t.toArray()),OD.none())}}function UD(e,t,n){e instanceof qD?function(e,t,n){const r=e.value.clone(),i=$D(e.fieldTransforms,t,n.transformResults);r.setAll(i),t.convertToFoundDocument(n.version,r).setHasCommittedMutations()}(e,t,n):e instanceof BD?function(e,t,n){if(!MD(e.precondition,t))return t.convertToUnknownDocument(n.version);const r=$D(e.fieldTransforms,t,n.transformResults),i=t.data;i.setAll(KD(e)),i.setAll(r),t.convertToFoundDocument(n.version,i).setHasCommittedMutations()}(e,t,n):t.convertToNoDocument(n.version).setHasCommittedMutations()}function VD(e,t,n,r){return e instanceof qD?function(e,t,n,r){if(!MD(e.precondition,t))return n;const i=e.value.clone(),s=zD(e.fieldTransforms,r,t);return i.setAll(s),t.convertToFoundDocument(t.version,i).setHasLocalMutations(),null}(e,t,n,r):e instanceof BD?function(e,t,n,r){if(!MD(e.precondition,t))return n;const i=zD(e.fieldTransforms,r,t),s=t.data;return s.setAll(KD(e)),s.setAll(i),t.convertToFoundDocument(t.version,s).setHasLocalMutations(),null===n?null:n.unionWith(e.fieldMask.fields).unionWith(e.fieldTransforms.map(e=>e.field))}(e,t,n,r):(t=t,n=n,MD(e.precondition,t)?(t.convertToNoDocument(t.version).setHasLocalMutations(),null):n)}function jD(e,t){return e.type===t.type&&!!e.key.isEqual(t.key)&&!!e.precondition.isEqual(t.precondition)&&(n=e.fieldTransforms,r=t.fieldTransforms,!!(void 0===n&&void 0===r||n&&r&&gR(n,r,(e,t)=>function(e,t){return e.field.isEqual(t.field)&&(e=e.transform,t=t.transform,e instanceof SD&&t instanceof SD||e instanceof CD&&t instanceof CD?gR(e.elements,t.elements,wP):e instanceof ND&&t instanceof ND?wP(e._t,t._t):e instanceof ED&&t instanceof ED)}(e,t)))&&(0===e.type?e.value.isEqual(t.value):1!==e.type||e.data.isEqual(t.data)&&e.fieldMask.isEqual(t.fieldMask)));var n,r}class qD extends LD{constructor(e,t,n,r=[]){super(),this.key=e,this.value=t,this.precondition=n,this.fieldTransforms=r,this.type=0}getFieldMask(){return null}}class BD extends LD{constructor(e,t,n,r,i=[]){super(),this.key=e,this.data=t,this.fieldMask=n,this.precondition=r,this.fieldTransforms=i,this.type=1}getFieldMask(){return this.fieldMask}}function KD(n){const r=new Map;return n.fieldMask.fields.forEach(e=>{var t;e.isEmpty()||(t=n.data.field(e),r.set(e,t))}),r}function $D(e,t,n){const r=new Map;tR(e.length===n.length);for(let u=0;u<n.length;u++){var i=e[u],s=i.transform,o=t.data.field(i.field);r.set(i.field,(a=s,c=o,l=n[u],a instanceof SD?kD(a,c):a instanceof CD?AD(a,c):l))}var a,c,l;return r}function zD(e,t,n){const r=new Map;for(const l of e){const e=l.transform,u=n.data.field(l.field);r.set(l.field,(i=e,s=u,o=t,c=a=void 0,i instanceof ED?function(){const e={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:o.seconds,nanos:o.nanoseconds}}}};return s&&(e.fields.__previous_value__=s),{mapValue:e}}():i instanceof SD?kD(i,s):i instanceof CD?AD(i,s):(a=TD(i=i,s),c=xD(a)+xD(i._t),kP(a)&&kP(i._t)?wD(c):_D(i.wt,c))))}var i,s,o,a,c;return r}class WD extends LD{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class GD extends LD{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}class HD{constructor(e){this.count=e}}function QD(e){switch(e){default:return eR(),0;case nR.CANCELLED:case nR.UNKNOWN:case nR.DEADLINE_EXCEEDED:case nR.RESOURCE_EXHAUSTED:case nR.INTERNAL:case nR.UNAVAILABLE:case nR.UNAUTHENTICATED:return;case nR.INVALID_ARGUMENT:case nR.NOT_FOUND:case nR.ALREADY_EXISTS:case nR.PERMISSION_DENIED:case nR.FAILED_PRECONDITION:case nR.ABORTED:case nR.OUT_OF_RANGE:case nR.UNIMPLEMENTED:case nR.DATA_LOSS:return 1}}function YD(e){if(void 0===e)return Jx("GRPC error has no .code"),nR.UNKNOWN;switch(e){case Mx.OK:return nR.OK;case Mx.CANCELLED:return nR.CANCELLED;case Mx.UNKNOWN:return nR.UNKNOWN;case Mx.DEADLINE_EXCEEDED:return nR.DEADLINE_EXCEEDED;case Mx.RESOURCE_EXHAUSTED:return nR.RESOURCE_EXHAUSTED;case Mx.INTERNAL:return nR.INTERNAL;case Mx.UNAVAILABLE:return nR.UNAVAILABLE;case Mx.UNAUTHENTICATED:return nR.UNAUTHENTICATED;case Mx.INVALID_ARGUMENT:return nR.INVALID_ARGUMENT;case Mx.NOT_FOUND:return nR.NOT_FOUND;case Mx.ALREADY_EXISTS:return nR.ALREADY_EXISTS;case Mx.PERMISSION_DENIED:return nR.PERMISSION_DENIED;case Mx.FAILED_PRECONDITION:return nR.FAILED_PRECONDITION;case Mx.ABORTED:return nR.ABORTED;case Mx.OUT_OF_RANGE:return nR.OUT_OF_RANGE;case Mx.UNIMPLEMENTED:return nR.UNIMPLEMENTED;case Mx.DATA_LOSS:return nR.DATA_LOSS;default:return eR()}}(c=Mx=Mx||{})[c.OK=0]="OK",c[c.CANCELLED=1]="CANCELLED",c[c.UNKNOWN=2]="UNKNOWN",c[c.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",c[c.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",c[c.NOT_FOUND=5]="NOT_FOUND",c[c.ALREADY_EXISTS=6]="ALREADY_EXISTS",c[c.PERMISSION_DENIED=7]="PERMISSION_DENIED",c[c.UNAUTHENTICATED=16]="UNAUTHENTICATED",c[c.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",c[c.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",c[c.ABORTED=10]="ABORTED",c[c.OUT_OF_RANGE=11]="OUT_OF_RANGE",c[c.UNIMPLEMENTED=12]="UNIMPLEMENTED",c[c.INTERNAL=13]="INTERNAL",c[c.UNAVAILABLE=14]="UNAVAILABLE",c[c.DATA_LOSS=15]="DATA_LOSS";class JD{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){const t=this.mapKeyFn(e),n=this.inner[t];if(void 0!==n)for(const[t,r]of n)if(this.equalsFn(t,e))return r}has(e){return void 0!==this.get(e)}set(e,t){const n=this.mapKeyFn(e),r=this.inner[n];if(void 0===r)return this.inner[n]=[[e,t]],void this.innerSize++;for(let i=0;i<r.length;i++)if(this.equalsFn(r[i][0],e))return void(r[i]=[e,t]);r.push([e,t]),this.innerSize++}delete(e){const t=this.mapKeyFn(e),n=this.inner[t];if(void 0===n)return!1;for(let r=0;r<n.length;r++)if(this.equalsFn(n[r][0],e))return 1===n.length?delete this.inner[t]:n.splice(r,1),this.innerSize--,!0;return!1}forEach(r){YR(this.inner,(e,t)=>{for(const[e,n]of t)r(e,n)})}isEmpty(){return JR(this.inner)}size(){return this.innerSize}}const XD=new XR(TR.comparator);const ZD=new XR(TR.comparator);function e1(...e){let t=ZD;for(const n of e)t=t.insert(n.key,n);return t}function t1(e){let n=ZD;return e.forEach((e,t)=>n=n.insert(e,t.overlayedDocument)),n}function n1(){return new JD(e=>e.toString(),(e,t)=>e.isEqual(t))}const r1=new XR(TR.comparator),i1=new tP(TR.comparator);function s1(...e){let t=i1;for(const n of e)t=t.add(n);return t}const o1=new tP(pR);class a1{constructor(e,t,n,r,i){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=n,this.documentUpdates=r,this.resolvedLimboDocuments=i}static createSynthesizedRemoteEventForCurrentChange(e,t){const n=new Map;return n.set(e,c1.createSynthesizedTargetChangeForCurrentChange(e,t)),new a1(yR.min(),n,o1,XD,s1())}}class c1{constructor(e,t,n,r,i){this.resumeToken=e,this.current=t,this.addedDocuments=n,this.modifiedDocuments=r,this.removedDocuments=i}static createSynthesizedTargetChangeForCurrentChange(e,t){return new c1(sP.EMPTY_BYTE_STRING,t,s1(),s1(),s1())}}class l1{constructor(e,t,n,r){this.gt=e,this.removedTargetIds=t,this.key=n,this.yt=r}}class u1{constructor(e,t){this.targetId=e,this.It=t}}class h1{constructor(e,t,n=sP.EMPTY_BYTE_STRING,r=null){this.state=e,this.targetIds=t,this.resumeToken=n,this.cause=r}}class d1{constructor(){this.Tt=0,this.Et=g1(),this.At=sP.EMPTY_BYTE_STRING,this.Rt=!1,this.bt=!0}get current(){return this.Rt}get resumeToken(){return this.At}get Pt(){return 0!==this.Tt}get vt(){return this.bt}Vt(e){0<e.approximateByteSize()&&(this.bt=!0,this.At=e)}St(){let n=s1(),r=s1(),i=s1();return this.Et.forEach((e,t)=>{switch(t){case 0:n=n.add(e);break;case 2:r=r.add(e);break;case 1:i=i.add(e);break;default:eR()}}),new c1(this.At,this.Rt,n,r,i)}Dt(){this.bt=!1,this.Et=g1()}Ct(e,t){this.bt=!0,this.Et=this.Et.insert(e,t)}xt(e){this.bt=!0,this.Et=this.Et.remove(e)}Nt(){this.Tt+=1}kt(){--this.Tt}Ot(){this.bt=!0,this.Rt=!0}}class f1{constructor(e){this.Mt=e,this.Ft=new Map,this.$t=XD,this.Bt=p1(),this.Lt=new tP(pR)}Ut(e){for(const t of e.gt)e.yt&&e.yt.isFoundDocument()?this.qt(t,e.yt):this.Kt(t,e.key,e.yt);for(const n of e.removedTargetIds)this.Kt(n,e.key,e.yt)}Gt(n){this.forEachTarget(n,e=>{const t=this.Qt(e);switch(n.state){case 0:this.jt(e)&&t.Vt(n.resumeToken);break;case 1:t.kt(),t.Pt||t.Dt(),t.Vt(n.resumeToken);break;case 2:t.kt(),t.Pt||this.removeTarget(e);break;case 3:this.jt(e)&&(t.Ot(),t.Vt(n.resumeToken));break;case 4:this.jt(e)&&(this.Wt(e),t.Vt(n.resumeToken));break;default:eR()}})}forEachTarget(e,n){0<e.targetIds.length?e.targetIds.forEach(n):this.Ft.forEach((e,t)=>{this.jt(t)&&n(t)})}zt(e){const t=e.targetId,n=e.It.count,r=this.Ht(t);if(r){const e=r.target;if(qP(e))if(0===n){const n=new TR(e.path);this.Kt(t,n,LP.newNoDocument(n,yR.min()))}else tR(1===n);else this.Jt(t)!==n&&(this.Wt(t),this.Lt=this.Lt.add(t))}}Yt(r){const i=new Map;this.Ft.forEach((e,t)=>{var n=this.Ht(t);if(n){if(e.current&&qP(n.target)){const i=new TR(n.target.path);null!==this.$t.get(i)||this.Xt(t,i)||this.Kt(t,i,LP.newNoDocument(i,r))}e.vt&&(i.set(t,e.St()),e.Dt())}});let s=s1();this.Bt.forEach((e,t)=>{let n=!0;t.forEachWhile(e=>{var t=this.Ht(e);return!t||2===t.purpose||(n=!1)}),n&&(s=s.add(e))}),this.$t.forEach((e,t)=>t.setReadTime(r));var e=new a1(r,i,this.Lt,this.$t,s);return this.$t=XD,this.Bt=p1(),this.Lt=new tP(pR),e}qt(e,t){var n;this.jt(e)&&(n=this.Xt(e,t.key)?2:0,this.Qt(e).Ct(t.key,n),this.$t=this.$t.insert(t.key,t),this.Bt=this.Bt.insert(t.key,this.Zt(t.key).add(e)))}Kt(e,t,n){if(this.jt(e)){const r=this.Qt(e);this.Xt(e,t)?r.Ct(t,1):r.xt(t),this.Bt=this.Bt.insert(t,this.Zt(t).delete(e)),n&&(this.$t=this.$t.insert(t,n))}}removeTarget(e){this.Ft.delete(e)}Jt(e){var t=this.Qt(e).St();return this.Mt.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}Nt(e){this.Qt(e).Nt()}Qt(e){let t=this.Ft.get(e);return t||(t=new d1,this.Ft.set(e,t)),t}Zt(e){let t=this.Bt.get(e);return t||(t=new tP(pR),this.Bt=this.Bt.insert(e,t)),t}jt(e){var t=null!==this.Ht(e);return t||Yx("WatchChangeAggregator","Detected inactive target",e),t}Ht(e){var t=this.Ft.get(e);return t&&t.Pt?null:this.Mt.te(e)}Wt(t){this.Ft.set(t,new d1),this.Mt.getRemoteKeysForTarget(t).forEach(e=>{this.Kt(t,e,null)})}Xt(e,t){return this.Mt.getRemoteKeysForTarget(e).has(t)}}function p1(){return new XR(TR.comparator)}function g1(){return new XR(TR.comparator)}const m1={asc:"ASCENDING",desc:"DESCENDING"},v1={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"};class y1{constructor(e,t){this.databaseId=e,this.dt=t}}function _1(e,t){return e.dt?`${new Date(1e3*t.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+t.nanoseconds).slice(-9)}Z`:{seconds:""+t.seconds,nanos:t.nanoseconds}}function w1(e,t){return e.dt?t.toBase64():t.toUint8Array()}function b1(e){return tR(!!e),yR.fromTimestamp((t=aP(e),new vR(t.seconds,t.nanos)));var t}function I1(e,t){return e=e,new wR(["projects",e.projectId,"databases",e.database]).child("documents").child(t).canonicalString()}function T1(e){var t=wR.fromString(e);return tR(q1(t)),t}function E1(e,t){return I1(e.databaseId,t.path)}function S1(e,t){const n=T1(t);if(n.get(1)!==e.databaseId.projectId)throw new rR(nR.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+n.get(1)+" vs "+e.databaseId.projectId);if(n.get(3)!==e.databaseId.database)throw new rR(nR.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+n.get(3)+" vs "+e.databaseId.database);return new TR(N1(n))}function k1(e,t){return I1(e.databaseId,t)}function C1(e){var t=T1(e);return 4===t.length?wR.emptyPath():N1(t)}function A1(e){return new wR(["projects",e.databaseId.projectId,"databases",e.databaseId.database]).canonicalString()}function N1(e){return tR(4<e.length&&"documents"===e.get(4)),e.popFirst(5)}function x1(e,t,n){return{name:E1(e,t),fields:n.value.mapValue.fields}}function R1(e,t,n){const r=S1(e,t.name),i=b1(t.updateTime),s=new MP({mapValue:{fields:t.fields}}),o=LP.newFoundDocument(r,i,s);return n&&o.setHasCommittedMutations(),n?o.setHasCommittedMutations():o}function P1(e,t){let n;if(t instanceof qD)n={update:x1(e,t.key,t.value)};else if(t instanceof WD)n={delete:E1(e,t.key)};else if(t instanceof BD)n={update:x1(e,t.key,t.data),updateMask:function(e){const t=[];return e.fields.forEach(e=>t.push(e.canonicalString())),{fieldPaths:t}}(t.fieldMask)};else{if(!(t instanceof GD))return eR();n={verify:E1(e,t.key)}}return 0<t.fieldTransforms.length&&(n.updateTransforms=t.fieldTransforms.map(e=>function(e){var t=e.transform;if(t instanceof ED)return{fieldPath:e.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(t instanceof SD)return{fieldPath:e.field.canonicalString(),appendMissingElements:{values:t.elements}};if(t instanceof CD)return{fieldPath:e.field.canonicalString(),removeAllFromArray:{values:t.elements}};if(t instanceof ND)return{fieldPath:e.field.canonicalString(),increment:t._t};throw eR()}(e))),t.precondition.isNone||(n.currentDocument=void 0!==(r=t.precondition).updateTime?{updateTime:(t=r.updateTime,_1(e,t.toTimestamp()))}:void 0!==r.exists?{exists:r.exists}:eR()),n;var r}function D1(t,n){const e=n.currentDocument?void 0!==(i=n.currentDocument).updateTime?OD.updateTime(b1(i.updateTime)):void 0!==i.exists?OD.exists(i.exists):OD.none():OD.none(),r=n.updateTransforms?n.updateTransforms.map(e=>function(e,t){let n=null;if("setToServerValue"in t)tR("REQUEST_TIME"===t.setToServerValue),n=new ED;else if("appendMissingElements"in t){const e=t.appendMissingElements.values||[];n=new SD(e)}else if("removeAllFromArray"in t){const e=t.removeAllFromArray.values||[];n=new CD(e)}else"increment"in t?n=new ND(e,t.increment):eR();var r=IR.fromServerFormat(t.fieldPath);return new PD(r,n)}(t,e)):[];var i;if(n.update){n.update.name;var s=S1(t,n.update.name),o=new MP({mapValue:{fields:n.update.fields}});if(n.updateMask){const t=function(){const e=n.updateMask.fieldPaths||[];return new iP(e.map(e=>IR.fromServerFormat(e)))}();return new BD(s,o,t,e,r)}return new qD(s,o,e,r)}if(n.delete){const r=S1(t,n.delete);return new WD(r,e)}if(n.verify){const r=S1(t,n.verify);return new GD(r,e)}return eR()}function O1(e,t){return{documents:[k1(e,t.path)]}}function M1(e,t){const n={structuredQuery:{}},r=t.path;null!==t.collectionGroup?(n.parent=k1(e,r),n.structuredQuery.from=[{collectionId:t.collectionGroup,allDescendants:!0}]):(n.parent=k1(e,r.popLast()),n.structuredQuery.from=[{collectionId:r.lastSegment()}]);var i=function(e){if(0!==e.length){var t=e.map(e=>function(e){if("=="===e.op){if(NP(e.value))return{unaryFilter:{field:F1(e.field),op:"IS_NAN"}};if(AP(e.value))return{unaryFilter:{field:F1(e.field),op:"IS_NULL"}}}else if("!="===e.op){if(NP(e.value))return{unaryFilter:{field:F1(e.field),op:"IS_NOT_NAN"}};if(AP(e.value))return{unaryFilter:{field:F1(e.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:F1(e.field),op:(t=e.op,v1[t]),value:e.value}};var t}(e));return 1===t.length?t[0]:{compositeFilter:{op:"AND",filters:t}}}}(t.filters);i&&(n.structuredQuery.where=i);i=function(e){if(0!==e.length)return e.map(e=>function(e){return{field:F1(e.field),direction:(e=e.dir,m1[e])}}(e))}(t.orderBy);i&&(n.structuredQuery.orderBy=i);var s,i=(s=t.limit,e.dt||pP(s)?s:{value:s});return null!==i&&(n.structuredQuery.limit=i),t.startAt&&(n.structuredQuery.startAt={before:(i=t.startAt).inclusive,values:i.position}),t.endAt&&(n.structuredQuery.endAt={before:!(t=t.endAt).inclusive,values:t.position}),n}function L1(e){let t=C1(e.parent);const n=e.structuredQuery,r=n.from?n.from.length:0;let i=null;if(0<r){tR(1===r);const p=n.from[0];p.allDescendants?i=p.collectionId:t=t.child(p.collectionId)}let s=[];n.where&&(s=function t(e){return e?void 0!==e.unaryFilter?[j1(e)]:void 0!==e.fieldFilter?[V1(e)]:void 0!==e.compositeFilter?e.compositeFilter.filters.map(e=>t(e)).reduce((e,t)=>e.concat(t)):eR():[]}(n.where));let o=[];n.orderBy&&(o=n.orderBy.map(e=>function(e){return new tD(U1(e.field),function(){switch(e.direction){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}())}(e)));let a=null;var c,l,u,h;n.limit&&(a=(e=n.limit,pP(c="object"==typeof e?e.value:e)?null:c));let d=null;n.startAt&&(d=(l=n.startAt,h=!!l.before,u=l.values||[],new eD(u,h)));let f=null;return n.endAt&&(f=(l=n.endAt,u=!l.before,h=l.values||[],new eD(h,u))),sD(t,i,o,s,a,"F",d,f)}function F1(e){return{fieldPath:e.canonicalString()}}function U1(e){return IR.fromServerFormat(e.fieldPath)}function V1(e){return zP.create(U1(e.fieldFilter.field),function(){switch(e.fieldFilter.op){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return eR()}}(),e.fieldFilter.value)}function j1(e){switch(e.unaryFilter.op){case"IS_NAN":var t=U1(e.unaryFilter.field);return zP.create(t,"==",{doubleValue:NaN});case"IS_NULL":t=U1(e.unaryFilter.field);return zP.create(t,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":var n=U1(e.unaryFilter.field);return zP.create(n,"!=",{doubleValue:NaN});case"IS_NOT_NULL":n=U1(e.unaryFilter.field);return zP.create(n,"!=",{nullValue:"NULL_VALUE"});default:return eR()}}function q1(e){return 4<=e.length&&"projects"===e.get(0)&&"databases"===e.get(2)}function B1(e){let t="";for(let n=0;n<e.length;n++)0<t.length&&(t=K1(t)),t=function(e,t){let n=t;const r=e.length;for(let i=0;i<r;i++){const r=e.charAt(i);switch(r){case"\0":n+="";break;case"":n+="";break;default:n+=r}}return n}(e.get(n),t);return K1(t)}function K1(e){return e+""}function $1(t){const n=t.length;if(tR(2<=n),2===n)return tR(""===t.charAt(0)&&""===t.charAt(1)),wR.emptyPath();const r=n-2,i=[];let s="";for(let o=0;o<n;){const n=t.indexOf("",o);switch((n<0||n>r)&&eR(),t.charAt(n+1)){case"":const r=t.substring(o,n);let e;0===s.length?e=r:(s+=r,e=s,s=""),i.push(e);break;case"":s+=t.substring(o,n),s+="\0";break;case"":s+=t.substring(o,n+1);break;default:eR()}o=n+2}return new wR(i)}const z1=["userId","batchId"];function W1(e,t){return[e,B1(t)]}function G1(e,t,n){return[e,B1(t),n]}const H1={},Q1=["prefixPath","collectionGroup","readTime","documentId"],Y1=["prefixPath","collectionGroup","documentId"],J1=["collectionGroup","readTime","prefixPath","documentId"],X1=["canonicalId","targetId"],Z1=["targetId","path"],eO=["path","targetId"],tO=["collectionId","parent"],nO=["indexId","uid"],rO=["uid","sequenceNumber"],iO=["indexId","uid","arrayValue","directionalValue","orderedDocumentKey","documentKey"],sO=["indexId","uid","orderedDocumentKey"],oO=["userId","collectionPath","documentId"],aO=["userId","collectionPath","largestBatchId"],cO=["userId","collectionGroup","largestBatchId"],lO=["mutationQueues","mutations","documentMutations","remoteDocuments","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries"],uO=[...lO,"documentOverlays"],hO=["mutationQueues","mutations","documentMutations","remoteDocumentsV14","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries","documentOverlays"],dO=hO,fO=[...dO,"indexConfiguration","indexState","indexEntries"];class pO extends OR{constructor(e,t){super(),this.ee=e,this.currentSequenceNumber=t}}function gO(e,t){var n=e;return UR.N(n.ee,t)}class mO{constructor(e,t,n,r){this.batchId=e,this.localWriteTime=t,this.baseMutations=n,this.mutations=r}applyToRemoteDocument(e,t){var n=t.mutationResults;for(let r=0;r<this.mutations.length;r++){const i=this.mutations[r];i.key.isEqual(e.key)&&UD(i,e,n[r])}}applyToLocalView(e,t){for(const n of this.baseMutations)n.key.isEqual(e.key)&&(t=VD(n,e,t,this.localWriteTime));for(const r of this.mutations)r.key.isEqual(e.key)&&(t=VD(r,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(s,o){const a=n1();return this.mutations.forEach(e=>{const t=s.get(e.key),n=t.overlayedDocument;let r=this.applyToLocalView(n,t.mutatedFields);r=o.has(e.key)?null:r;var i=FD(n,r);null!==i&&a.set(e.key,i),n.isValidDocument()||n.convertToNoDocument(yR.min())}),a}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),s1())}isEqual(e){return this.batchId===e.batchId&&gR(this.mutations,e.mutations,(e,t)=>jD(e,t))&&gR(this.baseMutations,e.baseMutations,(e,t)=>jD(e,t))}}class vO{constructor(e,t,n,r){this.batch=e,this.commitVersion=t,this.mutationResults=n,this.docVersions=r}static from(e,t,n){tR(e.mutations.length===n.length);let r=r1;var i=e.mutations;for(let s=0;s<i.length;s++)r=r.insert(i[s].key,n[s].version);return new vO(e,t,n,r)}}class yO{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return null!==e&&this.mutation===e.mutation}toString(){return`Overlay{\n      largestBatchId: ${this.largestBatchId},\n      mutation: ${this.mutation.toString()}\n    }`}}class _O{constructor(e,t,n,r,i=yR.min(),s=yR.min(),o=sP.EMPTY_BYTE_STRING){this.target=e,this.targetId=t,this.purpose=n,this.sequenceNumber=r,this.snapshotVersion=i,this.lastLimboFreeSnapshotVersion=s,this.resumeToken=o}withSequenceNumber(e){return new _O(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken)}withResumeToken(e,t){return new _O(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e)}withLastLimboFreeSnapshotVersion(e){return new _O(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken)}}class wO{constructor(e){this.ne=e}}function bO(e,t){const n=t.key,r={prefixPath:n.getCollectionPath().popLast().toArray(),collectionGroup:n.collectionGroup,documentId:n.path.lastSegment(),readTime:IO(t.readTime),hasCommittedMutations:t.hasCommittedMutations};if(t.isFoundDocument())r.document={name:E1(i=e.ne,(e=t).key),fields:e.data.value.mapValue.fields,updateTime:_1(i,e.version.toTimestamp())};else if(t.isNoDocument())r.noDocument={path:n.path.toArray(),readTime:TO(t.version)};else{if(!t.isUnknownDocument())return eR();r.unknownDocument={path:n.path.toArray(),version:TO(t.version)}}var i;return r}function IO(e){var t=e.toTimestamp();return[t.seconds,t.nanoseconds]}function TO(e){var t=e.toTimestamp();return{seconds:t.seconds,nanoseconds:t.nanoseconds}}function EO(e){var t=new vR(e.seconds,e.nanoseconds);return yR.fromTimestamp(t)}function SO(t,e){const n=(e.baseMutations||[]).map(e=>D1(t.ne,e));for(let s=0;s<e.mutations.length-1;++s){const n=e.mutations[s];if(s+1<e.mutations.length&&void 0!==e.mutations[s+1].transform){const r=e.mutations[s+1];n.updateTransforms=r.transform.fieldTransforms,e.mutations.splice(s+1,1),++s}}const r=e.mutations.map(e=>D1(t.ne,e)),i=vR.fromMillis(e.localWriteTimeMs);return new mO(e.batchId,i,n,r)}function kO(e){var t,n=EO(e.readTime),r=void 0!==e.lastLimboFreeSnapshotVersion?EO(e.lastLimboFreeSnapshotVersion):yR.min();let i;return i=void 0!==e.query.documents?(tR(1===(t=e.query).documents.length),hD(oD(C1(t.documents[0])))):hD(L1(e.query)),new _O(i,e.targetId,0,e.lastListenSequenceNumber,n,r,sP.fromBase64String(e.resumeToken))}function CO(e,t){var n=TO(t.snapshotVersion),r=TO(t.lastLimboFreeSnapshotVersion),i=(qP(t.target)?O1:M1)(e.ne,t.target),s=t.resumeToken.toBase64();return{targetId:t.targetId,canonicalId:VP(t.target),readTime:n,resumeToken:s,lastListenSequenceNumber:t.sequenceNumber,lastLimboFreeSnapshotVersion:r,query:i}}function AO(e){var t=L1({parent:e.parent,structuredQuery:e.structuredQuery});return"LAST"===e.limitType?dD(t,t.limit,"L"):t}function NO(e,t){return new yO(t.largestBatchId,D1(e.ne,t.overlayMutation))}function xO(e,t){var n=t.path.lastSegment();return[e,B1(t.path.popLast()),n]}function RO(e,t,n,r){return{indexId:e,uid:t.uid||"",sequenceNumber:n,readTime:TO(r.readTime),documentKey:B1(r.documentKey.path),largestBatchId:r.largestBatchId}}class PO{getBundleMetadata(e,t){return DO(e).get(t).next(e=>{if(e)return{id:(t=e).bundleId,createTime:EO(t.createTime),version:t.version};var t})}saveBundleMetadata(e,t){return DO(e).put({bundleId:(n=t).id,createTime:TO(b1(n.createTime)),version:n.version});var n}getNamedQuery(e,t){return OO(e).get(t).next(e=>{if(e)return{name:(t=e).name,query:AO(t.bundledQuery),readTime:EO(t.readTime)};var t})}saveNamedQuery(e,t){return OO(e).put({name:(t=t).name,readTime:TO(b1(t.readTime)),bundledQuery:t.bundledQuery})}}function DO(e){return gO(e,"bundles")}function OO(e){return gO(e,"namedQueries")}class MO{constructor(e,t){this.wt=e,this.userId=t}static se(e,t){var n=t.uid||"";return new MO(e,n)}getOverlay(e,t){return LO(e).get(xO(this.userId,t)).next(e=>e?NO(this.wt,e):null)}getOverlays(e,t){const n=n1();return LR.forEach(t,t=>this.getOverlay(e,t).next(e=>{null!==e&&n.set(t,e)})).next(()=>n)}saveOverlays(r,i,e){const s=[];return e.forEach((e,t)=>{var n=new yO(i,t);s.push(this.ie(r,n))}),LR.waitFor(s)}removeOverlaysForBatchId(n,e,r){const t=new Set;e.forEach(e=>t.add(B1(e.getCollectionPath())));const i=[];return t.forEach(e=>{var t=IDBKeyRange.bound([this.userId,e,r],[this.userId,e,r+1],!1,!0);i.push(LO(n).W("collectionPathOverlayIndex",t))}),LR.waitFor(i)}getOverlaysForCollection(e,t,n){const r=n1(),i=B1(t),s=IDBKeyRange.bound([this.userId,i,n],[this.userId,i,Number.POSITIVE_INFINITY],!0);return LO(e).K("collectionPathOverlayIndex",s).next(e=>{for(const t of e){const e=NO(this.wt,t);r.set(e.getKey(),e)}return r})}getOverlaysForCollectionGroup(e,t,n,i){const s=n1();let o;var r=IDBKeyRange.bound([this.userId,t,n],[this.userId,t,Number.POSITIVE_INFINITY],!0);return LO(e).J({index:"collectionGroupOverlayIndex",range:r},(e,t,n)=>{const r=NO(this.wt,t);s.size()<i||r.largestBatchId===o?(s.set(r.getKey(),r),o=r.largestBatchId):n.done()}).next(()=>s)}ie(e,t){return LO(e).put(function(e,t,n){var[,r,i]=xO(t,n.mutation.key);return{userId:t,collectionPath:r,documentId:i,collectionGroup:n.mutation.key.getCollectionGroup(),largestBatchId:n.largestBatchId,overlayMutation:P1(e.ne,n.mutation)}}(this.wt,this.userId,t))}}function LO(e){return gO(e,"documentOverlays")}class FO{constructor(){}re(e,t){this.oe(e,t),t.ue()}oe(e,t){var n,r;"nullValue"in e?this.ce(t,5):"booleanValue"in e?(this.ce(t,10),t.ae(e.booleanValue?1:0)):"integerValue"in e?(this.ce(t,15),t.ae(cP(e.integerValue))):"doubleValue"in e?(n=cP(e.doubleValue),isNaN(n)?this.ce(t,13):(this.ce(t,15),gP(n)?t.ae(0):t.ae(n))):"timestampValue"in e?(r=e.timestampValue,this.ce(t,20),"string"==typeof r?t.he(r):(t.he(`${r.seconds||""}`),t.ae(r.nanos||0))):"stringValue"in e?(this.le(e.stringValue,t),this.fe(t)):"bytesValue"in e?(this.ce(t,30),t.de(lP(e.bytesValue)),this.fe(t)):"referenceValue"in e?this._e(e.referenceValue,t):"geoPointValue"in e?(r=e.geoPointValue,this.ce(t,45),t.ae(r.latitude||0),t.ae(r.longitude||0)):"mapValue"in e?PP(e)?this.ce(t,Number.MAX_SAFE_INTEGER):(this.we(e.mapValue,t),this.fe(t)):"arrayValue"in e?(this.me(e.arrayValue,t),this.fe(t)):eR()}le(e,t){this.ce(t,25),this.ge(e,t)}ge(e,t){t.he(e)}we(e,t){var n=e.fields||{};this.ce(t,55);for(const e of Object.keys(n))this.le(e,t),this.oe(n[e],t)}me(e,t){var n=e.values||[];this.ce(t,50);for(const e of n)this.oe(e,t)}_e(e,t){this.ce(t,37),TR.fromName(e).path.forEach(e=>{this.ce(t,60),this.ge(e,t)})}ce(e,t){e.ae(t)}fe(e){e.ae(2)}}function UO(e){var t=64-function(e){let t=0;for(let r=0;r<8;++r){var n=function(e){if(0===e)return 8;let t=0;return e>>4==0&&(t+=4,e<<=4),e>>6==0&&(t+=2,e<<=2),e>>7==0&&(t+=1),t}(255&e[r]);if(t+=n,8!==n)break}return t}(e);return Math.ceil(t/8)}FO.ye=new FO;class VO{constructor(){this.buffer=new Uint8Array(1024),this.position=0}pe(e){const t=e[Symbol.iterator]();let n=t.next();for(;!n.done;)this.Ie(n.value),n=t.next();this.Te()}Ee(e){const t=e[Symbol.iterator]();let n=t.next();for(;!n.done;)this.Ae(n.value),n=t.next();this.Re()}be(e){for(const t of e){const e=t.charCodeAt(0);if(e<128)this.Ie(e);else if(e<2048)this.Ie(960|e>>>6),this.Ie(128|63&e);else if(t<"\ud800"||"\udbff"<t)this.Ie(480|e>>>12),this.Ie(128|63&e>>>6),this.Ie(128|63&e);else{const e=t.codePointAt(0);this.Ie(240|e>>>18),this.Ie(128|63&e>>>12),this.Ie(128|63&e>>>6),this.Ie(128|63&e)}}this.Te()}Pe(e){for(const t of e){const e=t.charCodeAt(0);if(e<128)this.Ae(e);else if(e<2048)this.Ae(960|e>>>6),this.Ae(128|63&e);else if(t<"\ud800"||"\udbff"<t)this.Ae(480|e>>>12),this.Ae(128|63&e>>>6),this.Ae(128|63&e);else{const e=t.codePointAt(0);this.Ae(240|e>>>18),this.Ae(128|63&e>>>12),this.Ae(128|63&e>>>6),this.Ae(128|63&e)}}this.Re()}ve(e){var t=this.Ve(e),n=UO(t);this.Se(1+n),this.buffer[this.position++]=255&n;for(let r=t.length-n;r<t.length;++r)this.buffer[this.position++]=255&t[r]}De(e){var t=this.Ve(e),n=UO(t);this.Se(1+n),this.buffer[this.position++]=~(255&n);for(let r=t.length-n;r<t.length;++r)this.buffer[this.position++]=~(255&t[r])}Ce(){this.xe(255),this.xe(255)}Ne(){this.ke(255),this.ke(255)}reset(){this.position=0}seed(e){this.Se(e.length),this.buffer.set(e,this.position),this.position+=e.length}Oe(){return this.buffer.slice(0,this.position)}Ve(e){const t=function(e){const t=new DataView(new ArrayBuffer(8));return t.setFloat64(0,e,!1),new Uint8Array(t.buffer)}(e),n=0!=(128&t[0]);t[0]^=n?255:128;for(let r=1;r<t.length;++r)t[r]^=n?255:0;return t}Ie(e){var t=255&e;0==t?(this.xe(0),this.xe(255)):255==t?(this.xe(255),this.xe(0)):this.xe(t)}Ae(e){var t=255&e;0==t?(this.ke(0),this.ke(255)):255==t?(this.ke(255),this.ke(0)):this.ke(e)}Te(){this.xe(0),this.xe(1)}Re(){this.ke(0),this.ke(1)}xe(e){this.Se(1),this.buffer[this.position++]=e}ke(e){this.Se(1),this.buffer[this.position++]=~e}Se(e){var t=e+this.position;if(!(t<=this.buffer.length)){let e=2*this.buffer.length;e<t&&(e=t);const n=new Uint8Array(e);n.set(this.buffer),this.buffer=n}}}class jO{constructor(e){this.Me=e}de(e){this.Me.pe(e)}he(e){this.Me.be(e)}ae(e){this.Me.ve(e)}ue(){this.Me.Ce()}}class qO{constructor(e){this.Me=e}de(e){this.Me.Ee(e)}he(e){this.Me.Pe(e)}ae(e){this.Me.De(e)}ue(){this.Me.Ne()}}class BO{constructor(){this.Me=new VO,this.Fe=new jO(this.Me),this.$e=new qO(this.Me)}seed(e){this.Me.seed(e)}Be(e){return 0===e?this.Fe:this.$e}Oe(){return this.Me.Oe()}reset(){this.Me.reset()}}class KO{constructor(e,t,n,r){this.indexId=e,this.documentKey=t,this.arrayValue=n,this.directionalValue=r}Le(){const e=this.directionalValue.length,t=0===e||255===this.directionalValue[e-1]?e+1:e,n=new Uint8Array(t);return n.set(this.directionalValue,0),t!==e?n.set([0],this.directionalValue.length):++n[n.length-1],new KO(this.indexId,this.documentKey,this.arrayValue,n)}}function $O(e,t){let n=e.indexId-t.indexId;return 0!==n?n:(n=zO(e.arrayValue,t.arrayValue),0!==n?n:(n=zO(e.directionalValue,t.directionalValue),0!==n?n:TR.comparator(e.documentKey,t.documentKey)))}function zO(e,t){for(let r=0;r<e.length&&r<t.length;++r){var n=e[r]-t[r];if(0!=n)return n}return e.length-t.length}class WO{constructor(e){this.collectionId=null!=e.collectionGroup?e.collectionGroup:e.path.lastSegment(),this.Ue=e.orderBy,this.qe=[];for(const t of e.filters){const e=t;e.ht()?this.Ke=e:this.qe.push(e)}}Ge(e){var t=SR(e);if(void 0!==t&&!this.Qe(t))return!1;var n=kR(e);let r=0,i=0;for(;r<n.length&&this.Qe(n[r]);++r);if(r===n.length)return!0;if(void 0!==this.Ke){const e=n[r];if(!this.je(this.Ke,e)||!this.We(this.Ue[i++],e))return!1;++r}for(;r<n.length;++r){const e=n[r];if(i>=this.Ue.length||!this.We(this.Ue[i++],e))return!1}return!0}Qe(e){for(const t of this.qe)if(this.je(t,e))return!0;return!1}je(e,t){if(void 0===e||!e.field.isEqual(t.fieldPath))return!1;var n="array-contains"===e.op||"array-contains-any"===e.op;return 2===t.kind==n}We(e,t){return!!e.field.isEqual(t.fieldPath)&&(0===t.kind&&"asc"===e.dir||1===t.kind&&"desc"===e.dir)}}class GO{constructor(){this.ze=new HO}addToCollectionParentIndex(e,t){return this.ze.add(t),LR.resolve()}getCollectionParents(e,t){return LR.resolve(this.ze.getEntries(t))}addFieldIndex(e,t){return LR.resolve()}deleteFieldIndex(e,t){return LR.resolve()}getDocumentsMatchingTarget(e,t){return LR.resolve(null)}getIndexType(e,t){return LR.resolve(0)}getFieldIndexes(e,t){return LR.resolve([])}getNextCollectionGroupToUpdate(e){return LR.resolve(null)}getMinOffset(e,t){return LR.resolve(RR.min())}getMinOffsetFromCollectionGroup(e,t){return LR.resolve(RR.min())}updateCollectionGroup(e,t,n){return LR.resolve()}updateIndexEntries(e,t){return LR.resolve()}}class HO{constructor(){this.index={}}add(e){const t=e.lastSegment(),n=e.popLast(),r=this.index[t]||new tP(wR.comparator),i=!r.has(n);return this.index[t]=r.add(n),i}has(e){const t=e.lastSegment(),n=e.popLast(),r=this.index[t];return r&&r.has(n)}getEntries(e){return(this.index[e]||new tP(wR.comparator)).toArray()}}const QO=new Uint8Array(0);class YO{constructor(e,t){this.user=e,this.databaseId=t,this.He=new HO,this.Je=new JD(e=>VP(e),(e,t)=>jP(e,t)),this.uid=e.uid||""}addToCollectionParentIndex(e,t){if(this.He.has(t))return LR.resolve();var n=t.lastSegment(),r=t.popLast();e.addOnCommittedListener(()=>{this.He.add(t)});r={collectionId:n,parent:B1(r)};return JO(e).put(r)}getCollectionParents(e,n){const r=[],t=IDBKeyRange.bound([n,""],[mR(n),""],!1,!0);return JO(e).K(t).next(e=>{for(const t of e){if(t.collectionId!==n)break;r.push($1(t.parent))}return r})}addFieldIndex(e,t){const n=ZO(e),r={indexId:t.indexId,collectionGroup:t.collectionGroup,fields:t.fields.map(e=>[e.fieldPath.canonicalString(),e.kind])};delete r.indexId;const i=n.add(r);if(t.indexState){const n=eM(e);return i.next(e=>{n.put(RO(e,this.user,t.indexState.sequenceNumber,t.indexState.offset))})}return i.next()}deleteFieldIndex(e,t){const n=ZO(e),r=eM(e),i=XO(e);return n.delete(t.indexId).next(()=>r.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0))).next(()=>i.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0)))}getDocumentsMatchingTarget(e,l){const u=XO(e);let h=!0;const n=new Map;return LR.forEach(this.Ye(l),t=>this.Xe(e,t).next(e=>{h=h&&!!e,n.set(t,e)})).next(()=>{if(h){let c=s1();const h=[];return LR.forEach(n,(e,t)=>{Yx("IndexedDbIndexManager",`Using index ${a=e,`id=${a.indexId}|cg=${a.collectionGroup}|f=${a.fields.map(e=>`${e.fieldPath}:${e.kind}`).join(",")}`} to execute ${VP(l)}`);var n=function(e,t){var n=SR(t);if(void 0===n)return null;for(const t of BP(e,n.fieldPath))switch(t.op){case"array-contains-any":return t.value.arrayValue.values||[];case"array-contains":return[t.value]}return null}(t,e),r=function(e,t){const n=new Map;for(const r of kR(t))for(const t of BP(e,r.fieldPath))switch(t.op){case"==":case"in":n.set(r.fieldPath.canonicalString(),t.value);break;case"not-in":case"!=":return n.set(r.fieldPath.canonicalString(),t.value),Array.from(n.values())}return null}(t,e),i=function(e,t){const n=[];let r=!0;for(const i of kR(t)){const t=(0===i.kind?KP:$P)(e,i.fieldPath,e.startAt);n.push(t.value),r=r&&t.inclusive}return new eD(n,r)}(t,e),s=function(e,t){const n=[];let r=!0;for(const i of kR(t)){const t=(0===i.kind?$P:KP)(e,i.fieldPath,e.endAt);n.push(t.value),r=r&&t.inclusive}return new eD(n,r)}(t,e),o=this.Ze(e,t,i),a=this.Ze(e,t,s),r=this.tn(e,t,r),r=this.en(e.indexId,n,o,i.inclusive,a,s.inclusive,r);return LR.forEach(r,e=>u.j(e,l.limit).next(e=>{e.forEach(e=>{var t=TR.fromSegments(e.documentKey);c.has(t)||(c=c.add(t),h.push(t))})}))}).next(()=>h)}return LR.resolve(null)})}Ye(e){var t;return(t=this.Je.get(e))||(this.Je.set(e,t=[e]),t)}en(t,e,n,r,i,s,o){const a=(null!=e?e.length:1)*Math.max(n.length,i.length),c=a/(null!=e?e.length:1),l=[];for(let u=0;u<a;++u){const a=e?this.nn(e[u/c]):QO,h=this.sn(t,a,n[u%c],r),d=this.rn(t,a,i[u%c],s),f=o.map(e=>this.sn(t,a,e,!0));l.push(...this.createRange(h,d,f))}return l}sn(e,t,n,r){const i=new KO(e,TR.empty(),t,n);return r?i:i.Le()}rn(e,t,n,r){const i=new KO(e,TR.empty(),t,n);return r?i.Le():i}Xe(e,t){const r=new WO(t),n=null!=t.collectionGroup?t.collectionGroup:t.path.lastSegment();return this.getFieldIndexes(e,n).next(e=>{let t=null;for(const n of e)r.Ge(n)&&(!t||n.fields.length>t.fields.length)&&(t=n);return t})}getIndexType(e,t){let n=2;return LR.forEach(this.Ye(t),t=>this.Xe(e,t).next(e=>{e?0!==n&&e.fields.length<function(e){let t=new tP(IR.comparator),n=!1;for(const r of e.filters){const e=r;e.field.isKeyField()||("array-contains"===e.op||"array-contains-any"===e.op?n=!0:t=t.add(e.field))}for(const n of e.orderBy)n.field.isKeyField()||(t=t.add(n.field));return t.size+(n?1:0)}(t)&&(n=1):n=0})).next(()=>n)}on(e,t){const n=new BO;for(const i of kR(e)){const e=t.data.field(i.fieldPath);if(null==e)return null;var r=n.Be(i.kind);FO.ye.re(e,r)}return n.Oe()}nn(e){const t=new BO;return FO.ye.re(e,t.Be(0)),t.Oe()}un(e,t){const n=new BO;return FO.ye.re(SP(this.databaseId,t),n.Be(0===(r=kR(e)).length?0:r[r.length-1].kind)),n.Oe();var r}tn(e,t,n){if(null===n)return[];let r=[];r.push(new BO);let i=0;for(const s of kR(e)){const e=n[i++];for(const n of r)if(this.cn(t,s.fieldPath)&&CP(e))r=this.an(r,s,e);else{const t=n.Be(s.kind);FO.ye.re(e,t)}}return this.hn(r)}Ze(e,t,n){return this.tn(e,t,n.position)}hn(e){const t=[];for(let n=0;n<e.length;++n)t[n]=e[n].Oe();return t}an(e,t,n){const r=[...e],i=[];for(const e of n.arrayValue.values||[])for(const n of r){const r=new BO;r.seed(n.Oe()),FO.ye.re(e,r.Be(t.kind)),i.push(r)}return i}cn(e,t){return!!e.filters.find(e=>e instanceof zP&&e.field.isEqual(t)&&("in"===e.op||"not-in"===e.op))}getFieldIndexes(e,t){const n=ZO(e),r=eM(e);return(t?n.K("collectionGroupIndex",IDBKeyRange.bound(t,t)):n.K()).next(e=>{const s=[];return LR.forEach(e,i=>r.get([i.indexId,this.uid]).next(e=>{var t,n,r;s.push((t=i,n=(e=e)?new AR(e.sequenceNumber,new RR(EO(e.readTime),new TR($1(e.documentKey)),e.largestBatchId)):AR.empty(),r=t.fields.map(([e,t])=>new CR(IR.fromServerFormat(e),t)),new ER(t.indexId,t.collectionGroup,r,n)))})).next(()=>s)})}getNextCollectionGroupToUpdate(e){return this.getFieldIndexes(e).next(e=>0===e.length?null:(e.sort((e,t)=>{var n=e.indexState.sequenceNumber-t.indexState.sequenceNumber;return 0!=n?n:pR(e.collectionGroup,t.collectionGroup)}),e[0].collectionGroup))}updateCollectionGroup(e,n,r){const i=ZO(e),s=eM(e);return this.ln(e).next(t=>i.K("collectionGroupIndex",IDBKeyRange.bound(n,n)).next(e=>LR.forEach(e,e=>s.put(RO(e.indexId,this.user,t,r)))))}updateIndexEntries(i,e){const n=new Map;return LR.forEach(e,(t,r)=>{var e=n.get(t.collectionGroup);return(e?LR.resolve(e):this.getFieldIndexes(i,t.collectionGroup)).next(e=>(n.set(t.collectionGroup,e),LR.forEach(e,n=>this.fn(i,t,n).next(e=>{var t=this.dn(r,n);return e.isEqual(t)?LR.resolve():this._n(i,r,n,e,t)}))))})}wn(e,t,n,r){return XO(e).put({indexId:r.indexId,uid:this.uid,arrayValue:r.arrayValue,directionalValue:r.directionalValue,orderedDocumentKey:this.un(n,t.key),documentKey:t.key.path.toArray()})}mn(e,t,n,r){return XO(e).delete([r.indexId,this.uid,r.arrayValue,r.directionalValue,this.un(n,t.key),t.key.path.toArray()])}fn(e,n,r){const t=XO(e);let i=new tP($O);return t.J({index:"documentKeyIndex",range:IDBKeyRange.only([r.indexId,this.uid,this.un(r,n)])},(e,t)=>{i=i.add(new KO(r.indexId,n,t.arrayValue,t.directionalValue))}).next(()=>i)}dn(e,t){let n=new tP($O);var r=this.on(t,e);if(null==r)return n;const i=SR(t);if(null!=i){var s=e.data.field(i.fieldPath);if(CP(s))for(const i of s.arrayValue.values||[])n=n.add(new KO(t.indexId,e.key,this.nn(i),r))}else n=n.add(new KO(t.indexId,e.key,QO,r));return n}_n(t,n,r,l,e){Yx("IndexedDbIndexManager","Updating index entries for document '%s'",n.key);const i=[];return function(e,n,r,i){var s=l.getIterator(),o=e.getIterator();let a=rP(s),c=rP(o);for(;a||c;){let e=!1,t=!1;if(a&&c){const r=n(a,c);r<0?t=!0:0<r&&(e=!0)}else null!=a?t=!0:e=!0;e?(r(c),c=rP(o)):t?(i(a),a=rP(s)):(a=rP(s),c=rP(o))}}(e,$O,e=>{i.push(this.wn(t,n,r,e))},e=>{i.push(this.mn(t,n,r,e))}),LR.waitFor(i)}ln(e){let r=1;return eM(e).J({index:"sequenceNumberIndex",reverse:!0,range:IDBKeyRange.upperBound([this.uid,Number.MAX_SAFE_INTEGER])},(e,t,n)=>{n.done(),r=t.sequenceNumber+1}).next(()=>r)}createRange(e,t,n){n=n.sort((e,t)=>$O(e,t)).filter((e,t,n)=>!t||0!==$O(e,n[t-1]));const r=[];r.push(e);for(const i of n){const n=$O(i,e),s=$O(i,t);if(0===n)r[0]=e.Le();else if(0<n&&s<0)r.push(i),r.push(i.Le());else if(0<s)break}r.push(t);const i=[];for(let o=0;o<r.length;o+=2)i.push(IDBKeyRange.bound([r[o].indexId,this.uid,r[o].arrayValue,r[o].directionalValue,QO,[]],[r[o+1].indexId,this.uid,r[o+1].arrayValue,r[o+1].directionalValue,QO,[]]));return i}getMinOffsetFromCollectionGroup(e,t){return this.getFieldIndexes(e,t).next(tM)}getMinOffset(t,e){return LR.mapArray(this.Ye(e),e=>this.Xe(t,e).next(e=>e||eR())).next(tM)}}function JO(e){return gO(e,"collectionParents")}function XO(e){return gO(e,"indexEntries")}function ZO(e){return gO(e,"indexConfiguration")}function eM(e){return gO(e,"indexState")}function tM(e){tR(0!==e.length);let t=e[0].indexState.offset,n=t.largestBatchId;for(let i=1;i<e.length;i++){var r=e[i].indexState.offset;PR(r,t)<0&&(t=r),n<r.largestBatchId&&(n=r.largestBatchId)}return new RR(t.readTime,t.documentKey,n)}const nM={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0};class rM{constructor(e,t,n){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=n}static withCacheSize(e){return new rM(e,rM.DEFAULT_COLLECTION_PERCENTILE,rM.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}}function iM(e,t,n){const r=e.store("mutations"),i=e.store("documentMutations"),s=[],o=IDBKeyRange.only(n.batchId);let a=0;const c=r.J({range:o},(e,t,n)=>(a++,n.delete()));s.push(c.next(()=>{tR(1===a)}));const l=[];for(const e of n.mutations){const r=G1(t,e.key.path,n.batchId);s.push(i.delete(r)),l.push(e.key)}return LR.waitFor(s).next(()=>l)}function sM(e){if(!e)return 0;let t;if(e.document)t=e.document;else if(e.unknownDocument)t=e.unknownDocument;else{if(!e.noDocument)throw eR();t=e.noDocument}return JSON.stringify(t).length}rM.DEFAULT_COLLECTION_PERCENTILE=10,rM.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,rM.DEFAULT=new rM(41943040,rM.DEFAULT_COLLECTION_PERCENTILE,rM.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),rM.DISABLED=new rM(-1,0,0);class oM{constructor(e,t,n,r){this.userId=e,this.wt=t,this.indexManager=n,this.referenceDelegate=r,this.gn={}}static se(e,t,n,r){tR(""!==e.uid);var i=e.isAuthenticated()?e.uid:"";return new oM(i,t,n,r)}checkEmpty(e){let r=!0;var t=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return cM(e).J({index:"userMutationsIndex",range:t},(e,t,n)=>{r=!1,n.done()}).next(()=>r)}addMutationBatch(u,h,d,f){const p=lM(u),g=cM(u);return g.add({}).next(e=>{tR("number"==typeof e);const t=new mO(e,h,d,f),n=(i=this.wt,s=this.userId,o=t,a=o.baseMutations.map(e=>P1(i.ne,e)),c=o.mutations.map(e=>P1(i.ne,e)),{userId:s,batchId:o.batchId,localWriteTimeMs:o.localWriteTime.toMillis(),baseMutations:a,mutations:c}),r=[];var i,s,o,a,c;let l=new tP((e,t)=>pR(e.canonicalString(),t.canonicalString()));for(const u of f){const h=G1(this.userId,u.key.path,e);l=l.add(u.key.path.popLast()),r.push(g.put(n)),r.push(p.put(h,H1))}return l.forEach(e=>{r.push(this.indexManager.addToCollectionParentIndex(u,e))}),u.addOnCommittedListener(()=>{this.gn[e]=t.keys()}),LR.waitFor(r).next(()=>t)})}lookupMutationBatch(e,t){return cM(e).get(t).next(e=>e?(tR(e.userId===this.userId),SO(this.wt,e)):null)}yn(e,n){return this.gn[n]?LR.resolve(this.gn[n]):this.lookupMutationBatch(e,n).next(e=>{if(e){var t=e.keys();return this.gn[n]=t}return null})}getNextMutationBatchAfterBatchId(e,t){const r=t+1,n=IDBKeyRange.lowerBound([this.userId,r]);let i=null;return cM(e).J({index:"userMutationsIndex",range:n},(e,t,n)=>{t.userId===this.userId&&(tR(t.batchId>=r),i=SO(this.wt,t)),n.done()}).next(()=>i)}getHighestUnacknowledgedBatchId(e){var t=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]);let r=-1;return cM(e).J({index:"userMutationsIndex",range:t,reverse:!0},(e,t,n)=>{r=t.batchId,n.done()}).next(()=>r)}getAllMutationBatches(e){var t=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return cM(e).K("userMutationsIndex",t).next(e=>e.map(e=>SO(this.wt,e)))}getAllMutationBatchesAffectingDocumentKey(o,a){const e=W1(this.userId,a.path),t=IDBKeyRange.lowerBound(e),c=[];return lM(o).J({range:t},(e,t,n)=>{var[r,i,s]=e,i=$1(i);if(r===this.userId&&a.path.isEqual(i))return cM(o).get(s).next(e=>{if(!e)throw eR();tR(e.userId===this.userId),c.push(SO(this.wt,e))});n.done()}).next(()=>c)}getAllMutationBatchesAffectingDocumentKeys(t,e){let a=new tP(pR);const n=[];return e.forEach(o=>{var e=W1(this.userId,o.path),e=IDBKeyRange.lowerBound(e),e=lM(t).J({range:e},(e,t,n)=>{var[r,i,s]=e,i=$1(i);r===this.userId&&o.path.isEqual(i)?a=a.add(s):n.done()});n.push(e)}),LR.waitFor(n).next(()=>this.pn(t,a))}getAllMutationBatchesAffectingQuery(e,t){const o=t.path,a=o.length+1,n=W1(this.userId,o),r=IDBKeyRange.lowerBound(n);let c=new tP(pR);return lM(e).J({range:r},(e,t,n)=>{var[r,i,s]=e,i=$1(i);r===this.userId&&o.isPrefixOf(i)?i.length===a&&(c=c.add(s)):n.done()}).next(()=>this.pn(e,c))}pn(t,e){const n=[],r=[];return e.forEach(e=>{r.push(cM(t).get(e).next(e=>{if(null===e)throw eR();tR(e.userId===this.userId),n.push(SO(this.wt,e))}))}),LR.waitFor(r).next(()=>n)}removeMutationBatch(t,n){return iM(t.ee,this.userId,n).next(e=>(t.addOnCommittedListener(()=>{this.In(n.batchId)}),LR.forEach(e,e=>this.referenceDelegate.markPotentiallyOrphaned(t,e))))}In(e){delete this.gn[e]}performConsistencyCheck(n){return this.checkEmpty(n).next(e=>{if(!e)return LR.resolve();var t=IDBKeyRange.lowerBound([this.userId]);const r=[];return lM(n).J({range:t},(e,t,n)=>{if(e[0]===this.userId){const t=$1(e[1]);r.push(t)}else n.done()}).next(()=>{tR(0===r.length)})})}containsKey(e,t){return aM(e,this.userId,t)}Tn(e){return uM(e).get(this.userId).next(e=>e||{userId:this.userId,lastAcknowledgedBatchId:-1,lastStreamToken:""})}}function aM(e,s,t){const n=W1(s,t.path),o=n[1],r=IDBKeyRange.lowerBound(n);let a=!1;return lM(e).J({range:r,H:!0},(e,t,n)=>{var[r,i]=e;r===s&&i===o&&(a=!0),n.done()}).next(()=>a)}function cM(e){return gO(e,"mutations")}function lM(e){return gO(e,"documentMutations")}function uM(e){return gO(e,"mutationQueues")}class hM{constructor(e){this.En=e}next(){return this.En+=2,this.En}static An(){return new hM(0)}static Rn(){return new hM(-1)}}class dM{constructor(e,t){this.referenceDelegate=e,this.wt=t}allocateTargetId(n){return this.bn(n).next(e=>{const t=new hM(e.highestTargetId);return e.highestTargetId=t.next(),this.Pn(n,e).next(()=>e.highestTargetId)})}getLastRemoteSnapshotVersion(e){return this.bn(e).next(e=>yR.fromTimestamp(new vR(e.lastRemoteSnapshotVersion.seconds,e.lastRemoteSnapshotVersion.nanoseconds)))}getHighestSequenceNumber(e){return this.bn(e).next(e=>e.highestListenSequenceNumber)}setTargetsMetadata(t,n,r){return this.bn(t).next(e=>(e.highestListenSequenceNumber=n,r&&(e.lastRemoteSnapshotVersion=r.toTimestamp()),n>e.highestListenSequenceNumber&&(e.highestListenSequenceNumber=n),this.Pn(t,e)))}addTargetData(t,n){return this.vn(t,n).next(()=>this.bn(t).next(e=>(e.targetCount+=1,this.Vn(n,e),this.Pn(t,e))))}updateTargetData(e,t){return this.vn(e,t)}removeTargetData(t,e){return this.removeMatchingKeysForTargetId(t,e.targetId).next(()=>fM(t).delete(e.targetId)).next(()=>this.bn(t)).next(e=>(tR(0<e.targetCount),--e.targetCount,this.Pn(t,e)))}removeTargets(r,i,s){let o=0;const a=[];return fM(r).J((e,t)=>{var n=kO(t);n.sequenceNumber<=i&&null===s.get(n.targetId)&&(o++,a.push(this.removeTargetData(r,n)))}).next(()=>LR.waitFor(a)).next(()=>o)}forEachTarget(e,r){return fM(e).J((e,t)=>{var n=kO(t);r(n)})}bn(e){return pM(e).get("targetGlobalKey").next(e=>(tR(null!==e),e))}Pn(e,t){return pM(e).put("targetGlobalKey",t)}vn(e,t){return fM(e).put(CO(this.wt,t))}Vn(e,t){let n=!1;return e.targetId>t.highestTargetId&&(t.highestTargetId=e.targetId,n=!0),e.sequenceNumber>t.highestListenSequenceNumber&&(t.highestListenSequenceNumber=e.sequenceNumber,n=!0),n}getTargetCount(e){return this.bn(e).next(e=>e.targetCount)}getTargetData(e,i){var t=VP(i),t=IDBKeyRange.bound([t,Number.NEGATIVE_INFINITY],[t,Number.POSITIVE_INFINITY]);let s=null;return fM(e).J({range:t,index:"queryTargetsIndex"},(e,t,n)=>{var r=kO(t);jP(i,r.target)&&(s=r,n.done())}).next(()=>s)}addMatchingKeys(n,e,r){const i=[],s=gM(n);return e.forEach(e=>{var t=B1(e.path);i.push(s.put({targetId:r,path:t})),i.push(this.referenceDelegate.addReference(n,r,e))}),LR.waitFor(i)}removeMatchingKeys(n,e,r){const i=gM(n);return LR.forEach(e,e=>{var t=B1(e.path);return LR.waitFor([i.delete([r,t]),this.referenceDelegate.removeReference(n,r,e)])})}removeMatchingKeysForTargetId(e,t){const n=gM(e),r=IDBKeyRange.bound([t],[t+1],!1,!0);return n.delete(r)}getMatchingKeysForTargetId(e,t){const n=IDBKeyRange.bound([t],[t+1],!1,!0),r=gM(e);let i=s1();return r.J({range:n,H:!0},(e,t,n)=>{var r=$1(e[1]),r=new TR(r);i=i.add(r)}).next(()=>i)}containsKey(e,t){var n=B1(t.path),n=IDBKeyRange.bound([n],[mR(n)],!1,!0);let r=0;return gM(e).J({index:"documentTargetsIndex",H:!0,range:n},([e],t,n)=>{0!==e&&(r++,n.done())}).next(()=>0<r)}te(e,t){return fM(e).get(t).next(e=>e?kO(e):null)}}function fM(e){return gO(e,"targets")}function pM(e){return gO(e,"targetGlobal")}function gM(e){return gO(e,"targetDocuments")}function mM([e,t],[n,r]){var i=pR(e,n);return 0===i?pR(t,r):i}class vM{constructor(e){this.Sn=e,this.buffer=new tP(mM),this.Dn=0}Cn(){return++this.Dn}xn(e){var t=[e,this.Cn()];if(this.buffer.size<this.Sn)this.buffer=this.buffer.add(t);else{const e=this.buffer.last();mM(t,e)<0&&(this.buffer=this.buffer.delete(e).add(t))}}get maxValue(){return this.buffer.last()[0]}}class yM{constructor(e,t,n){this.garbageCollector=e,this.asyncQueue=t,this.localStore=n,this.Nn=null}start(){-1!==this.garbageCollector.params.cacheSizeCollectionThreshold&&this.kn(6e4)}stop(){this.Nn&&(this.Nn.cancel(),this.Nn=null)}get started(){return null!==this.Nn}kn(e){Yx("LruGarbageCollector",`Garbage collection scheduled in ${e}ms`),this.Nn=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,async()=>{this.Nn=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(e){qR(e)?Yx("LruGarbageCollector","Ignoring IndexedDB error during garbage collection: ",e):await MR(e)}await this.kn(3e5)})}}class _M{constructor(e,t){this.On=e,this.params=t}calculateTargetCount(e,t){return this.On.Mn(e).next(e=>Math.floor(t/100*e))}nthSequenceNumber(e,t){if(0===t)return LR.resolve(HR.ot);const n=new vM(t);return this.On.forEachTarget(e,e=>n.xn(e.sequenceNumber)).next(()=>this.On.Fn(e,e=>n.xn(e))).next(()=>n.maxValue)}removeTargets(e,t,n){return this.On.removeTargets(e,t,n)}removeOrphanedDocuments(e,t){return this.On.removeOrphanedDocuments(e,t)}collect(t,n){return-1===this.params.cacheSizeCollectionThreshold?(Yx("LruGarbageCollector","Garbage collection skipped; disabled"),LR.resolve(nM)):this.getCacheSize(t).next(e=>e<this.params.cacheSizeCollectionThreshold?(Yx("LruGarbageCollector",`Garbage collection skipped; Cache size ${e} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),nM):this.$n(t,n))}getCacheSize(e){return this.On.getCacheSize(e)}$n(t,n){let r,i,s,o,a,c,l;const u=Date.now();return this.calculateTargetCount(t,this.params.percentileToCollect).next(e=>(i=e>this.params.maximumSequenceNumbersToCollect?(Yx("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${e}`),this.params.maximumSequenceNumbersToCollect):e,o=Date.now(),this.nthSequenceNumber(t,i))).next(e=>(r=e,a=Date.now(),this.removeTargets(t,r,n))).next(e=>(s=e,c=Date.now(),this.removeOrphanedDocuments(t,r))).next(e=>(l=Date.now(),Qx()<=$h.DEBUG&&Yx("LruGarbageCollector",`LRU Garbage Collection\n\tCounted targets in ${o-u}ms\n\tDetermined least recently used ${i} in `+(a-o)+"ms\n"+`\tRemoved ${s} targets in `+(c-a)+"ms\n"+`\tRemoved ${e} documents in `+(l-c)+"ms\n"+`Total Duration: ${l-u}ms`),LR.resolve({didRun:!0,sequenceNumbersCollected:i,targetsRemoved:s,documentsRemoved:e})))}}class wM{constructor(e,t){this.db=e,this.garbageCollector=(e=this,t=t,new _M(e,t))}Mn(e){const n=this.Bn(e);return this.db.getTargetCache().getTargetCount(e).next(t=>n.next(e=>t+e))}Bn(e){let t=0;return this.Fn(e,e=>{t++}).next(()=>t)}forEachTarget(e,t){return this.db.getTargetCache().forEachTarget(e,t)}Fn(e,n){return this.Ln(e,(e,t)=>n(t))}addReference(e,t,n){return bM(e,n)}removeReference(e,t,n){return bM(e,n)}removeTargets(e,t,n){return this.db.getTargetCache().removeTargets(e,t,n)}markPotentiallyOrphaned(e,t){return bM(e,t)}Un(t,n){let r=!1;return uM(t).Y(e=>aM(t,e,n).next(e=>(e&&(r=!0),LR.resolve(!e)))).next(()=>r)}removeOrphanedDocuments(n,r){const i=this.db.getRemoteDocumentCache().newChangeBuffer(),s=[];let o=0;return this.Ln(n,(t,e)=>{if(e<=r){const r=this.Un(n,t).next(e=>{if(!e)return o++,i.getEntry(n,t).next(()=>(i.removeEntry(t,yR.min()),gM(n).delete([0,B1(t.path)])))});s.push(r)}}).next(()=>LR.waitFor(s)).next(()=>i.apply(n)).next(()=>o)}removeTarget(e,t){var n=t.withSequenceNumber(e.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(e,n)}updateLimboDocument(e,t){return bM(e,t)}Ln(e,r){const t=gM(e);let i,s=HR.ot;return t.J({index:"documentTargetsIndex"},([e],{path:t,sequenceNumber:n})=>{0===e?(s!==HR.ot&&r(new TR($1(i)),s),s=n,i=t):s=HR.ot}).next(()=>{s!==HR.ot&&r(new TR($1(i)),s)})}getCacheSize(e){return this.db.getRemoteDocumentCache().getSize(e)}}function bM(e,t){return gM(e).put((e=e.currentSequenceNumber,{targetId:0,path:B1(t.path),sequenceNumber:e}))}class IM{constructor(){this.changes=new JD(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,LP.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();var n=this.changes.get(t);return void 0!==n?LR.resolve(n):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}class TM{constructor(e){this.wt=e}setIndexManager(e){this.indexManager=e}addEntry(e,t,n){return CM(e).put(n)}removeEntry(e,n,t){return CM(e).delete(function(e){const t=n.path.toArray();return[t.slice(0,t.length-2),t[t.length-2],IO(e),t[t.length-1]]}(t))}updateMetadata(t,n){return this.getMetadata(t).next(e=>(e.byteSize+=n,this.qn(t,e)))}getEntry(e,n){let r=LP.newInvalidDocument(n);return CM(e).J({index:"documentKeyIndex",range:IDBKeyRange.only(AM(n))},(e,t)=>{r=this.Kn(n,t)}).next(()=>r)}Gn(e,n){let r={size:0,document:LP.newInvalidDocument(n)};return CM(e).J({index:"documentKeyIndex",range:IDBKeyRange.only(AM(n))},(e,t)=>{r={document:this.Kn(n,t),size:sM(t)}}).next(()=>r)}getEntries(e,t){let r=XD;return this.Qn(e,t,(e,t)=>{var n=this.Kn(e,t);r=r.insert(e,n)}).next(()=>r)}jn(e,t){let r=XD,i=new XR(TR.comparator);return this.Qn(e,t,(e,t)=>{var n=this.Kn(e,t);r=r.insert(e,n),i=i.insert(e,sM(t))}).next(()=>({documents:r,Wn:i}))}Qn(e,t,i){if(t.isEmpty())return LR.resolve();let n=new tP(xM);t.forEach(e=>n=n.add(e));const r=IDBKeyRange.bound(AM(n.first()),AM(n.last())),s=n.getIterator();let o=s.getNext();return CM(e).J({index:"documentKeyIndex",range:r},(e,t,n)=>{for(var r=TR.fromSegments([...t.prefixPath,t.collectionGroup,t.documentId]);o&&xM(o,r)<0;)i(o,null),o=s.getNext();o&&o.isEqual(r)&&(i(o,t),o=s.hasNext()?s.getNext():null),o?n.q(AM(o)):n.done()}).next(()=>{for(;o;)i(o,null),o=s.hasNext()?s.getNext():null})}getAllFromCollection(e,t,n){var r=[t.popLast().toArray(),t.lastSegment(),IO(n.readTime),n.documentKey.path.isEmpty()?"":n.documentKey.path.lastSegment()],i=[t.popLast().toArray(),t.lastSegment(),[Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],""];return CM(e).K(IDBKeyRange.bound(r,i,!0)).next(e=>{let t=XD;for(const n of e){const e=this.Kn(TR.fromSegments(n.prefixPath.concat(n.collectionGroup,n.documentId)),n);t=t.insert(e.key,e)}return t})}getAllFromCollectionGroup(e,t,n,i){let s=XD;var r=NM(t,n),o=NM(t,RR.max());return CM(e).J({index:"collectionGroupIndex",range:IDBKeyRange.bound(r,o,!0)},(e,t,n)=>{var r=this.Kn(TR.fromSegments(t.prefixPath.concat(t.collectionGroup,t.documentId)),t);s=s.insert(r.key,r),s.size===i&&n.done()}).next(()=>s)}newChangeBuffer(e){return new SM(this,!!e&&e.trackRemovals)}getSize(e){return this.getMetadata(e).next(e=>e.byteSize)}getMetadata(e){return kM(e).get("remoteDocumentGlobalKey").next(e=>(tR(!!e),e))}qn(e,t){return kM(e).put("remoteDocumentGlobalKey",t)}Kn(e,t){if(t){const e=function(e,t){let n;if(t.document)n=R1(e.ne,t.document,!!t.hasCommittedMutations);else if(t.noDocument){const e=TR.fromSegments(t.noDocument.path),i=EO(t.noDocument.readTime);n=LP.newNoDocument(e,i),t.hasCommittedMutations&&n.setHasCommittedMutations()}else{if(!t.unknownDocument)return eR();{const e=TR.fromSegments(t.unknownDocument.path),s=EO(t.unknownDocument.version);n=LP.newUnknownDocument(e,s)}}return t.readTime&&n.setReadTime((t=t.readTime,r=new vR(t[0],t[1]),yR.fromTimestamp(r))),n;var r}(this.wt,t);if(!e.isNoDocument()||!e.version.isEqual(yR.min()))return e}return LP.newInvalidDocument(e)}}function EM(e){return new TM(e)}class SM extends IM{constructor(e,t){super(),this.zn=e,this.trackRemovals=t,this.Hn=new JD(e=>e.toString(),(e,t)=>e.isEqual(t))}applyChanges(s){const o=[];let a=0,c=new tP((e,t)=>pR(e.canonicalString(),t.canonicalString()));return this.changes.forEach((e,t)=>{var n=this.Hn.get(e);if(o.push(this.zn.removeEntry(s,e,n.readTime)),t.isValidDocument()){var r=bO(this.zn.wt,t);c=c.add(e.path.popLast());var i=sM(r);a+=i-n.size,o.push(this.zn.addEntry(s,e,r))}else if(a-=n.size,this.trackRemovals){const a=bO(this.zn.wt,t.convertToNoDocument(yR.min()));o.push(this.zn.addEntry(s,e,a))}}),c.forEach(e=>{o.push(this.zn.indexManager.addToCollectionParentIndex(s,e))}),o.push(this.zn.updateMetadata(s,a)),LR.waitFor(o)}getFromCache(e,t){return this.zn.Gn(e,t).next(e=>(this.Hn.set(t,{size:e.size,readTime:e.document.readTime}),e.document))}getAllFromCache(e,t){return this.zn.jn(e,t).next(({documents:n,Wn:e})=>(e.forEach((e,t)=>{this.Hn.set(e,{size:t,readTime:n.get(e).readTime})}),n))}}function kM(e){return gO(e,"remoteDocumentGlobal")}function CM(e){return gO(e,"remoteDocumentsV14")}function AM(e){const t=e.path.toArray();return[t.slice(0,t.length-2),t[t.length-2],t[t.length-1]]}function NM(e,t){const n=t.documentKey.path.toArray();return[e,IO(t.readTime),n.slice(0,n.length-2),0<n.length?n[n.length-1]:""]}function xM(e,t){var n=e.path.toArray(),r=t.path.toArray();let i=0;for(let s=0;s<n.length-2&&s<r.length-2;++s)if(i=pR(n[s],r[s]),i)return i;return i=pR(n.length,r.length),i||(i=pR(n[n.length-2],r[r.length-2]),i||pR(n[n.length-1],r[r.length-1]))}class RM{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}class PM{constructor(e,t,n,r){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=n,this.indexManager=r}getDocument(t,n){let r=null;return this.documentOverlayCache.getOverlay(t,n).next(e=>(r=e,this.getBaseDocument(t,n,r))).next(e=>(null!==r&&VD(r.mutation,e,iP.empty(),vR.now()),e))}getDocuments(t,e){return this.remoteDocumentCache.getEntries(t,e).next(e=>this.getLocalViewOfDocuments(t,e,s1()).next(()=>e))}getLocalViewOfDocuments(e,t,n=s1()){const r=n1();return this.populateOverlays(e,r,t).next(()=>this.computeViews(e,t,r,n).next(e=>{let n=e1();return e.forEach((e,t)=>{n=n.insert(e,t.overlayedDocument)}),n}))}getOverlayedDocuments(e,t){const n=n1();return this.populateOverlays(e,n,t).next(()=>this.computeViews(e,t,n,s1()))}populateOverlays(e,n,t){const r=[];return t.forEach(e=>{n.has(e)||r.push(e)}),this.documentOverlayCache.getOverlays(e,r).next(e=>{e.forEach((e,t)=>{n.set(e,t)})})}computeViews(e,t,r,i){let s=XD;const o=n1(),a=n1();return t.forEach((e,t)=>{const n=r.get(t.key);i.has(t.key)&&(void 0===n||n.mutation instanceof BD)?s=s.insert(t.key,t):void 0!==n&&(o.set(t.key,n.mutation.getFieldMask()),VD(n.mutation,t,n.mutation.getFieldMask(),vR.now()))}),this.recalculateAndSaveOverlays(e,s).next(e=>(e.forEach((e,t)=>o.set(e,t)),t.forEach((e,t)=>{var n;return a.set(e,new RM(t,null!==(n=o.get(e))&&void 0!==n?n:null))}),a))}recalculateAndSaveOverlays(s,o){const a=n1();let c=new XR((e,t)=>e-t),l=s1();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(s,o).next(e=>{for(const r of e)r.keys().forEach(e=>{var t,n=o.get(e);null!==n&&(t=a.get(e)||iP.empty(),t=r.applyToLocalView(n,t),a.set(e,t),t=(c.get(r.batchId)||s1()).add(e),c=c.insert(r.batchId,t))})}).next(()=>{const e=[],t=c.getReverseIterator();for(;t.hasNext();){const c=t.getNext(),n=c.key,r=c.value,i=n1();r.forEach(e=>{var t;l.has(e)||(null!==(t=FD(o.get(e),a.get(e)))&&i.set(e,t),l=l.add(e))}),e.push(this.documentOverlayCache.saveOverlays(s,n,i))}return LR.waitFor(e)}).next(()=>a)}recalculateAndSaveOverlaysForDocumentKeys(t,e){return this.remoteDocumentCache.getEntries(t,e).next(e=>this.recalculateAndSaveOverlays(t,e))}getDocumentsMatchingQuery(e,t,n){return r=t,TR.isDocumentKey(r.path)&&null===r.collectionGroup&&0===r.filters.length?this.getDocumentsMatchingDocumentQuery(e,t.path):lD(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,n):this.getDocumentsMatchingCollectionQuery(e,t,n);var r}getNextDocuments(s,t,o,a){return this.remoteDocumentCache.getAllFromCollectionGroup(s,t,o,a).next(n=>{const e=0<a-n.size?this.documentOverlayCache.getOverlaysForCollectionGroup(s,t,o.largestBatchId,a-n.size):LR.resolve(n1());let r=-1,i=n;return e.next(e=>LR.forEach(e,(t,e)=>(r<e.largestBatchId&&(r=e.largestBatchId),n.get(t)?LR.resolve():this.getBaseDocument(s,t,e).next(e=>{i=i.insert(t,e)}))).next(()=>this.populateOverlays(s,e,n)).next(()=>this.computeViews(s,i,e,s1())).next(e=>({batchId:r,changes:t1(e)})))})}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new TR(t)).next(e=>{let t=e1();return e.isFoundDocument()&&(t=t.insert(e.key,e)),t})}getDocumentsMatchingCollectionGroupQuery(r,i,s){const o=i.collectionGroup;let a=e1();return this.indexManager.getCollectionParents(r,o).next(e=>LR.forEach(e,e=>{var t,n=(t=i,e=e.child(o),new iD(e,null,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,t.startAt,t.endAt));return this.getDocumentsMatchingCollectionQuery(r,n,s).next(e=>{e.forEach((e,t)=>{a=a.insert(e,t)})})}).next(()=>a))}getDocumentsMatchingCollectionQuery(t,s,n){let o;return this.remoteDocumentCache.getAllFromCollection(t,s.path,n).next(e=>(o=e,this.documentOverlayCache.getOverlaysForCollection(t,s.path,n.largestBatchId))).next(r=>{r.forEach((e,t)=>{var n=t.getKey();null===o.get(n)&&(o=o.insert(n,LP.newInvalidDocument(n)))});let i=e1();return o.forEach((e,t)=>{var n=r.get(e);void 0!==n&&VD(n.mutation,t,iP.empty(),vR.now()),mD(s,t)&&(i=i.insert(e,t))}),i})}getBaseDocument(e,t,n){return null===n||1===n.mutation.type?this.remoteDocumentCache.getEntry(e,t):LR.resolve(LP.newInvalidDocument(t))}}class DM{constructor(e){this.wt=e,this.Jn=new Map,this.Yn=new Map}getBundleMetadata(e,t){return LR.resolve(this.Jn.get(t))}saveBundleMetadata(e,t){return this.Jn.set(t.id,{id:t.id,version:t.version,createTime:b1(t.createTime)}),LR.resolve()}getNamedQuery(e,t){return LR.resolve(this.Yn.get(t))}saveNamedQuery(e,t){return this.Yn.set(t.name,{name:(t=t).name,query:AO(t.bundledQuery),readTime:b1(t.readTime)}),LR.resolve()}}class OM{constructor(){this.overlays=new XR(TR.comparator),this.Xn=new Map}getOverlay(e,t){return LR.resolve(this.overlays.get(t))}getOverlays(e,t){const n=n1();return LR.forEach(t,t=>this.getOverlay(e,t).next(e=>{null!==e&&n.set(t,e)})).next(()=>n)}saveOverlays(n,r,e){return e.forEach((e,t)=>{this.ie(n,r,t)}),LR.resolve()}removeOverlaysForBatchId(e,t,n){const r=this.Xn.get(n);return void 0!==r&&(r.forEach(e=>this.overlays=this.overlays.remove(e)),this.Xn.delete(n)),LR.resolve()}getOverlaysForCollection(e,t,n){const r=n1(),i=t.length+1,s=new TR(t.child("")),o=this.overlays.getIteratorFrom(s);for(;o.hasNext();){const e=o.getNext().value,s=e.getKey();if(!t.isPrefixOf(s.path))break;s.path.length===i&&e.largestBatchId>n&&r.set(e.getKey(),e)}return LR.resolve(r)}getOverlaysForCollectionGroup(t,e,n,r){let i=new XR((e,t)=>e-t);const s=this.overlays.getIterator();for(;s.hasNext();){const t=s.getNext().value;if(t.getKey().getCollectionGroup()===e&&t.largestBatchId>n){let e=i.get(t.largestBatchId);null===e&&(e=n1(),i=i.insert(t.largestBatchId,e)),e.set(t.getKey(),t)}}const o=n1(),a=i.getIterator();for(;a.hasNext()&&(a.getNext().value.forEach((e,t)=>o.set(e,t)),!(o.size()>=r)););return LR.resolve(o)}ie(e,t,n){var r=this.overlays.get(n.key);if(null!==r){const e=this.Xn.get(r.largestBatchId).delete(n.key);this.Xn.set(r.largestBatchId,e)}this.overlays=this.overlays.insert(n.key,new yO(t,n));let i=this.Xn.get(t);void 0===i&&(i=s1(),this.Xn.set(t,i)),this.Xn.set(t,i.add(n.key))}}class MM{constructor(){this.Zn=new tP(LM.ts),this.es=new tP(LM.ns)}isEmpty(){return this.Zn.isEmpty()}addReference(e,t){var n=new LM(e,t);this.Zn=this.Zn.add(n),this.es=this.es.add(n)}ss(e,t){e.forEach(e=>this.addReference(e,t))}removeReference(e,t){this.rs(new LM(e,t))}os(e,t){e.forEach(e=>this.removeReference(e,t))}us(e){const t=new TR(new wR([])),n=new LM(t,e),r=new LM(t,e+1),i=[];return this.es.forEachInRange([n,r],e=>{this.rs(e),i.push(e.key)}),i}cs(){this.Zn.forEach(e=>this.rs(e))}rs(e){this.Zn=this.Zn.delete(e),this.es=this.es.delete(e)}hs(e){var t=new TR(new wR([])),n=new LM(t,e),t=new LM(t,e+1);let r=s1();return this.es.forEachInRange([n,t],e=>{r=r.add(e.key)}),r}containsKey(e){var t=new LM(e,0),t=this.Zn.firstAfterOrEqual(t);return null!==t&&e.isEqual(t.key)}}class LM{constructor(e,t){this.key=e,this.ls=t}static ts(e,t){return TR.comparator(e.key,t.key)||pR(e.ls,t.ls)}static ns(e,t){return pR(e.ls,t.ls)||TR.comparator(e.key,t.key)}}class FM{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.fs=1,this.ds=new tP(LM.ts)}checkEmpty(e){return LR.resolve(0===this.mutationQueue.length)}addMutationBatch(e,t,n,r){var i=this.fs;this.fs++,0<this.mutationQueue.length&&this.mutationQueue[this.mutationQueue.length-1];var s=new mO(i,t,n,r);this.mutationQueue.push(s);for(const t of r)this.ds=this.ds.add(new LM(t.key,i)),this.indexManager.addToCollectionParentIndex(e,t.key.path.popLast());return LR.resolve(s)}lookupMutationBatch(e,t){return LR.resolve(this._s(t))}getNextMutationBatchAfterBatchId(e,t){var n=this.ws(t+1),n=n<0?0:n;return LR.resolve(this.mutationQueue.length>n?this.mutationQueue[n]:null)}getHighestUnacknowledgedBatchId(){return LR.resolve(0===this.mutationQueue.length?-1:this.fs-1)}getAllMutationBatches(e){return LR.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){const n=new LM(t,0),r=new LM(t,Number.POSITIVE_INFINITY),i=[];return this.ds.forEachInRange([n,r],e=>{var t=this._s(e.ls);i.push(t)}),LR.resolve(i)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new tP(pR);return t.forEach(e=>{var t=new LM(e,0),n=new LM(e,Number.POSITIVE_INFINITY);this.ds.forEachInRange([t,n],e=>{r=r.add(e.ls)})}),LR.resolve(this.gs(r))}getAllMutationBatchesAffectingQuery(e,t){const n=t.path,r=n.length+1;let i=n;TR.isDocumentKey(i)||(i=i.child(""));var s=new LM(new TR(i),0);let o=new tP(pR);return this.ds.forEachWhile(e=>{var t=e.key.path;return!!n.isPrefixOf(t)&&(t.length===r&&(o=o.add(e.ls)),!0)},s),LR.resolve(this.gs(o))}gs(e){const n=[];return e.forEach(e=>{var t=this._s(e);null!==t&&n.push(t)}),n}removeMutationBatch(n,r){tR(0===this.ys(r.batchId,"removed")),this.mutationQueue.shift();let i=this.ds;return LR.forEach(r.mutations,e=>{var t=new LM(e.key,r.batchId);return i=i.delete(t),this.referenceDelegate.markPotentiallyOrphaned(n,e.key)}).next(()=>{this.ds=i})}In(e){}containsKey(e,t){var n=new LM(t,0),n=this.ds.firstAfterOrEqual(n);return LR.resolve(t.isEqual(n&&n.key))}performConsistencyCheck(e){return this.mutationQueue.length,LR.resolve()}ys(e,t){return this.ws(e)}ws(e){return 0===this.mutationQueue.length?0:e-this.mutationQueue[0].batchId}_s(e){var t=this.ws(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}class UM{constructor(e){this.ps=e,this.docs=new XR(TR.comparator),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){const n=t.key,r=this.docs.get(n),i=r?r.size:0,s=this.ps(t);return this.docs=this.docs.insert(n,{document:t.mutableCopy(),size:s}),this.size+=s-i,this.indexManager.addToCollectionParentIndex(e,n.path.popLast())}removeEntry(e){var t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){const n=this.docs.get(t);return LR.resolve(n?n.document.mutableCopy():LP.newInvalidDocument(t))}getEntries(e,t){let n=XD;return t.forEach(e=>{const t=this.docs.get(e);n=n.insert(e,t?t.document.mutableCopy():LP.newInvalidDocument(e))}),LR.resolve(n)}getAllFromCollection(e,t,n){let r=XD;const i=new TR(t.child("")),s=this.docs.getIteratorFrom(i);for(;s.hasNext();){const{key:e,value:{document:i}}=s.getNext();if(!t.isPrefixOf(e.path))break;e.path.length>t.length+1||PR(xR(i),n)<=0||(r=r.insert(i.key,i.mutableCopy()))}return LR.resolve(r)}getAllFromCollectionGroup(e,t,n,r){eR()}Is(e,t){return LR.forEach(this.docs,e=>t(e))}newChangeBuffer(e){return new VM(this)}getSize(e){return LR.resolve(this.size)}}class VM extends IM{constructor(e){super(),this.zn=e}applyChanges(n){const r=[];return this.changes.forEach((e,t)=>{t.isValidDocument()?r.push(this.zn.addEntry(n,t)):this.zn.removeEntry(e)}),LR.waitFor(r)}getFromCache(e,t){return this.zn.getEntry(e,t)}getAllFromCache(e,t){return this.zn.getEntries(e,t)}}class jM{constructor(e){this.persistence=e,this.Ts=new JD(e=>VP(e),jP),this.lastRemoteSnapshotVersion=yR.min(),this.highestTargetId=0,this.Es=0,this.As=new MM,this.targetCount=0,this.Rs=hM.An()}forEachTarget(e,n){return this.Ts.forEach((e,t)=>n(t)),LR.resolve()}getLastRemoteSnapshotVersion(e){return LR.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return LR.resolve(this.Es)}allocateTargetId(e){return this.highestTargetId=this.Rs.next(),LR.resolve(this.highestTargetId)}setTargetsMetadata(e,t,n){return n&&(this.lastRemoteSnapshotVersion=n),t>this.Es&&(this.Es=t),LR.resolve()}vn(e){this.Ts.set(e.target,e);var t=e.targetId;t>this.highestTargetId&&(this.Rs=new hM(t),this.highestTargetId=t),e.sequenceNumber>this.Es&&(this.Es=e.sequenceNumber)}addTargetData(e,t){return this.vn(t),this.targetCount+=1,LR.resolve()}updateTargetData(e,t){return this.vn(t),LR.resolve()}removeTargetData(e,t){return this.Ts.delete(t.target),this.As.us(t.targetId),--this.targetCount,LR.resolve()}removeTargets(n,r,i){let s=0;const o=[];return this.Ts.forEach((e,t)=>{t.sequenceNumber<=r&&null===i.get(t.targetId)&&(this.Ts.delete(e),o.push(this.removeMatchingKeysForTargetId(n,t.targetId)),s++)}),LR.waitFor(o).next(()=>s)}getTargetCount(e){return LR.resolve(this.targetCount)}getTargetData(e,t){var n=this.Ts.get(t)||null;return LR.resolve(n)}addMatchingKeys(e,t,n){return this.As.ss(t,n),LR.resolve()}removeMatchingKeys(t,e,n){this.As.os(e,n);const r=this.persistence.referenceDelegate,i=[];return r&&e.forEach(e=>{i.push(r.markPotentiallyOrphaned(t,e))}),LR.waitFor(i)}removeMatchingKeysForTargetId(e,t){return this.As.us(t),LR.resolve()}getMatchingKeysForTargetId(e,t){var n=this.As.hs(t);return LR.resolve(n)}containsKey(e,t){return LR.resolve(this.As.containsKey(t))}}class qM{constructor(e,t){this.bs={},this.overlays={},this.Ps=new HR(0),this.vs=!1,this.vs=!0,this.referenceDelegate=e(this),this.Vs=new jM(this),this.indexManager=new GO,this.remoteDocumentCache=(e=e=>this.referenceDelegate.Ss(e),new UM(e)),this.wt=new wO(t),this.Ds=new DM(this.wt)}start(){return Promise.resolve()}shutdown(){return this.vs=!1,Promise.resolve()}get started(){return this.vs}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new OM,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let n=this.bs[e.toKey()];return n||(n=new FM(t,this.referenceDelegate),this.bs[e.toKey()]=n),n}getTargetCache(){return this.Vs}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Ds}runTransaction(e,t,n){Yx("MemoryPersistence","Starting transaction:",e);const r=new BM(this.Ps.next());return this.referenceDelegate.Cs(),n(r).next(e=>this.referenceDelegate.xs(r).next(()=>e)).toPromise().then(e=>(r.raiseOnCommittedEvent(),e))}Ns(t,n){return LR.or(Object.values(this.bs).map(e=>()=>e.containsKey(t,n)))}}class BM extends OR{constructor(e){super(),this.currentSequenceNumber=e}}class KM{constructor(e){this.persistence=e,this.ks=new MM,this.Os=null}static Ms(e){return new KM(e)}get Fs(){if(this.Os)return this.Os;throw eR()}addReference(e,t,n){return this.ks.addReference(n,t),this.Fs.delete(n.toString()),LR.resolve()}removeReference(e,t,n){return this.ks.removeReference(n,t),this.Fs.add(n.toString()),LR.resolve()}markPotentiallyOrphaned(e,t){return this.Fs.add(t.toString()),LR.resolve()}removeTarget(e,t){this.ks.us(t.targetId).forEach(e=>this.Fs.add(e.toString()));const n=this.persistence.getTargetCache();return n.getMatchingKeysForTargetId(e,t.targetId).next(e=>{e.forEach(e=>this.Fs.add(e.toString()))}).next(()=>n.removeTargetData(e,t))}Cs(){this.Os=new Set}xs(n){const r=this.persistence.getRemoteDocumentCache().newChangeBuffer();return LR.forEach(this.Fs,e=>{const t=TR.fromPath(e);return this.$s(n,t).next(e=>{e||r.removeEntry(t,yR.min())})}).next(()=>(this.Os=null,r.apply(n)))}updateLimboDocument(e,t){return this.$s(e,t).next(e=>{e?this.Fs.delete(t.toString()):this.Fs.add(t.toString())})}Ss(e){return 0}$s(e,t){return LR.or([()=>LR.resolve(this.ks.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Ns(e,t)])}}class $M{constructor(e){this.wt=e}O(t,e,n,r){const i=new FR("createOrUpgrade",e);var s;n<1&&1<=r&&(t.createObjectStore("owner"),(s=t).createObjectStore("mutationQueues",{keyPath:"userId"}),s.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",z1,{unique:!0}),s.createObjectStore("documentMutations"),zM(t),t.createObjectStore("remoteDocuments"));let o=LR.resolve();return n<3&&3<=r&&(0!==n&&((s=t).deleteObjectStore("targetDocuments"),s.deleteObjectStore("targets"),s.deleteObjectStore("targetGlobal"),zM(t)),o=o.next(()=>function(){const e=i.store("targetGlobal"),t={highestTargetId:0,highestListenSequenceNumber:0,lastRemoteSnapshotVersion:yR.min().toTimestamp(),targetCount:0};return e.put("targetGlobalKey",t)}())),n<4&&4<=r&&(0!==n&&(o=o.next(()=>function(r,i){return i.store("mutations").K().next(e=>{r.deleteObjectStore("mutations"),r.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",z1,{unique:!0});const t=i.store("mutations"),n=e.map(e=>t.put(e));return LR.waitFor(n)})}(t,i))),o=o.next(()=>{t.createObjectStore("clientMetadata",{keyPath:"clientId"})})),n<5&&5<=r&&(o=o.next(()=>this.Bs(i))),n<6&&6<=r&&(o=o.next(()=>(t.createObjectStore("remoteDocumentGlobal"),this.Ls(i)))),n<7&&7<=r&&(o=o.next(()=>this.Us(i))),n<8&&8<=r&&(o=o.next(()=>this.qs(t,i))),n<9&&9<=r&&(o=o.next(()=>{var e;(e=t).objectStoreNames.contains("remoteDocumentChanges")&&e.deleteObjectStore("remoteDocumentChanges")})),n<10&&10<=r&&(o=o.next(()=>this.Ks(i))),n<11&&11<=r&&(o=o.next(()=>{t.createObjectStore("bundles",{keyPath:"bundleId"}),t.createObjectStore("namedQueries",{keyPath:"name"})})),n<12&&12<=r&&(o=o.next(()=>{!function(){const e=t.createObjectStore("documentOverlays",{keyPath:oO});e.createIndex("collectionPathOverlayIndex",aO,{unique:!1}),e.createIndex("collectionGroupOverlayIndex",cO,{unique:!1})}()})),n<13&&13<=r&&(o=o.next(()=>function(){const e=t.createObjectStore("remoteDocumentsV14",{keyPath:Q1});e.createIndex("documentKeyIndex",Y1),e.createIndex("collectionGroupIndex",J1)}()).next(()=>this.Gs(t,i)).next(()=>t.deleteObjectStore("remoteDocuments"))),n<14&&14<=r&&(o=o.next(()=>this.Qs(t,i))),n<15&&15<=r&&(o=o.next(()=>function(e){e.createObjectStore("indexConfiguration",{keyPath:"indexId",autoIncrement:!0}).createIndex("collectionGroupIndex","collectionGroup",{unique:!1}),e.createObjectStore("indexState",{keyPath:nO}).createIndex("sequenceNumberIndex",rO,{unique:!1}),e.createObjectStore("indexEntries",{keyPath:iO}).createIndex("documentKeyIndex",sO,{unique:!1})}(t))),o}Ls(t){let n=0;return t.store("remoteDocuments").J((e,t)=>{n+=sM(t)}).next(()=>{var e={byteSize:n};return t.store("remoteDocumentGlobal").put("remoteDocumentGlobalKey",e)})}Bs(r){const e=r.store("mutationQueues"),t=r.store("mutations");return e.K().next(e=>LR.forEach(e,n=>{var e=IDBKeyRange.bound([n.userId,-1],[n.userId,n.lastAcknowledgedBatchId]);return t.K("userMutationsIndex",e).next(e=>LR.forEach(e,e=>{tR(e.userId===n.userId);var t=SO(this.wt,e);return iM(r,n.userId,t).next(()=>{})}))}))}Us(e){const o=e.store("targetDocuments"),t=e.store("remoteDocuments");return e.store("targetGlobal").get("targetGlobalKey").next(i=>{const s=[];return t.J((e,t)=>{const n=new wR(e),r=[0,B1(n)];s.push(o.get(r).next(e=>e?LR.resolve():(e=>o.put({targetId:0,path:B1(e),sequenceNumber:i.highestListenSequenceNumber}))(n)))}).next(()=>LR.waitFor(s))})}qs(e,t){e.createObjectStore("collectionParents",{keyPath:tO});const n=t.store("collectionParents"),r=new HO,i=e=>{if(r.add(e)){const t=e.lastSegment(),r=e.popLast();return n.put({collectionId:t,parent:B1(r)})}};return t.store("remoteDocuments").J({H:!0},(e,t)=>{const n=new wR(e);return i(n.popLast())}).next(()=>t.store("documentMutations").J({H:!0},([,e],t)=>{const n=$1(e);return i(n.popLast())}))}Ks(e){const r=e.store("targets");return r.J((e,t)=>{var n=kO(t),n=CO(this.wt,n);return r.put(n)})}Gs(e,s){const t=s.store("remoteDocuments"),o=[];return t.J((e,t)=>{const n=s.store("remoteDocumentsV14"),r=((i=t).document?new TR(wR.fromString(i.document.name).popFirst(5)):i.noDocument?TR.fromSegments(i.noDocument.path):i.unknownDocument?TR.fromSegments(i.unknownDocument.path):eR()).path.toArray();var i={prefixPath:r.slice(0,r.length-2),collectionGroup:r[r.length-2],documentId:r[r.length-1],readTime:t.readTime||[0,0],unknownDocument:t.unknownDocument,noDocument:t.noDocument,document:t.document,hasCommittedMutations:!!t.hasCommittedMutations};o.push(n.put(i))}).next(()=>LR.waitFor(o))}Qs(e,s){const t=s.store("mutations"),o=EM(this.wt),a=new qM(KM.Ms,this.wt.ne);return t.K().next(e=>{const r=new Map;return e.forEach(e=>{var t;let n=null!==(t=r.get(e.userId))&&void 0!==t?t:s1();SO(this.wt,e).keys().forEach(e=>n=n.add(e)),r.set(e.userId,n)}),LR.forEach(r,(e,t)=>{var n=new Wx(t),r=MO.se(this.wt,n),i=a.getIndexManager(n),n=oM.se(n,this.wt,i,a.referenceDelegate);return new PM(o,n,r,i).recalculateAndSaveOverlaysForDocumentKeys(new pO(s,HR.ot),e).next()})})}}function zM(e){e.createObjectStore("targetDocuments",{keyPath:Z1}).createIndex("documentTargetsIndex",eO,{unique:!0}),e.createObjectStore("targets",{keyPath:"targetId"}).createIndex("queryTargetsIndex",X1,{unique:!0}),e.createObjectStore("targetGlobal")}const WM="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.";class GM{constructor(e,t,n,r,i,s,o,a,c,l,u=14){if(this.allowTabSynchronization=e,this.persistenceKey=t,this.clientId=n,this.js=i,this.window=s,this.document=o,this.Ws=c,this.zs=l,this.Hs=u,this.Ps=null,this.vs=!1,this.isPrimary=!1,this.networkEnabled=!0,this.Js=null,this.inForeground=!1,this.Ys=null,this.Xs=null,this.Zs=Number.NEGATIVE_INFINITY,this.ti=e=>Promise.resolve(),!GM.V())throw new rR(nR.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new wM(this,r),this.ei=t+"main",this.wt=new wO(a),this.ni=new UR(this.ei,this.Hs,new $M(this.wt)),this.Vs=new dM(this.referenceDelegate,this.wt),this.remoteDocumentCache=EM(this.wt),this.Ds=new PO,this.window&&this.window.localStorage?this.si=this.window.localStorage:(this.si=null,!1===l&&Jx("IndexedDbPersistence","LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.ii().then(()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new rR(nR.FAILED_PRECONDITION,WM);return this.ri(),this.oi(),this.ui(),this.runTransaction("getHighestListenSequenceNumber","readonly",e=>this.Vs.getHighestSequenceNumber(e))}).then(e=>{this.Ps=new HR(e,this.Ws)}).then(()=>{this.vs=!0}).catch(e=>(this.ni&&this.ni.close(),Promise.reject(e)))}ci(t){return this.ti=async e=>{if(this.started)return t(e)},t(this.isPrimary)}setDatabaseDeletedListener(t){this.ni.F(async e=>{null===e.newVersion&&await t()})}setNetworkEnabled(e){this.networkEnabled!==e&&(this.networkEnabled=e,this.js.enqueueAndForget(async()=>{this.started&&await this.ii()}))}ii(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",t=>QM(t).put({clientId:this.clientId,updateTimeMs:Date.now(),networkEnabled:this.networkEnabled,inForeground:this.inForeground}).next(()=>{if(this.isPrimary)return this.ai(t).next(e=>{e||(this.isPrimary=!1,this.js.enqueueRetryable(()=>this.ti(!1)))})}).next(()=>this.hi(t)).next(e=>this.isPrimary&&!e?this.li(t).next(()=>!1):!!e&&this.fi(t).next(()=>!0))).catch(e=>{if(qR(e))return Yx("IndexedDbPersistence","Failed to extend owner lease: ",e),this.isPrimary;if(!this.allowTabSynchronization)throw e;return Yx("IndexedDbPersistence","Releasing owner lease after error during lease refresh",e),!1}).then(e=>{this.isPrimary!==e&&this.js.enqueueRetryable(()=>this.ti(e)),this.isPrimary=e})}ai(e){return HM(e).get("owner").next(e=>LR.resolve(this.di(e)))}_i(e){return QM(e).delete(this.clientId)}async wi(){if(this.isPrimary&&!this.mi(this.Zs,18e5)){this.Zs=Date.now();var e=await this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",e=>{const r=gO(e,"clientMetadata");return r.K().next(e=>{const t=this.gi(e,18e5),n=e.filter(e=>-1===t.indexOf(e));return LR.forEach(n,e=>r.delete(e.clientId)).next(()=>n)})}).catch(()=>[]);if(this.si)for(const t of e)this.si.removeItem(this.yi(t.clientId))}}ui(){this.Xs=this.js.enqueueAfterDelay("client_metadata_refresh",4e3,()=>this.ii().then(()=>this.wi()).then(()=>this.ui()))}di(e){return!!e&&e.ownerId===this.clientId}hi(t){return this.zs?LR.resolve(!0):HM(t).get("owner").next(e=>{if(null!==e&&this.mi(e.leaseTimestampMs,5e3)&&!this.pi(e.ownerId)){if(this.di(e)&&this.networkEnabled)return!0;if(!this.di(e)){if(!e.allowTabSynchronization)throw new rR(nR.FAILED_PRECONDITION,WM);return!1}}return!(!this.networkEnabled||!this.inForeground)||QM(t).K().next(e=>void 0===this.gi(e,5e3).find(e=>{if(this.clientId!==e.clientId){var t=!this.networkEnabled&&e.networkEnabled,n=!this.inForeground&&e.inForeground,r=this.networkEnabled===e.networkEnabled;if(t||n&&r)return!0}return!1}))}).next(e=>(this.isPrimary!==e&&Yx("IndexedDbPersistence",`Client ${e?"is":"is not"} eligible for a primary lease.`),e))}async shutdown(){this.vs=!1,this.Ii(),this.Xs&&(this.Xs.cancel(),this.Xs=null),this.Ti(),this.Ei(),await this.ni.runTransaction("shutdown","readwrite",["owner","clientMetadata"],e=>{const t=new pO(e,HR.ot);return this.li(t).next(()=>this._i(t))}),this.ni.close(),this.Ai()}gi(e,t){return e.filter(e=>this.mi(e.updateTimeMs,t)&&!this.pi(e.clientId))}Ri(){return this.runTransaction("getActiveClients","readonly",e=>QM(e).K().next(e=>this.gi(e,18e5).map(e=>e.clientId)))}get started(){return this.vs}getMutationQueue(e,t){return oM.se(e,this.wt,t,this.referenceDelegate)}getTargetCache(){return this.Vs}getRemoteDocumentCache(){return this.remoteDocumentCache}getIndexManager(e){return new YO(e,this.wt.ne.databaseId)}getDocumentOverlayCache(e){return MO.se(this.wt,e)}getBundleCache(){return this.Ds}runTransaction(t,n,r){Yx("IndexedDbPersistence","Starting transaction:",t);var e,i="readonly"===n?"readonly":"readwrite",e=15===(e=this.Hs)?fO:14===e?dO:13===e?hO:12===e?uO:11===e?lO:void eR();let s;return this.ni.runTransaction(t,i,e,e=>(s=new pO(e,this.Ps?this.Ps.next():HR.ot),"readwrite-primary"===n?this.ai(s).next(e=>!!e||this.hi(s)).next(e=>{if(!e)throw Jx(`Failed to obtain primary lease for action '${t}'.`),this.isPrimary=!1,this.js.enqueueRetryable(()=>this.ti(!1)),new rR(nR.FAILED_PRECONDITION,DR);return r(s)}).next(e=>this.fi(s).next(()=>e)):this.bi(s).next(()=>r(s)))).then(e=>(s.raiseOnCommittedEvent(),e))}bi(e){return HM(e).get("owner").next(e=>{if(null!==e&&this.mi(e.leaseTimestampMs,5e3)&&!this.pi(e.ownerId)&&!this.di(e)&&!(this.zs||this.allowTabSynchronization&&e.allowTabSynchronization))throw new rR(nR.FAILED_PRECONDITION,WM)})}fi(e){var t={ownerId:this.clientId,allowTabSynchronization:this.allowTabSynchronization,leaseTimestampMs:Date.now()};return HM(e).put("owner",t)}static V(){return UR.V()}li(e){const t=HM(e);return t.get("owner").next(e=>this.di(e)?(Yx("IndexedDbPersistence","Releasing primary lease."),t.delete("owner")):LR.resolve())}mi(e,t){var n=Date.now();return!(e<n-t||n<e&&(Jx(`Detected an update time that is in the future: ${e} > ${n}`),1))}ri(){null!==this.document&&"function"==typeof this.document.addEventListener&&(this.Ys=()=>{this.js.enqueueAndForget(()=>(this.inForeground="visible"===this.document.visibilityState,this.ii()))},this.document.addEventListener("visibilitychange",this.Ys),this.inForeground="visible"===this.document.visibilityState)}Ti(){this.Ys&&(this.document.removeEventListener("visibilitychange",this.Ys),this.Ys=null)}oi(){var e;"function"==typeof(null===(e=this.window)||void 0===e?void 0:e.addEventListener)&&(this.Js=()=>{this.Ii(),!cd()&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")&&navigator.appVersion.match(/Version\/1[45]/)&&this.js.enterRestrictedMode(!0),this.js.enqueueAndForget(()=>this.shutdown())},this.window.addEventListener("pagehide",this.Js))}Ei(){this.Js&&(this.window.removeEventListener("pagehide",this.Js),this.Js=null)}pi(e){var t;try{var n=null!==(null===(t=this.si)||void 0===t?void 0:t.getItem(this.yi(e)));return Yx("IndexedDbPersistence",`Client '${e}' ${n?"is":"is not"} zombied in LocalStorage`),n}catch(e){return Jx("IndexedDbPersistence","Failed to get zombied client id.",e),!1}}Ii(){if(this.si)try{this.si.setItem(this.yi(this.clientId),String(Date.now()))}catch(e){Jx("Failed to set zombie client id.",e)}}Ai(){if(this.si)try{this.si.removeItem(this.yi(this.clientId))}catch(e){}}yi(e){return`firestore_zombie_${this.persistenceKey}_${e}`}}function HM(e){return gO(e,"owner")}function QM(e){return gO(e,"clientMetadata")}function YM(e,t){let n=e.projectId;return e.isDefaultDatabase||(n+="."+e.database),"firestore/"+t+"/"+n+"/"}class JM{constructor(e,t,n,r){this.targetId=e,this.fromCache=t,this.Pi=n,this.vi=r}static Vi(e,t){let n=s1(),r=s1();for(const e of t.docChanges)switch(e.type){case 0:n=n.add(e.doc.key);break;case 1:r=r.add(e.doc.key)}return new JM(e,t.fromCache,n,r)}}class XM{constructor(){this.Si=!1}initialize(e,t){this.Di=e,this.indexManager=t,this.Si=!0}getDocumentsMatchingQuery(t,n,r,i){return this.Ci(t,n).next(e=>e||this.xi(t,n,i,r)).next(e=>e||this.Ni(t,n))}Ci(e,t){return LR.resolve(null)}xi(n,r,i,s){return 0===(e=r).filters.length&&null===e.limit&&null==e.startAt&&null==e.endAt&&(0===e.explicitOrderBy.length||1===e.explicitOrderBy.length&&e.explicitOrderBy[0].field.isKeyField())||s.isEqual(yR.min())?this.Ni(n,r):this.Di.getDocuments(n,i).next(e=>{var t=this.ki(r,e);return this.Oi(r,t,i,s)?this.Ni(n,r):(Qx()<=$h.DEBUG&&Yx("QueryEngine","Re-using previous result from %s to execute query: %s",s.toString(),gD(r)),this.Mi(n,t,r,NR(s,-1)))});var e}ki(n,e){let r=new tP(yD(n));return e.forEach((e,t)=>{mD(n,t)&&(r=r.add(t))}),r}Oi(e,t,n,r){if(null===e.limit)return!1;if(n.size!==t.size)return!0;const i="F"===e.limitType?t.last():t.first();return!!i&&(i.hasPendingWrites||0<i.version.compareTo(r))}Ni(e,t){return Qx()<=$h.DEBUG&&Yx("QueryEngine","Using full collection scan to execute query:",gD(t)),this.Di.getDocumentsMatchingQuery(e,t,RR.min())}Mi(e,n,t,r){return this.Di.getDocumentsMatchingQuery(e,t,r).next(t=>(n.forEach(e=>{t=t.insert(e.key,e)}),t))}}class ZM{constructor(e,t,n,r){this.persistence=e,this.Fi=t,this.wt=r,this.$i=new XR(pR),this.Bi=new JD(e=>VP(e),jP),this.Li=new Map,this.Ui=e.getRemoteDocumentCache(),this.Vs=e.getTargetCache(),this.Ds=e.getBundleCache(),this.qi(n)}qi(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new PM(this.Ui,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.Ui.setIndexManager(this.indexManager),this.Fi.initialize(this.localDocuments,this.indexManager)}collectGarbage(t){return this.persistence.runTransaction("Collect garbage","readwrite-primary",e=>t.collect(e,this.$i))}}function eL(e,t,n,r){return new ZM(e,t,n,r)}async function tL(e,t){const o=e;return o.persistence.runTransaction("Handle user change","readonly",i=>{let s;return o.mutationQueue.getAllMutationBatches(i).next(e=>(s=e,o.qi(t),o.mutationQueue.getAllMutationBatches(i))).next(e=>{const t=[],n=[];let r=s1();for(const i of s){t.push(i.batchId);for(const e of i.mutations)r=r.add(e.key)}for(const i of e){n.push(i.batchId);for(const e of i.mutations)r=r.add(e.key)}return o.localDocuments.getDocuments(i,r).next(e=>({Ki:e,removedBatchIds:t,addedBatchIds:n}))})})}function nL(e){const t=e;return t.persistence.runTransaction("Get last remote snapshot version","readonly",e=>t.Vs.getLastRemoteSnapshotVersion(e))}function rL(e,l){const u=e,h=l.snapshotVersion;let d=u.$i;return u.persistence.runTransaction("Apply remote event","readwrite-primary",a=>{const e=u.Ui.newChangeBuffer({trackRemovals:!0});d=u.$i;const c=[];l.targetChanges.forEach((t,n)=>{const r=d.get(n);if(r){c.push(u.Vs.removeMatchingKeys(a,t.removedDocuments,n).next(()=>u.Vs.addMatchingKeys(a,t.addedDocuments,n)));let e=r.withSequenceNumber(a.currentSequenceNumber);var i,s,o;l.targetMismatches.has(n)?e=e.withResumeToken(sP.EMPTY_BYTE_STRING,yR.min()).withLastLimboFreeSnapshotVersion(yR.min()):0<t.resumeToken.approximateByteSize()&&(e=e.withResumeToken(t.resumeToken,h)),d=d.insert(n,e),i=r,s=e,o=t,0!==i.resumeToken.approximateByteSize()&&!(3e8<=s.snapshotVersion.toMicroseconds()-i.snapshotVersion.toMicroseconds()||0<o.addedDocuments.size+o.modifiedDocuments.size+o.removedDocuments.size)||c.push(u.Vs.updateTargetData(a,e))}});let t=XD,n=s1();if(l.documentUpdates.forEach(e=>{l.resolvedLimboDocuments.has(e)&&c.push(u.persistence.referenceDelegate.updateLimboDocument(a,e))}),c.push(iL(a,e,l.documentUpdates).next(e=>{t=e.Gi,n=e.Qi})),!h.isEqual(yR.min())){const l=u.Vs.getLastRemoteSnapshotVersion(a).next(e=>u.Vs.setTargetsMetadata(a,a.currentSequenceNumber,h));c.push(l)}return LR.waitFor(c).next(()=>e.apply(a)).next(()=>u.localDocuments.getLocalViewOfDocuments(a,t,n)).next(()=>t)}).then(e=>(u.$i=d,e))}function iL(e,s,t){let n=s1(),o=s1();return t.forEach(e=>n=n.add(e)),s.getEntries(e,n).next(r=>{let i=XD;return t.forEach((e,t)=>{const n=r.get(e);t.isFoundDocument()!==n.isFoundDocument()&&(o=o.add(e)),t.isNoDocument()&&t.version.isEqual(yR.min())?(s.removeEntry(e,t.readTime),i=i.insert(e,t)):!n.isValidDocument()||0<t.version.compareTo(n.version)||0===t.version.compareTo(n.version)&&n.hasPendingWrites?(s.addEntry(t),i=i.insert(e,t)):Yx("LocalStore","Ignoring outdated watch update for ",e,". Current version:",n.version," Watch version:",t.version)}),{Gi:i,Qi:o}})}function sL(e,r){const i=e;return i.persistence.runTransaction("Allocate target","readwrite",t=>{let n;return i.Vs.getTargetData(t,r).next(e=>e?(n=e,LR.resolve(n)):i.Vs.allocateTargetId(t).next(e=>(n=new _O(r,e,0,t.currentSequenceNumber),i.Vs.addTargetData(t,n).next(()=>n))))}).then(e=>{var t=i.$i.get(e.targetId);return(null===t||0<e.snapshotVersion.compareTo(t.snapshotVersion))&&(i.$i=i.$i.insert(e.targetId,e),i.Bi.set(r,e.targetId)),e})}async function oL(e,t,n){const r=e,i=r.$i.get(t),s=n?"readwrite":"readwrite-primary";try{n||await r.persistence.runTransaction("Release target",s,e=>r.persistence.referenceDelegate.removeTarget(e,i))}catch(e){if(!qR(e))throw e;Yx("LocalStore",`Failed to update sequence numbers for target ${t}: ${e}`)}r.$i=r.$i.remove(t),r.Bi.delete(i.target)}function aL(e,n,r){const i=e;let s=yR.min(),o=s1();return i.persistence.runTransaction("Execute query","readonly",t=>function(e,t,n){const r=e,i=r.Bi.get(n);return void 0!==i?LR.resolve(r.$i.get(i)):r.Vs.getTargetData(t,n)}(i,t,hD(n)).next(e=>{if(e)return s=e.lastLimboFreeSnapshotVersion,i.Vs.getMatchingKeysForTargetId(t,e.targetId).next(e=>{o=e})}).next(()=>i.Fi.getDocumentsMatchingQuery(t,n,r?s:yR.min(),r?o:s1())).next(e=>(uL(i,vD(n),e),{documents:e,ji:o})))}function cL(e,t){const n=e,r=n.Vs,i=n.$i.get(t);return i?Promise.resolve(i.target):n.persistence.runTransaction("Get target data","readonly",e=>r.te(e,t).next(e=>e?e.target:null))}function lL(e,t){const n=e,r=n.Li.get(t)||yR.min();return n.persistence.runTransaction("Get new document changes","readonly",e=>n.Ui.getAllFromCollectionGroup(e,t,NR(r,-1),Number.MAX_SAFE_INTEGER)).then(e=>(uL(n,t,e),e))}function uL(e,t,n){let r=yR.min();n.forEach((e,t)=>{0<t.readTime.compareTo(r)&&(r=t.readTime)}),e.Li.set(t,r)}function hL(e,t){return`firestore_clients_${e}_${t}`}function dL(e,t,n){let r=`firestore_mutations_${e}_${n}`;return t.isAuthenticated()&&(r+=`_${t.uid}`),r}function fL(e,t){return`firestore_targets_${e}_${t}`}class pL{constructor(e,t,n,r){this.user=e,this.batchId=t,this.state=n,this.error=r}static Ji(e,t,n){var r=JSON.parse(n);let i,s="object"==typeof r&&-1!==["pending","acknowledged","rejected"].indexOf(r.state)&&(void 0===r.error||"object"==typeof r.error);return s&&r.error&&(s="string"==typeof r.error.message&&"string"==typeof r.error.code,s&&(i=new rR(r.error.code,r.error.message))),s?new pL(e,t,r.state,i):(Jx("SharedClientState",`Failed to parse mutation state for ID '${t}': ${n}`),null)}Yi(){const e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class gL{constructor(e,t,n){this.targetId=e,this.state=t,this.error=n}static Ji(e,t){var n=JSON.parse(t);let r,i="object"==typeof n&&-1!==["not-current","current","rejected"].indexOf(n.state)&&(void 0===n.error||"object"==typeof n.error);return i&&n.error&&(i="string"==typeof n.error.message&&"string"==typeof n.error.code,i&&(r=new rR(n.error.code,n.error.message))),i?new gL(e,n.state,r):(Jx("SharedClientState",`Failed to parse target state for ID '${e}': ${t}`),null)}Yi(){const e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class mL{constructor(e,t){this.clientId=e,this.activeTargetIds=t}static Ji(e,t){var n=JSON.parse(t);let r="object"==typeof n&&n.activeTargetIds instanceof Array,i=o1;for(let s=0;r&&s<n.activeTargetIds.length;++s)r=mP(n.activeTargetIds[s]),i=i.add(n.activeTargetIds[s]);return r?new mL(e,i):(Jx("SharedClientState",`Failed to parse client data for instance '${e}': ${t}`),null)}}class vL{constructor(e,t){this.clientId=e,this.onlineState=t}static Ji(e){var t=JSON.parse(e);return"object"==typeof t&&-1!==["Unknown","Online","Offline"].indexOf(t.onlineState)&&"string"==typeof t.clientId?new vL(t.clientId,t.onlineState):(Jx("SharedClientState",`Failed to parse online state: ${e}`),null)}}class yL{constructor(){this.activeTargetIds=o1}Xi(e){this.activeTargetIds=this.activeTargetIds.add(e)}Zi(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Yi(){var e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class _L{constructor(e,t,n,r,i){this.window=e,this.js=t,this.persistenceKey=n,this.tr=r,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.er=this.nr.bind(this),this.sr=new XR(pR),this.started=!1,this.ir=[];var s=n.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=i,this.rr=hL(this.persistenceKey,this.tr),this.ur=`firestore_sequence_number_${this.persistenceKey}`,this.sr=this.sr.insert(this.tr,new yL),this.cr=new RegExp(`^firestore_clients_${s}_([^_]*)$`),this.ar=new RegExp(`^firestore_mutations_${s}_(\\d+)(?:_(.*))?$`),this.hr=new RegExp(`^firestore_targets_${s}_(\\d+)$`),this.lr=`firestore_online_state_${this.persistenceKey}`,this.dr=`firestore_bundle_loaded_v2_${this.persistenceKey}`,this.window.addEventListener("storage",this.er)}static V(e){return!(!e||!e.localStorage)}async start(){const e=await this.syncEngine.Ri();for(const n of e)if(n!==this.tr){const e=this.getItem(hL(this.persistenceKey,n));var t;!e||(t=mL.Ji(n,e))&&(this.sr=this.sr.insert(t.clientId,t))}this._r();const n=this.storage.getItem(this.lr);if(n){const e=this.wr(n);e&&this.mr(e)}for(const e of this.ir)this.nr(e);this.ir=[],this.window.addEventListener("pagehide",()=>this.shutdown()),this.started=!0}writeSequenceNumber(e){this.setItem(this.ur,JSON.stringify(e))}getAllActiveQueryTargets(){return this.gr(this.sr)}isActiveQueryTarget(n){let r=!1;return this.sr.forEach((e,t)=>{t.activeTargetIds.has(n)&&(r=!0)}),r}addPendingMutation(e){this.yr(e,"pending")}updateMutationState(e,t,n){this.yr(e,t,n),this.pr(e)}addLocalQueryTarget(e){let t="not-current";var n;return this.isActiveQueryTarget(e)&&(!(n=this.storage.getItem(fL(this.persistenceKey,e)))||(n=gL.Ji(e,n))&&(t=n.state)),this.Ir.Xi(e),this._r(),t}removeLocalQueryTarget(e){this.Ir.Zi(e),this._r()}isLocalQueryTarget(e){return this.Ir.activeTargetIds.has(e)}clearQueryState(e){this.removeItem(fL(this.persistenceKey,e))}updateQueryState(e,t,n){this.Tr(e,t,n)}handleUserChange(e,t,n){t.forEach(e=>{this.pr(e)}),this.currentUser=e,n.forEach(e=>{this.addPendingMutation(e)})}setOnlineState(e){this.Er(e)}notifyBundleLoaded(e){this.Ar(e)}shutdown(){this.started&&(this.window.removeEventListener("storage",this.er),this.removeItem(this.rr),this.started=!1)}getItem(e){var t=this.storage.getItem(e);return Yx("SharedClientState","READ",e,t),t}setItem(e,t){Yx("SharedClientState","SET",e,t),this.storage.setItem(e,t)}removeItem(e){Yx("SharedClientState","REMOVE",e),this.storage.removeItem(e)}nr(e){const i=e;i.storageArea===this.storage&&(Yx("SharedClientState","EVENT",i.key,i.newValue),i.key!==this.rr?this.js.enqueueRetryable(async()=>{if(this.started){if(null!==i.key)if(this.cr.test(i.key)){if(null==i.newValue){var e=this.Rr(i.key);return this.br(e,null)}e=this.Pr(i.key,i.newValue);if(e)return this.br(e.clientId,e)}else if(this.ar.test(i.key)){if(null!==i.newValue){var t=this.vr(i.key,i.newValue);if(t)return this.Vr(t)}}else if(this.hr.test(i.key)){if(null!==i.newValue){t=this.Sr(i.key,i.newValue);if(t)return this.Dr(t)}}else if(i.key===this.lr){if(null!==i.newValue){var n=this.wr(i.newValue);if(n)return this.mr(n)}}else if(i.key===this.ur){n=function(e){let t=HR.ot;if(null!=e)try{var n=JSON.parse(e);tR("number"==typeof n),t=n}catch(e){Jx("SharedClientState","Failed to read sequence number from WebStorage",e)}return t}(i.newValue);n!==HR.ot&&this.sequenceNumberHandler(n)}else if(i.key===this.dr){const r=this.Cr(i.newValue);await Promise.all(r.map(e=>this.syncEngine.Nr(e)))}}else this.ir.push(i)}):Jx("Received WebStorage notification for local change. Another client might have garbage-collected our state"))}get Ir(){return this.sr.get(this.tr)}_r(){this.setItem(this.rr,this.Ir.Yi())}yr(e,t,n){const r=new pL(this.currentUser,e,t,n),i=dL(this.persistenceKey,this.currentUser,e);this.setItem(i,r.Yi())}pr(e){var t=dL(this.persistenceKey,this.currentUser,e);this.removeItem(t)}Er(e){var t={clientId:this.tr,onlineState:e};this.storage.setItem(this.lr,JSON.stringify(t))}Tr(e,t,n){const r=fL(this.persistenceKey,e),i=new gL(e,t,n);this.setItem(r,i.Yi())}Ar(e){var t=JSON.stringify(Array.from(e));this.setItem(this.dr,t)}Rr(e){var t=this.cr.exec(e);return t?t[1]:null}Pr(e,t){var n=this.Rr(e);return mL.Ji(n,t)}vr(e,t){var n=this.ar.exec(e),r=Number(n[1]),n=void 0!==n[2]?n[2]:null;return pL.Ji(new Wx(n),r,t)}Sr(e,t){var n=this.hr.exec(e),n=Number(n[1]);return gL.Ji(n,t)}wr(e){return vL.Ji(e)}Cr(e){return JSON.parse(e)}async Vr(e){if(e.user.uid===this.currentUser.uid)return this.syncEngine.kr(e.batchId,e.state,e.error);Yx("SharedClientState",`Ignoring mutation for non-active user ${e.user.uid}`)}Dr(e){return this.syncEngine.Or(e.targetId,e.state,e.error)}br(e,t){const n=t?this.sr.insert(e,t):this.sr.remove(e),r=this.gr(this.sr),i=this.gr(n),s=[],o=[];return i.forEach(e=>{r.has(e)||s.push(e)}),r.forEach(e=>{i.has(e)||o.push(e)}),this.syncEngine.Mr(s,o).then(()=>{this.sr=n})}mr(e){this.sr.get(e.clientId)&&this.onlineStateHandler(e.onlineState)}gr(e){let n=o1;return e.forEach((e,t)=>{n=n.unionWith(t.activeTargetIds)}),n}}class wL{constructor(){this.Fr=new yL,this.$r={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,n){}addLocalQueryTarget(e){return this.Fr.Xi(e),this.$r[e]||"not-current"}updateQueryState(e,t,n){this.$r[e]=t}removeLocalQueryTarget(e){this.Fr.Zi(e)}isLocalQueryTarget(e){return this.Fr.activeTargetIds.has(e)}clearQueryState(e){delete this.$r[e]}getAllActiveQueryTargets(){return this.Fr.activeTargetIds}isActiveQueryTarget(e){return this.Fr.activeTargetIds.has(e)}start(){return this.Fr=new yL,Promise.resolve()}handleUserChange(e,t,n){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}class bL{Br(e){}shutdown(){}}class IL{constructor(){this.Lr=()=>this.Ur(),this.qr=()=>this.Kr(),this.Gr=[],this.Qr()}Br(e){this.Gr.push(e)}shutdown(){window.removeEventListener("online",this.Lr),window.removeEventListener("offline",this.qr)}Qr(){window.addEventListener("online",this.Lr),window.addEventListener("offline",this.qr)}Ur(){Yx("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(const e of this.Gr)e(0)}Kr(){Yx("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(const e of this.Gr)e(1)}static V(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener}}const TL={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery"};class EL{constructor(e){this.jr=e.jr,this.Wr=e.Wr}zr(e){this.Hr=e}Jr(e){this.Yr=e}onMessage(e){this.Xr=e}close(){this.Wr()}send(e){this.jr(e)}Zr(){this.Hr()}eo(e){this.Yr(e)}no(e){this.Xr(e)}}class SL extends class{constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;var t=e.ssl?"https":"http";this.so=t+"://"+e.host,this.io="projects/"+this.databaseId.projectId+"/databases/"+this.databaseId.database+"/documents"}ro(t,e,n,r,i){const s=this.oo(t,e);Yx("RestConnection","Sending: ",s,n);var o={};return this.uo(o,r,i),this.co(t,s,o,n).then(e=>(Yx("RestConnection","Received: ",e),e),e=>{throw Xx("RestConnection",`${t} failed with error: `,e,"url: ",s,"request:",n),e})}ao(e,t,n,r,i,s){return this.ro(e,t,n,r,i)}uo(n,e,t){n["X-Goog-Api-Client"]="gl-js/ fire/"+Gx,n["Content-Type"]="text/plain",this.databaseInfo.appId&&(n["X-Firebase-GMPID"]=this.databaseInfo.appId),e&&e.headers.forEach((e,t)=>n[t]=e),t&&t.headers.forEach((e,t)=>n[t]=e)}oo(e,t){var n=TL[e];return`${this.so}/v1/${t}:${n}`}}{constructor(e){super(e),this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams}co(a,t,n,r){return new Promise((i,s)=>{const o=new $x;o.listenOnce(Ux.COMPLETE,()=>{try{switch(o.getLastErrorCode()){case Fx.NO_ERROR:var e=o.getResponseJson();Yx("Connection","XHR received:",JSON.stringify(e)),i(e);break;case Fx.TIMEOUT:Yx("Connection",'RPC "'+a+'" timed out'),s(new rR(nR.DEADLINE_EXCEEDED,"Request time out"));break;case Fx.HTTP_ERROR:var t,n=o.getStatus();if(Yx("Connection",'RPC "'+a+'" failed with status:',n,"response text:",o.getResponseText()),0<n){const a=o.getResponseJson().error;a&&a.status&&a.message?(r=a.status.toLowerCase().replace(/_/g,"-"),t=0<=Object.values(nR).indexOf(r)?r:nR.UNKNOWN,s(new rR(t,a.message))):s(new rR(nR.UNKNOWN,"Server responded with status "+o.getStatus()))}else s(new rR(nR.UNAVAILABLE,"Connection failed."));break;default:eR()}}finally{Yx("Connection",'RPC "'+a+'" completed.')}var r});var e=JSON.stringify(r);o.send(t,"POST",e,n,15)})}ho(e,t,n){const r=[this.so,"/","google.firestore.v1.Firestore","/",e,"/channel"],i=new xx,s=Lx(),o={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling};this.useFetchStreams&&(o.xmlHttpFactory=new Bx({})),this.uo(o.initMessageHeaders,t,n),ad()||ud()||0<=od().indexOf("Electron/")||hd()||0<=od().indexOf("MSAppHost/")||ld()||(o.httpHeadersOverwriteParam="$httpHeaders");var a=r.join("");Yx("Connection","Creating WebChannel: "+a,o);const c=i.createWebChannel(a,o);let l=!1,u=!1;const h=new EL({jr:e=>{u?Yx("Connection","Not sending because WebChannel is closed:",e):(l||(Yx("Connection","Opening WebChannel transport."),c.open(),l=!0),Yx("Connection","WebChannel sending:",e),c.send(e))},Wr:()=>c.close()}),d=(e,t,n)=>{e.listen(t,e=>{try{n(e)}catch(e){setTimeout(()=>{throw e},0)}})};return d(c,Kx.EventType.OPEN,()=>{u||Yx("Connection","WebChannel transport opened.")}),d(c,Kx.EventType.CLOSE,()=>{u||(u=!0,Yx("Connection","WebChannel transport closed"),h.eo())}),d(c,Kx.EventType.ERROR,e=>{u||(u=!0,Xx("Connection","WebChannel transport errored:",e),h.eo(new rR(nR.UNAVAILABLE,"The operation could not be completed")))}),d(c,Kx.EventType.MESSAGE,n=>{if(!u){var e=n.data[0];tR(!!e);var r=e.error||(null===(r=e[0])||void 0===r?void 0:r.error);if(r){Yx("Connection","WebChannel received error:",r);const n=r.status;let e=function(e){var t=Mx[e];if(void 0!==t)return YD(t)}(n),t=r.message;void 0===e&&(e=nR.INTERNAL,t="Unknown error status: "+n+" with message "+r.message),u=!0,h.eo(new rR(e,t)),c.close()}else Yx("Connection","WebChannel received:",e),h.no(e)}}),d(s,Vx.STAT_EVENT,e=>{e.stat===jx?Yx("Connection","Detected buffering proxy"):e.stat===qx&&Yx("Connection","Detected no buffering proxy")}),setTimeout(()=>{h.Zr()},0),h}}function kL(){return"undefined"!=typeof window?window:null}function CL(){return"undefined"!=typeof document?document:null}function AL(e){return new y1(e,!0)}class NL{constructor(e,t,n=1e3,r=1.5,i=6e4){this.js=e,this.timerId=t,this.lo=n,this.fo=r,this._o=i,this.wo=0,this.mo=null,this.yo=Date.now(),this.reset()}reset(){this.wo=0}po(){this.wo=this._o}Io(e){this.cancel();var t=Math.floor(this.wo+this.To()),n=Math.max(0,Date.now()-this.yo),r=Math.max(0,t-n);0<r&&Yx("ExponentialBackoff",`Backing off for ${r} ms (base delay: ${this.wo} ms, delay with jitter: ${t} ms, last attempt: ${n} ms ago)`),this.mo=this.js.enqueueAfterDelay(this.timerId,r,()=>(this.yo=Date.now(),e())),this.wo*=this.fo,this.wo<this.lo&&(this.wo=this.lo),this.wo>this._o&&(this.wo=this._o)}Eo(){null!==this.mo&&(this.mo.skipDelay(),this.mo=null)}cancel(){null!==this.mo&&(this.mo.cancel(),this.mo=null)}To(){return(Math.random()-.5)*this.wo}}class xL{constructor(e,t,n,r,i,s,o,a){this.js=e,this.Ao=n,this.Ro=r,this.bo=i,this.authCredentialsProvider=s,this.appCheckCredentialsProvider=o,this.listener=a,this.state=0,this.Po=0,this.vo=null,this.Vo=null,this.stream=null,this.So=new NL(e,t)}Do(){return 1===this.state||5===this.state||this.Co()}Co(){return 2===this.state||3===this.state}start(){4!==this.state?this.auth():this.xo()}async stop(){this.Do()&&await this.close(0)}No(){this.state=0,this.So.reset()}ko(){this.Co()&&null===this.vo&&(this.vo=this.js.enqueueAfterDelay(this.Ao,6e4,()=>this.Oo()))}Mo(e){this.Fo(),this.stream.send(e)}async Oo(){if(this.Co())return this.close(0)}Fo(){this.vo&&(this.vo.cancel(),this.vo=null)}$o(){this.Vo&&(this.Vo.cancel(),this.Vo=null)}async close(e,t){this.Fo(),this.$o(),this.So.cancel(),this.Po++,4!==e?this.So.reset():t&&t.code===nR.RESOURCE_EXHAUSTED?(Jx(t.toString()),Jx("Using maximum backoff delay to prevent overloading the backend."),this.So.po()):t&&t.code===nR.UNAUTHENTICATED&&3!==this.state&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),null!==this.stream&&(this.Bo(),this.stream.close(),this.stream=null),this.state=e,await this.listener.Jr(t)}Bo(){}auth(){this.state=1;const e=this.Lo(this.Po),n=this.Po;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([e,t])=>{this.Po===n&&this.Uo(e,t)},t=>{e(()=>{var e=new rR(nR.UNKNOWN,"Fetching auth token failed: "+t.message);return this.qo(e)})})}Uo(e,t){const n=this.Lo(this.Po);this.stream=this.Ko(e,t),this.stream.zr(()=>{n(()=>(this.state=2,this.Vo=this.js.enqueueAfterDelay(this.Ro,1e4,()=>(this.Co()&&(this.state=3),Promise.resolve())),this.listener.zr()))}),this.stream.Jr(e=>{n(()=>this.qo(e))}),this.stream.onMessage(e=>{n(()=>this.onMessage(e))})}xo(){this.state=5,this.So.Io(async()=>{this.state=0,this.start()})}qo(e){return Yx("PersistentStream",`close with error: ${e}`),this.stream=null,this.close(4,e)}Lo(t){return e=>{this.js.enqueueAndForget(()=>this.Po===t?e():(Yx("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class RL extends xL{constructor(e,t,n,r,i,s){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,n,r,s),this.wt=i}Ko(e,t){return this.bo.ho("Listen",e,t)}onMessage(e){this.So.reset();var t=function(e,t){let n;if("targetChange"in t){t.targetChange;var r="NO_CHANGE"===(f=t.targetChange.targetChangeType||"NO_CHANGE")?0:"ADD"===f?1:"REMOVE"===f?2:"CURRENT"===f?3:"RESET"===f?4:eR(),i=t.targetChange.targetIds||[],s=(f=t.targetChange.resumeToken,e.dt?(tR(void 0===f||"string"==typeof f),sP.fromBase64String(f||"")):(tR(void 0===f||f instanceof Uint8Array),sP.fromUint8Array(f||new Uint8Array))),o=t.targetChange.cause,a=o&&(a=void 0===(f=o).code?nR.UNKNOWN:YD(f.code),new rR(a,f.message||""));n=new h1(r,i,s,a||null)}else if("documentChange"in t){t.documentChange;var c=t.documentChange;c.document,c.document.name,c.document.updateTime;var a=S1(e,c.document.name),l=b1(c.document.updateTime),u=new MP({mapValue:{fields:c.document.fields}}),l=LP.newFoundDocument(a,l,u),u=c.targetIds||[],c=c.removedTargetIds||[];n=new l1(u,c,l.key,l)}else if("documentDelete"in t){t.documentDelete;u=t.documentDelete;u.document;c=S1(e,u.document),l=u.readTime?b1(u.readTime):yR.min(),l=LP.newNoDocument(c,l),u=u.removedTargetIds||[];n=new l1([],u,l.key,l)}else if("documentRemove"in t){t.documentRemove;var h=t.documentRemove;h.document;var d=S1(e,h.document),h=h.removedTargetIds||[];n=new l1([],h,d,null)}else{if(!("filter"in t))return eR();{t.filter;const e=t.filter;e.targetId;h=e.count||0,d=new HD(h),h=e.targetId;n=new u1(h,d)}}var a,f;return n}(this.wt,e),n=function(e){if(!("targetChange"in e))return yR.min();var t=e.targetChange;return(!t.targetIds||!t.targetIds.length)&&t.readTime?b1(t.readTime):yR.min()}(e);return this.listener.Go(t,n)}Qo(e){const t={};t.database=A1(this.wt),t.addTarget=function(e,t){let n;var r=t.target;return n=qP(r)?{documents:O1(e,r)}:{query:M1(e,r)},n.targetId=t.targetId,0<t.resumeToken.approximateByteSize()?n.resumeToken=w1(e,t.resumeToken):0<t.snapshotVersion.compareTo(yR.min())&&(n.readTime=_1(e,t.snapshotVersion.toTimestamp())),n}(this.wt,e);var n,r,r=(this.wt,n=e,null==(r=function(){switch(n.purpose){case 0:return null;case 1:return"existence-filter-mismatch";case 2:return"limbo-document";default:return eR()}}())?null:{"goog-listen-tags":r});r&&(t.labels=r),this.Mo(t)}jo(e){const t={};t.database=A1(this.wt),t.removeTarget=e,this.Mo(t)}}class PL extends xL{constructor(e,t,n,r,i,s){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,n,r,s),this.wt=i,this.Wo=!1}get zo(){return this.Wo}start(){this.Wo=!1,this.lastStreamToken=void 0,super.start()}Bo(){this.Wo&&this.Ho([])}Ko(e,t){return this.bo.ho("Write",e,t)}onMessage(e){if(tR(!!e.streamToken),this.lastStreamToken=e.streamToken,this.Wo){this.So.reset();var t=(r=e.writeResults,i=e.commitTime,r&&0<r.length?(tR(void 0!==i),r.map(e=>function(e,t){let n=e.updateTime?b1(e.updateTime):b1(t);return n.isEqual(yR.min())&&(n=b1(t)),new DD(n,e.transformResults||[])}(e,i))):[]),n=b1(e.commitTime);return this.listener.Jo(n,t)}var r,i;return tR(!e.writeResults||0===e.writeResults.length),this.Wo=!0,this.listener.Yo()}Xo(){const e={};e.database=A1(this.wt),this.Mo(e)}Ho(e){var t={streamToken:this.lastStreamToken,writes:e.map(e=>P1(this.wt,e))};this.Mo(t)}}class DL extends class{}{constructor(e,t,n,r){super(),this.authCredentials=e,this.appCheckCredentials=t,this.bo=n,this.wt=r,this.Zo=!1}tu(){if(this.Zo)throw new rR(nR.FAILED_PRECONDITION,"The client has already been terminated.")}ro(n,r,i){return this.tu(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([e,t])=>this.bo.ro(n,r,i,e,t)).catch(e=>{throw"FirebaseError"===e.name?(e.code===nR.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),e):new rR(nR.UNKNOWN,e.toString())})}ao(n,r,i,s){return this.tu(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([e,t])=>this.bo.ao(n,r,i,e,t,s)).catch(e=>{throw"FirebaseError"===e.name?(e.code===nR.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),e):new rR(nR.UNKNOWN,e.toString())})}terminate(){this.Zo=!0}}class OL{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.eu=0,this.nu=null,this.su=!0}iu(){0===this.eu&&(this.ru("Unknown"),this.nu=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.nu=null,this.ou("Backend didn't respond within 10 seconds."),this.ru("Offline"),Promise.resolve())))}uu(e){"Online"===this.state?this.ru("Unknown"):(this.eu++,1<=this.eu&&(this.cu(),this.ou(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.ru("Offline")))}set(e){this.cu(),this.eu=0,"Online"===e&&(this.su=!1),this.ru(e)}ru(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}ou(e){var t=`Could not reach Cloud Firestore backend. ${e}\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.su?(Jx(t),this.su=!1):Yx("OnlineStateTracker",t)}cu(){null!==this.nu&&(this.nu.cancel(),this.nu=null)}}class ML{constructor(e,t,n,r,i){this.localStore=e,this.datastore=t,this.asyncQueue=n,this.remoteSyncer={},this.au=[],this.hu=new Map,this.lu=new Set,this.fu=[],this.du=i,this.du.Br(e=>{n.enqueueAndForget(async()=>{$L(this)&&(Yx("RemoteStore","Restarting streams for network reachability change."),await async function(e){const t=e;t.lu.add(4),await FL(t),t._u.set("Unknown"),t.lu.delete(4),await LL(t)}(this))})}),this._u=new OL(n,r)}}async function LL(e){if($L(e))for(const t of e.fu)await t(!0)}async function FL(e){for(const t of e.fu)await t(!1)}function UL(e,t){const n=e;n.hu.has(t.targetId)||(n.hu.set(t.targetId,t),KL(n)?BL(n):ZL(n).Co()&&jL(n,t))}function VL(e,t){const n=e,r=ZL(n);n.hu.delete(t),r.Co()&&qL(n,t),0===n.hu.size&&(r.Co()?r.ko():$L(n)&&n._u.set("Unknown"))}function jL(e,t){e.wu.Nt(t.targetId),ZL(e).Qo(t)}function qL(e,t){e.wu.Nt(t),ZL(e).jo(t)}function BL(t){t.wu=new f1({getRemoteKeysForTarget:e=>t.remoteSyncer.getRemoteKeysForTarget(e),te:e=>t.hu.get(e)||null}),ZL(t).start(),t._u.iu()}function KL(e){return $L(e)&&!ZL(e).Do()&&0<e.hu.size}function $L(e){return 0===e.lu.size}function zL(e){e.wu=void 0}async function WL(e,t,n){if(!qR(t))throw t;e.lu.add(1),await FL(e),e._u.set("Offline"),n=n||(()=>nL(e.localStore)),e.asyncQueue.enqueueRetryable(async()=>{Yx("RemoteStore","Retrying IndexedDB access"),await n(),e.lu.delete(1),await LL(e)})}function GL(t,n){return n().catch(e=>WL(t,e,n))}async function HL(e){const t=e,n=eF(t);let r=0<t.au.length?t.au[t.au.length-1].batchId:-1;for(;$L(i=t)&&i.au.length<10;)try{const e=await function(e,t){const n=e;return n.persistence.runTransaction("Get next mutation batch","readonly",e=>(void 0===t&&(t=-1),n.mutationQueue.getNextMutationBatchAfterBatchId(e,t)))}(t.localStore,r);if(null===e){0===t.au.length&&n.ko();break}r=e.batchId,function(e,t){e.au.push(t);const n=eF(e);n.Co()&&n.zo&&n.Ho(t.mutations)}(t,e)}catch(e){await WL(t,e)}var i;QL(t)&&YL(t)}function QL(e){return $L(e)&&!eF(e).Do()&&0<e.au.length}function YL(e){eF(e).start()}async function JL(e,t){const n=e;n.asyncQueue.verifyOperationInProgress(),Yx("RemoteStore","RemoteStore received new credentials");var r=$L(n);n.lu.add(3),await FL(n),r&&n._u.set("Unknown"),await n.remoteSyncer.handleCredentialChange(t),n.lu.delete(3),await LL(n)}async function XL(e,t){const n=e;t?(n.lu.delete(2),await LL(n)):(n.lu.add(2),await FL(n),n._u.set("Unknown"))}function ZL(t){return t.mu||(t.mu=function(e,t,n){const r=e;return r.tu(),new RL(t,r.bo,r.authCredentials,r.appCheckCredentials,r.wt,n)}(t.datastore,t.asyncQueue,{zr:(async function(n){n.hu.forEach((e,t)=>{jL(n,e)})}).bind(null,t),Jr:(async function(e,t){zL(e),KL(e)?(e._u.uu(t),BL(e)):e._u.set("Unknown")}).bind(null,t),Go:(async function(e,r,t){if(e._u.set("Online"),r instanceof h1&&2===r.state&&r.cause)try{await async function(e){var t=r.cause;for(const n of r.targetIds)e.hu.has(n)&&(await e.remoteSyncer.rejectListen(n,t),e.hu.delete(n),e.wu.removeTarget(n))}(e)}catch(t){Yx("RemoteStore","Failed to remove targets %s: %s ",r.targetIds.join(","),t),await WL(e,t)}else if(r instanceof l1?e.wu.Ut(r):r instanceof u1?e.wu.zt(r):e.wu.Gt(r),!t.isEqual(yR.min()))try{const r=await nL(e.localStore);0<=t.compareTo(r)&&await function(r,i){const e=r.wu.Yt(i);return e.targetChanges.forEach((e,t)=>{if(0<e.resumeToken.approximateByteSize()){const n=r.hu.get(t);n&&r.hu.set(t,n.withResumeToken(e.resumeToken,i))}}),e.targetMismatches.forEach(e=>{const t=r.hu.get(e);var n;t&&(r.hu.set(e,t.withResumeToken(sP.EMPTY_BYTE_STRING,t.snapshotVersion)),qL(r,e),n=new _O(t.target,e,1,t.sequenceNumber),jL(r,n))}),r.remoteSyncer.applyRemoteEvent(e)}(e,t)}catch(r){Yx("RemoteStore","Failed to raise snapshot:",r),await WL(e,r)}}).bind(null,t)}),t.fu.push(async e=>{e?(t.mu.No(),KL(t)?BL(t):t._u.set("Unknown")):(await t.mu.stop(),zL(t))})),t.mu}function eF(t){return t.gu||(t.gu=function(e,t,n){const r=e;return r.tu(),new PL(t,r.bo,r.authCredentials,r.appCheckCredentials,r.wt,n)}(t.datastore,t.asyncQueue,{zr:(async function(e){eF(e).Xo()}).bind(null,t),Jr:(async function(e,t){t&&eF(e).zo&&await async function(e,t){if(QD(n=t.code)&&n!==nR.ABORTED){const n=e.au.shift();eF(e).No(),await GL(e,()=>e.remoteSyncer.rejectFailedWrite(n.batchId,t)),await HL(e)}var n}(e,t),QL(e)&&YL(e)}).bind(null,t),Yo:(async function(e){const t=eF(e);for(const n of e.au)t.Ho(n.mutations)}).bind(null,t),Jo:(async function(e,t,n){const r=e.au.shift(),i=vO.from(r,t,n);await GL(e,()=>e.remoteSyncer.applySuccessfulWrite(i)),await HL(e)}).bind(null,t)}),t.fu.push(async e=>{e?(t.gu.No(),await HL(t)):(await t.gu.stop(),0<t.au.length&&(Yx("RemoteStore",`Stopping write stream with ${t.au.length} pending writes`),t.au=[]))})),t.gu}class tF{constructor(e,t,n,r,i){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=n,this.op=r,this.removalCallback=i,this.deferred=new iR,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(e=>{})}static createAndSchedule(e,t,n,r,i){const s=Date.now()+n,o=new tF(e,t,s,r,i);return o.start(n),o}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new rR(nR.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>null!==this.timerHandle?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function nF(e,t){if(Jx("AsyncQueue",`${t}: ${e}`),qR(e))return new rR(nR.UNAVAILABLE,`${t}: ${e}`);throw e}class rF{constructor(n){this.comparator=n?(e,t)=>n(e,t)||TR.comparator(e.key,t.key):(e,t)=>TR.comparator(e.key,t.key),this.keyedMap=e1(),this.sortedSet=new XR(this.comparator)}static emptySet(e){return new rF(e.comparator)}has(e){return null!=this.keyedMap.get(e)}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){var t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(n){this.sortedSet.inorderTraversal((e,t)=>(n(e),!1))}add(e){const t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){var t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof rF))return!1;if(this.size!==e.size)return!1;const t=this.sortedSet.getIterator(),n=e.sortedSet.getIterator();for(;t.hasNext();){const e=t.getNext().key,r=n.getNext().key;if(!e.isEqual(r))return!1}return!0}toString(){const t=[];return this.forEach(e=>{t.push(e.toString())}),0===t.length?"DocumentSet ()":"DocumentSet (\n  "+t.join("  \n")+"\n)"}copy(e,t){const n=new rF;return n.comparator=this.comparator,n.keyedMap=e,n.sortedSet=t,n}}class iF{constructor(){this.yu=new XR(TR.comparator)}track(e){var t=e.doc.key,n=this.yu.get(t);!n||0!==e.type&&3===n.type?this.yu=this.yu.insert(t,e):3===e.type&&1!==n.type?this.yu=this.yu.insert(t,{type:n.type,doc:e.doc}):2===e.type&&2===n.type?this.yu=this.yu.insert(t,{type:2,doc:e.doc}):2===e.type&&0===n.type?this.yu=this.yu.insert(t,{type:0,doc:e.doc}):1===e.type&&0===n.type?this.yu=this.yu.remove(t):1===e.type&&2===n.type?this.yu=this.yu.insert(t,{type:1,doc:n.doc}):0===e.type&&1===n.type?this.yu=this.yu.insert(t,{type:2,doc:e.doc}):eR()}pu(){const n=[];return this.yu.inorderTraversal((e,t)=>{n.push(t)}),n}}class sF{constructor(e,t,n,r,i,s,o,a){this.query=e,this.docs=t,this.oldDocs=n,this.docChanges=r,this.mutatedKeys=i,this.fromCache=s,this.syncStateChanged=o,this.excludesMetadataChanges=a}static fromInitialDocuments(e,t,n,r){const i=[];return t.forEach(e=>{i.push({type:0,doc:e})}),new sF(e,t,rF.emptySet(t),i,n,r,!0,!1)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&fD(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const t=this.docChanges,n=e.docChanges;if(t.length!==n.length)return!1;for(let r=0;r<t.length;r++)if(t[r].type!==n[r].type||!t[r].doc.isEqual(n[r].doc))return!1;return!0}}class oF{constructor(){this.Iu=void 0,this.listeners=[]}}class aF{constructor(){this.queries=new JD(e=>pD(e),fD),this.onlineState="Unknown",this.Tu=new Set}}async function cF(e,t){const n=e,r=t.query;let i=!1,s=n.queries.get(r);if(s||(i=!0,s=new oF),i)try{s.Iu=await n.onListen(r)}catch(e){const n=nF(e,`Initialization of query '${gD(t.query)}' failed`);return void t.onError(n)}n.queries.set(r,s),s.listeners.push(t),t.Eu(n.onlineState),!s.Iu||t.Au(s.Iu)&&uF(n)}async function lF(e,t){const n=e,r=t.query;let i=!1;const s=n.queries.get(r);if(s){const e=s.listeners.indexOf(t);0<=e&&(s.listeners.splice(e,1),i=0===s.listeners.length)}if(i)return n.queries.delete(r),n.onUnlisten(r)}function uF(e){e.Tu.forEach(e=>{e.next()})}class hF{constructor(e,t,n){this.query=e,this.Ru=t,this.bu=!1,this.Pu=null,this.onlineState="Unknown",this.options=n||{}}Au(e){if(!this.options.includeMetadataChanges){const t=[];for(const n of e.docChanges)3!==n.type&&t.push(n);e=new sF(e.query,e.docs,e.oldDocs,t,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0)}let t=!1;return this.bu?this.vu(e)&&(this.Ru.next(e),t=!0):this.Vu(e,this.onlineState)&&(this.Su(e),t=!0),this.Pu=e,t}onError(e){this.Ru.error(e)}Eu(e){this.onlineState=e;let t=!1;return this.Pu&&!this.bu&&this.Vu(this.Pu,e)&&(this.Su(this.Pu),t=!0),t}Vu(e,t){return!e.fromCache||!(this.options.Du&&"Offline"!==t||e.docs.isEmpty()&&"Offline"!==t)}vu(e){if(0<e.docChanges.length)return!0;var t=this.Pu&&this.Pu.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&!0===this.options.includeMetadataChanges}Su(e){e=sF.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache),this.bu=!0,this.Ru.next(e)}}class dF{constructor(e,t){this.payload=e,this.byteLength=t}Cu(){return"metadata"in this.payload}}class fF{constructor(e){this.wt=e}Wi(e){return S1(this.wt,e)}zi(e){return e.metadata.exists?R1(this.wt,e.document,!1):LP.newNoDocument(this.Wi(e.metadata.name),this.Hi(e.metadata.readTime))}Hi(e){return b1(e)}}class pF{constructor(e,t,n){this.xu=e,this.localStore=t,this.wt=n,this.queries=[],this.documents=[],this.collectionGroups=new Set,this.progress=gF(e)}Nu(e){this.progress.bytesLoaded+=e.byteLength;let t=this.progress.documentsLoaded;if(e.payload.namedQuery)this.queries.push(e.payload.namedQuery);else if(e.payload.documentMetadata){this.documents.push({metadata:e.payload.documentMetadata}),e.payload.documentMetadata.exists||++t;const n=wR.fromString(e.payload.documentMetadata.name);this.collectionGroups.add(n.get(n.length-2))}else e.payload.document&&(this.documents[this.documents.length-1].document=e.payload.document,++t);return t!==this.progress.documentsLoaded?(this.progress.documentsLoaded=t,Object.assign({},this.progress)):null}ku(e){const t=new Map,n=new fF(this.wt);for(const i of e)if(i.metadata.queries){const e=n.Wi(i.metadata.name);for(const n of i.metadata.queries){var r=(t.get(n)||s1()).add(e);t.set(n,r)}}return t}async complete(){const e=await async function(e,t,n,r){const i=e;let s=s1(),o=XD;for(const e of n){const n=t.Wi(e.metadata.name);e.document&&(s=s.add(n));const l=t.zi(e);l.setReadTime(t.Hi(e.metadata.readTime)),o=o.insert(n,l)}const a=i.Ui.newChangeBuffer({trackRemovals:!0}),c=await sL(i,(r=r,hD(oD(wR.fromString(`__bundle__/docs/${r}`)))));return i.persistence.runTransaction("Apply bundle documents","readwrite",t=>iL(t,a,o).next(e=>(a.apply(t),e)).next(e=>i.Vs.removeMatchingKeysForTargetId(t,c.targetId).next(()=>i.Vs.addMatchingKeys(t,s,c.targetId)).next(()=>i.localDocuments.getLocalViewOfDocuments(t,e.Gi,e.Qi)).next(()=>e.Gi)))}(this.localStore,new fF(this.wt),this.documents,this.xu.id),t=this.ku(this.documents);for(const e of this.queries)await async function(e,n,r=s1()){const i=await sL(e,hD(AO(n.bundledQuery))),s=e;return s.persistence.runTransaction("Save named query","readwrite",e=>{var t=b1(n.readTime);if(0<=i.snapshotVersion.compareTo(t))return s.Ds.saveNamedQuery(e,n);t=i.withResumeToken(sP.EMPTY_BYTE_STRING,t);return s.$i=s.$i.insert(t.targetId,t),s.Vs.updateTargetData(e,t).next(()=>s.Vs.removeMatchingKeysForTargetId(e,i.targetId)).next(()=>s.Vs.addMatchingKeys(e,r,i.targetId)).next(()=>s.Ds.saveNamedQuery(e,n))})}(this.localStore,e,t.get(e.name));return this.progress.taskState="Success",{progress:this.progress,Ou:this.collectionGroups,Mu:e}}}function gF(e){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:e.totalDocuments,totalBytes:e.totalBytes}}class mF{constructor(e){this.key=e}}class vF{constructor(e){this.key=e}}class yF{constructor(e,t){this.query=e,this.Fu=t,this.$u=null,this.current=!1,this.Bu=s1(),this.mutatedKeys=s1(),this.Lu=yD(e),this.Uu=new rF(this.Lu)}get qu(){return this.Fu}Ku(e,t){const a=t?t.Gu:new iF,c=(t||this).Uu;let l=(t||this).mutatedKeys,u=c,h=!1;const d="F"===this.query.limitType&&c.size===this.query.limit?c.last():null,f="L"===this.query.limitType&&c.size===this.query.limit?c.first():null;if(e.inorderTraversal((e,t)=>{const n=c.get(e),r=mD(this.query,t)?t:null,i=!!n&&this.mutatedKeys.has(n.key),s=!!r&&(r.hasLocalMutations||this.mutatedKeys.has(r.key)&&r.hasCommittedMutations);let o=!1;n&&r?n.data.isEqual(r.data)?i!==s&&(a.track({type:3,doc:r}),o=!0):this.Qu(n,r)||(a.track({type:2,doc:r}),o=!0,(d&&0<this.Lu(r,d)||f&&this.Lu(r,f)<0)&&(h=!0)):!n&&r?(a.track({type:0,doc:r}),o=!0):n&&!r&&(a.track({type:1,doc:n}),o=!0,(d||f)&&(h=!0)),o&&(l=r?(u=u.add(r),s?l.add(e):l.delete(e)):(u=u.delete(e),l.delete(e)))}),null!==this.query.limit)for(;u.size>this.query.limit;){const e="F"===this.query.limitType?u.last():u.first();u=u.delete(e.key),l=l.delete(e.key),a.track({type:1,doc:e})}return{Uu:u,Gu:a,Oi:h,mutatedKeys:l}}Qu(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,n){var r=this.Uu;this.Uu=e.Uu,this.mutatedKeys=e.mutatedKeys;const i=e.Gu.pu();i.sort((e,t)=>function(e,t){var n=e=>{switch(e){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return eR()}};return n(e)-n(t)}(e.type,t.type)||this.Lu(e.doc,t.doc)),this.ju(n);var s=t?this.Wu():[],o=0===this.Bu.size&&this.current?1:0,a=o!==this.$u;return this.$u=o,0!==i.length||a?{snapshot:new sF(this.query,e.Uu,r,i,e.mutatedKeys,0==o,a,!1),zu:s}:{zu:s}}Eu(e){return this.current&&"Offline"===e?(this.current=!1,this.applyChanges({Uu:this.Uu,Gu:new iF,mutatedKeys:this.mutatedKeys,Oi:!1},!1)):{zu:[]}}Hu(e){return!this.Fu.has(e)&&!!this.Uu.has(e)&&!this.Uu.get(e).hasLocalMutations}ju(e){e&&(e.addedDocuments.forEach(e=>this.Fu=this.Fu.add(e)),e.modifiedDocuments.forEach(e=>{}),e.removedDocuments.forEach(e=>this.Fu=this.Fu.delete(e)),this.current=e.current)}Wu(){if(!this.current)return[];const t=this.Bu;this.Bu=s1(),this.Uu.forEach(e=>{this.Hu(e.key)&&(this.Bu=this.Bu.add(e.key))});const n=[];return t.forEach(e=>{this.Bu.has(e)||n.push(new vF(e))}),this.Bu.forEach(e=>{t.has(e)||n.push(new mF(e))}),n}Ju(e){this.Fu=e.ji,this.Bu=s1();var t=this.Ku(e.documents);return this.applyChanges(t,!0)}Yu(){return sF.fromInitialDocuments(this.query,this.Uu,this.mutatedKeys,0===this.$u)}}class _F{constructor(e,t,n){this.query=e,this.targetId=t,this.view=n}}class wF{constructor(e){this.key=e,this.Xu=!1}}class bF{constructor(e,t,n,r,i,s){this.localStore=e,this.remoteStore=t,this.eventManager=n,this.sharedClientState=r,this.currentUser=i,this.maxConcurrentLimboResolutions=s,this.Zu={},this.tc=new JD(e=>pD(e),fD),this.ec=new Map,this.nc=new Set,this.sc=new XR(TR.comparator),this.ic=new Map,this.rc=new MM,this.oc={},this.uc=new Map,this.cc=hM.Rn(),this.onlineState="Unknown",this.ac=void 0}get isPrimaryClient(){return!0===this.ac}}async function IF(n,e,t,r){n.hc=(e,s,t)=>async function(e,t,n){let r=t.view.Ku(s);r.Oi&&(r=await aL(e.localStore,t.query,!1).then(({documents:e})=>t.view.Ku(e,r)));var i=n&&n.targetChanges.get(t.targetId),i=t.view.applyChanges(r,e.isPrimaryClient,i);return RF(e,t.targetId,i.zu),i.snapshot}(n,e,t);const i=await aL(n.localStore,e,!0),s=new yF(e,i.ji),o=s.Ku(i.documents),a=c1.createSynthesizedTargetChangeForCurrentChange(t,r&&"Offline"!==n.onlineState),c=s.applyChanges(o,n.isPrimaryClient,a);RF(n,t,c.zu);var l=new _F(e,t,s);return n.tc.set(e,l),n.ec.has(t)?n.ec.get(t).push(e):n.ec.set(t,[e]),c.snapshot}async function TF(e,t,n){const r=UF(e);try{const e=await function(e,i){const s=e,o=vR.now(),a=i.reduce((e,t)=>e.add(t.key),s1());let c,l;return s.persistence.runTransaction("Locally write mutations","readwrite",n=>{let t=XD,r=s1();return s.Ui.getEntries(n,a).next(e=>{t=e,t.forEach((e,t)=>{t.isValidDocument()||(r=r.add(e))})}).next(()=>s.localDocuments.getOverlayedDocuments(n,t)).next(e=>{c=e;const t=[];for(const n of i){const i=function(e,t){let n=null;for(const r of e.fieldTransforms){const e=t.data.field(r.field),i=TD(r.transform,e||null);null!=i&&(null===n&&(n=MP.empty()),n.set(r.field,i))}return n||null}(n,c.get(n.key).overlayedDocument);null!=i&&t.push(new BD(n.key,i,function r(e){const i=[];return YR(e.fields,(e,t)=>{const n=new IR([e]);if(xP(t)){const e=r(t.mapValue).fields;if(0===e.length)i.push(n);else for(const t of e)i.push(n.child(t))}else i.push(n)}),new iP(i)}(i.value.mapValue),OD.exists(!0)))}return s.mutationQueue.addMutationBatch(n,o,t,i)}).next(e=>{var t=(l=e).applyToLocalDocumentSet(c,r);return s.documentOverlayCache.saveOverlays(n,e.batchId,t)})}).then(()=>({batchId:l.batchId,changes:t1(c)}))}(r.localStore,t);r.sharedClientState.addPendingMutation(e.batchId),function(e,t,n){let r=e.oc[e.currentUser.toKey()];r=r||new XR(pR),r=r.insert(t,n),e.oc[e.currentUser.toKey()]=r}(r,e.batchId,n),await DF(r,e.changes),await HL(r.remoteStore)}catch(e){const t=nF(e,"Failed to persist write");n.reject(t)}}async function EF(e,t){const r=e;try{const e=await rL(r.localStore,t);t.targetChanges.forEach((e,t)=>{const n=r.ic.get(t);n&&(tR(e.addedDocuments.size+e.modifiedDocuments.size+e.removedDocuments.size<=1),0<e.addedDocuments.size?n.Xu=!0:0<e.modifiedDocuments.size?tR(n.Xu):0<e.removedDocuments.size&&(tR(n.Xu),n.Xu=!1))}),await DF(r,e,t)}catch(e){await MR(e)}}function SF(r,i,e){const t=r;if(t.isPrimaryClient&&0===e||!t.isPrimaryClient&&1===e){const r=[];t.tc.forEach((e,t)=>{var n=t.view.Eu(i);n.snapshot&&r.push(n.snapshot)}),function(e,n){const t=e;t.onlineState=n;let r=!1;t.queries.forEach((e,t)=>{for(const e of t.listeners)e.Eu(n)&&(r=!0)}),r&&uF(t)}(t.eventManager,i),r.length&&t.Zu.Go(r),t.onlineState=i,t.isPrimaryClient&&t.sharedClientState.setOnlineState(i)}}async function kF(e,t){const n=e,r=t.batch.batchId;try{const e=await function(e,r){const i=e;return i.persistence.runTransaction("Acknowledge batch","readwrite-primary",e=>{const t=r.batch.keys(),n=i.Ui.newChangeBuffer({trackRemovals:!0});return function(e,t,r,i){const s=r.batch,n=s.keys();let o=LR.resolve();return n.forEach(n=>{o=o.next(()=>i.getEntry(t,n)).next(e=>{var t=r.docVersions.get(n);tR(null!==t),e.version.compareTo(t)<0&&(s.applyToRemoteDocument(e,r),e.isValidDocument()&&(e.setReadTime(r.commitVersion),i.addEntry(e)))})}),o.next(()=>e.mutationQueue.removeMutationBatch(t,s))}(i,e,r,n).next(()=>n.apply(e)).next(()=>i.mutationQueue.performConsistencyCheck(e)).next(()=>i.documentOverlayCache.removeOverlaysForBatchId(e,t,r.batch.batchId)).next(()=>i.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(e,function(e){let t=s1();for(let n=0;n<e.mutationResults.length;++n)0<e.mutationResults[n].transformResults.length&&(t=t.add(e.batch.mutations[n].key));return t}(r))).next(()=>i.localDocuments.getDocuments(e,t))})}(n.localStore,t);AF(n,r,null),CF(n,r),n.sharedClientState.updateMutationState(r,"acknowledged"),await DF(n,e)}catch(e){await MR(e)}}function CF(e,t){(e.uc.get(t)||[]).forEach(e=>{e.resolve()}),e.uc.delete(t)}function AF(e,t,n){const r=e;let i=r.oc[r.currentUser.toKey()];if(i){const e=i.get(t);e&&(n?e.reject(n):e.resolve(),i=i.remove(t)),r.oc[r.currentUser.toKey()]=i}}function NF(t,e,n=null){t.sharedClientState.removeLocalQueryTarget(e);for(const r of t.ec.get(e))t.tc.delete(r),n&&t.Zu.lc(r,n);t.ec.delete(e),t.isPrimaryClient&&t.rc.us(e).forEach(e=>{t.rc.containsKey(e)||xF(t,e)})}function xF(e,t){e.nc.delete(t.path.canonicalString());var n=e.sc.get(t);null!==n&&(VL(e.remoteStore,n),e.sc=e.sc.remove(t),e.ic.delete(n),PF(e))}function RF(e,t,n){for(const r of n)r instanceof mF?(e.rc.addReference(r.key,t),function(e,t){const n=t.key,r=n.path.canonicalString();e.sc.get(n)||e.nc.has(r)||(Yx("SyncEngine","New document in limbo: "+n),e.nc.add(r),PF(e))}(e,r)):r instanceof vF?(Yx("SyncEngine","Document no longer in limbo: "+r.key),e.rc.removeReference(r.key,t),e.rc.containsKey(r.key)||xF(e,r.key)):eR()}function PF(e){for(;0<e.nc.size&&e.sc.size<e.maxConcurrentLimboResolutions;){var t=e.nc.values().next().value;e.nc.delete(t);var n=new TR(wR.fromString(t)),t=e.cc.next();e.ic.set(t,new wF(n)),e.sc=e.sc.insert(n,t),UL(e.remoteStore,new _O(hD(oD(n.path)),t,2,HR.ot))}}async function DF(e,t,r){const i=e,s=[],o=[],a=[];i.tc.isEmpty()||(i.tc.forEach((e,n)=>{a.push(i.hc(n,t,r).then(e=>{var t;e&&(i.isPrimaryClient&&i.sharedClientState.updateQueryState(n.targetId,e.fromCache?"not-current":"current"),s.push(e),t=JM.Vi(n.targetId,e),o.push(t))}))}),await Promise.all(a),i.Zu.Go(s),await async function(e,t){const r=e;try{await r.persistence.runTransaction("notifyLocalViewChanges","readwrite",n=>LR.forEach(t,t=>LR.forEach(t.Pi,e=>r.persistence.referenceDelegate.addReference(n,t.targetId,e)).next(()=>LR.forEach(t.vi,e=>r.persistence.referenceDelegate.removeReference(n,t.targetId,e)))))}catch(e){if(!qR(e))throw e;Yx("LocalStore","Failed to update sequence numbers: "+e)}for(const e of t){const t=e.targetId;if(!e.fromCache){const e=r.$i.get(t),n=e.snapshotVersion,i=e.withLastLimboFreeSnapshotVersion(n);r.$i=r.$i.insert(t,i)}}}(i.localStore,o))}async function OF(r,e){const i=r;if(FF(i),UF(i),!0===e&&!0!==i.ac){const r=i.sharedClientState.getAllActiveQueryTargets(),e=await MF(i,r.toArray());i.ac=!0,await XL(i.remoteStore,!0);for(const r of e)UL(i.remoteStore,r)}else if(!1===e&&!1!==i.ac){const r=[];let n=Promise.resolve();i.ec.forEach((e,t)=>{i.sharedClientState.isLocalQueryTarget(t)?r.push(t):n=n.then(()=>(NF(i,t),oL(i.localStore,t,!0))),VL(i.remoteStore,t)}),await n,await MF(i,r),function(){const n=i;n.ic.forEach((e,t)=>{VL(n.remoteStore,t)}),n.rc.cs(),n.ic=new Map,n.sc=new XR(TR.comparator)}(),i.ac=!1,await XL(i.remoteStore,!1)}}async function MF(t,n){const r=t,i=[],s=[];for(const t of n){let e;const u=r.ec.get(t);if(u&&0!==u.length){e=await sL(r.localStore,hD(u[0]));for(const t of u){const n=r.tc.get(t),u=(o=r,a=n,l=c=void 0,l=await aL((c=o).localStore,a.query,!0),l=a.view.Ju(l),c.isPrimaryClient&&RF(c,a.targetId,l.zu),await l);u.snapshot&&s.push(u.snapshot)}}else{const u=await cL(r.localStore,t);e=await sL(r.localStore,u),await IF(r,LF(u),t,!1)}i.push(e)}var o,a,c,l;return r.Zu.Go(s),i}function LF(e){return sD(e.path,e.collectionGroup,e.orderBy,e.filters,e.limit,"F",e.startAt,e.endAt)}function FF(e){const t=e;return t.remoteStore.remoteSyncer.applyRemoteEvent=EF.bind(null,t),t.remoteStore.remoteSyncer.getRemoteKeysForTarget=(function(e,t){const n=e,r=n.ic.get(t);if(r&&r.Xu)return s1().add(r.key);{let e=s1();const r=n.ec.get(t);if(!r)return e;for(const t of r){const r=n.tc.get(t);e=e.unionWith(r.view.qu)}return e}}).bind(null,t),t.remoteStore.remoteSyncer.rejectListen=(async function(e,t,n){const r=e;r.sharedClientState.updateQueryState(t,"rejected",n);const i=r.ic.get(t),s=i&&i.key;if(s){let e=new XR(TR.comparator);e=e.insert(s,LP.newNoDocument(s,yR.min()));const n=s1().add(s),i=new a1(yR.min(),new Map,new tP(pR),e,n);await EF(r,i),r.sc=r.sc.remove(s),r.ic.delete(t),PF(r)}else await oL(r.localStore,t,!1).then(()=>NF(r,t,n)).catch(MR)}).bind(null,t),t.Zu.Go=(function(e,t){const n=e;let r=!1;for(const e of t){const t=e.query,i=n.queries.get(t);if(i){for(const t of i.listeners)t.Au(e)&&(r=!0);i.Iu=e}}r&&uF(n)}).bind(null,t.eventManager),t.Zu.lc=(function(e,t,n){const r=e,i=r.queries.get(t);if(i)for(const e of i.listeners)e.onError(n);r.queries.delete(t)}).bind(null,t.eventManager),t}function UF(e){const t=e;return t.remoteStore.remoteSyncer.applySuccessfulWrite=kF.bind(null,t),t.remoteStore.remoteSyncer.rejectFailedWrite=(async function(e,t,n){const r=e;try{const e=await function(e,r){const i=e;return i.persistence.runTransaction("Reject batch","readwrite-primary",t=>{let n;return i.mutationQueue.lookupMutationBatch(t,r).next(e=>(tR(null!==e),n=e.keys(),i.mutationQueue.removeMutationBatch(t,e))).next(()=>i.mutationQueue.performConsistencyCheck(t)).next(()=>i.documentOverlayCache.removeOverlaysForBatchId(t,n,r)).next(()=>i.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(t,n)).next(()=>i.localDocuments.getDocuments(t,n))})}(r.localStore,t);AF(r,t,n),CF(r,t),r.sharedClientState.updateMutationState(t,"rejected",n),await DF(r,e)}catch(n){await MR(n)}}).bind(null,t),t}class VF{constructor(){this.synchronizeTabs=!1}async initialize(e){this.wt=AL(e.databaseInfo.databaseId),this.sharedClientState=this.dc(e),this.persistence=this._c(e),await this.persistence.start(),this.localStore=this.wc(e),this.gcScheduler=this.mc(e,this.localStore),this.indexBackfillerScheduler=this.gc(e,this.localStore)}mc(e,t){return null}gc(e,t){return null}wc(e){return eL(this.persistence,new XM,e.initialUser,this.wt)}_c(e){return new qM(KM.Ms,this.wt)}dc(e){return new wL}async terminate(){this.gcScheduler&&this.gcScheduler.stop(),await this.sharedClientState.shutdown(),await this.persistence.shutdown()}}class jF extends VF{constructor(e,t,n){super(),this.yc=e,this.cacheSizeBytes=t,this.forceOwnership=n,this.synchronizeTabs=!1}async initialize(e){await super.initialize(e),await this.yc.initialize(this,e),await UF(this.yc.syncEngine),await HL(this.yc.remoteStore),await this.persistence.ci(()=>(this.gcScheduler&&!this.gcScheduler.started&&this.gcScheduler.start(),this.indexBackfillerScheduler&&!this.indexBackfillerScheduler.started&&this.indexBackfillerScheduler.start(),Promise.resolve()))}wc(e){return eL(this.persistence,new XM,e.initialUser,this.wt)}mc(e,t){var n=this.persistence.referenceDelegate.garbageCollector;return new yM(n,e.asyncQueue,t)}gc(e,t){var n=new GR(t,this.persistence);return new WR(e.asyncQueue,n)}_c(e){var t=YM(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey),n=void 0!==this.cacheSizeBytes?rM.withCacheSize(this.cacheSizeBytes):rM.DEFAULT;return new GM(this.synchronizeTabs,t,e.clientId,n,e.asyncQueue,kL(),CL(),this.wt,this.sharedClientState,!!this.forceOwnership)}dc(e){return new wL}}class qF extends jF{constructor(e,t){super(e,t,!1),this.yc=e,this.cacheSizeBytes=t,this.synchronizeTabs=!0}async initialize(e){await super.initialize(e);var t=this.yc.syncEngine;this.sharedClientState instanceof _L&&(this.sharedClientState.syncEngine={kr:(async function(e,t,n,r){var i=e,s=await function(e,n){const r=e,i=r.mutationQueue;return r.persistence.runTransaction("Lookup mutation documents","readonly",t=>i.yn(t,n).next(e=>e?r.localDocuments.getDocuments(t,e):LR.resolve(null)))}(i.localStore,t);null!==s?("pending"===n?await HL(i.remoteStore):"acknowledged"===n||"rejected"===n?(AF(i,t,r||null),CF(i,t),i.localStore.mutationQueue.In(t)):eR(),await DF(i,s)):Yx("SyncEngine","Cannot apply mutation batch with id: "+t)}).bind(null,t),Or:(async function(e,t,n,r){const i=e;if(i.ac)Yx("SyncEngine","Ignoring unexpected query state notification.");else{var s=i.ec.get(t);if(s&&0<s.length)switch(n){case"current":case"not-current":{const e=await lL(i.localStore,vD(s[0])),r=a1.createSynthesizedRemoteEventForCurrentChange(t,"current"===n);await DF(i,e,r);break}case"rejected":await oL(i.localStore,t,!0),NF(i,t,r);break;default:eR()}}}).bind(null,t),Mr:(async function(e,t,n){const r=FF(e);if(r.ac){for(const e of t)if(r.ec.has(e))Yx("SyncEngine","Adding an already active target "+e);else{const t=await cL(r.localStore,e),n=await sL(r.localStore,t);await IF(r,LF(t),n.targetId,!1),UL(r.remoteStore,n)}for(const e of n)r.ec.has(e)&&await oL(r.localStore,e,!1).then(()=>{VL(r.remoteStore,e),NF(r,e)}).catch(MR)}}).bind(null,t),Ri:(function(e){return e.localStore.persistence.Ri()}).bind(null,t),Nr:(async function(e,t){const n=e;return lL(n.localStore,t).then(e=>DF(n,e))}).bind(null,t)},await this.sharedClientState.start()),await this.persistence.ci(async e=>{await OF(this.yc.syncEngine,e),this.gcScheduler&&(e&&!this.gcScheduler.started?this.gcScheduler.start():e||this.gcScheduler.stop()),this.indexBackfillerScheduler&&(e&&!this.indexBackfillerScheduler.started?this.indexBackfillerScheduler.start():e||this.indexBackfillerScheduler.stop())})}dc(e){var t=kL();if(!_L.V(t))throw new rR(nR.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");var n=YM(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey);return new _L(t,e.asyncQueue,n,e.clientId,e.initialUser)}}class BF{async initialize(e,t){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=e=>SF(this.syncEngine,e,1),this.remoteStore.remoteSyncer.handleCredentialChange=(async function(e,t){const n=e;if(!n.currentUser.isEqual(t)){Yx("SyncEngine","User change. New user:",t.toKey());const r=await tL(n.localStore,t);n.currentUser=t,(e=n).uc.forEach(e=>{e.forEach(e=>{e.reject(new rR(nR.CANCELLED,"'waitForPendingWrites' promise is rejected due to a user change."))})}),e.uc.clear(),n.sharedClientState.handleUserChange(t,r.removedBatchIds,r.addedBatchIds),await DF(n,r.Ki)}}).bind(null,this.syncEngine),await XL(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return new aF}createDatastore(e){var t,n,r,i,s=AL(e.databaseInfo.databaseId),t=(t=e.databaseInfo,new SL(t));return n=e.authCredentials,r=e.appCheckCredentials,i=t,e=s,new DL(n,r,i,e)}createRemoteStore(e){return t=this.localStore,n=this.datastore,r=e.asyncQueue,i=e=>SF(this.syncEngine,e,0),s=new(IL.V()?IL:bL),new ML(t,n,r,i,s);var t,n,r,i,s}createSyncEngine(e,t){return function(e,t,n,r,i,s,o){const a=new bF(e,t,n,r,i,s);return o&&(a.ac=!0),a}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}terminate(){return async function(e){const t=e;Yx("RemoteStore","RemoteStore shutting down."),t.lu.add(5),await FL(t),t.du.shutdown(),t._u.set("Unknown")}(this.remoteStore)}}function KF(t,n=10240){let r=0;return{async read(){if(r<t.byteLength){var e={value:t.slice(r,r+n),done:!1};return r+=n,e}return{done:!0}},async cancel(){},releaseLock(){},closed:Promise.reject("unimplemented")}}class $F{constructor(e){this.observer=e,this.muted=!1}next(e){this.observer.next&&this.Ic(this.observer.next,e)}error(e){this.observer.error?this.Ic(this.observer.error,e):console.error("Uncaught Error in snapshot listener:",e)}Tc(){this.muted=!0}Ic(e,t){this.muted||setTimeout(()=>{this.muted||e(t)},0)}}class zF{constructor(e,t){this.Ec=e,this.wt=t,this.metadata=new iR,this.buffer=new Uint8Array,this.Ac=new TextDecoder("utf-8"),this.Rc().then(e=>{e&&e.Cu()?this.metadata.resolve(e.payload.metadata):this.metadata.reject(new Error(`The first element of the bundle is not a metadata, it is\n             ${JSON.stringify(null==e?void 0:e.payload)}`))},e=>this.metadata.reject(e))}close(){return this.Ec.cancel()}async getMetadata(){return this.metadata.promise}async fc(){return await this.getMetadata(),this.Rc()}async Rc(){var e=await this.bc();if(null===e)return null;var t=this.Ac.decode(e),n=Number(t);isNaN(n)&&this.Pc(`length string (${t}) is not valid number`);t=await this.vc(n);return new dF(JSON.parse(t),e.length+n)}Vc(){return this.buffer.findIndex(e=>e==="{".charCodeAt(0))}async bc(){for(;this.Vc()<0&&!await this.Sc(););if(0===this.buffer.length)return null;var e=this.Vc();e<0&&this.Pc("Reached the end of bundle when a length string is expected.");var t=this.buffer.slice(0,e);return this.buffer=this.buffer.slice(e),t}async vc(e){for(;this.buffer.length<e;)await this.Sc()&&this.Pc("Reached the end of bundle when more is expected.");var t=this.Ac.decode(this.buffer.slice(0,e));return this.buffer=this.buffer.slice(e),t}Pc(e){throw this.Ec.cancel(),new Error(`Invalid bundle format: ${e}`)}async Sc(){var e=await this.Ec.read();if(!e.done){const t=new Uint8Array(this.buffer.length+e.value.length);t.set(this.buffer),t.set(e.value,this.buffer.length),this.buffer=t}return e.done}}class WF{constructor(e){this.datastore=e,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastWriteError=null,this.writtenDocs=new Set}async lookup(e){if(this.ensureCommitNotCalled(),0<this.mutations.length)throw new rR(nR.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes.");const t=await async function(e,t){const r=e,n=A1(r.wt)+"/documents",i={documents:t.map(e=>E1(r.wt,e))},s=await r.ao("BatchGetDocuments",n,i,t.length),o=new Map;s.forEach(e=>{const t=(n=r.wt,"found"in(e=e)?function(e,t){tR(!!t.found),t.found.name,t.found.updateTime;var n=S1(e,t.found.name),r=b1(t.found.updateTime),i=new MP({mapValue:{fields:t.found.fields}});return LP.newFoundDocument(n,r,i)}(n,e):"missing"in e?function(e,t){tR(!!t.missing),tR(!!t.readTime);var n=S1(e,t.missing),r=b1(t.readTime);return LP.newNoDocument(n,r)}(n,e):eR());var n;o.set(t.key.toString(),t)});const a=[];return t.forEach(e=>{var t=o.get(e.toString());tR(!!t),a.push(t)}),a}(this.datastore,e);return t.forEach(e=>this.recordVersion(e)),t}set(e,t){this.write(t.toMutation(e,this.precondition(e))),this.writtenDocs.add(e.toString())}update(e,t){try{this.write(t.toMutation(e,this.preconditionForUpdate(e)))}catch(e){this.lastWriteError=e}this.writtenDocs.add(e.toString())}delete(e){this.write(new WD(e,this.precondition(e))),this.writtenDocs.add(e.toString())}async commit(){if(this.ensureCommitNotCalled(),this.lastWriteError)throw this.lastWriteError;const t=this.readVersions;this.mutations.forEach(e=>{t.delete(e.key.toString())}),t.forEach((e,t)=>{var n=TR.fromPath(t);this.mutations.push(new GD(n,this.precondition(n)))}),await async function(e,t){const n=e,r=A1(n.wt)+"/documents",i={writes:t.map(e=>P1(n.wt,e))};await n.ro("Commit",r,i)}(this.datastore,this.mutations),this.committed=!0}recordVersion(e){let t;if(e.isFoundDocument())t=e.version;else{if(!e.isNoDocument())throw eR();t=yR.min()}var n=this.readVersions.get(e.key.toString());if(n){if(!t.isEqual(n))throw new rR(nR.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(e.key.toString(),t)}precondition(e){var t=this.readVersions.get(e.toString());return!this.writtenDocs.has(e.toString())&&t?OD.updateTime(t):OD.none()}preconditionForUpdate(e){const t=this.readVersions.get(e.toString());if(this.writtenDocs.has(e.toString())||!t)return OD.exists(!0);if(t.isEqual(yR.min()))throw new rR(nR.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return OD.updateTime(t)}write(e){this.ensureCommitNotCalled(),this.mutations.push(e)}ensureCommitNotCalled(){}}class GF{constructor(e,t,n,r,i){this.asyncQueue=e,this.datastore=t,this.options=n,this.updateFunction=r,this.deferred=i,this.Dc=n.maxAttempts,this.So=new NL(this.asyncQueue,"transaction_retry")}run(){--this.Dc,this.Cc()}Cc(){this.So.Io(async()=>{const t=new WF(this.datastore),e=this.xc(t);e&&e.then(e=>{this.asyncQueue.enqueueAndForget(()=>t.commit().then(()=>{this.deferred.resolve(e)}).catch(e=>{this.Nc(e)}))}).catch(e=>{this.Nc(e)})})}xc(e){try{var t=this.updateFunction(e);return!pP(t)&&t.catch&&t.then?t:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(e){return this.deferred.reject(e),null}}Nc(e){0<this.Dc&&this.kc(e)?(--this.Dc,this.asyncQueue.enqueueAndForget(()=>(this.Cc(),Promise.resolve()))):this.deferred.reject(e)}kc(e){if("FirebaseError"!==e.name)return!1;var t=e.code;return"aborted"===t||"failed-precondition"===t||!QD(t)}}class HF{constructor(e,t,n,r){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=n,this.databaseInfo=r,this.user=Wx.UNAUTHENTICATED,this.clientId=fR.I(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this.authCredentials.start(n,async e=>{Yx("FirestoreClient","Received user=",e.uid),await this.authCredentialListener(e),this.user=e}),this.appCheckCredentials.start(n,e=>(Yx("FirestoreClient","Received new app check token=",e),this.appCheckCredentialListener(e,this.user)))}async getConfiguration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}verifyNotTerminated(){if(this.asyncQueue.isShuttingDown)throw new rR(nR.FAILED_PRECONDITION,"The client has already been terminated.")}terminate(){this.asyncQueue.enterRestrictedMode();const n=new iR;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(async()=>{try{this.onlineComponents&&await this.onlineComponents.terminate(),this.offlineComponents&&await this.offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),n.resolve()}catch(e){var t=nF(e,"Failed to shutdown persistence");n.reject(t)}}),n.promise}}async function QF(e,t){e.asyncQueue.verifyOperationInProgress(),Yx("FirestoreClient","Initializing OfflineComponentProvider");var n=await e.getConfiguration();await t.initialize(n);let r=n.initialUser;e.setCredentialChangeListener(async e=>{r.isEqual(e)||(await tL(t.localStore,e),r=e)}),t.persistence.setDatabaseDeletedListener(()=>e.terminate()),e.offlineComponents=t}async function YF(e,n){e.asyncQueue.verifyOperationInProgress();var t=await JF(e);Yx("FirestoreClient","Initializing OnlineComponentProvider");var r=await e.getConfiguration();await n.initialize(t,r),e.setCredentialChangeListener(e=>JL(n.remoteStore,e)),e.setAppCheckTokenChangeListener((e,t)=>JL(n.remoteStore,t)),e.onlineComponents=n}async function JF(e){return e.offlineComponents||(Yx("FirestoreClient","Using default OfflineComponentProvider"),await QF(e,new VF)),e.offlineComponents}async function XF(e){return e.onlineComponents||(Yx("FirestoreClient","Using default OnlineComponentProvider"),await YF(e,new BF)),e.onlineComponents}function ZF(e){return JF(e).then(e=>e.persistence)}function eU(e){return JF(e).then(e=>e.localStore)}function tU(e){return XF(e).then(e=>e.remoteStore)}function nU(e){return XF(e).then(e=>e.syncEngine)}async function rU(e){const t=await XF(e),n=t.eventManager;return n.onListen=(async function(e,t){const n=FF(e);let r,i;const s=n.tc.get(t);if(s)r=s.targetId,n.sharedClientState.addLocalQueryTarget(r),i=s.view.Yu();else{const e=await sL(n.localStore,hD(t));n.isPrimaryClient&&UL(n.remoteStore,e);const s=n.sharedClientState.addLocalQueryTarget(e.targetId);r=e.targetId,i=await IF(n,t,r,"current"===s)}return i}).bind(null,t.syncEngine),n.onUnlisten=(async function(e,t){const n=e,r=n.tc.get(t),i=n.ec.get(r.targetId);if(1<i.length)return n.ec.set(r.targetId,i.filter(e=>!fD(e,t))),void n.tc.delete(t);n.isPrimaryClient?(n.sharedClientState.removeLocalQueryTarget(r.targetId),n.sharedClientState.isActiveQueryTarget(r.targetId)||await oL(n.localStore,r.targetId,!1).then(()=>{n.sharedClientState.clearQueryState(r.targetId),VL(n.remoteStore,r.targetId),NF(n,r.targetId)}).catch(MR)):(NF(n,r.targetId),await oL(n.localStore,r.targetId,!0))}).bind(null,t.syncEngine),n}function iU(e,t,n={}){const r=new iR;return e.asyncQueue.enqueueAndForget(async()=>function(n,r,i,s,o){const e=new $F({next:e=>{r.enqueueAndForget(()=>lF(n,a));var t=e.docs.has(i);!t&&e.fromCache?o.reject(new rR(nR.UNAVAILABLE,"Failed to get document because the client is offline.")):t&&e.fromCache&&s&&"server"===s.source?o.reject(new rR(nR.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):o.resolve(e)},error:e=>o.reject(e)}),a=new hF(oD(i.path),e,{includeMetadataChanges:!0,Du:!0});return cF(n,a)}(await rU(e),e.asyncQueue,t,n,r)),r.promise}function sU(e,t,n={}){const r=new iR;return e.asyncQueue.enqueueAndForget(async()=>function(t,n,e,r,i){const s=new $F({next:e=>{n.enqueueAndForget(()=>lF(t,o)),e.fromCache&&"server"===r.source?i.reject(new rR(nR.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):i.resolve(e)},error:e=>i.reject(e)}),o=new hF(e,s,{includeMetadataChanges:!0,Du:!0});return cF(t,o)}(await rU(e),e.asyncQueue,t,n,r)),r.promise}function oU(e,t,n,r){const i=(n=n,t=AL(t),s="string"==typeof n?(new TextEncoder).encode(n):n,n=function(e){if(e instanceof Uint8Array)return KF(e,void 0);if(e instanceof ArrayBuffer)return KF(new Uint8Array(e),void 0);if(e instanceof ReadableStream)return e.getReader();throw new Error("Source of `toByteStreamReader` has to be a ArrayBuffer or ReadableStream")}(s),t=t,new zF(n,t));var s;e.asyncQueue.enqueueAndForget(async()=>{!function(e,t,n){const r=e;!async function(t,n,r){try{var i=await n.getMetadata();if(await function(e,t){const n=e,r=b1(t.createTime);return n.persistence.runTransaction("hasNewerBundle","readonly",e=>n.Ds.getBundleMetadata(e,t.id)).then(e=>!!e&&0<=e.createTime.compareTo(r))}(t.localStore,i))return await n.close(),r._completeWith({taskState:"Success",documentsLoaded:i.totalDocuments,bytesLoaded:i.totalBytes,totalDocuments:i.totalDocuments,totalBytes:i.totalBytes}),Promise.resolve(new Set);r._updateProgress(gF(i));const o=new pF(i,t.localStore,n.wt);let e=await n.fc();for(;e;){const t=await o.Nu(e);t&&r._updateProgress(t),e=await n.fc()}var s=await o.complete();return await DF(t,s.Mu,void 0),await function(e,t){const n=e;return n.persistence.runTransaction("Save bundle","readwrite",e=>n.Ds.saveBundleMetadata(e,t))}(t.localStore,i),r._completeWith(s.progress),Promise.resolve(s.Ou)}catch(t){return Xx("SyncEngine",`Loading bundle failed with ${t}`),r._failWith(t),Promise.resolve(new Set)}}(r,t,n).then(e=>{r.sharedClientState.notifyBundleLoaded(e)})}(await nU(e),i,r)})}const aU=new Map;function cU(e,t,n){if(!n)throw new rR(nR.INVALID_ARGUMENT,`Function ${e}() cannot be called with an empty ${t}.`)}function lU(e,t,n,r){if(!0===t&&!0===r)throw new rR(nR.INVALID_ARGUMENT,`${e} and ${n} cannot be used together.`)}function uU(e){if(!TR.isDocumentKey(e))throw new rR(nR.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${e} has ${e.length}.`)}function hU(e){if(TR.isDocumentKey(e))throw new rR(nR.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${e} has ${e.length}.`)}function dU(e){if(void 0===e)return"undefined";if(null===e)return"null";if("string"==typeof e)return 20<e.length&&(e=`${e.substring(0,20)}...`),JSON.stringify(e);if("number"==typeof e||"boolean"==typeof e)return""+e;if("object"!=typeof e)return"function"==typeof e?"a function":eR();if(e instanceof Array)return"an array";var t=(e=e).constructor?e.constructor.name:null;return t?`a custom ${t} object`:"an object"}function fU(e,t){if((e="_delegate"in e?e._delegate:e)instanceof t)return e;if(t.name===e.constructor.name)throw new rR(nR.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");var n=dU(e);throw new rR(nR.INVALID_ARGUMENT,`Expected type '${t.name}', but it was: ${n}`)}function pU(e,t){if(t<=0)throw new rR(nR.INVALID_ARGUMENT,`Function ${e}() requires a positive number, but it was: ${t}.`)}class gU{constructor(e){var t;if(void 0===e.host){if(void 0!==e.ssl)throw new rR(nR.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=e.host,this.ssl=null===(t=e.ssl)||void 0===t||t;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,void 0===e.cacheSizeBytes)this.cacheSizeBytes=41943040;else{if(-1!==e.cacheSizeBytes&&e.cacheSizeBytes<1048576)throw new rR(nR.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.useFetchStreams=!!e.useFetchStreams,lU("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling)}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class mU{constructor(e,t,n){this._authCredentials=t,this._appCheckCredentials=n,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new gU({}),this._settingsFrozen=!1,e instanceof fP?this._databaseId=e:(this._app=e,this._databaseId=function(e){if(!Object.prototype.hasOwnProperty.apply(e.options,["projectId"]))throw new rR(nR.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new fP(e.options.projectId)}(e))}get app(){if(!this._app)throw new rR(nR.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return void 0!==this._terminateTask}_setSettings(e){if(this._settingsFrozen)throw new rR(nR.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new gU(e),void 0!==e.credentials&&(this._authCredentials=function(e){if(!e)return new oR;switch(e.type){case"gapi":var t=e.client;return tR(!("object"!=typeof t||null===t||!t.auth||!t.auth.getAuthHeaderValueForFirstParty)),new uR(t,e.sessionIndex||"0",e.iamToken||null);case"provider":return e.client;default:throw new rR(nR.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(e){const t=aU.get(e);t&&(Yx("ComponentProvider","Removing Datastore"),aU.delete(e),t.terminate())}(this),Promise.resolve()}}class vU{constructor(e,t,n){this.converter=t,this._key=n,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new _U(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new vU(this.firestore,e,this._key)}}class yU{constructor(e,t,n){this.converter=t,this._query=n,this.type="query",this.firestore=e}withConverter(e){return new yU(this.firestore,e,this._query)}}class _U extends yU{constructor(e,t,n){super(e,t,oD(n)),this._path=n,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new vU(this.firestore,null,new TR(e))}withConverter(e){return new _U(this.firestore,e,this._path)}}function wU(e,t,...n){if(e=Wd(e),cU("collection","path",t),e instanceof mU){var r=wR.fromString(t,...n);return hU(r),new _U(e,null,r)}if(!(e instanceof vU||e instanceof _U))throw new rR(nR.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");r=e._path.child(wR.fromString(t,...n));return hU(r),new _U(e.firestore,null,r)}function bU(e,t,...n){if(e=Wd(e),cU("doc","path",t=1===arguments.length?fR.I():t),e instanceof mU){var r=wR.fromString(t,...n);return uU(r),new vU(e,null,new TR(r))}if(!(e instanceof vU||e instanceof _U))throw new rR(nR.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");r=e._path.child(wR.fromString(t,...n));return uU(r),new vU(e.firestore,e instanceof _U?e.converter:null,new TR(r))}function IU(e,t){return e=Wd(e),t=Wd(t),(e instanceof vU||e instanceof _U)&&(t instanceof vU||t instanceof _U)&&e.firestore===t.firestore&&e.path===t.path&&e.converter===t.converter}function TU(e,t){return e=Wd(e),t=Wd(t),e instanceof yU&&t instanceof yU&&e.firestore===t.firestore&&fD(e._query,t._query)&&e.converter===t.converter}class EU{constructor(){this.Oc=Promise.resolve(),this.Mc=[],this.Fc=!1,this.$c=[],this.Bc=null,this.Lc=!1,this.Uc=!1,this.qc=[],this.So=new NL(this,"async_queue_retry"),this.Kc=()=>{var e=CL();e&&Yx("AsyncQueue","Visibility state changed to "+e.visibilityState),this.So.Eo()};const e=CL();e&&"function"==typeof e.addEventListener&&e.addEventListener("visibilitychange",this.Kc)}get isShuttingDown(){return this.Fc}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.Gc(),this.Qc(e)}enterRestrictedMode(e){if(!this.Fc){this.Fc=!0,this.Uc=e||!1;const t=CL();t&&"function"==typeof t.removeEventListener&&t.removeEventListener("visibilitychange",this.Kc)}}enqueue(e){if(this.Gc(),this.Fc)return new Promise(()=>{});const t=new iR;return this.Qc(()=>this.Fc&&this.Uc?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.Mc.push(e),this.jc()))}async jc(){if(0!==this.Mc.length){try{await this.Mc[0](),this.Mc.shift(),this.So.reset()}catch(e){if(!qR(e))throw e;Yx("AsyncQueue","Operation failed with retryable error: "+e)}0<this.Mc.length&&this.So.Io(()=>this.jc())}}Qc(e){var t=this.Oc.then(()=>(this.Lc=!0,e().catch(e=>{throw this.Bc=e,this.Lc=!1,Jx("INTERNAL UNHANDLED ERROR: ",function(e){let t=e.message||"";return e.stack&&(t=e.stack.includes(e.message)?e.stack:e.message+"\n"+e.stack),t}(e)),e}).then(e=>(this.Lc=!1,e))));return this.Oc=t}enqueueAfterDelay(e,t,n){this.Gc(),-1<this.qc.indexOf(e)&&(t=0);var r=tF.createAndSchedule(this,e,t,n,e=>this.Wc(e));return this.$c.push(r),r}Gc(){this.Bc&&eR()}verifyOperationInProgress(){}async zc(){for(var e;await(e=this.Oc),e!==this.Oc;);}Hc(e){for(const t of this.$c)if(t.timerId===e)return!0;return!1}Jc(t){return this.zc().then(()=>{this.$c.sort((e,t)=>e.targetTimeMs-t.targetTimeMs);for(const e of this.$c)if(e.skipDelay(),"all"!==t&&e.timerId===t)break;return this.zc()})}Yc(e){this.qc.push(e)}Wc(e){var t=this.$c.indexOf(e);this.$c.splice(t,1)}}function SU(e){return function(e){if("object"==typeof e&&null!==e){var t=e;for(const e of["next","error","complete"])if(e in t&&"function"==typeof t[e])return 1}}(e)}class kU{constructor(){this._progressObserver={},this._taskCompletionResolver=new iR,this._lastProgress={taskState:"Running",totalBytes:0,totalDocuments:0,bytesLoaded:0,documentsLoaded:0}}onProgress(e,t,n){this._progressObserver={next:e,error:t,complete:n}}catch(e){return this._taskCompletionResolver.promise.catch(e)}then(e,t){return this._taskCompletionResolver.promise.then(e,t)}_completeWith(e){this._updateProgress(e),this._progressObserver.complete&&this._progressObserver.complete(),this._taskCompletionResolver.resolve(e)}_failWith(e){this._lastProgress.taskState="Error",this._progressObserver.next&&this._progressObserver.next(this._lastProgress),this._progressObserver.error&&this._progressObserver.error(e),this._taskCompletionResolver.reject(e)}_updateProgress(e){this._lastProgress=e,this._progressObserver.next&&this._progressObserver.next(e)}}var CU,AU,NU,xU;class RU extends mU{constructor(e,t,n){super(e,t,n),this.type="firestore",this._queue=new EU,this._persistenceKey="name"in e?e.name:"[DEFAULT]"}_terminate(){return this._firestoreClient||DU(this),this._firestoreClient.terminate()}}function PU(e){return e._firestoreClient||DU(e),e._firestoreClient.verifyNotTerminated(),e._firestoreClient}function DU(e){var t,n,r,i,s,o=e._freezeSettings(),o=(n=e._databaseId,r=(null===(t=e._app)||void 0===t?void 0:t.options.appId)||"",i=e._persistenceKey,s=o,new dP(n,r,i,s.host,s.ssl,s.experimentalForceLongPolling,s.experimentalAutoDetectLongPolling,s.useFetchStreams));e._firestoreClient=new HF(e._authCredentials,e._appCheckCredentials,e._queue,o)}function OU(e,n,r){const i=new iR;return e.asyncQueue.enqueue(async()=>{try{await QF(e,r),await YF(e,n),i.resolve()}catch(e){const n=e;if(!("FirebaseError"===(t=n).name?t.code===nR.FAILED_PRECONDITION||t.code===nR.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&t instanceof DOMException)||(22===t.code||20===t.code||11===t.code)))throw n;console.warn("Error enabling offline persistence. Falling back to persistence disabled: "+n),i.reject(n)}var t}).then(()=>i.promise)}function MU(e){return function(e){const t=new iR;return e.asyncQueue.enqueueAndForget(async()=>async function(e,t){const n=e;$L(n.remoteStore)||Yx("SyncEngine","The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled.");try{const e=await function(){const t=n.localStore;return t.persistence.runTransaction("Get highest unacknowledged batch id","readonly",e=>t.mutationQueue.getHighestUnacknowledgedBatchId(e))}();if(-1===e)return void t.resolve();const r=n.uc.get(e)||[];r.push(t),n.uc.set(e,r)}catch(e){const n=nF(e,"Initialization of waitForPendingWrites() operation failed");t.reject(n)}}(await nU(e),t)),t.promise}(PU(e=fU(e,RU)))}function LU(e){return(n=PU(e=fU(e,RU))).asyncQueue.enqueue(async()=>{const e=await ZF(n),t=await tU(n);return e.setNetworkEnabled(!0),function(){const e=t;return e.lu.delete(0),LL(e)}()});var n}function FU(e){return(n=PU(e=fU(e,RU))).asyncQueue.enqueue(async()=>{const e=await ZF(n),t=await tU(n);return e.setNetworkEnabled(!1),async function(){const e=t;e.lu.add(0),await FL(e),e._u.set("Offline")}()});var n}function UU(t,e){return n=PU(t=fU(t,RU)),r=e,n.asyncQueue.enqueue(async()=>function(e,t){const n=e;return n.persistence.runTransaction("Get named query","readonly",e=>n.Ds.getNamedQuery(e,t))}(await eU(n),r)).then(e=>e?new yU(t,null,e.query):null);var n,r}function VU(e){if(e._initialized||e._terminated)throw new rR(nR.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.")}class jU{constructor(...e){for(let t=0;t<e.length;++t)if(0===e[t].length)throw new rR(nR.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new IR(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}class qU{constructor(e){this._byteString=e}static fromBase64String(e){try{return new qU(sP.fromBase64String(e))}catch(e){throw new rR(nR.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+e)}}static fromUint8Array(e){return new qU(sP.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}}class BU{constructor(e){this._methodName=e}}class KU{constructor(e,t){if(!isFinite(e)||e<-90||90<e)throw new rR(nR.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||180<t)throw new rR(nR.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return pR(this._lat,e._lat)||pR(this._long,e._long)}}const $U=/^__.*__$/;class zU{constructor(e,t,n){this.data=e,this.fieldMask=t,this.fieldTransforms=n}toMutation(e,t){return null!==this.fieldMask?new BD(e,this.data,this.fieldMask,t,this.fieldTransforms):new qD(e,this.data,t,this.fieldTransforms)}}class WU{constructor(e,t,n){this.data=e,this.fieldMask=t,this.fieldTransforms=n}toMutation(e,t){return new BD(e,this.data,this.fieldMask,t,this.fieldTransforms)}}function GU(e){switch(e){case 0:case 2:case 1:return 1;case 3:case 4:return;default:throw eR()}}class HU{constructor(e,t,n,r,i,s){this.settings=e,this.databaseId=t,this.wt=n,this.ignoreUndefinedProperties=r,void 0===i&&this.Xc(),this.fieldTransforms=i||[],this.fieldMask=s||[]}get path(){return this.settings.path}get Zc(){return this.settings.Zc}ta(e){return new HU(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.wt,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}ea(e){var t;const n=null===(t=this.path)||void 0===t?void 0:t.child(e),r=this.ta({path:n,na:!1});return r.sa(e),r}ia(e){var t;const n=null===(t=this.path)||void 0===t?void 0:t.child(e),r=this.ta({path:n,na:!1});return r.Xc(),r}ra(e){return this.ta({path:void 0,na:!0})}oa(e){return pV(e,this.settings.methodName,this.settings.ua||!1,this.path,this.settings.ca)}contains(t){return void 0!==this.fieldMask.find(e=>t.isPrefixOf(e))||void 0!==this.fieldTransforms.find(e=>t.isPrefixOf(e.field))}Xc(){if(this.path)for(let e=0;e<this.path.length;e++)this.sa(this.path.get(e))}sa(e){if(0===e.length)throw this.oa("Document fields must not be empty");if(GU(this.Zc)&&$U.test(e))throw this.oa('Document fields cannot begin and end with "__"')}}class QU{constructor(e,t,n){this.databaseId=e,this.ignoreUndefinedProperties=t,this.wt=n||AL(e)}aa(e,t,n,r=!1){return new HU({Zc:e,methodName:t,ca:n,path:IR.emptyPath(),na:!1,ua:r},this.databaseId,this.wt,this.ignoreUndefinedProperties)}}function YU(e){var t=e._freezeSettings(),n=AL(e._databaseId);return new QU(e._databaseId,!!t.ignoreUndefinedProperties,n)}function JU(e,t,n,r,i,s={}){const o=e.aa(s.merge||s.mergeFields?2:0,t,n,i);uV("Data must be an object, but it was:",o,r);var a=cV(r,o);let c,l;if(s.merge)c=new iP(o.fieldMask),l=o.fieldTransforms;else if(s.mergeFields){const e=[];for(const r of s.mergeFields){const i=hV(t,r,n);if(!o.contains(i))throw new rR(nR.INVALID_ARGUMENT,`Field '${i}' is specified in your field mask but missing from your input data.`);gV(e,i)||e.push(i)}c=new iP(e),l=o.fieldTransforms.filter(e=>c.covers(e.field))}else c=null,l=o.fieldTransforms;return new zU(new MP(a),c,l)}class XU extends BU{_toFieldTransform(e){if(2!==e.Zc)throw 1===e.Zc?e.oa(`${this._methodName}() can only appear at the top level of your update data`):e.oa(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof XU}}function ZU(e,t,n){return new HU({Zc:3,ca:t.settings.ca,methodName:e._methodName,na:n},t.databaseId,t.wt,t.ignoreUndefinedProperties)}class eV extends BU{_toFieldTransform(e){return new PD(e.path,new ED)}isEqual(e){return e instanceof eV}}class tV extends BU{constructor(e,t){super(e),this.ha=t}_toFieldTransform(e){const t=ZU(this,e,!0),n=this.ha.map(e=>aV(e,t)),r=new SD(n);return new PD(e.path,r)}isEqual(e){return this===e}}class nV extends BU{constructor(e,t){super(e),this.ha=t}_toFieldTransform(e){const t=ZU(this,e,!0),n=this.ha.map(e=>aV(e,t)),r=new CD(n);return new PD(e.path,r)}isEqual(e){return this===e}}class rV extends BU{constructor(e,t){super(e),this.la=t}_toFieldTransform(e){var t=new ND(e.wt,bD(e.wt,this.la));return new PD(e.path,t)}isEqual(e){return this===e}}function iV(e,i,s,t){const o=e.aa(1,i,s);uV("Data must be an object, but it was:",o,t);const a=[],c=MP.empty();YR(t,(e,t)=>{var n=fV(i,e,s);t=Wd(t);var r=o.ia(n);if(t instanceof XU)a.push(n);else{const e=aV(t,r);null!=e&&(a.push(n),c.set(n,e))}});var n=new iP(a);return new WU(c,n,o.fieldTransforms)}function sV(e,t,n,r,i,s){const o=e.aa(1,t,n),a=[hV(t,r,n)],c=[i];if(s.length%2!=0)throw new rR(nR.INVALID_ARGUMENT,`Function ${t}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let f=0;f<s.length;f+=2)a.push(hV(t,s[f])),c.push(s[f+1]);const l=[],u=MP.empty();for(let p=a.length-1;0<=p;--p)if(!gV(l,a[p])){const t=a[p];var h=Wd(h=c[p]);const r=o.ia(t);if(h instanceof XU)l.push(t);else{const e=aV(h,r);null!=e&&(l.push(t),u.set(t,e))}}var d=new iP(l);return new WU(u,d,o.fieldTransforms)}function oV(e,t,n,r=!1){return aV(n,e.aa(r?4:3,t))}function aV(s,e){if(lV(s=Wd(s)))return uV("Unsupported field value:",e,s),cV(s,e);if(s instanceof BU)return function(e,t){if(!GU(t.Zc))throw t.oa(`${e._methodName}() can only be used with update() and set()`);if(!t.path)throw t.oa(`${e._methodName}() is not currently supported inside arrays`);var n=e._toFieldTransform(t);n&&t.fieldTransforms.push(n)}(s,e),null;if(void 0===s&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),s instanceof Array){if(e.settings.na&&4!==e.Zc)throw e.oa("Nested arrays are not supported");return function(t){const n=[];let r=0;for(const i of s){let e=aV(i,t.ra(r));null==e&&(e={nullValue:"NULL_VALUE"}),n.push(e),r++}return{arrayValue:{values:n}}}(e)}return function(e,t){if(null===(e=Wd(s)))return{nullValue:"NULL_VALUE"};if("number"==typeof e)return bD(t.wt,e);if("boolean"==typeof e)return{booleanValue:e};if("string"==typeof e)return{stringValue:e};if(e instanceof Date){var n=vR.fromDate(e);return{timestampValue:_1(t.wt,n)}}if(e instanceof vR){n=new vR(e.seconds,1e3*Math.floor(e.nanoseconds/1e3));return{timestampValue:_1(t.wt,n)}}if(e instanceof KU)return{geoPointValue:{latitude:e.latitude,longitude:e.longitude}};if(e instanceof qU)return{bytesValue:w1(t.wt,e._byteString)};if(e instanceof vU){const r=t.databaseId,i=e.firestore._databaseId;if(!i.isEqual(r))throw t.oa(`Document reference is for database ${i.projectId}/${i.database} but should be for database ${r.projectId}/${r.database}`);return{referenceValue:I1(e.firestore._databaseId||t.databaseId,e._key.path)}}throw t.oa(`Unsupported field value: ${dU(e)}`)}(0,e)}function cV(e,r){const i={};return JR(e)?r.path&&0<r.path.length&&r.fieldMask.push(r.path):YR(e,(e,t)=>{var n=aV(t,r.ea(e));null!=n&&(i[e]=n)}),{mapValue:{fields:i}}}function lV(e){return!("object"!=typeof e||null===e||e instanceof Array||e instanceof Date||e instanceof vR||e instanceof KU||e instanceof qU||e instanceof vU||e instanceof BU)}function uV(e,t,n){if(!lV(n)||("object"!=typeof(i=n)||null===i||Object.getPrototypeOf(i)!==Object.prototype&&null!==Object.getPrototypeOf(i))){var r=dU(n);throw"an object"===r?t.oa(e+" a custom object"):t.oa(e+" "+r)}var i}function hV(e,t,n){if((t=Wd(t))instanceof jU)return t._internalPath;if("string"==typeof t)return fV(e,t);throw pV("Field path arguments must be of type string or ",e,!1,void 0,n)}const dV=new RegExp("[~\\*/\\[\\]]");function fV(t,n,r){if(0<=n.search(dV))throw pV(`Invalid field path (${n}). Paths must not contain '~', '*', '/', '[', or ']'`,t,!1,void 0,r);try{return new jU(...n.split("."))._internalPath}catch(e){throw pV(`Invalid field path (${n}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,t,!1,void 0,r)}}function pV(e,t,n,r,i){var s=r&&!r.isEmpty(),o=void 0!==i;let a=`Function ${t}() called with invalid data`;n&&(a+=" (via `toFirestore()`)"),a+=". ";let c="";return(s||o)&&(c+=" (found",s&&(c+=` in field ${r}`),o&&(c+=` in document ${i}`),c+=")"),new rR(nR.INVALID_ARGUMENT,a+e+c)}function gV(e,t){return e.some(e=>e.isEqual(t))}class mV{constructor(e,t,n,r,i){this._firestore=e,this._userDataWriter=t,this._key=n,this._document=r,this._converter=i}get id(){return this._key.path.lastSegment()}get ref(){return new vU(this._firestore,this._converter,this._key)}exists(){return null!==this._document}data(){if(this._document){if(this._converter){var e=new vV(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){var t=this._document.data.field(yV("DocumentSnapshot.get",e));if(null!==t)return this._userDataWriter.convertValue(t)}}}class vV extends mV{data(){return super.data()}}function yV(e,t){return"string"==typeof t?fV(e,t):(t instanceof jU?t:t._delegate)._internalPath}class _V{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class wV extends mV{constructor(e,t,n,r,i,s){super(e,t,n,r,s),this._firestore=e,this._firestoreImpl=e,this.metadata=i}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){var t=new bV(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){var n=this._document.data.field(yV("DocumentSnapshot.get",e));if(null!==n)return this._userDataWriter.convertValue(n,t.serverTimestamps)}}}class bV extends wV{data(e={}){return super.data(e)}}class IV{constructor(e,t,n,r){this._firestore=e,this._userDataWriter=t,this._snapshot=r,this.metadata=new _V(r.hasPendingWrites,r.fromCache),this.query=n}get docs(){const t=[];return this.forEach(e=>t.push(e)),t}get size(){return this._snapshot.docs.size}get empty(){return 0===this.size}forEach(t,n){this._snapshot.docs.forEach(e=>{t.call(n,new bV(this._firestore,this._userDataWriter,e.key,e,new _V(this._snapshot.mutatedKeys.has(e.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){var t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new rR(nR.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function(s,t){if(s._snapshot.oldDocs.isEmpty()){let t=0;return s._snapshot.docChanges.map(e=>({type:"added",doc:new bV(s._firestore,s._userDataWriter,e.doc.key,e.doc,new _V(s._snapshot.mutatedKeys.has(e.doc.key),s._snapshot.fromCache),s.query.converter),oldIndex:-1,newIndex:t++}))}{let i=s._snapshot.oldDocs;return s._snapshot.docChanges.filter(e=>t||3!==e.type).map(e=>{var t=new bV(s._firestore,s._userDataWriter,e.doc.key,e.doc,new _V(s._snapshot.mutatedKeys.has(e.doc.key),s._snapshot.fromCache),s.query.converter);let n=-1,r=-1;return 0!==e.type&&(n=i.indexOf(e.doc.key),i=i.delete(e.doc.key)),1!==e.type&&(i=i.add(e.doc),r=i.indexOf(e.doc.key)),{type:function(e){switch(e){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return eR()}}(e.type),doc:t,oldIndex:n,newIndex:r}})}}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}}function TV(e,t){return e instanceof wV&&t instanceof wV?e._firestore===t._firestore&&e._key.isEqual(t._key)&&(null===e._document?null===t._document:e._document.isEqual(t._document))&&e._converter===t._converter:e instanceof IV&&t instanceof IV&&e._firestore===t._firestore&&TU(e.query,t.query)&&e.metadata.isEqual(t.metadata)&&e._snapshot.isEqual(t._snapshot)}function EV(e){if("L"===e.limitType&&0===e.explicitOrderBy.length)throw new rR(nR.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class SV{}function kV(e,...t){for(const n of t)e=n._apply(e);return e}class CV extends SV{constructor(e,t,n){super(),this.fa=e,this.da=t,this._a=n,this.type="where"}_apply(e){var t=YU(e.firestore),t=function(e,t,n,r,i,s,o){let a;if(i.isKeyField()){if("array-contains"===s||"array-contains-any"===s)throw new rR(nR.INVALID_ARGUMENT,`Invalid Query. You can't perform '${s}' queries on documentId().`);if("in"===s||"not-in"===s){OV(o,s);const t=[];for(const n of o)t.push(DV(r,e,n));a={arrayValue:{values:t}}}else a=DV(r,e,o)}else"in"!==s&&"not-in"!==s&&"array-contains-any"!==s||OV(o,s),a=oV(n,t,o,"in"===s||"not-in"===s);var c=zP.create(i,s,a);return function(e,t){if(t.ht()){const r=cD(e);if(null!==r&&!r.isEqual(t.field))throw new rR(nR.INVALID_ARGUMENT,`Invalid query. All where filters with an inequality (<, <=, !=, not-in, >, or >=) must be on the same field. But you have inequality filters on '${r.toString()}' and '${t.field.toString()}'`);var n=aD(e);null!==n&&MV(0,t.field,n)}const r=function(e,t){for(const n of e.filters)if(0<=t.indexOf(n.op))return n.op;return null}(e,function(){switch(t.op){case"!=":return["!=","not-in"];case"array-contains":return["array-contains","array-contains-any","not-in"];case"in":return["array-contains-any","in","not-in"];case"array-contains-any":return["array-contains","array-contains-any","in","not-in"];case"not-in":return["array-contains","array-contains-any","in","not-in","!="];default:return[]}}());if(null!==r)throw r===t.op?new rR(nR.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${t.op.toString()}' filter.`):new rR(nR.INVALID_ARGUMENT,`Invalid query. You cannot use '${t.op.toString()}' filters with '${r.toString()}' filters.`)}(e,c),c}(e._query,"where",t,e.firestore._databaseId,this.fa,this.da,this._a);return new yU(e.firestore,e.converter,(e=e._query,t=e.filters.concat([t]),new iD(e.path,e.collectionGroup,e.explicitOrderBy.slice(),t,e.limit,e.limitType,e.startAt,e.endAt)))}}class AV extends SV{constructor(e,t){super(),this.fa=e,this.wa=t,this.type="orderBy"}_apply(e){var t=function(e,t,n){if(null!==e.startAt)throw new rR(nR.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(null!==e.endAt)throw new rR(nR.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");var r,i=new tD(t,n);return n=i,null!==aD(e=e)||null!==(r=cD(e))&&MV(0,r,n.field),i}(e._query,this.fa,this.wa);return new yU(e.firestore,e.converter,(e=e._query,t=e.explicitOrderBy.concat([t]),new iD(e.path,e.collectionGroup,t,e.filters.slice(),e.limit,e.limitType,e.startAt,e.endAt)))}}class NV extends SV{constructor(e,t,n){super(),this.type=e,this.ma=t,this.ga=n}_apply(e){return new yU(e.firestore,e.converter,dD(e._query,this.ma,this.ga))}}class xV extends SV{constructor(e,t,n){super(),this.type=e,this.ya=t,this.pa=n}_apply(e){var t,n=PV(e,this.type,this.ya,this.pa);return new yU(e.firestore,e.converter,(t=e._query,e=n,new iD(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,e,t.endAt)))}}class RV extends SV{constructor(e,t,n){super(),this.type=e,this.ya=t,this.pa=n}_apply(e){var t,n=PV(e,this.type,this.ya,this.pa);return new yU(e.firestore,e.converter,(t=e._query,e=n,new iD(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,t.startAt,e)))}}function PV(e,t,n,r){if(n[0]=Wd(n[0]),n[0]instanceof mV)return function(e,t,n,r,i){if(!r)throw new rR(nR.NOT_FOUND,`Can't use a DocumentSnapshot that doesn't exist for ${n}().`);const s=[];for(const n of uD(e))if(n.field.isKeyField())s.push(SP(t,r.key));else{const e=r.data.field(n.field);if(uP(e))throw new rR(nR.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+n.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(null===e){const e=n.field.canonicalString();throw new rR(nR.INVALID_ARGUMENT,`Invalid query. You are trying to start or end a query using a document for which the field '${e}' (used as the orderBy) does not exist.`)}s.push(e)}return new eD(s,i)}(e._query,e.firestore._databaseId,t,n[0]._document,r);var i=YU(e.firestore);return function(e,t,n,r,i,s){const o=e.explicitOrderBy;if(i.length>o.length)throw new rR(nR.INVALID_ARGUMENT,`Too many arguments provided to ${r}(). The number of arguments must be less than or equal to the number of orderBy() clauses`);const a=[];for(let c=0;c<i.length;c++){const l=i[c];if(o[c].field.isKeyField()){if("string"!=typeof l)throw new rR(nR.INVALID_ARGUMENT,`Invalid query. Expected a string for document ID in ${r}(), but got a ${typeof l}`);if(!lD(e)&&-1!==l.indexOf("/"))throw new rR(nR.INVALID_ARGUMENT,`Invalid query. When querying a collection and ordering by documentId(), the value passed to ${r}() must be a plain document ID, but '${l}' contains a slash.`);const n=e.path.child(wR.fromString(l));if(!TR.isDocumentKey(n))throw new rR(nR.INVALID_ARGUMENT,`Invalid query. When querying a collection group and ordering by documentId(), the value passed to ${r}() must result in a valid document path, but '${n}' is not because it contains an odd number of segments.`);const i=new TR(n);a.push(SP(t,i))}else{const e=oV(n,r,l);a.push(e)}}return new eD(a,s)}(e._query,e.firestore._databaseId,i,t,n,r)}function DV(e,t,n){if("string"==typeof(n=Wd(n))){if(""===n)throw new rR(nR.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!lD(t)&&-1!==n.indexOf("/"))throw new rR(nR.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${n}' contains a '/' character.`);var r=t.path.child(wR.fromString(n));if(!TR.isDocumentKey(r))throw new rR(nR.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${r}' is not because it has an odd number of segments (${r.length}).`);return SP(e,new TR(r))}if(n instanceof vU)return SP(e,n._key);throw new rR(nR.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${dU(n)}.`)}function OV(e,t){if(!Array.isArray(e)||0===e.length)throw new rR(nR.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${t.toString()}' filters.`);if(10<e.length)throw new rR(nR.INVALID_ARGUMENT,`Invalid Query. '${t.toString()}' filters support a maximum of 10 elements in the value array.`)}function MV(e,t,n){if(!n.isEqual(t))throw new rR(nR.INVALID_ARGUMENT,`Invalid query. You have a where filter with an inequality (<, <=, !=, not-in, >, or >=) on field '${t.toString()}' and so you must also use '${t.toString()}' as your first argument to orderBy(), but your first orderBy() is on field '${n.toString()}' instead.`)}const LV={maxAttempts:5};class FV{convertValue(e,t="none"){switch(_P(e)){case 0:return null;case 1:return e.booleanValue;case 2:return cP(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(lP(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 10:return this.convertObject(e.mapValue,t);default:throw eR()}}convertObject(e,n){const r={};return YR(e.fields,(e,t)=>{r[e]=this.convertValue(t,n)}),r}convertGeoPoint(e){return new KU(cP(e.latitude),cP(e.longitude))}convertArray(e,t){return(e.values||[]).map(e=>this.convertValue(e,t))}convertServerTimestamp(e,t){switch(t){case"previous":var n=function e(t){var n=t.mapValue.fields.__previous_value__;return uP(n)?e(n):n}(e);return null==n?null:this.convertValue(n,t);case"estimate":return this.convertTimestamp(hP(e));default:return null}}convertTimestamp(e){var t=aP(e);return new vR(t.seconds,t.nanos)}convertDocumentKey(e,t){const n=wR.fromString(e);tR(q1(n));const r=new fP(n.get(1),n.get(3)),i=new TR(n.popFirst(5));return r.isEqual(t)||Jx(`Document ${i} contains a document reference within a different database (${r.projectId}/${r.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),i}}function UV(e,t,n){return e?n&&(n.merge||n.mergeFields)?e.toFirestore(t,n):e.toFirestore(t):t}class VV extends FV{constructor(e){super(),this.firestore=e}convertBytes(e){return new qU(e)}convertReference(e){var t=this.convertDocumentKey(e,this.firestore._databaseId);return new vU(this.firestore,null,t)}}class jV{constructor(e,t){this._firestore=e,this._commitHandler=t,this._mutations=[],this._committed=!1,this._dataReader=YU(e)}set(e,t,n){this._verifyNotCommitted();const r=qV(e,this._firestore),i=UV(r.converter,t,n),s=JU(this._dataReader,"WriteBatch.set",r._key,i,null!==r.converter,n);return this._mutations.push(s.toMutation(r._key,OD.none())),this}update(e,t,n,...r){this._verifyNotCommitted();var i=qV(e,this._firestore);let s;return s="string"==typeof(t=Wd(t))||t instanceof jU?sV(this._dataReader,"WriteBatch.update",i._key,t,n,r):iV(this._dataReader,"WriteBatch.update",i._key,t),this._mutations.push(s.toMutation(i._key,OD.exists(!0))),this}delete(e){this._verifyNotCommitted();var t=qV(e,this._firestore);return this._mutations=this._mutations.concat(new WD(t._key,OD.none())),this}commit(){return this._verifyNotCommitted(),this._committed=!0,0<this._mutations.length?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new rR(nR.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}}function qV(e,t){if((e=Wd(e)).firestore!==t)throw new rR(nR.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return e}class BV extends FV{constructor(e){super(),this.firestore=e}convertBytes(e){return new qU(e)}convertReference(e){var t=this.convertDocumentKey(e,this.firestore._databaseId);return new vU(this.firestore,null,t)}}function KV(t){t=fU(t,vU);const n=fU(t.firestore,RU),e=PU(n),r=new BV(n);return function(e,t){const n=new iR;return e.asyncQueue.enqueueAndForget(async()=>async function(e,t,n){try{const i=await function(t){const n=e;return n.persistence.runTransaction("read document","readonly",e=>n.localDocuments.getDocument(e,t))}(t);i.isFoundDocument()?n.resolve(i):i.isNoDocument()?n.resolve(null):n.reject(new rR(nR.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)"))}catch(e){var r=nF(e,`Failed to get document '${t} from cache`);n.reject(r)}}(await eU(e),t,n)),n.promise}(e,t._key).then(e=>new wV(n,r,t._key,e,new _V(null!==e&&e.hasLocalMutations,!0),t.converter))}function $V(t){t=fU(t,yU);const n=fU(t.firestore,RU),e=PU(n),r=new BV(n);return function(e,t){const n=new iR;return e.asyncQueue.enqueueAndForget(async()=>async function(e,t,n){try{const i=await aL(e,t,!0),s=new yF(t,i.ji),o=s.Ku(i.documents),a=s.applyChanges(o,!1);n.resolve(a.snapshot)}catch(e){var r=nF(e,`Failed to execute query '${t} against cache`);n.reject(r)}}(await eU(e),t,n)),n.promise}(e,t._query).then(e=>new IV(n,r,t,e))}function zV(e,t,n){e=fU(e,vU);var r=fU(e.firestore,RU),i=UV(e.converter,t,n);return QV(r,[JU(YU(r),"setDoc",e._key,i,null!==e.converter,n).toMutation(e._key,OD.none())])}function WV(e,t,n,...r){e=fU(e,vU);var i=fU(e.firestore,RU),s=YU(i);let o;return o="string"==typeof(t=Wd(t))||t instanceof jU?sV(s,"updateDoc",e._key,t,n,r):iV(s,"updateDoc",e._key,t),QV(i,[o.toMutation(e._key,OD.exists(!0))])}function GV(t,...n){var e;t=Wd(t);let r={includeMetadataChanges:!1},i=0;"object"!=typeof n[i]||SU(n[i])||(r=n[i],i++);var s={includeMetadataChanges:r.includeMetadataChanges};if(SU(n[i])){const t=n[i];n[i]=null===(e=t.next)||void 0===e?void 0:e.bind(t),n[i+1]=null===(e=t.error)||void 0===e?void 0:e.bind(t),n[i+2]=null===(e=t.complete)||void 0===e?void 0:e.bind(t)}let o,a,c;if(t instanceof vU)a=fU(t.firestore,RU),c=oD(t._key.path),o={next:e=>{n[i]&&n[i](YV(a,t,e))},error:n[i+1],complete:n[i+2]};else{const l=fU(t,yU);a=fU(l.firestore,RU),c=l._query;const u=new BV(a);o={next:e=>{n[i]&&n[i](new IV(a,u,l,e))},error:n[i+1],complete:n[i+2]},EV(t._query)}return function(e,t,n,r){const i=new $F(r),s=new hF(t,i,n);return e.asyncQueue.enqueueAndForget(async()=>cF(await rU(e),s)),()=>{i.Tc(),e.asyncQueue.enqueueAndForget(async()=>lF(await rU(e),s))}}(PU(a),c,s,o)}function HV(e,t){return function(e,t){const n=new $F(t);return e.asyncQueue.enqueueAndForget(async()=>function(e,t){e.Tu.add(t),t.next()}(await rU(e),n)),()=>{n.Tc(),e.asyncQueue.enqueueAndForget(async()=>function(e,t){e.Tu.delete(t)}(await rU(e),n))}}(PU(e=fU(e,RU)),SU(t)?t:{next:t})}function QV(e,t){return function(e,t){const n=new iR;return e.asyncQueue.enqueueAndForget(async()=>TF(await nU(e),t,n)),n.promise}(PU(e),t)}function YV(e,t,n){var r=n.docs.get(t._key),i=new BV(e);return new wV(e,i,t._key,r,new _V(n.hasPendingWrites,n.fromCache),t.converter)}class JV extends class{constructor(e,t){this._firestore=e,this._transaction=t,this._dataReader=YU(e)}get(e){const n=qV(e,this._firestore),r=new VV(this._firestore);return this._transaction.lookup([n._key]).then(e=>{if(!e||1!==e.length)return eR();const t=e[0];if(t.isFoundDocument())return new mV(this._firestore,r,t.key,t,n.converter);if(t.isNoDocument())return new mV(this._firestore,r,n._key,null,n.converter);throw eR()})}set(e,t,n){var r=qV(e,this._firestore),i=UV(r.converter,t,n),i=JU(this._dataReader,"Transaction.set",r._key,i,null!==r.converter,n);return this._transaction.set(r._key,i),this}update(e,t,n,...r){var i=qV(e,this._firestore),s="string"==typeof(t=Wd(t))||t instanceof jU?sV(this._dataReader,"Transaction.update",i._key,t,n,r):iV(this._dataReader,"Transaction.update",i._key,t);return this._transaction.update(i._key,s),this}delete(e){var t=qV(e,this._firestore);return this._transaction.delete(t._key),this}}{constructor(e,t){super(e,t),this._firestore=e}get(e){const t=qV(e,this._firestore),n=new BV(this._firestore);return super.get(e).then(e=>new wV(this._firestore,n,t._key,e._document,new _V(!1,!1),t.converter))}}function XV(t,n,e){t=fU(t,RU);var r=Object.assign(Object.assign({},LV),e);return function(){if(r.maxAttempts<1)throw new rR(nR.INVALID_ARGUMENT,"Max attempts must be at least 1")}(),function(t,n,r){const i=new iR;return t.asyncQueue.enqueueAndForget(async()=>{var e=await XF(t).then(e=>e.datastore);new GF(t.asyncQueue,e,r,n,i).run()}),i.promise}(PU(t),e=>n(new JV(t,e)),r)}W=Ff,Gx=W,Df(new Gd("firestore",(e,{options:t})=>{const n=e.getProvider("app").getImmediate(),r=new RU(n,new cR(e.getProvider("auth-internal")),new dR(e.getProvider("app-check-internal")));return t=Object.assign({useFetchStreams:!0},t),r._setSettings(t),r},"PUBLIC")),qf(zx,"3.4.13",void 0),qf(zx,"3.4.13","esm2017");function ZV(e,t){if(void 0===t)return{merge:!1};if(void 0!==t.mergeFields&&void 0!==t.merge)throw new rR("invalid-argument",`Invalid options passed to function ${e}(): You cannot `+'specify both "merge" and "mergeFields".');return t}function ej(){if("undefined"==typeof Uint8Array)throw new rR("unimplemented","Uint8Arrays are not available in this environment.")}function tj(){if("undefined"==typeof atob)throw new rR("unimplemented","Blobs are unavailable in Firestore in this environment.")}class nj{constructor(e){this._delegate=e}static fromBase64String(e){return tj(),new nj(qU.fromBase64String(e))}static fromUint8Array(e){return ej(),new nj(qU.fromUint8Array(e))}toBase64(){return tj(),this._delegate.toBase64()}toUint8Array(){return ej(),this._delegate.toUint8Array()}isEqual(e){return this._delegate.isEqual(e._delegate)}toString(){return"Blob(base64: "+this.toBase64()+")"}}function rj(e){return function(e,t){if("object"!=typeof e||null===e)return;var n=e;for(const r of t)if(r in n&&"function"==typeof n[r])return 1;return}(e,["next","error","complete"])}class ij{enableIndexedDbPersistence(e,t){return function(e,t){VU(e=fU(e,RU));var n=PU(e),r=e._freezeSettings(),i=new BF;return OU(n,i,new jF(i,r.cacheSizeBytes,null==t?void 0:t.forceOwnership))}(e._delegate,{forceOwnership:t})}enableMultiTabIndexedDbPersistence(e){return function(e){VU(e=fU(e,RU));var t=PU(e),n=e._freezeSettings(),r=new BF;return OU(t,r,new qF(r,n.cacheSizeBytes))}(e._delegate)}clearIndexedDbPersistence(e){return function(e){if(e._initialized&&!e._terminated)throw new rR(nR.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");const t=new iR;return e._queue.enqueueAndForgetEvenWhileRestricted(async()=>{try{await async function(e){if(!UR.V())return Promise.resolve();var t=e+"main";await UR.delete(t)}(YM(e._databaseId,e._persistenceKey)),t.resolve()}catch(e){t.reject(e)}}),t.promise}(e._delegate)}}class sj{constructor(e,t,n){this._delegate=t,this._persistenceProvider=n,this.INTERNAL={delete:()=>this.terminate()},e instanceof fP||(this._appCompat=e)}get _databaseId(){return this._delegate._databaseId}settings(e){var t=this._delegate._getSettings();e.merge||t.host===e.host||Xx("You are overriding the original host. If you did not intend to override your settings, use {merge: true}."),e.merge&&delete(e=Object.assign(Object.assign({},t),e)).merge,this._delegate._setSettings(e)}useEmulator(e,t,n={}){!function(n,e,t,r={}){var i;const s=(n=fU(n,mU))._getSettings();if("firestore.googleapis.com"!==s.host&&s.host!==e&&Xx("Host has been set in both settings() and useEmulator(), emulator host will be used"),n._setSettings(Object.assign(Object.assign({},s),{host:`${e}:${t}`,ssl:!1})),r.mockUserToken){let e,t;if("string"==typeof r.mockUserToken)e=r.mockUserToken,t=Wx.MOCK_USER;else{e=sd(r.mockUserToken,null===(i=n._app)||void 0===i?void 0:i.options.projectId);const s=r.mockUserToken.sub||r.mockUserToken.user_id;if(!s)throw new rR(nR.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");t=new Wx(s)}n._authCredentials=new aR(new sR(e,t))}}(this._delegate,e,t,n)}enableNetwork(){return LU(this._delegate)}disableNetwork(){return FU(this._delegate)}enablePersistence(e){let t=!1,n=!1;return e&&(t=!!e.synchronizeTabs,n=!!e.experimentalForceOwningTab,lU("synchronizeTabs",t,"experimentalForceOwningTab",n)),t?this._persistenceProvider.enableMultiTabIndexedDbPersistence(this):this._persistenceProvider.enableIndexedDbPersistence(this,n)}clearPersistence(){return this._persistenceProvider.clearIndexedDbPersistence(this)}terminate(){return this._appCompat&&(this._appCompat._removeServiceInstance("firestore-compat"),this._appCompat._removeServiceInstance("firestore")),this._delegate._delete()}waitForPendingWrites(){return MU(this._delegate)}onSnapshotsInSync(e){return HV(this._delegate,e)}get app(){if(!this._appCompat)throw new rR("failed-precondition","Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._appCompat}collection(e){try{return new _j(this,wU(this._delegate,e))}catch(e){throw hj(e,"collection()","Firestore.collection()")}}doc(e){try{return new uj(this,bU(this._delegate,e))}catch(e){throw hj(e,"doc()","Firestore.doc()")}}collectionGroup(e){try{return new mj(this,function(e,t){if(e=fU(e,mU),cU("collectionGroup","collection id",t),0<=t.indexOf("/"))throw new rR(nR.INVALID_ARGUMENT,`Invalid collection ID '${t}' passed to function collectionGroup(). Collection IDs must not contain '/'.`);return new yU(e,null,(t=t,new iD(wR.emptyPath(),t)))}(this._delegate,e))}catch(e){throw hj(e,"collectionGroup()","Firestore.collectionGroup()")}}runTransaction(t){return XV(this._delegate,e=>t(new aj(this,e)))}batch(){return PU(this._delegate),new cj(new jV(this._delegate,e=>QV(this._delegate,e)))}loadBundle(e){return t=this._delegate,e=e,n=PU(t=fU(t,RU)),r=new kU,oU(n,t._databaseId,e,r),r;var t,n,r}namedQuery(e){return UU(this._delegate,e).then(e=>e?new mj(this,e):null)}}class oj extends FV{constructor(e){super(),this.firestore=e}convertBytes(e){return new nj(new qU(e))}convertReference(e){var t=this.convertDocumentKey(e,this.firestore._databaseId);return uj.forKey(t,this.firestore,null)}}class aj{constructor(e,t){this._firestore=e,this._delegate=t,this._userDataWriter=new oj(e)}get(e){const t=wj(e);return this._delegate.get(t).then(e=>new pj(this._firestore,new wV(this._firestore._delegate,this._userDataWriter,e._key,e._document,e.metadata,t.converter)))}set(e,t,n){var r=wj(e);return n?(ZV("Transaction.set",n),this._delegate.set(r,t,n)):this._delegate.set(r,t),this}update(e,t,n,...r){var i=wj(e);return 2===arguments.length?this._delegate.update(i,t):this._delegate.update(i,t,n,...r),this}delete(e){var t=wj(e);return this._delegate.delete(t),this}}class cj{constructor(e){this._delegate=e}set(e,t,n){var r=wj(e);return n?(ZV("WriteBatch.set",n),this._delegate.set(r,t,n)):this._delegate.set(r,t),this}update(e,t,n,...r){var i=wj(e);return 2===arguments.length?this._delegate.update(i,t):this._delegate.update(i,t,n,...r),this}delete(e){var t=wj(e);return this._delegate.delete(t),this}commit(){return this._delegate.commit()}}class lj{constructor(e,t,n){this._firestore=e,this._userDataWriter=t,this._delegate=n}fromFirestore(e,t){var n=new bV(this._firestore._delegate,this._userDataWriter,e._key,e._document,e.metadata,null);return this._delegate.fromFirestore(new gj(this._firestore,n),null!=t?t:{})}toFirestore(e,t){return t?this._delegate.toFirestore(e,t):this._delegate.toFirestore(e)}static getInstance(e,t){const n=lj.INSTANCES;let r=n.get(e);r||(r=new WeakMap,n.set(e,r));let i=r.get(t);return i||(i=new lj(e,new oj(e),t),r.set(t,i)),i}}lj.INSTANCES=new WeakMap;class uj{constructor(e,t){this.firestore=e,this._delegate=t,this._userDataWriter=new oj(e)}static forPath(e,t,n){if(e.length%2!=0)throw new rR("invalid-argument","Invalid document reference. Document references must have an even number of segments, but "+`${e.canonicalString()} has ${e.length}`);return new uj(t,new vU(t._delegate,n,new TR(e)))}static forKey(e,t,n){return new uj(t,new vU(t._delegate,n,e))}get id(){return this._delegate.id}get parent(){return new _j(this.firestore,this._delegate.parent)}get path(){return this._delegate.path}collection(e){try{return new _j(this.firestore,wU(this._delegate,e))}catch(e){throw hj(e,"collection()","DocumentReference.collection()")}}isEqual(e){return(e=Wd(e))instanceof vU&&IU(this._delegate,e)}set(e,t){t=ZV("DocumentReference.set",t);try{return t?zV(this._delegate,e,t):zV(this._delegate,e)}catch(e){throw hj(e,"setDoc()","DocumentReference.set()")}}update(e,t,...n){try{return 1===arguments.length?WV(this._delegate,e):WV(this._delegate,e,t,...n)}catch(e){throw hj(e,"updateDoc()","DocumentReference.update()")}}delete(){return QV(fU((e=this._delegate).firestore,RU),[new WD(e._key,OD.none())]);var e}onSnapshot(...e){var t=dj(e),n=fj(e,e=>new pj(this.firestore,new wV(this.firestore._delegate,this._userDataWriter,e._key,e._document,e.metadata,this._delegate.converter)));return GV(this._delegate,t,n)}get(e){let t;return t=("cache"===(null==e?void 0:e.source)?KV:"server"===(null==e?void 0:e.source)?function(t){t=fU(t,vU);const n=fU(t.firestore,RU);return iU(PU(n),t._key,{source:"server"}).then(e=>YV(n,t,e))}:function(t){t=fU(t,vU);const n=fU(t.firestore,RU);return iU(PU(n),t._key).then(e=>YV(n,t,e))})(this._delegate),t.then(e=>new pj(this.firestore,new wV(this.firestore._delegate,this._userDataWriter,e._key,e._document,e.metadata,this._delegate.converter)))}withConverter(e){return new uj(this.firestore,e?this._delegate.withConverter(lj.getInstance(this.firestore,e)):this._delegate.withConverter(null))}}function hj(e,t,n){return e.message=e.message.replace(t,n),e}function dj(e){for(const t of e)if("object"==typeof t&&!rj(t))return t;return{}}function fj(e,t){var n;let r;return r=rj(e[0])?e[0]:rj(e[1])?e[1]:"function"==typeof e[0]?{next:e[0],error:e[1],complete:e[2]}:{next:e[1],error:e[2],complete:e[3]},{next:e=>{r.next&&r.next(t(e))},error:null===(n=r.error)||void 0===n?void 0:n.bind(r),complete:null===(n=r.complete)||void 0===n?void 0:n.bind(r)}}class pj{constructor(e,t){this._firestore=e,this._delegate=t}get ref(){return new uj(this._firestore,this._delegate.ref)}get id(){return this._delegate.id}get metadata(){return this._delegate.metadata}get exists(){return this._delegate.exists()}data(e){return this._delegate.data(e)}get(e,t){return this._delegate.get(e,t)}isEqual(e){return TV(this._delegate,e._delegate)}}class gj extends pj{data(e){var t=this._delegate.data(e);return void 0!==t||eR(),t}}class mj{constructor(e,t){this.firestore=e,this._delegate=t,this._userDataWriter=new oj(e)}where(e,t,n){try{return new mj(this.firestore,kV(this._delegate,(r=n,i=t,s=yV("where",e),new CV(s,i,r))))}catch(e){throw hj(e,/(orderBy|where)\(\)/,"Query.$1()")}var r,i,s}orderBy(e,t){try{return new mj(this.firestore,kV(this._delegate,([n,r="asc"]=[e,t],i=r,s=yV("orderBy",n),new AV(s,i))))}catch(e){throw hj(e,/(orderBy|where)\(\)/,"Query.$1()")}var n,r,i,s}limit(e){try{return new mj(this.firestore,kV(this._delegate,(pU("limit",t=e),new NV("limit",t,"F"))))}catch(e){throw hj(e,"limit()","Query.limit()")}var t}limitToLast(e){try{return new mj(this.firestore,kV(this._delegate,(pU("limitToLast",t=e),new NV("limitToLast",t,"L"))))}catch(e){throw hj(e,"limitToLast()","Query.limitToLast()")}var t}startAt(...e){try{return new mj(this.firestore,kV(this._delegate,function(...e){return new xV("startAt",e,!0)}(...e)))}catch(e){throw hj(e,"startAt()","Query.startAt()")}}startAfter(...e){try{return new mj(this.firestore,kV(this._delegate,function(...e){return new xV("startAfter",e,!1)}(...e)))}catch(e){throw hj(e,"startAfter()","Query.startAfter()")}}endBefore(...e){try{return new mj(this.firestore,kV(this._delegate,function(...e){return new RV("endBefore",e,!1)}(...e)))}catch(e){throw hj(e,"endBefore()","Query.endBefore()")}}endAt(...e){try{return new mj(this.firestore,kV(this._delegate,function(...e){return new RV("endAt",e,!0)}(...e)))}catch(e){throw hj(e,"endAt()","Query.endAt()")}}isEqual(e){return TU(this._delegate,e._delegate)}get(e){let t;return t=("cache"===(null==e?void 0:e.source)?$V:"server"===(null==e?void 0:e.source)?function(t){t=fU(t,yU);const n=fU(t.firestore,RU),e=PU(n),r=new BV(n);return sU(e,t._query,{source:"server"}).then(e=>new IV(n,r,t,e))}:function(t){t=fU(t,yU);const n=fU(t.firestore,RU),e=PU(n),r=new BV(n);return EV(t._query),sU(e,t._query).then(e=>new IV(n,r,t,e))})(this._delegate),t.then(e=>new yj(this.firestore,new IV(this.firestore._delegate,this._userDataWriter,this._delegate,e._snapshot)))}onSnapshot(...e){var t=dj(e),n=fj(e,e=>new yj(this.firestore,new IV(this.firestore._delegate,this._userDataWriter,this._delegate,e._snapshot)));return GV(this._delegate,t,n)}withConverter(e){return new mj(this.firestore,e?this._delegate.withConverter(lj.getInstance(this.firestore,e)):this._delegate.withConverter(null))}}class vj{constructor(e,t){this._firestore=e,this._delegate=t}get type(){return this._delegate.type}get doc(){return new gj(this._firestore,this._delegate.doc)}get oldIndex(){return this._delegate.oldIndex}get newIndex(){return this._delegate.newIndex}}class yj{constructor(e,t){this._firestore=e,this._delegate=t}get query(){return new mj(this._firestore,this._delegate.query)}get metadata(){return this._delegate.metadata}get size(){return this._delegate.size}get empty(){return this._delegate.empty}get docs(){return this._delegate.docs.map(e=>new gj(this._firestore,e))}docChanges(e){return this._delegate.docChanges(e).map(e=>new vj(this._firestore,e))}forEach(t,n){this._delegate.forEach(e=>{t.call(n,new gj(this._firestore,e))})}isEqual(e){return TV(this._delegate,e._delegate)}}class _j extends mj{constructor(e,t){super(e,t),this.firestore=e,this._delegate=t}get id(){return this._delegate.id}get path(){return this._delegate.path}get parent(){var e=this._delegate.parent;return e?new uj(this.firestore,e):null}doc(e){try{return void 0===e?new uj(this.firestore,bU(this._delegate)):new uj(this.firestore,bU(this._delegate,e))}catch(e){throw hj(e,"doc()","CollectionReference.doc()")}}add(e){return function(e,t){const n=fU(e.firestore,RU),r=bU(e),i=UV(e.converter,t);return QV(n,[JU(YU(e.firestore),"addDoc",r._key,i,null!==e.converter,{}).toMutation(r._key,OD.exists(!1))]).then(()=>r)}(this._delegate,e).then(e=>new uj(this.firestore,e))}isEqual(e){return IU(this._delegate,e._delegate)}withConverter(e){return new _j(this.firestore,e?this._delegate.withConverter(lj.getInstance(this.firestore,e)):this._delegate.withConverter(null))}}function wj(e){return fU(e,vU)}const bj={Firestore:sj,GeoPoint:KU,Timestamp:vR,Blob:nj,Transaction:aj,WriteBatch:cj,DocumentReference:uj,DocumentSnapshot:pj,Query:mj,QueryDocumentSnapshot:gj,QuerySnapshot:yj,CollectionReference:_j,FieldPath:class E${constructor(...e){this._delegate=new jU(...e)}static documentId(){return new E$(IR.keyField().canonicalString())}isEqual(e){return(e=Wd(e))instanceof jU&&this._delegate._internalPath.isEqual(e._internalPath)}},FieldValue:class S${constructor(e){this._delegate=e}static serverTimestamp(){const e=new eV("serverTimestamp");return e._methodName="FieldValue.serverTimestamp",new S$(e)}static delete(){const e=new XU("deleteField");return e._methodName="FieldValue.delete",new S$(e)}static arrayUnion(...e){const t=function(...e){return new tV("arrayUnion",e)}(...e);return t._methodName="FieldValue.arrayUnion",new S$(t)}static arrayRemove(...e){const t=function(...e){return new nV("arrayRemove",e)}(...e);return t._methodName="FieldValue.arrayRemove",new S$(t)}static increment(e){const t=new rV("increment",e);return t._methodName="FieldValue.increment",new S$(t)}isEqual(e){return this._delegate.isEqual(e._delegate)}},setLogLevel:function(e){e=e,Hx.setLogLevel(e)},CACHE_SIZE_UNLIMITED:-1};CU=op,AU=(e,t)=>new sj(e,t,new ij),CU.INTERNAL.registerComponent(new Gd("firestore-compat",e=>{var t=e.getProvider("app-compat").getImmediate(),n=e.getProvider("firestore").getImmediate();return AU(t,n)},"PUBLIC").setServiceProps(Object.assign({},bj))),CU.registerVersion("@firebase/firestore-compat","0.1.22");const Ij="type.googleapis.com/google.protobuf.Int64Value",Tj="type.googleapis.com/google.protobuf.UInt64Value";function Ej(e,t){const n={};for(const r in e)e.hasOwnProperty(r)&&(n[r]=t(e[r]));return n}function Sj(e){if(null==e)return e;if(e["@type"])switch(e["@type"]){case Ij:case Tj:var t=Number(e.value);if(isNaN(t))throw new Error("Data cannot be decoded from JSON: "+e);return t;default:throw new Error("Data cannot be decoded from JSON: "+e)}return Array.isArray(e)?e.map(e=>Sj(e)):"function"==typeof e||"object"==typeof e?Ej(e,e=>Sj(e)):e}const kj="functions",Cj={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class Aj extends md{constructor(e,t,n){super(`${kj}/${e}`,t||""),this.details=n}}function Nj(e,t){let n=function(e){if(200<=e&&e<300)return"ok";switch(e){case 0:return"internal";case 400:return"invalid-argument";case 401:return"unauthenticated";case 403:return"permission-denied";case 404:return"not-found";case 409:return"aborted";case 429:return"resource-exhausted";case 499:return"cancelled";case 500:return"internal";case 501:return"unimplemented";case 503:return"unavailable";case 504:return"deadline-exceeded"}return"unknown"}(e),r=n,i=void 0;try{var s=t&&t.error;if(s){const e=s.status;if("string"==typeof e){if(!Cj[e])return new Aj("internal","internal");n=Cj[e],r=e}var o=s.message;"string"==typeof o&&(r=o),i=s.details,void 0!==i&&(i=Sj(i))}}catch(e){}return"ok"===n?null:new Aj(n,r,i)}class xj{constructor(e,t,n){this.auth=null,this.messaging=null,this.appCheck=null,this.auth=e.getImmediate({optional:!0}),this.messaging=t.getImmediate({optional:!0}),this.auth||e.get().then(e=>this.auth=e,()=>{}),this.messaging||t.get().then(e=>this.messaging=e,()=>{}),this.appCheck||n.get().then(e=>this.appCheck=e,()=>{})}async getAuthToken(){if(this.auth)try{var e=await this.auth.getToken();return null==e?void 0:e.accessToken}catch(e){return}}async getMessagingToken(){if(this.messaging&&"Notification"in self&&"granted"===Notification.permission)try{return this.messaging.getToken()}catch(e){return}}async getAppCheckToken(){if(this.appCheck){var e=await this.appCheck.getToken();return e.error?null:e.token}return null}async getContext(){return{authToken:await this.getAuthToken(),messagingToken:await this.getMessagingToken(),appCheckToken:await this.getAppCheckToken()}}}const Rj="us-central1";class Pj{constructor(e,t,n,r,i=Rj,s){this.app=e,this.fetchImpl=s,this.emulatorOrigin=null,this.contextProvider=new xj(t,n,r),this.cancelAllRequests=new Promise(e=>{this.deleteService=()=>Promise.resolve(e())});try{var o=new URL(i);this.customDomain=o.origin,this.region=Rj}catch(e){this.customDomain=null,this.region=i}}_delete(){return this.deleteService()}_url(e){var t=this.app.options.projectId;return null===this.emulatorOrigin?null!==this.customDomain?`${this.customDomain}/${e}`:`https://${this.region}-${t}.cloudfunctions.net/${e}`:`${this.emulatorOrigin}/${t}/${this.region}/${e}`}}function Dj(i,s,o){return e=>{return t=e,n=o||{},r=(e=i)._url(s),Oj(e,r,t,n);var t,n,r}}async function Oj(e,t,n,r){var i={data:n=function t(e){if(null==e)return null;if("number"==typeof(e=e instanceof Number?e.valueOf():e)&&isFinite(e))return e;if(!0===e||!1===e)return e;if("[object String]"===Object.prototype.toString.call(e))return e;if(e instanceof Date)return e.toISOString();if(Array.isArray(e))return e.map(e=>t(e));if("function"==typeof e||"object"==typeof e)return Ej(e,e=>t(e));throw new Error("Data cannot be encoded in JSON: "+e)}(n)};const s={};var o=await e.contextProvider.getContext();o.authToken&&(s.Authorization="Bearer "+o.authToken),o.messagingToken&&(s["Firebase-Instance-ID-Token"]=o.messagingToken),null!==o.appCheckToken&&(s["X-Firebase-AppCheck"]=o.appCheckToken);const a=function(n){let r=null;return{promise:new Promise((e,t)=>{r=setTimeout(()=>{t(new Aj("deadline-exceeded","deadline-exceeded"))},n)}),cancel:()=>{r&&clearTimeout(r)}}}(r.timeout||7e4);o=await Promise.race([async function(e,t,n,r){n["Content-Type"]="application/json";let i;try{i=await r(e,{method:"POST",body:JSON.stringify(t),headers:n})}catch(e){return{status:0,json:null}}let s=null;try{s=await i.json()}catch(e){}return{status:i.status,json:s}}(t,i,s,e.fetchImpl),a.promise,e.cancelAllRequests]);if(a.cancel(),!o)throw new Aj("cancelled","Firebase Functions instance was deleted.");i=Nj(o.status,o.json);if(i)throw i;if(!o.json)throw new Aj("internal","Response is not valid JSON object.");let c=o.json.data;if(void 0===c&&(c=o.json.result),void 0===c)throw new Aj("internal","Response is missing data field.");return{data:Sj(c)}}const Mj="@firebase/functions";function Lj(e,t,n){Wd(e).emulatorOrigin=`http://${t}:${n}`}function Fj(e,t,n){return r=Wd(e),i=t,s=n,e=>Oj(r,i,e,s||{});var r,i,s}NU=fetch.bind(self),Df(new Gd(kj,(e,{instanceIdentifier:t})=>{var n=e.getProvider("app").getImmediate(),r=e.getProvider("auth-internal"),i=e.getProvider("messaging-internal"),s=e.getProvider("app-check-internal");return new Pj(n,r,i,s,t,NU)},"PUBLIC").setMultipleInstances(!0)),qf(Mj,"0.8.4",xU),qf(Mj,"0.8.4","esm2017");var Uj,Vj,jj,qj;class Bj{constructor(e,t){this.app=e,this._delegate=t,this._region=this._delegate.region,this._customDomain=this._delegate.customDomain}httpsCallable(e,t){return Dj(Wd(this._delegate),e,t)}httpsCallableFromURL(e,t){return Fj(this._delegate,e,t)}useFunctionsEmulator(e){var t=e.match("[a-zA-Z]+://([a-zA-Z0-9.-]+)(?::([0-9]+))?");if(null==t)throw new md("functions","No origin provided to useFunctionsEmulator()");if(null==t[2])throw new md("functions","Port missing in origin provided to useFunctionsEmulator()");return Lj(this._delegate,t[1],Number(t[2]))}useEmulator(e,t){return Lj(this._delegate,e,t)}}const Kj="us-central1",$j=(e,{instanceIdentifier:t})=>{var n=e.getProvider("app-compat").getImmediate(),r=e.getProvider("functions").getImmediate({identifier:null!=t?t:Kj});return new Bj(n,r)};Uj={Functions:Bj},op.INTERNAL.registerComponent(new Gd("functions-compat",$j,"PUBLIC").setServiceProps(Uj).setMultipleInstances(!0)),op.registerVersion("@firebase/functions-compat","0.2.4");const zj="/firebase-messaging-sw.js",Wj="/firebase-cloud-messaging-push-scope",Gj="BDOU99-h67HcA6JeFXHbSNMu7e2yNNu3RzoMj8TM4W88jITfq7ZmPvIM1Iv-4_l2LxQcYwhqby2xGpWwzjfAnG4",Hj="https://fcmregistrations.googleapis.com/v1",Qj="google.c.a.c_id",Yj="google.c.a.e";function Jj(e){var t=new Uint8Array(e);const n=btoa(String.fromCharCode(...t));return n.replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")}(yt=oK=oK||{})[yt.DATA_MESSAGE=1]="DATA_MESSAGE",yt[yt.DISPLAY_NOTIFICATION=3]="DISPLAY_NOTIFICATION",(yt=Vj=Vj||{}).PUSH_RECEIVED="push-received",yt.NOTIFICATION_CLICKED="notification-clicked";const Xj="fcm_token_details_db",Zj="fcm_token_object_Store";async function eq(c){if("databases"in indexedDB){const t=await indexedDB.databases(),n=t.map(e=>e.name);if(!n.includes(Xj))return null}let l=null;const e=await vf(Xj,5,{upgrade:async(e,t,n,r)=>{var i;if(!(t<2)&&e.objectStoreNames.contains(Zj)){const a=r.objectStore(Zj);var s,o=await a.index("fcmSenderId").get(c);await a.clear(),o&&(2===t?(s=o).auth&&s.p256dh&&s.endpoint&&(l={token:s.fcmToken,createTime:null!==(i=s.createTime)&&void 0!==i?i:Date.now(),subscriptionOptions:{auth:s.auth,p256dh:s.p256dh,endpoint:s.endpoint,swScope:s.swScope,vapidKey:"string"==typeof s.vapidKey?s.vapidKey:Jj(s.vapidKey)}}):3===t?(s=o,l={token:s.fcmToken,createTime:s.createTime,subscriptionOptions:{auth:Jj(s.auth),p256dh:Jj(s.p256dh),endpoint:s.endpoint,swScope:s.swScope,vapidKey:Jj(s.vapidKey)}}):4===t&&(o=o,l={token:o.fcmToken,createTime:o.createTime,subscriptionOptions:{auth:Jj(o.auth),p256dh:Jj(o.p256dh),endpoint:o.endpoint,swScope:o.swScope,vapidKey:Jj(o.vapidKey)}}))}}});return e.close(),await yf(Xj),await yf("fcm_vapid_details_db"),await yf("undefined"),function(e){if(!e||!e.subscriptionOptions)return!1;var t=e["subscriptionOptions"];return"number"==typeof e.createTime&&0<e.createTime&&"string"==typeof e.token&&0<e.token.length&&"string"==typeof t.auth&&0<t.auth.length&&"string"==typeof t.p256dh&&0<t.p256dh.length&&"string"==typeof t.endpoint&&0<t.endpoint.length&&"string"==typeof t.swScope&&0<t.swScope.length&&"string"==typeof t.vapidKey&&0<t.vapidKey.length}(l)?l:null}const tq="firebase-messaging-database",nq=1,rq="firebase-messaging-store";let iq=null;function sq(){return iq=iq||vf(tq,nq,{upgrade:(e,t)=>{0===t&&e.createObjectStore(rq)}}),iq}async function oq(e){var t=cq(e);const n=await sq();t=await n.transaction(rq).objectStore(rq).get(t);if(t)return t;t=await eq(e.appConfig.senderId);return t?(await aq(e,t),t):void 0}async function aq(e,t){var n=cq(e);const r=await sq(),i=r.transaction(rq,"readwrite");return await i.objectStore(rq).put(t,n),await i.done,t}function cq({appConfig:e}){return e.appId}const lq=new vd("messaging","Messaging",{"missing-app-config-values":'Missing App configuration value: "{$valueName}"',"only-available-in-window":"This method is available in a Window context.","only-available-in-sw":"This method is available in a service worker context.","permission-default":"The notification permission was not granted and dismissed instead.","permission-blocked":"The notification permission was not granted and blocked instead.","unsupported-browser":"This browser doesn't support the API's required to use the Firebase SDK.","indexed-db-unsupported":"This browser doesn't support indexedDb.open() (ex. Safari iFrame, Firefox Private Browsing, etc)","failed-service-worker-registration":"We are unable to register the default service worker. {$browserErrorMessage}","token-subscribe-failed":"A problem occurred while subscribing the user to FCM: {$errorInfo}","token-subscribe-no-token":"FCM returned no token when subscribing the user to push.","token-unsubscribe-failed":"A problem occurred while unsubscribing the user from FCM: {$errorInfo}","token-update-failed":"A problem occurred while updating the user from FCM: {$errorInfo}","token-update-no-token":"FCM returned no token when updating the user to push.","use-sw-after-get-token":"The useServiceWorker() method may only be called once and must be called before calling getToken() to ensure your service worker is used.","invalid-sw-registration":"The input to useServiceWorker() must be a ServiceWorkerRegistration.","invalid-bg-handler":"The input to setBackgroundMessageHandler() must be a function.","invalid-vapid-key":"The public VAPID key must be a string.","use-vapid-key-after-get-token":"The usePublicVapidKey() method may only be called once and must be called before calling getToken() to ensure your VAPID key is used."});async function uq(e,t){var n={method:"DELETE",headers:await dq(e)};try{const s=await fetch(`${hq(e.appConfig)}/${t}`,n);var r=await s.json();if(r.error){var i=r.error.message;throw lq.create("token-unsubscribe-failed",{errorInfo:i})}}catch(e){throw lq.create("token-unsubscribe-failed",{errorInfo:null===e||void 0===e?void 0:e.toString()})}}function hq({projectId:e}){return`${Hj}/projects/${e}/registrations`}async function dq({appConfig:e,installations:t}){var n=await t.getToken();return new Headers({"Content-Type":"application/json",Accept:"application/json","x-goog-api-key":e.apiKey,"x-goog-firebase-installations-auth":`FIS ${n}`})}function fq({p256dh:e,auth:t,endpoint:n,vapidKey:r}){const i={web:{endpoint:n,auth:t,p256dh:e}};return r!==Gj&&(i.web.applicationPubKey=r),i}const pq=6048e5;async function gq(e){const t=await async function(e,t){var n=await e.pushManager.getSubscription();if(n)return n;return e.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:function(e){var t=(e+"=".repeat((4-e.length%4)%4)).replace(/\-/g,"+").replace(/_/g,"/");const n=atob(t),r=new Uint8Array(n.length);for(let i=0;i<n.length;++i)r[i]=n.charCodeAt(i);return r}(t)})}(e.swRegistration,e.vapidKey);var n,r,i,s,o,a={vapidKey:e.vapidKey,swScope:e.swRegistration.scope,endpoint:t.endpoint,auth:Jj(t.getKey("auth")),p256dh:Jj(t.getKey("p256dh"))},c=await oq(e.firebaseDependencies);if(c){if(n=c.subscriptionOptions,r=a.vapidKey===n.vapidKey,i=a.endpoint===n.endpoint,s=a.auth===n.auth,o=a.p256dh===n.p256dh,r&&i&&s&&o)return Date.now()>=c.createTime+pq?async function(t,e){try{var n=await async function(e,t){var n=await dq(e),r=fq(t.subscriptionOptions),r={method:"PATCH",headers:n,body:JSON.stringify(r)};let i;try{const s=await fetch(`${hq(e.appConfig)}/${t.token}`,r);i=await s.json()}catch(e){throw lq.create("token-update-failed",{errorInfo:null===e||void 0===e?void 0:e.toString()})}if(i.error){r=i.error.message;throw lq.create("token-update-failed",{errorInfo:r})}if(!i.token)throw lq.create("token-update-no-token");return i.token}(t.firebaseDependencies,e),r=Object.assign(Object.assign({},e),{token:n,createTime:Date.now()});return await aq(t.firebaseDependencies,r),n}catch(e){throw await mq(t),e}}(e,{token:c.token,createTime:Date.now(),subscriptionOptions:a}):c.token;try{await uq(e.firebaseDependencies,c.token)}catch(e){console.warn(e)}return vq(e.firebaseDependencies,a)}return vq(e.firebaseDependencies,a)}async function mq(e){var t=await oq(e.firebaseDependencies);t&&(await uq(e.firebaseDependencies,t.token),await async function(e){var t=cq(e);const n=await sq(),r=n.transaction(rq,"readwrite");await r.objectStore(rq).delete(t),await r.done}(e.firebaseDependencies));const n=await e.swRegistration.pushManager.getSubscription();return!n||n.unsubscribe()}async function vq(e,t){var n={token:await async function(e,t){var n=await dq(e),r=fq(t),r={method:"POST",headers:n,body:JSON.stringify(r)};let i;try{const s=await fetch(hq(e.appConfig),r);i=await s.json()}catch(e){throw lq.create("token-subscribe-failed",{errorInfo:null===e||void 0===e?void 0:e.toString()})}if(i.error){r=i.error.message;throw lq.create("token-subscribe-failed",{errorInfo:r})}if(!i.token)throw lq.create("token-subscribe-no-token");return i.token}(e,t),createTime:Date.now(),subscriptionOptions:t};return await aq(e,n),n.token}function yq(e){var t,n,r,i,s,o={from:e.from,collapseKey:e.collapse_key,messageId:e.fcmMessageId};return r=o,(n=e).notification&&(r.notification={},(t=n.notification.title)&&(r.notification.title=t),(t=n.notification.body)&&(r.notification.body=t),(t=n.notification.image)&&(r.notification.image=t)),n=o,(r=e).data&&(n.data=r.data),r=o,((e=e).fcmOptions||null!==(i=e.notification)&&void 0!==i&&i.click_action)&&(r.fcmOptions={},(s=null!==(i=null===(i=e.fcmOptions)||void 0===i?void 0:i.link)&&void 0!==i?i:null===(s=e.notification)||void 0===s?void 0:s.click_action)&&(r.fcmOptions.link=s),(s=null===(s=e.fcmOptions)||void 0===s?void 0:s.analytics_label)&&(r.fcmOptions.analyticsLabel=s)),o}function _q(e,t){const n=[];for(let r=0;r<e.length;r++)n.push(e.charAt(r)),r<t.length&&n.push(t.charAt(r));return n.join("")}function wq(e){return lq.create("missing-app-config-values",{valueName:e})}_q("hts/frbslgigp.ogepscmv/ieo/eaylg","tp:/ieaeogn-agolai.o/1frlglgc/o"),_q("AzSCbw63g1R0nCw85jG8","Iaya3yLKwmgvh7cF0q4");class bq{constructor(e,t,n){this.deliveryMetricsExportedToBigQueryEnabled=!1,this.onBackgroundMessageHandler=null,this.onMessageHandler=null,this.logEvents=[],this.isLogServiceStarted=!1;var r=function(e){if(!e||!e.options)throw wq("App Configuration Object");if(!e.name)throw wq("App Name");var t=e["options"];for(const n of["projectId","apiKey","appId","messagingSenderId"])if(!t[n])throw wq(n);return{appName:e.name,projectId:t.projectId,apiKey:t.apiKey,appId:t.appId,senderId:t.messagingSenderId}}(e);this.firebaseDependencies={app:e,appConfig:r,installations:t,analyticsProvider:n}}_delete(){return Promise.resolve()}}async function Iq(e){try{e.swRegistration=await navigator.serviceWorker.register(zj,{scope:Wj}),e.swRegistration.update().catch(()=>{})}catch(e){throw lq.create("failed-service-worker-registration",{browserErrorMessage:null===e||void 0===e?void 0:e.message})}}async function Tq(e,t){if(!navigator)throw lq.create("only-available-in-window");if("default"===Notification.permission&&await Notification.requestPermission(),"granted"!==Notification.permission)throw lq.create("permission-blocked");var n,r;return n=e,await((r=null==t?void 0:t.vapidKey)?n.vapidKey=r:n.vapidKey||(n.vapidKey=Gj)),await async function(e,t){if(t||e.swRegistration||await Iq(e),t||!e.swRegistration){if(!(t instanceof ServiceWorkerRegistration))throw lq.create("invalid-sw-registration");e.swRegistration=t}}(e,null==t?void 0:t.serviceWorkerRegistration),gq(e)}async function Eq(e,t,n){var r=function(e){switch(e){case Vj.NOTIFICATION_CLICKED:return"notification_open";case Vj.PUSH_RECEIVED:return"notification_foreground";default:throw new Error}}(t);const i=await e.firebaseDependencies.analyticsProvider.get();i.logEvent(r,{message_id:n[Qj],message_name:n["google.c.a.c_l"],message_time:n["google.c.a.ts"],message_device_time:Math.floor(Date.now()/1e3)})}async function Sq(e,t){var n,r=t.data;r.isFirebaseMessaging&&(e.onMessageHandler&&r.messageType===Vj.PUSH_RECEIVED&&("function"==typeof e.onMessageHandler?e.onMessageHandler(yq(r)):e.onMessageHandler.next(yq(r))),n=r.data,"object"==typeof(t=n)&&t&&Qj in t&&"1"===n[Yj]&&await Eq(e,r.messageType,n))}const kq="@firebase/messaging",Cq=e=>{const t=new bq(e.getProvider("app").getImmediate(),e.getProvider("installations-internal").getImmediate(),e.getProvider("analytics-internal"));return navigator.serviceWorker.addEventListener("message",e=>Sq(t,e)),t},Aq=e=>{const t=e.getProvider("messaging").getImmediate();return{getToken:e=>Tq(t,e)}};function Nq(e){return async function(e){if(!navigator)throw lq.create("only-available-in-window");return e.swRegistration||await Iq(e),mq(e)}(e=Wd(e))}function xq(e,t){return function(e,t){if(!navigator)throw lq.create("only-available-in-window");return e.onMessageHandler=t,()=>{e.onMessageHandler=null}}(e=Wd(e),t)}Df(new Gd("messaging",Cq,"PUBLIC")),Df(new Gd("messaging-internal",Aq,"PRIVATE")),qf(kq,"0.9.16"),qf(kq,"0.9.16","esm2017");const Rq="BDOU99-h67HcA6JeFXHbSNMu7e2yNNu3RzoMj8TM4W88jITfq7ZmPvIM1Iv-4_l2LxQcYwhqby2xGpWwzjfAnG4",Pq="https://fcmregistrations.googleapis.com/v1",Dq="FCM_MSG",Oq="google.c.a.c_id",Mq=3,Lq=1;function Fq(e){var t=new Uint8Array(e);const n=btoa(String.fromCharCode(...t));return n.replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")}(yt=jj=jj||{})[yt.DATA_MESSAGE=1]="DATA_MESSAGE",yt[yt.DISPLAY_NOTIFICATION=3]="DISPLAY_NOTIFICATION",(c=qj=qj||{}).PUSH_RECEIVED="push-received",c.NOTIFICATION_CLICKED="notification-clicked";const Uq="fcm_token_details_db",Vq="fcm_token_object_Store";async function jq(c){if("databases"in indexedDB){const t=await indexedDB.databases(),n=t.map(e=>e.name);if(!n.includes(Uq))return null}let l=null;const e=await vf(Uq,5,{upgrade:async(e,t,n,r)=>{var i;if(!(t<2)&&e.objectStoreNames.contains(Vq)){const a=r.objectStore(Vq);var s,o=await a.index("fcmSenderId").get(c);await a.clear(),o&&(2===t?(s=o).auth&&s.p256dh&&s.endpoint&&(l={token:s.fcmToken,createTime:null!==(i=s.createTime)&&void 0!==i?i:Date.now(),subscriptionOptions:{auth:s.auth,p256dh:s.p256dh,endpoint:s.endpoint,swScope:s.swScope,vapidKey:"string"==typeof s.vapidKey?s.vapidKey:Fq(s.vapidKey)}}):3===t?(s=o,l={token:s.fcmToken,createTime:s.createTime,subscriptionOptions:{auth:Fq(s.auth),p256dh:Fq(s.p256dh),endpoint:s.endpoint,swScope:s.swScope,vapidKey:Fq(s.vapidKey)}}):4===t&&(o=o,l={token:o.fcmToken,createTime:o.createTime,subscriptionOptions:{auth:Fq(o.auth),p256dh:Fq(o.p256dh),endpoint:o.endpoint,swScope:o.swScope,vapidKey:Fq(o.vapidKey)}}))}}});return e.close(),await yf(Uq),await yf("fcm_vapid_details_db"),await yf("undefined"),function(e){if(!e||!e.subscriptionOptions)return!1;var t=e["subscriptionOptions"];return"number"==typeof e.createTime&&0<e.createTime&&"string"==typeof e.token&&0<e.token.length&&"string"==typeof t.auth&&0<t.auth.length&&"string"==typeof t.p256dh&&0<t.p256dh.length&&"string"==typeof t.endpoint&&0<t.endpoint.length&&"string"==typeof t.swScope&&0<t.swScope.length&&"string"==typeof t.vapidKey&&0<t.vapidKey.length}(l)?l:null}const qq="firebase-messaging-database",Bq=1,Kq="firebase-messaging-store";let $q=null;function zq(){return $q=$q||vf(qq,Bq,{upgrade:(e,t)=>{0===t&&e.createObjectStore(Kq)}}),$q}async function Wq(e){var t=Hq(e);const n=await zq();t=await n.transaction(Kq).objectStore(Kq).get(t);if(t)return t;t=await jq(e.appConfig.senderId);return t?(await Gq(e,t),t):void 0}async function Gq(e,t){var n=Hq(e);const r=await zq(),i=r.transaction(Kq,"readwrite");return await i.objectStore(Kq).put(t,n),await i.done,t}function Hq({appConfig:e}){return e.appId}const Qq=new vd("messaging","Messaging",{"missing-app-config-values":'Missing App configuration value: "{$valueName}"',"only-available-in-window":"This method is available in a Window context.","only-available-in-sw":"This method is available in a service worker context.","permission-default":"The notification permission was not granted and dismissed instead.","permission-blocked":"The notification permission was not granted and blocked instead.","unsupported-browser":"This browser doesn't support the API's required to use the Firebase SDK.","indexed-db-unsupported":"This browser doesn't support indexedDb.open() (ex. Safari iFrame, Firefox Private Browsing, etc)","failed-service-worker-registration":"We are unable to register the default service worker. {$browserErrorMessage}","token-subscribe-failed":"A problem occurred while subscribing the user to FCM: {$errorInfo}","token-subscribe-no-token":"FCM returned no token when subscribing the user to push.","token-unsubscribe-failed":"A problem occurred while unsubscribing the user from FCM: {$errorInfo}","token-update-failed":"A problem occurred while updating the user from FCM: {$errorInfo}","token-update-no-token":"FCM returned no token when updating the user to push.","use-sw-after-get-token":"The useServiceWorker() method may only be called once and must be called before calling getToken() to ensure your service worker is used.","invalid-sw-registration":"The input to useServiceWorker() must be a ServiceWorkerRegistration.","invalid-bg-handler":"The input to setBackgroundMessageHandler() must be a function.","invalid-vapid-key":"The public VAPID key must be a string.","use-vapid-key-after-get-token":"The usePublicVapidKey() method may only be called once and must be called before calling getToken() to ensure your VAPID key is used."});async function Yq(e,t){var n={method:"DELETE",headers:await Xq(e)};try{const s=await fetch(`${Jq(e.appConfig)}/${t}`,n);var r=await s.json();if(r.error){var i=r.error.message;throw Qq.create("token-unsubscribe-failed",{errorInfo:i})}}catch(e){throw Qq.create("token-unsubscribe-failed",{errorInfo:null===e||void 0===e?void 0:e.toString()})}}function Jq({projectId:e}){return`${Pq}/projects/${e}/registrations`}async function Xq({appConfig:e,installations:t}){var n=await t.getToken();return new Headers({"Content-Type":"application/json",Accept:"application/json","x-goog-api-key":e.apiKey,"x-goog-firebase-installations-auth":`FIS ${n}`})}function Zq({p256dh:e,auth:t,endpoint:n,vapidKey:r}){const i={web:{endpoint:n,auth:t,p256dh:e}};return r!==Rq&&(i.web.applicationPubKey=r),i}async function eB(e){const t=await async function(e,t){var n=await e.pushManager.getSubscription();if(n)return n;return e.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:function(e){var t=(e+"=".repeat((4-e.length%4)%4)).replace(/\-/g,"+").replace(/_/g,"/");const n=atob(t),r=new Uint8Array(n.length);for(let i=0;i<n.length;++i)r[i]=n.charCodeAt(i);return r}(t)})}(e.swRegistration,e.vapidKey);var n,r,i,s,o,a={vapidKey:e.vapidKey,swScope:e.swRegistration.scope,endpoint:t.endpoint,auth:Fq(t.getKey("auth")),p256dh:Fq(t.getKey("p256dh"))},c=await Wq(e.firebaseDependencies);if(c){if(n=c.subscriptionOptions,r=a.vapidKey===n.vapidKey,i=a.endpoint===n.endpoint,s=a.auth===n.auth,o=a.p256dh===n.p256dh,r&&i&&s&&o)return Date.now()>=c.createTime+6048e5?async function(t,e){try{var n=await async function(e,t){var n=await Xq(e),r=Zq(t.subscriptionOptions),r={method:"PATCH",headers:n,body:JSON.stringify(r)};let i;try{const s=await fetch(`${Jq(e.appConfig)}/${t.token}`,r);i=await s.json()}catch(e){throw Qq.create("token-update-failed",{errorInfo:null===e||void 0===e?void 0:e.toString()})}if(i.error){r=i.error.message;throw Qq.create("token-update-failed",{errorInfo:r})}if(!i.token)throw Qq.create("token-update-no-token");return i.token}(t.firebaseDependencies,e),r=Object.assign(Object.assign({},e),{token:n,createTime:Date.now()});return await Gq(t.firebaseDependencies,r),n}catch(e){throw await tB(t),e}}(e,{token:c.token,createTime:Date.now(),subscriptionOptions:a}):c.token;try{await Yq(e.firebaseDependencies,c.token)}catch(e){console.warn(e)}return nB(e.firebaseDependencies,a)}return nB(e.firebaseDependencies,a)}async function tB(e){var t=await Wq(e.firebaseDependencies);t&&(await Yq(e.firebaseDependencies,t.token),await async function(e){var t=Hq(e);const n=await zq(),r=n.transaction(Kq,"readwrite");await r.objectStore(Kq).delete(t),await r.done}(e.firebaseDependencies));const n=await e.swRegistration.pushManager.getSubscription();return!n||n.unsubscribe()}async function nB(e,t){var n={token:await async function(e,t){var n=await Xq(e),r=Zq(t),r={method:"POST",headers:n,body:JSON.stringify(r)};let i;try{const s=await fetch(Jq(e.appConfig),r);i=await s.json()}catch(e){throw Qq.create("token-subscribe-failed",{errorInfo:null===e||void 0===e?void 0:e.toString()})}if(i.error){r=i.error.message;throw Qq.create("token-subscribe-failed",{errorInfo:r})}if(!i.token)throw Qq.create("token-subscribe-no-token");return i.token}(e,t),createTime:Date.now(),subscriptionOptions:t};return await Gq(e,n),n.token}async function rB(e,t){var n=function(e,t){var n;const r={};e.from&&(r.project_number=e.from);e.fcmMessageId&&(r.message_id=e.fcmMessageId);r.instance_id=t,e.notification?r.message_type=jj.DISPLAY_NOTIFICATION.toString():r.message_type=jj.DATA_MESSAGE.toString();r.sdk_platform=Mq.toString(),r.package_name=self.origin.replace(/(^\w+:|^)\/\//,""),e.collapse_key&&(r.collapse_key=e.collapse_key);r.event=Lq.toString(),null!==(n=e.fcmOptions)&&void 0!==n&&n.analytics_label&&(r.analytics_label=null===(n=e.fcmOptions)||void 0===n?void 0:n.analytics_label);return r}(t,await e.firebaseDependencies.installations.getId());!function(e,t){const n={};n.event_time_ms=Math.floor(Date.now()).toString(),n.source_extension_json_proto3=JSON.stringify(t),e.logEvents.push(n)}(e,n)}function iB(e,t){const n=[];for(let r=0;r<e.length;r++)n.push(e.charAt(r)),r<t.length&&n.push(t.charAt(r));return n.join("")}async function sB(e,t){var n=function({data:e}){if(!e)return null;try{return e.json()}catch(e){return null}}(e);if(n){t.deliveryMetricsExportedToBigQueryEnabled&&await rB(t,n);var r,i,s,o,a=await aB();if(a.some(e=>"visible"===e.visibilityState&&!e.url.startsWith("chrome-extension://")))return function(e,t){t.isFirebaseMessaging=!0,t.messageType=qj.PUSH_RECEIVED;for(const n of e)n.postMessage(t)}(a,n);n.notification&&await function(e){var t=e["actions"],n=Notification["maxActions"];t&&n&&t.length>n&&console.warn(`This browser only supports ${n} actions. The remaining actions will not be displayed.`);return self.registration.showNotification(null!==(n=e.title)&&void 0!==n?n:"",e)}(function(e){const t=Object.assign({},e.notification);return t.data={[Dq]:e},t}(n)),t&&t.onBackgroundMessageHandler&&(o={from:(r=n).from,collapseKey:r.collapse_key,messageId:r.fcmMessageId},a=o,(e=r).notification&&(a.notification={},(n=e.notification.title)&&(a.notification.title=n),(n=e.notification.body)&&(a.notification.body=n),(n=e.notification.image)&&(a.notification.image=n)),e=o,(a=r).data&&(e.data=a.data),a=o,((r=r).fcmOptions||null!==(i=r.notification)&&void 0!==i&&i.click_action)&&(a.fcmOptions={},(s=null!==(i=null===(i=r.fcmOptions)||void 0===i?void 0:i.link)&&void 0!==i?i:null===(s=r.notification)||void 0===s?void 0:s.click_action)&&(a.fcmOptions.link=s),(s=null===(s=r.fcmOptions)||void 0===s?void 0:s.analytics_label)&&(a.fcmOptions.analyticsLabel=s)),o=o,"function"==typeof t.onBackgroundMessageHandler?await t.onBackgroundMessageHandler(o):t.onBackgroundMessageHandler.next(o))}}async function oB(e){const t=null===(s=null===(i=e.notification)||void 0===i?void 0:i.data)||void 0===s?void 0:s[Dq];if(t&&!e.action){e.stopImmediatePropagation(),e.notification.close();var n=function(e){var t;var n=null!==(t=null===(t=e.fcmOptions)||void 0===t?void 0:t.link)&&void 0!==t?t:null===(n=e.notification)||void 0===n?void 0:n.click_action;if(n)return n;return function(e){return"object"==typeof e&&e&&Oq in e}(e.data)?self.location.origin:null}(t);if(n){var r,i=new URL(n,self.location.href),s=new URL(self.location.origin);if(i.host===s.host){let e=await async function(e){var t=await aB();for(const r of t){var n=new URL(r.url,self.location.href);if(e.host===n.host)return r}return null}(i);if(e?e=await e.focus():(e=await self.clients.openWindow(n),r=3e3,await new Promise(e=>{setTimeout(e,r)})),e)return t.messageType=qj.NOTIFICATION_CLICKED,t.isFirebaseMessaging=!0,e.postMessage(t)}}}}function aB(){return self.clients.matchAll({type:"window",includeUncontrolled:!0})}function cB(e){return Qq.create("missing-app-config-values",{valueName:e})}iB("hts/frbslgigp.ogepscmv/ieo/eaylg","tp:/ieaeogn-agolai.o/1frlglgc/o"),iB("AzSCbw63g1R0nCw85jG8","Iaya3yLKwmgvh7cF0q4");class lB{constructor(e,t,n){this.deliveryMetricsExportedToBigQueryEnabled=!1,this.onBackgroundMessageHandler=null,this.onMessageHandler=null,this.logEvents=[],this.isLogServiceStarted=!1;var r=function(e){if(!e||!e.options)throw cB("App Configuration Object");if(!e.name)throw cB("App Name");var t=e["options"];for(const n of["projectId","apiKey","appId","messagingSenderId"])if(!t[n])throw cB(n);return{appName:e.name,projectId:t.projectId,apiKey:t.apiKey,appId:t.appId,senderId:t.messagingSenderId}}(e);this.firebaseDependencies={app:e,appConfig:r,installations:t,analyticsProvider:n}}_delete(){return Promise.resolve()}}const uB=e=>{const t=new lB(e.getProvider("app").getImmediate(),e.getProvider("installations-internal").getImmediate(),e.getProvider("analytics-internal"));return self.addEventListener("push",e=>{e.waitUntil(sB(e,t))}),self.addEventListener("pushsubscriptionchange",e=>{e.waitUntil(async function(e,t){var n;(n=e["newSubscription"])?(n=await Wq(t.firebaseDependencies),await tB(t),t.vapidKey=null!==(n=null===(n=null==n?void 0:n.subscriptionOptions)||void 0===n?void 0:n.vapidKey)&&void 0!==n?n:Rq,await eB(t)):await tB(t)}(e,t))}),self.addEventListener("notificationclick",e=>{e.waitUntil(oB(e))}),t};function hB(e,t){return function(e,t){if(void 0!==self.document)throw Qq.create("only-available-in-sw");return e.onBackgroundMessageHandler=t,()=>{e.onBackgroundMessageHandler=null}}(e=Wd(e),t)}Df(new Gd("messaging-sw",uB,"PUBLIC"));var dB,fB,pB;class gB{constructor(e,t){this.app=e,this._delegate=t,this.app=e,this._delegate=t}async getToken(e){return async function(e,t){return Tq(e=Wd(e),t)}(this._delegate,e)}async deleteToken(){return Nq(this._delegate)}onMessage(e){return xq(this._delegate,e)}onBackgroundMessage(e){return hB(this._delegate,e)}}const mB=e=>self&&"ServiceWorkerGlobalScope"in self?new gB(e.getProvider("app-compat").getImmediate(),e.getProvider("messaging-sw").getImmediate()):new gB(e.getProvider("app-compat").getImmediate(),e.getProvider("messaging").getImmediate()),vB={isSupported:function(){return self&&"ServiceWorkerGlobalScope"in self?fd()&&"PushManager"in self&&"Notification"in self&&ServiceWorkerRegistration.prototype.hasOwnProperty("showNotification")&&PushSubscription.prototype.hasOwnProperty("getKey"):"undefined"!=typeof window&&fd()&&gd()&&"serviceWorker"in navigator&&"PushManager"in window&&"Notification"in window&&"fetch"in window&&ServiceWorkerRegistration.prototype.hasOwnProperty("showNotification")&&PushSubscription.prototype.hasOwnProperty("getKey")}};op.INTERNAL.registerComponent(new Gd("messaging-compat",mB,"PUBLIC").setServiceProps(vB)),op.registerVersion("@firebase/messaging-compat","0.1.16");const yB="firebasestorage.googleapis.com",_B="storageBucket";class wB extends md{constructor(e,t){super(bB(e),`Firebase Storage: ${t} (${bB(e)})`),this.customData={serverResponse:null},this._baseMessage=this.message,Object.setPrototypeOf(this,wB.prototype)}_codeEquals(e){return bB(e)===this.code}get serverResponse(){return this.customData.serverResponse}set serverResponse(e){this.customData.serverResponse=e,this.customData.serverResponse?this.message=`${this._baseMessage}\n${this.customData.serverResponse}`:this.message=this._baseMessage}}function bB(e){return"storage/"+e}function IB(){return new wB("unknown","An unknown error occurred, please check the error payload for server response.")}function TB(){return new wB("canceled","User canceled the upload/download.")}function EB(){return new wB("cannot-slice-blob","Cannot slice blob for upload. Please retry the upload.")}function SB(e){return new wB("invalid-argument",e)}function kB(){return new wB("app-deleted","The Firebase app was deleted.")}function CB(e){return new wB("invalid-root-operation","The operation '"+e+"' cannot be performed on a root reference, create a non-root reference using child, such as .child('file.png').")}function AB(e,t){return new wB("invalid-format","String does not match format '"+e+"': "+t)}function NB(e){throw new wB("internal-error","Internal error: "+e)}class xB{constructor(e,t){this.bucket=e,this.path_=t}get path(){return this.path_}get isRoot(){return 0===this.path.length}fullServerUrl(){const e=encodeURIComponent;return"/b/"+e(this.bucket)+"/o/"+e(this.path)}bucketOnlyServerUrl(){const e=encodeURIComponent;return"/b/"+e(this.bucket)+"/o"}static makeFromBucketSpec(t,e){let n;try{n=xB.makeFromUrl(t,e)}catch(e){return new xB(t,"")}if(""===n.path)return n;throw t=t,new wB("invalid-default-bucket","Invalid default bucket '"+t+"'.")}static makeFromUrl(e,t){let n=null;var r="([A-Za-z0-9.\\-_]+)";var i=new RegExp("^gs://"+r+"(/(.*))?$","i");function s(e){e.path_=decodeURIComponent(e.path)}var o=t.replace(/[.]/g,"\\."),a=new RegExp(`^https?://${o}/v[A-Za-z0-9_]+/b/${r}/o(/([^?#]*).*)?$`,"i"),o=t===yB?"(?:storage.googleapis.com|storage.cloud.google.com)":t,c=[{regex:i,indices:{bucket:1,path:3},postModify:function(e){"/"===e.path.charAt(e.path.length-1)&&(e.path_=e.path_.slice(0,-1))}},{regex:a,indices:{bucket:1,path:3},postModify:s},{regex:new RegExp(`^https?://${o}/${r}/([^?#]*)`,"i"),indices:{bucket:1,path:2},postModify:s}];for(let h=0;h<c.length;h++){const d=c[h];var l=d.regex.exec(e);if(l){var u=l[d.indices.bucket];let e=l[d.indices.path];e=e||"",n=new xB(u,e),d.postModify(n);break}}if(null==n)throw t=e,new wB("invalid-url","Invalid URL '"+t+"'.");return n}}class RB{constructor(e){this.promise_=Promise.reject(e)}getPromise(){return this.promise_}cancel(e=0){}}function PB(e){return"string"==typeof e||e instanceof String}function DB(e){return OB()&&e instanceof Blob}function OB(){return"undefined"!=typeof Blob}function MB(e,t,n,r){if(r<t)throw SB(`Invalid value for '${e}'. Expected ${t} or greater.`);if(n<r)throw SB(`Invalid value for '${e}'. Expected ${n} or less.`)}function LB(e,t,n){let r=null==n?`https://${t}`:t;return`${n}://${r}/v0${e}`}function FB(e){const t=encodeURIComponent;let n="?";for(const i in e){var r;e.hasOwnProperty(i)&&(r=t(i)+"="+t(e[i]),n=n+r+"&")}return n=n.slice(0,-1),n}(c=dB=dB||{})[c.NO_ERROR=0]="NO_ERROR",c[c.NETWORK_ERROR=1]="NETWORK_ERROR",c[c.ABORT=2]="ABORT";class UB{constructor(e,t,n,r,i,s,o,a,c,l,u){this.url_=e,this.method_=t,this.headers_=n,this.body_=r,this.successCodes_=i,this.additionalRetryCodes_=s,this.callback_=o,this.errorCallback_=a,this.timeout_=c,this.progressCallback_=l,this.connectionFactory_=u,this.pendingConnection_=null,this.backoffId_=null,this.canceled_=!1,this.appDelete_=!1,this.promise_=new Promise((e,t)=>{this.resolve_=e,this.reject_=t,this.start_()})}start_(){var e=(r,e)=>{if(e)r(!1,new VB(!1,null,!0));else{const i=this.connectionFactory_();this.pendingConnection_=i;const s=e=>{var t=e.loaded,n=e.lengthComputable?e.total:-1;null!==this.progressCallback_&&this.progressCallback_(t,n)};null!==this.progressCallback_&&i.addUploadProgressListener(s),i.send(this.url_,this.method_,this.body_,this.headers_).then(()=>{null!==this.progressCallback_&&i.removeUploadProgressListener(s),this.pendingConnection_=null;var e,t=i.getErrorCode()===dB.NO_ERROR,n=i.getStatus();t&&!this.isRetryStatusCode_(n)?(e=-1!==this.successCodes_.indexOf(n),r(!0,new VB(e,i))):(e=i.getErrorCode()===dB.ABORT,r(!1,new VB(!1,null,e)))})}},t=(e,t)=>{const n=this.resolve_,r=this.reject_,i=t.connection;if(t.wasSuccessCode)try{var s=this.callback_(i,i.getResponse());void 0!==s?n(s):n()}catch(e){r(e)}else if(null!==i){const a=IB();a.serverResponse=i.getErrorText(),this.errorCallback_?r(this.errorCallback_(i,a)):r(a)}else{var o;t.canceled?(o=(this.appDelete_?kB:TB)(),r(o)):(o=new wB("retry-limit-exceeded","Max retry time for operation exceeded, please try again."),r(o))}};this.canceled_?t(0,new VB(!1,null,!0)):this.backoffId_=function(t,n,e){let r=1,i=null,s=null,o=!1,a=0;function c(){return 2===a}let l=!1;function u(...e){l||(l=!0,n.apply(null,e))}function h(e){i=setTimeout(()=>{i=null,t(f,c())},e)}function d(){s&&clearTimeout(s)}function f(t,...n){if(l)d();else{if(t)return d(),void u.call(null,t,...n);if(c()||o)return d(),void u.call(null,t,...n);r<64&&(r*=2);let e;e=1===a?(a=2,0):1e3*(r+Math.random()),h(e)}}let p=!1;function g(e){p||(p=!0,d(),l||(null!==i?(e||(a=2),clearTimeout(i),h(0)):e||(a=1)))}return h(0),s=setTimeout(()=>{g(o=!0)},e),g}(e,t,this.timeout_)}getPromise(){return this.promise_}cancel(e){this.canceled_=!0,this.appDelete_=e||!1,null!==this.backoffId_&&(0,this.backoffId_)(!1),null!==this.pendingConnection_&&this.pendingConnection_.abort()}isRetryStatusCode_(e){var t=500<=e&&e<600,n=-1!==[408,429].indexOf(e),r=-1!==this.additionalRetryCodes_.indexOf(e);return t||n||r}}class VB{constructor(e,t,n){this.wasSuccessCode=e,this.connection=t,this.canceled=!!n}}function jB(...t){const n="undefined"!=typeof BlobBuilder?BlobBuilder:"undefined"!=typeof WebKitBlobBuilder?WebKitBlobBuilder:void 0;if(void 0!==n){const r=new n;for(let e=0;e<t.length;e++)r.append(t[e]);return r.getBlob()}if(OB())return new Blob(t);throw new wB("unsupported-environment","This browser doesn't seem to support creating Blobs")}const qB={RAW:"raw",BASE64:"base64",BASE64URL:"base64url",DATA_URL:"data_url"};class BB{constructor(e,t){this.data=e,this.contentType=t||null}}function KB(e,t){switch(e){case qB.RAW:return new BB($B(t));case qB.BASE64:case qB.BASE64URL:return new BB(zB(e,t));case qB.DATA_URL:return new BB((n=t,(r=new WB(n)).base64?zB(qB.BASE64,r.rest):function(e){let t;try{t=decodeURIComponent(e)}catch(e){throw AB(qB.DATA_URL,"Malformed data URL.")}return $B(t)}(r.rest)),(n=t,new WB(n).contentType))}var n,r;throw IB()}function $B(t){const n=[];for(let s=0;s<t.length;s++){let e=t.charCodeAt(s);var r,i;e<=127?n.push(e):e<=2047?n.push(192|e>>6,128|63&e):55296==(64512&e)?s<t.length-1&&56320==(64512&t.charCodeAt(s+1))?(r=e,i=t.charCodeAt(++s),e=65536|(1023&r)<<10|1023&i,n.push(240|e>>18,128|e>>12&63,128|e>>6&63,128|63&e)):n.push(239,191,189):56320==(64512&e)?n.push(239,191,189):n.push(224|e>>12,128|e>>6&63,128|63&e)}return new Uint8Array(n)}function zB(t,e){switch(t){case qB.BASE64:var n=-1!==e.indexOf("-"),r=-1!==e.indexOf("_");if(n||r)throw AB(t,"Invalid character '"+(n?"-":"_")+"' found: is it base64url encoded?");break;case qB.BASE64URL:r=-1!==e.indexOf("+"),n=-1!==e.indexOf("/");if(r||n)throw AB(t,"Invalid character '"+(r?"+":"/")+"' found: is it base64 encoded?");e=e.replace(/-/g,"+").replace(/_/g,"/")}let i;try{i=atob(e)}catch(e){throw AB(t,"Invalid character found")}const s=new Uint8Array(i.length);for(let o=0;o<i.length;o++)s[o]=i.charCodeAt(o);return s}class WB{constructor(e){this.base64=!1,this.contentType=null;var t,n,r=e.match(/^data:([^,]+)?,/);if(null===r)throw AB(qB.DATA_URL,"Must be formatted 'data:[<mediatype>][;base64],<data>");const i=r[1]||null;null!=i&&(this.base64=(t=i,n=";base64",t.length>=n.length&&t.substring(t.length-n.length)===n),this.contentType=this.base64?i.substring(0,i.length-";base64".length):i),this.rest=e.substring(e.indexOf(",")+1)}}class GB{constructor(e,t){let n=0,r="";DB(e)?(this.data_=e,n=e.size,r=e.type):e instanceof ArrayBuffer?(t?this.data_=new Uint8Array(e):(this.data_=new Uint8Array(e.byteLength),this.data_.set(new Uint8Array(e))),n=this.data_.length):e instanceof Uint8Array&&(t?this.data_=e:(this.data_=new Uint8Array(e.length),this.data_.set(e)),n=e.length),this.size_=n,this.type_=r}size(){return this.size_}type(){return this.type_}slice(e,t){if(DB(this.data_)){var n=this.data_,n=(i=e,s=t,(r=n).webkitSlice?r.webkitSlice(i,s):r.mozSlice?r.mozSlice(i,s):r.slice?r.slice(i,s):null);return null===n?null:new GB(n)}var r,i,s,n=new Uint8Array(this.data_.buffer,e,t-e);return new GB(n,!0)}static getBlob(...e){if(OB()){var t=e.map(e=>e instanceof GB?e.data_:e);return new GB(jB.apply(null,t))}{const r=e.map(e=>PB(e)?KB(qB.RAW,e).data:e.data_);let t=0;r.forEach(e=>{t+=e.byteLength});const i=new Uint8Array(t);let n=0;return r.forEach(e=>{for(let t=0;t<e.length;t++)i[n++]=e[t]}),new GB(i,!0)}}uploadData(){return this.data_}}function HB(e){let t;try{t=JSON.parse(e)}catch(e){return null}return"object"!=typeof(e=t)||Array.isArray(e)?null:t}function QB(e){var t=e.lastIndexOf("/",e.length-2);return-1===t?e:e.slice(t+1)}function YB(e,t){return t}class JB{constructor(e,t,n,r){this.server=e,this.local=t||e,this.writable=!!n,this.xform=r||YB}}let XB=null;function ZB(){if(XB)return XB;const e=[];e.push(new JB("bucket")),e.push(new JB("generation")),e.push(new JB("metageneration")),e.push(new JB("name","fullPath",!0));const t=new JB("name");t.xform=function(e,t){return!PB(t=t)||t.length<2?t:QB(t)},e.push(t);const n=new JB("size");return n.xform=function(e,t){return void 0!==t?Number(t):t},e.push(n),e.push(new JB("timeCreated")),e.push(new JB("updated")),e.push(new JB("md5Hash",null,!0)),e.push(new JB("cacheControl",null,!0)),e.push(new JB("contentDisposition",null,!0)),e.push(new JB("contentEncoding",null,!0)),e.push(new JB("contentLanguage",null,!0)),e.push(new JB("contentType",null,!0)),e.push(new JB("metadata","customMetadata",!0)),XB=e,XB}function e2(n,r){Object.defineProperty(n,"ref",{get:function(){var e=n.bucket,t=n.fullPath,t=new xB(e,t);return r._makeStorageReference(t)}})}function t2(e,t,n){var r=HB(t);return null===r?null:function(e,t,n){const r={type:"file"};var i=n.length;for(let s=0;s<i;s++){const o=n[s];r[o.local]=o.xform(r,t[o.server])}return e2(r,e),r}(e,r,n)}function n2(e,t){const n={};var r=t.length;for(let s=0;s<r;s++){var i=t[s];i.writable&&(n[i.server]=e[i.local])}return JSON.stringify(n)}function r2(e,t,n){var r=HB(n);return null===r?null:function(e,t,n){const r={prefixes:[],items:[],nextPageToken:n.nextPageToken};if(n.prefixes)for(const o of n.prefixes){var i=o.replace(/\/$/,""),i=e._makeStorageReference(new xB(t,i));r.prefixes.push(i)}if(n.items)for(const a of n.items){var s=e._makeStorageReference(new xB(t,a.name));r.items.push(s)}return r}(e,t,r)}class i2{constructor(e,t,n,r){this.url=e,this.method=t,this.handler=n,this.timeout=r,this.urlParams={},this.headers={},this.body=null,this.errorHandler=null,this.progressCallback=null,this.successCodes=[200],this.additionalRetryCodes=[]}}function s2(e){if(!e)throw IB()}function o2(r,i){return function(e,t){var n=t2(r,t,i);return s2(null!==n),n}}function a2(r,i){return function(e,t){var n=r2(r,i,t);return s2(null!==n),n}}function c2(r,i){return function(e,t){var n=t2(r,t,i);return s2(null!==n),function(r,e,i,s){var t=HB(e);if(null===t)return null;if(!PB(t.downloadTokens))return null;const n=t.downloadTokens;if(0===n.length)return null;const o=encodeURIComponent,a=n.split(",");return a.map(e=>{var t=r.bucket,n=r.fullPath;return LB("/b/"+o(t)+"/o/"+o(n),i,s)+FB({alt:"media",token:e})})[0]}(n,t,r.host,r._protocol)}}function l2(i){return function(e,t){let n;var r;return n=401===e.getStatus()?e.getErrorText().includes("Firebase App Check token is invalid")?new wB("unauthorized-app","This app does not have permission to access Firebase Storage on this project."):new wB("unauthenticated","User is not authenticated, please authenticate using Firebase Authentication and try again."):402===e.getStatus()?(r=i.bucket,new wB("quota-exceeded","Quota for bucket '"+r+"' exceeded, please view quota on https://firebase.google.com/pricing/.")):403===e.getStatus()?(e=i.path,new wB("unauthorized","User does not have permission to access '"+e+"'.")):t,n.serverResponse=t.serverResponse,n}}function u2(r){const i=l2(r);return function(e,t){let n=i(e,t);return 404===e.getStatus()&&(n=(e=r.path,new wB("object-not-found","Object '"+e+"' does not exist."))),n.serverResponse=t.serverResponse,n}}function h2(e,t,n){var r=LB(t.fullServerUrl(),e.host,e._protocol),i=e.maxOperationRetryTime;const s=new i2(r,"GET",o2(e,n),i);return s.errorHandler=u2(t),s}function d2(e,t,n){const r=Object.assign({},n);return r.fullPath=e.path,r.size=t.size(),r.contentType||(r.contentType=(e=t,(t=null)&&t.contentType||e&&e.type()||"application/octet-stream")),r}function f2(e,t,n,r,i){var s=t.bucketOnlyServerUrl();const o={"X-Goog-Upload-Protocol":"multipart"};var a=function(){let e="";for(let t=0;t<2;t++)e+=Math.random().toString().slice(2);return e}();o["Content-Type"]="multipart/related; boundary="+a;var c=d2(t,r,i),l="--"+a+"\r\nContent-Type: application/json; charset=utf-8\r\n\r\n"+n2(c,n)+"\r\n--"+a+"\r\nContent-Type: "+c.contentType+"\r\n\r\n",a="\r\n--"+a+"--";const u=GB.getBlob(l,r,a);if(null===u)throw EB();a={name:c.fullPath},c=LB(s,e.host,e._protocol),s=e.maxUploadRetryTime;const h=new i2(c,"POST",o2(e,n),s);return h.urlParams=a,h.headers=o,h.body=u.uploadData(),h.errorHandler=l2(t),h}class p2{constructor(e,t,n,r){this.current=e,this.total=t,this.finalized=!!n,this.metadata=r||null}}function g2(e,t){let n=null;try{n=e.getResponseHeader("X-Goog-Upload-Status")}catch(e){s2(!1)}const r=t||["active"];return s2(!!n&&-1!==r.indexOf(n)),n}function m2(e,t,n,r,i){var s=t.bucketOnlyServerUrl(),o=d2(t,r,i),a={name:o.fullPath},c=LB(s,e.host,e._protocol),l={"X-Goog-Upload-Protocol":"resumable","X-Goog-Upload-Command":"start","X-Goog-Upload-Header-Content-Length":`${r.size()}`,"X-Goog-Upload-Header-Content-Type":o.contentType,"Content-Type":"application/json; charset=utf-8"},s=n2(o,n),o=e.maxUploadRetryTime;const u=new i2(c,"POST",function(e){g2(e);let t;try{t=e.getResponseHeader("X-Goog-Upload-URL")}catch(e){s2(!1)}return s2(PB(t)),t},o);return u.urlParams=a,u.headers=l,u.body=s,u.errorHandler=l2(t),u}function v2(e,t,n,i){var r=e.maxUploadRetryTime;const s=new i2(n,"POST",function(e){var t=g2(e,["active","final"]);let n=null;try{n=e.getResponseHeader("X-Goog-Upload-Size-Received")}catch(e){s2(!1)}n||s2(!1);var r=Number(n);return s2(!isNaN(r)),new p2(r,i.size(),"final"===t)},r);return s.headers={"X-Goog-Upload-Command":"query"},s.errorHandler=l2(t),s}function y2(e,o,t,a,n,c,r,i){const l=new p2(0,0);if(r?(l.current=r.current,l.total=r.total):(l.current=0,l.total=a.size()),a.size()!==l.total)throw new wB("server-file-wrong-size","Server recorded incorrect upload file size, please retry the upload.");var s=l.total-l.current;let u=s;0<n&&(u=Math.min(u,n));var h=l.current,d=h+u,s={"X-Goog-Upload-Command":u===s?"upload, finalize":"upload","X-Goog-Upload-Offset":`${l.current}`};const f=a.slice(h,d);if(null===f)throw EB();d=o.maxUploadRetryTime;const p=new i2(t,"POST",function(e,t){var n=g2(e,["active","final"]),r=l.current+u,i=a.size();let s;return s="final"===n?o2(o,c)(e,t):null,new p2(r,i,"final"===n,s)},d);return p.headers=s,p.body=f.uploadData(),p.progressCallback=i||null,p.errorHandler=l2(e),p}const _2={STATE_CHANGED:"state_changed"},w2={RUNNING:"running",PAUSED:"paused",SUCCESS:"success",CANCELED:"canceled",ERROR:"error"};function b2(e){switch(e){case"running":case"pausing":case"canceling":return w2.RUNNING;case"paused":return w2.PAUSED;case"success":return w2.SUCCESS;case"canceled":return w2.CANCELED;default:return w2.ERROR}}class I2{constructor(e,t,n){var r;"function"==typeof e||null!=t||null!=n?(this.next=e,this.error=null!=t?t:void 0,this.complete=null!=n?n:void 0):(this.next=(r=e).next,this.error=r.error,this.complete=r.complete)}}function T2(t){return(...e)=>{Promise.resolve().then(()=>t(...e))}}class E2 extends class{constructor(){this.sent_=!1,this.xhr_=new XMLHttpRequest,this.initXhr(),this.errorCode_=dB.NO_ERROR,this.sendPromise_=new Promise(e=>{this.xhr_.addEventListener("abort",()=>{this.errorCode_=dB.ABORT,e()}),this.xhr_.addEventListener("error",()=>{this.errorCode_=dB.NETWORK_ERROR,e()}),this.xhr_.addEventListener("load",()=>{e()})})}send(e,t,n,r){if(this.sent_)throw NB("cannot .send() more than once");if(this.sent_=!0,this.xhr_.open(t,e,!0),void 0!==r)for(const i in r)r.hasOwnProperty(i)&&this.xhr_.setRequestHeader(i,r[i].toString());return void 0!==n?this.xhr_.send(n):this.xhr_.send(),this.sendPromise_}getErrorCode(){if(!this.sent_)throw NB("cannot .getErrorCode() before sending");return this.errorCode_}getStatus(){if(!this.sent_)throw NB("cannot .getStatus() before sending");try{return this.xhr_.status}catch(e){return-1}}getResponse(){if(!this.sent_)throw NB("cannot .getResponse() before sending");return this.xhr_.response}getErrorText(){if(!this.sent_)throw NB("cannot .getErrorText() before sending");return this.xhr_.statusText}abort(){this.xhr_.abort()}getResponseHeader(e){return this.xhr_.getResponseHeader(e)}addUploadProgressListener(e){null!=this.xhr_.upload&&this.xhr_.upload.addEventListener("progress",e)}removeUploadProgressListener(e){null!=this.xhr_.upload&&this.xhr_.upload.removeEventListener("progress",e)}}{initXhr(){this.xhr_.responseType="text"}}function S2(){return new E2}class k2{constructor(e,t,n=null){this._transferred=0,this._needToFetchStatus=!1,this._needToFetchMetadata=!1,this._observers=[],this._error=void 0,this._uploadUrl=void 0,this._request=void 0,this._chunkMultiplier=1,this._resolve=void 0,this._reject=void 0,this._ref=e,this._blob=t,this._metadata=n,this._mappings=ZB(),this._resumable=this._shouldDoResumable(this._blob),this._state="running",this._errorHandler=e=>{this._request=void 0,this._chunkMultiplier=1,e._codeEquals("canceled")?(this._needToFetchStatus=!0,this.completeTransitions_()):(this._error=e,this._transition("error"))},this._metadataErrorHandler=e=>{this._request=void 0,e._codeEquals("canceled")?this.completeTransitions_():(this._error=e,this._transition("error"))},this._promise=new Promise((e,t)=>{this._resolve=e,this._reject=t,this._start()}),this._promise.then(null,()=>{})}_makeProgressCallback(){const t=this._transferred;return e=>this._updateProgress(t+e)}_shouldDoResumable(e){return 262144<e.size()}_start(){"running"===this._state&&void 0===this._request&&(this._resumable?void 0===this._uploadUrl?this._createResumable():this._needToFetchStatus?this._fetchStatus():this._needToFetchMetadata?this._fetchMetadata():this._continueUpload():this._oneShotUpload())}_resolveToken(n){Promise.all([this._ref.storage._getAuthToken(),this._ref.storage._getAppCheckToken()]).then(([e,t])=>{switch(this._state){case"running":n(e,t);break;case"canceling":this._transition("canceled");break;case"pausing":this._transition("paused")}})}_createResumable(){this._resolveToken((e,t)=>{var n=m2(this._ref.storage,this._ref._location,this._mappings,this._blob,this._metadata);const r=this._ref.storage._makeRequest(n,S2,e,t);this._request=r,r.getPromise().then(e=>{this._request=void 0,this._uploadUrl=e,this._needToFetchStatus=!1,this.completeTransitions_()},this._errorHandler)})}_fetchStatus(){const i=this._uploadUrl;this._resolveToken((e,t)=>{var n=v2(this._ref.storage,this._ref._location,i,this._blob);const r=this._ref.storage._makeRequest(n,S2,e,t);this._request=r,r.getPromise().then(e=>{this._request=void 0,this._updateProgress(e.current),this._needToFetchStatus=!1,e.finalized&&(this._needToFetchMetadata=!0),this.completeTransitions_()},this._errorHandler)})}_continueUpload(){const i=262144*this._chunkMultiplier,s=new p2(this._transferred,this._blob.size()),o=this._uploadUrl;this._resolveToken((e,t)=>{let n;try{n=y2(this._ref._location,this._ref.storage,o,this._blob,i,this._mappings,s,this._makeProgressCallback())}catch(e){return this._error=e,void this._transition("error")}const r=this._ref.storage._makeRequest(n,S2,e,t);this._request=r,r.getPromise().then(e=>{this._increaseMultiplier(),this._request=void 0,this._updateProgress(e.current),e.finalized?(this._metadata=e.metadata,this._transition("success")):this.completeTransitions_()},this._errorHandler)})}_increaseMultiplier(){262144*this._chunkMultiplier<33554432&&(this._chunkMultiplier*=2)}_fetchMetadata(){this._resolveToken((e,t)=>{var n=h2(this._ref.storage,this._ref._location,this._mappings);const r=this._ref.storage._makeRequest(n,S2,e,t);this._request=r,r.getPromise().then(e=>{this._request=void 0,this._metadata=e,this._transition("success")},this._metadataErrorHandler)})}_oneShotUpload(){this._resolveToken((e,t)=>{var n=f2(this._ref.storage,this._ref._location,this._mappings,this._blob,this._metadata);const r=this._ref.storage._makeRequest(n,S2,e,t);this._request=r,r.getPromise().then(e=>{this._request=void 0,this._metadata=e,this._updateProgress(this._blob.size()),this._transition("success")},this._errorHandler)})}_updateProgress(e){var t=this._transferred;this._transferred=e,this._transferred!==t&&this._notifyObservers()}_transition(e){if(this._state!==e)switch(e){case"canceling":case"pausing":this._state=e,void 0!==this._request&&this._request.cancel();break;case"running":var t="paused"===this._state;this._state=e,t&&(this._notifyObservers(),this._start());break;case"paused":this._state=e,this._notifyObservers();break;case"canceled":this._error=TB(),this._state=e,this._notifyObservers();break;case"error":case"success":this._state=e,this._notifyObservers()}}completeTransitions_(){switch(this._state){case"pausing":this._transition("paused");break;case"canceling":this._transition("canceled");break;case"running":this._start()}}get snapshot(){var e=b2(this._state);return{bytesTransferred:this._transferred,totalBytes:this._blob.size(),state:e,metadata:this._metadata,task:this,ref:this._ref}}on(e,t,n,r){const i=new I2(t||void 0,n||void 0,r||void 0);return this._addObserver(i),()=>{this._removeObserver(i)}}then(e,t){return this._promise.then(e,t)}catch(e){return this.then(null,e)}_addObserver(e){this._observers.push(e),this._notifyObserver(e)}_removeObserver(e){var t=this._observers.indexOf(e);-1!==t&&this._observers.splice(t,1)}_notifyObservers(){this._finishPromise();const e=this._observers.slice();e.forEach(e=>{this._notifyObserver(e)})}_finishPromise(){if(void 0!==this._resolve){let e=!0;switch(b2(this._state)){case w2.SUCCESS:T2(this._resolve.bind(null,this.snapshot))();break;case w2.CANCELED:case w2.ERROR:const t=this._reject;T2(t.bind(null,this._error))();break;default:e=!1}e&&(this._resolve=void 0,this._reject=void 0)}}_notifyObserver(e){switch(b2(this._state)){case w2.RUNNING:case w2.PAUSED:e.next&&T2(e.next.bind(e,this.snapshot))();break;case w2.SUCCESS:e.complete&&T2(e.complete.bind(e))();break;case w2.CANCELED:case w2.ERROR:default:e.error&&T2(e.error.bind(e,this._error))()}}resume(){var e="paused"===this._state||"pausing"===this._state;return e&&this._transition("running"),e}pause(){var e="running"===this._state;return e&&this._transition("pausing"),e}cancel(){var e="running"===this._state||"pausing"===this._state;return e&&this._transition("canceling"),e}}class C2{constructor(e,t){this._service=e,t instanceof xB?this._location=t:this._location=xB.makeFromUrl(t,e.host)}toString(){return"gs://"+this._location.bucket+"/"+this._location.path}_newRef(e,t){return new C2(e,t)}get root(){var e=new xB(this._location.bucket,"");return this._newRef(this._service,e)}get bucket(){return this._location.bucket}get fullPath(){return this._location.path}get name(){return QB(this._location.path)}get storage(){return this._service}get parent(){var e=function(e){if(0===e.length)return null;var t=e.lastIndexOf("/");return-1===t?"":e.slice(0,t)}(this._location.path);if(null===e)return null;e=new xB(this._location.bucket,e);return new C2(this._service,e)}_throwIfRoot(e){if(""===this._location.path)throw CB(e)}}function A2(e){const t={prefixes:[],items:[]};return async function e(t,n,r){const i={pageToken:r};const s=await N2(t,i);n.prefixes.push(...s.prefixes);n.items.push(...s.items);null!=s.nextPageToken&&await e(t,n,s.nextPageToken)}(e,t).then(()=>t)}function N2(e,t){null!=t&&"number"==typeof t.maxResults&&MB("options.maxResults",1,1e3,t.maxResults);var n=t||{},n=function(e,t,n,r,i){const s={};t.isRoot?s.prefix="":s.prefix=t.path+"/",n&&0<n.length&&(s.delimiter=n),r&&(s.pageToken=r),i&&(s.maxResults=i);var o=LB(t.bucketOnlyServerUrl(),e.host,e._protocol),a=e.maxOperationRetryTime;const c=new i2(o,"GET",a2(e,t.bucket),a);return c.urlParams=s,c.errorHandler=l2(t),c}(e.storage,e._location,"/",n.pageToken,n.maxResults);return e.storage.makeRequestWithTokens(n,S2)}function x2(e,t){e._throwIfRoot("updateMetadata");var n=function(e,t,n,r){var i=LB(t.fullServerUrl(),e.host,e._protocol),s=n2(n,r),o=e.maxOperationRetryTime;const a=new i2(i,"PATCH",o2(e,r),o);return a.headers={"Content-Type":"application/json; charset=utf-8"},a.body=s,a.errorHandler=u2(t),a}(e.storage,e._location,t,ZB());return e.storage.makeRequestWithTokens(n,S2)}function R2(e){e._throwIfRoot("getDownloadURL");var t=function(e,t,n){var r=LB(t.fullServerUrl(),e.host,e._protocol),i=e.maxOperationRetryTime;const s=new i2(r,"GET",c2(e,n),i);return s.errorHandler=u2(t),s}(e.storage,e._location,ZB());return e.storage.makeRequestWithTokens(t,S2).then(e=>{if(null===e)throw new wB("no-download-url","The given file does not have any download URLs.");return e})}function P2(e){e._throwIfRoot("deleteObject");var t=function(e,t){var n=LB(t.fullServerUrl(),e.host,e._protocol),r=e.maxOperationRetryTime;const i=new i2(n,"DELETE",function(e,t){},r);return i.successCodes=[200,204],i.errorHandler=u2(t),i}(e.storage,e._location);return e.storage.makeRequestWithTokens(t,S2)}function D2(e,t){var n,r=(n=e._location.path,r=t.split("/").filter(e=>0<e.length).join("/"),0===n.length?r:n+"/"+r),r=new xB(e._location.bucket,r);return new C2(e.storage,r)}function O2(e,t){if(e instanceof F2){var n=e;if(null==n._bucket)throw new wB("no-default-bucket","No default bucket found. Did you set the '"+_B+"' property when initializing the app?");n=new C2(n,n._bucket);return null!=t?O2(n,t):n}return void 0!==t?D2(e,t):e}function M2(e,t){if(t&&/^[A-Za-z]+:\/\//.test(t)){if(e instanceof F2)return n=e,r=t,new C2(n,r);throw SB("To use ref(service, url), the first argument must be a Storage instance.")}return O2(e,t);var n,r}function L2(e,t){var n=null==t?void 0:t[_B];return null==n?null:xB.makeFromBucketSpec(n,e)}class F2{constructor(e,t,n,r,i){this.app=e,this._authProvider=t,this._appCheckProvider=n,this._url=r,this._firebaseVersion=i,this._bucket=null,this._host=yB,this._protocol="https",this._appId=null,this._deleted=!1,this._maxOperationRetryTime=12e4,this._maxUploadRetryTime=6e5,this._requests=new Set,this._bucket=null!=r?xB.makeFromBucketSpec(r,this._host):L2(this._host,this.app.options)}get host(){return this._host}set host(e){this._host=e,null!=this._url?this._bucket=xB.makeFromBucketSpec(this._url,e):this._bucket=L2(e,this.app.options)}get maxUploadRetryTime(){return this._maxUploadRetryTime}set maxUploadRetryTime(e){MB("time",0,Number.POSITIVE_INFINITY,e),this._maxUploadRetryTime=e}get maxOperationRetryTime(){return this._maxOperationRetryTime}set maxOperationRetryTime(e){MB("time",0,Number.POSITIVE_INFINITY,e),this._maxOperationRetryTime=e}async _getAuthToken(){if(this._overrideAuthToken)return this._overrideAuthToken;const e=this._authProvider.getImmediate({optional:!0});if(e){var t=await e.getToken();if(null!==t)return t.accessToken}return null}async _getAppCheckToken(){const e=this._appCheckProvider.getImmediate({optional:!0});return e?(await e.getToken()).token:null}_delete(){return this._deleted||(this._deleted=!0,this._requests.forEach(e=>e.cancel()),this._requests.clear()),Promise.resolve()}_makeStorageReference(e){return new C2(this,e)}_makeRequest(e,t,n,r){if(this._deleted)return new RB(kB());{const l=(i=e,s=this._appId,o=n,e=r,n=t,r=this._firebaseVersion,a=FB(i.urlParams),c=i.url+a,a=Object.assign({},i.headers),t=a,(s=s)&&(t["X-Firebase-GMPID"]=s),s=a,null!==(o=o)&&0<o.length&&(s.Authorization="Firebase "+o),r=r,a["X-Firebase-Storage-Version"]="webjs/"+(null!=r?r:"AppManager"),r=a,null!==(e=e)&&(r["X-Firebase-AppCheck"]=e),new UB(c,i.method,a,i.body,i.successCodes,i.additionalRetryCodes,i.handler,i.errorHandler,i.timeout,i.progressCallback,n));return this._requests.add(l),l.getPromise().then(()=>this._requests.delete(l),()=>this._requests.delete(l)),l}var i,s,o,a,c}async makeRequestWithTokens(e,t){var[n,r]=await Promise.all([this._getAuthToken(),this._getAppCheckToken()]);return this._makeRequest(e,t,n,r).getPromise()}}const U2="@firebase/storage";function V2(e,t,n){return e=Wd(e),t=t,n=n,(e=e)._throwIfRoot("uploadBytesResumable"),new k2(e,new GB(t),n)}function j2(e){return function(e){e._throwIfRoot("getMetadata");var t=h2(e.storage,e._location,ZB());return e.storage.makeRequestWithTokens(t,S2)}(e=Wd(e))}function q2(e,t){return M2(e=Wd(e),t)}function B2(e,t,n,r={}){!function(e,t,n,r={}){e.host=`${t}:${n}`,e._protocol="http";var i=r["mockUserToken"];i&&(e._overrideAuthToken="string"==typeof i?i:sd(i,e.app.options.projectId))}(e,t,n,r)}function K2(e,{instanceIdentifier:t}){var n=e.getProvider("app").getImmediate(),r=e.getProvider("auth-internal"),i=e.getProvider("app-check-internal");return new F2(n,r,i,t,Ff)}Df(new Gd("storage",K2,"PUBLIC").setMultipleInstances(!0)),qf(U2,"0.9.9",""),qf(U2,"0.9.9","esm2017");class $2{constructor(e,t,n){this._delegate=e,this.task=t,this.ref=n}get bytesTransferred(){return this._delegate.bytesTransferred}get metadata(){return this._delegate.metadata}get state(){return this._delegate.state}get totalBytes(){return this._delegate.totalBytes}}class z2{constructor(e,t){this._delegate=e,this._ref=t,this.cancel=this._delegate.cancel.bind(this._delegate),this.catch=this._delegate.catch.bind(this._delegate),this.pause=this._delegate.pause.bind(this._delegate),this.resume=this._delegate.resume.bind(this._delegate)}get snapshot(){return new $2(this._delegate.snapshot,this,this._ref)}then(t,e){return this._delegate.then(e=>{if(t)return t(new $2(e,this,this._ref))},e)}on(e,t,n,r){let i=void 0;return t&&(i="function"==typeof t?e=>t(new $2(e,this,this._ref)):{next:t.next?e=>t.next(new $2(e,this,this._ref)):void 0,complete:t.complete||void 0,error:t.error||void 0}),this._delegate.on(e,i,n||void 0,r||void 0)}}class W2{constructor(e,t){this._delegate=e,this._service=t}get prefixes(){return this._delegate.prefixes.map(e=>new G2(e,this._service))}get items(){return this._delegate.items.map(e=>new G2(e,this._service))}get nextPageToken(){return this._delegate.nextPageToken||null}}class G2{constructor(e,t){this._delegate=e,this.storage=t}get name(){return this._delegate.name}get bucket(){return this._delegate.bucket}get fullPath(){return this._delegate.fullPath}toString(){return this._delegate.toString()}child(e){var t=D2(this._delegate,e);return new G2(t,this.storage)}get root(){return new G2(this._delegate.root,this.storage)}get parent(){var e=this._delegate.parent;return null==e?null:new G2(e,this.storage)}put(e,t){return this._throwIfRoot("put"),new z2(V2(this._delegate,e,t),this)}putString(e,t=qB.RAW,n){this._throwIfRoot("putString");var r=KB(t,e);const i=Object.assign({},n);return null==i.contentType&&null!=r.contentType&&(i.contentType=r.contentType),new z2(new k2(this._delegate,new GB(r.data,!0),i),this)}listAll(){return A2(Wd(this._delegate)).then(e=>new W2(e,this.storage))}list(e){return t=this._delegate,e=e||void 0,N2(t=Wd(t),e).then(e=>new W2(e,this.storage));var t}getMetadata(){return j2(this._delegate)}updateMetadata(e){return x2(Wd(this._delegate),e)}getDownloadURL(){return R2(Wd(this._delegate))}delete(){return this._throwIfRoot("delete"),P2(Wd(this._delegate))}_throwIfRoot(e){if(""===this._delegate._location.path)throw CB(e)}}class H2{constructor(e,t){this.app=e,this._delegate=t}get maxOperationRetryTime(){return this._delegate.maxOperationRetryTime}get maxUploadRetryTime(){return this._delegate.maxUploadRetryTime}ref(e){if(Q2(e))throw SB("ref() expected a child path but got a URL, use refFromURL instead.");return new G2(q2(this._delegate,e),this)}refFromURL(e){if(!Q2(e))throw SB("refFromURL() expected a full URL but got a child path, use ref() instead.");try{xB.makeFromUrl(e,this._delegate.host)}catch(e){throw SB("refFromUrl() expected a valid full URL but got an invalid one.")}return new G2(q2(this._delegate,e),this)}setMaxUploadRetryTime(e){this._delegate.maxUploadRetryTime=e}setMaxOperationRetryTime(e){this._delegate.maxOperationRetryTime=e}useEmulator(e,t,n={}){B2(this._delegate,e,t,n)}}function Q2(e){return/^[A-Za-z]+:\/\//.test(e)}function Y2(e,{instanceIdentifier:t}){var n=e.getProvider("app-compat").getImmediate(),r=e.getProvider("storage").getImmediate({identifier:t});return new H2(n,r)}fB=op,pB={TaskState:w2,TaskEvent:_2,StringFormat:qB,Storage:H2,Reference:G2},fB.INTERNAL.registerComponent(new Gd("storage-compat",Y2,"PUBLIC").setServiceProps(pB).setMultipleInstances(!0)),fB.registerVersion("@firebase/storage-compat","0.1.17");const J2="@firebase/performance",X2="0.5.12",Z2=X2,eK="FB-PERF-TRACE-MEASURE",tK="@firebase/performance/config",nK="@firebase/performance/configexpire";var rK,iK,sK,oK="Performance";const aK=new vd("performance",oK,{"trace started":"Trace {$traceName} was started before.","trace stopped":"Trace {$traceName} is not running.","nonpositive trace startTime":"Trace {$traceName} startTime should be positive.","nonpositive trace duration":"Trace {$traceName} duration should be positive.","no window":"Window is not available.","no app id":"App id is not available.","no project id":"Project id is not available.","no api key":"Api key is not available.","invalid cc log":"Attempted to queue invalid cc event","FB not default":"Performance can only start when Firebase app instance is the default one.","RC response not ok":"RC response is not ok","invalid attribute name":"Attribute name {$attributeName} is invalid.","invalid attribute value":"Attribute value {$attributeValue} is invalid.","invalid custom metric name":"Custom metric name {$customMetricName} is invalid","invalid String merger input":"Input for String merger is invalid, contact support team to resolve.","already initialized":"initializePerformance() has already been called with different options. To avoid this error, call initializePerformance() with the same options as when it was originally called, or call getPerformance() to return the already initialized instance."}),cK=new nf(oK);cK.logLevel=$h.INFO;let lK,uK;class hK{constructor(e){if(!(this.window=e))throw aK.create("no window");this.performance=e.performance,this.PerformanceObserver=e.PerformanceObserver,this.windowLocation=e.location,this.navigator=e.navigator,this.document=e.document,this.navigator&&this.navigator.cookieEnabled&&(this.localStorage=e.localStorage),e.perfMetrics&&e.perfMetrics.onFirstInputDelay&&(this.onFirstInputDelay=e.perfMetrics.onFirstInputDelay)}getUrl(){return this.windowLocation.href.split("?")[0]}mark(e){this.performance&&this.performance.mark&&this.performance.mark(e)}measure(e,t,n){this.performance&&this.performance.measure&&this.performance.measure(e,t,n)}getEntriesByType(e){return this.performance&&this.performance.getEntriesByType?this.performance.getEntriesByType(e):[]}getEntriesByName(e){return this.performance&&this.performance.getEntriesByName?this.performance.getEntriesByName(e):[]}getTimeOrigin(){return this.performance&&(this.performance.timeOrigin||this.performance.timing.navigationStart)}requiredApisAvailable(){return fetch&&Promise&&gd()?!!fd()||(cK.info("IndexedDB is not supported by current browswer"),!1):(cK.info("Firebase Performance cannot start if browser does not support fetch and Promise or cookie is disabled."),!1)}setupObserver(e,n){if(this.PerformanceObserver){const t=new this.PerformanceObserver(e=>{for(const t of e.getEntries())n(t)});t.observe({entryTypes:[e]})}}static getInstance(){return void 0===lK&&(lK=new hK(uK)),lK}}let dK;function fK(e,t){var n=e.length-t.length;if(n<0||1<n)throw aK.create("invalid String merger input");const r=[];for(let i=0;i<e.length;i++)r.push(e.charAt(i)),t.length>i&&r.push(t.charAt(i));return r.join("")}let pK;class gK{constructor(){this.instrumentationEnabled=!0,this.dataCollectionEnabled=!0,this.loggingEnabled=!1,this.tracesSamplingRate=1,this.networkRequestsSamplingRate=1,this.logEndPointUrl="https://firebaselogging.googleapis.com/v0cc/log?format=json_proto",this.flTransportEndpointUrl=fK("hts/frbslgigp.ogepscmv/ieo/eaylg","tp:/ieaeogn-agolai.o/1frlglgc/o"),this.transportKey=fK("AzSC8r6ReiGqFMyfvgow","Iayx0u-XT3vksVM-pIV"),this.logSource=462,this.logTraceAfterSampling=!1,this.logNetworkAfterSampling=!1,this.configTimeToLive=12}getFlTransportFullUrl(){return this.flTransportEndpointUrl.concat("?key=",this.transportKey)}static getInstance(){return void 0===pK&&(pK=new gK),pK}}(c=rK=rK||{})[c.UNKNOWN=0]="UNKNOWN",c[c.VISIBLE=1]="VISIBLE",c[c.HIDDEN=2]="HIDDEN";const mK=["firebase_","google_","ga_"],vK=new RegExp("^[a-zA-Z]\\w*$");function yK(){switch(hK.getInstance().document.visibilityState){case"visible":return rK.VISIBLE;case"hidden":return rK.HIDDEN;default:return rK.UNKNOWN}}function _K(e){var t=null===(t=e.options)||void 0===t?void 0:t.appId;if(!t)throw aK.create("no app id");return t}const wK="0.0.1",bK={loggingEnabled:!0},IK="FIREBASE_INSTALLATIONS_AUTH";function TK(e,t){var r,i,n=function(){const e=hK.getInstance().localStorage;if(e){var t=e.getItem(nK);if(t&&function(e){return Number(e)>Date.now()}(t)){t=e.getItem(tK);if(t)try{return JSON.parse(t)}catch(e){return}}}}();return n?(SK(n),Promise.resolve()):(i=t,function(e){const t=e.getToken();return t.then(e=>{}),t}((r=e).installations).then(e=>{var t=function(e){var t=null===(t=e.options)||void 0===t?void 0:t.projectId;if(!t)throw aK.create("no project id");return t}(r.app),n=function(e){var t=null===(t=e.options)||void 0===t?void 0:t.apiKey;if(!t)throw aK.create("no api key");return t}(r.app),n=new Request(`https://firebaseremoteconfig.googleapis.com/v1/projects/${t}/namespaces/fireperf:fetch?key=${n}`,{method:"POST",headers:{Authorization:`${IK} ${e}`},body:JSON.stringify({app_instance_id:i,app_instance_id_token:e,app_id:_K(r.app),app_version:Z2,sdk_version:wK})});return fetch(n).then(e=>{if(e.ok)return e.json();throw aK.create("RC response not ok")})}).catch(()=>{cK.info(EK)}).then(SK).then(e=>function(e){const t=hK.getInstance().localStorage;e&&t&&(t.setItem(tK,JSON.stringify(e)),t.setItem(nK,String(Date.now()+60*gK.getInstance().configTimeToLive*60*1e3)))}(e),()=>{}))}const EK="Could not fetch config, will use default configs";function SK(e){if(!e)return e;const t=gK.getInstance();var n=e.entries||{};return void 0!==n.fpr_enabled?t.loggingEnabled="true"===String(n.fpr_enabled):t.loggingEnabled=bK.loggingEnabled,n.fpr_log_source?t.logSource=Number(n.fpr_log_source):bK.logSource&&(t.logSource=bK.logSource),n.fpr_log_endpoint_url?t.logEndPointUrl=n.fpr_log_endpoint_url:bK.logEndPointUrl&&(t.logEndPointUrl=bK.logEndPointUrl),n.fpr_log_transport_key?t.transportKey=n.fpr_log_transport_key:bK.transportKey&&(t.transportKey=bK.transportKey),void 0!==n.fpr_vc_network_request_sampling_rate?t.networkRequestsSamplingRate=Number(n.fpr_vc_network_request_sampling_rate):void 0!==bK.networkRequestsSamplingRate&&(t.networkRequestsSamplingRate=bK.networkRequestsSamplingRate),void 0!==n.fpr_vc_trace_sampling_rate?t.tracesSamplingRate=Number(n.fpr_vc_trace_sampling_rate):void 0!==bK.tracesSamplingRate&&(t.tracesSamplingRate=bK.tracesSamplingRate),t.logTraceAfterSampling=kK(t.tracesSamplingRate),t.logNetworkAfterSampling=kK(t.networkRequestsSamplingRate),e}function kK(e){return Math.random()<=e}let CK=1,AK;function NK(e){var t;return CK=2,AK=AK||(t=e,function(){const n=hK.getInstance().document;return new Promise(e=>{if(n&&"complete"!==n.readyState){const t=()=>{"complete"===n.readyState&&(n.removeEventListener("readystatechange",t),e())};n.addEventListener("readystatechange",t)}else e()})}().then(()=>function(e){const t=e.getId();return t.then(e=>{dK=e}),t}(t.installations)).then(e=>TK(t,e)).then(()=>xK(),()=>xK())),AK}function xK(){CK=3}const RK=1e4,PK=3,DK=1e3;let OK=PK,MK=[],LK=!1;function FK(e){setTimeout(()=>{if(0!==OK)return MK.length?void function(){const e=MK.splice(0,DK),t=e.map(e=>({source_extension_json_proto3:e.message,event_time_ms:String(e.eventTime)})),n={request_time_ms:String(Date.now()),client_info:{client_type:1,js_client_info:{}},log_source:gK.getInstance().logSource,log_event:t};!function(e,r){return function(e){var t=gK.getInstance().getFlTransportFullUrl();return fetch(t,{method:"POST",body:JSON.stringify(e)})}(e).then(e=>(e.ok||cK.info("Call to Firebase backend failed."),e.json())).then(e=>{var t=Number(e.nextRequestWaitMillis);let n=RK;isNaN(t)||(n=Math.max(t,n));t=e.logResponseDetails;Array.isArray(t)&&0<t.length&&"RETRY_REQUEST_LATER"===t[0].responseAction&&(MK=[...r,...MK],cK.info("Retry transport request later.")),OK=PK,FK(n)})}(n,e).catch(()=>{MK=[...e,...MK],OK--,cK.info(`Tries left: ${OK}.`),FK(RK)})}():FK(RK)},e)}function UK(t){return(...e)=>{!function(e){if(!e.eventTime||!e.message)throw aK.create("invalid cc log");MK=[...MK,e]}({message:t(...e),eventTime:Date.now()})}}let VK;function jK(e,t){VK=VK||UK(KK),VK(e,t)}function qK(e){var t=gK.getInstance();!t.instrumentationEnabled&&e.isAuto||(t.dataCollectionEnabled||e.isAuto)&&hK.getInstance().requiredApisAvailable()&&(e.isAuto&&yK()!==rK.VISIBLE||(3===CK?BK(e):NK(e.performanceController).then(()=>BK(e),()=>BK(e))))}function BK(e){var t;!dK||(t=gK.getInstance()).loggingEnabled&&t.logTraceAfterSampling&&setTimeout(()=>jK(e,1),0)}function KK(e,t){return 0===t?(n={url:e.url,http_method:e.httpMethod||0,http_response_code:200,response_payload_bytes:e.responsePayloadBytes,client_start_time_us:e.startTimeUs,time_to_response_initiated_us:e.timeToResponseInitiatedUs,time_to_response_completed_us:e.timeToResponseCompletedUs},n={application_info:$K(e.performanceController.app),network_request_metric:n},JSON.stringify(n)):function(e){const t={name:e.name,is_auto:e.isAuto,client_start_time_us:e.startTimeUs,duration_us:e.durationUs};0!==Object.keys(e.counters).length&&(t.counters=e.counters);var n=e.getAttributes();0!==Object.keys(n).length&&(t.custom_attributes=n);n={application_info:$K(e.performanceController.app),trace_metric:t};return JSON.stringify(n)}(e);var n}function $K(e){return{google_app_id:_K(e),app_instance_id:dK,web_app_info:{sdk_version:Z2,page_url:hK.getInstance().getUrl(),service_worker_status:"serviceWorker"in(t=hK.getInstance().navigator)?t.serviceWorker.controller?2:3:1,visibility_state:yK(),effective_connection_type:function(){var e=hK.getInstance().navigator.connection;switch(e&&e.effectiveType){case"slow-2g":return 1;case"2g":return 2;case"3g":return 3;case"4g":return 4;default:return 0}}()},application_process_state:0};var t}const zK=["_fp","_fcp","_fid"];class WK{constructor(e,t,n=!1,r){this.performanceController=e,this.name=t,this.isAuto=n,this.state=1,this.customAttributes={},this.counters={},this.api=hK.getInstance(),this.randomId=Math.floor(1e6*Math.random()),this.isAuto||(this.traceStartMark=`FB-PERF-TRACE-START-${this.randomId}-${this.name}`,this.traceStopMark=`FB-PERF-TRACE-STOP-${this.randomId}-${this.name}`,this.traceMeasure=r||`${eK}-${this.randomId}-${this.name}`,r&&this.calculateTraceMetrics())}start(){if(1!==this.state)throw aK.create("trace started",{traceName:this.name});this.api.mark(this.traceStartMark),this.state=2}stop(){if(2!==this.state)throw aK.create("trace stopped",{traceName:this.name});this.state=3,this.api.mark(this.traceStopMark),this.api.measure(this.traceMeasure,this.traceStartMark,this.traceStopMark),this.calculateTraceMetrics(),qK(this)}record(e,t,n){if(e<=0)throw aK.create("nonpositive trace startTime",{traceName:this.name});if(t<=0)throw aK.create("nonpositive trace duration",{traceName:this.name});if(this.durationUs=Math.floor(1e3*t),this.startTimeUs=Math.floor(1e3*e),n&&n.attributes&&(this.customAttributes=Object.assign({},n.attributes)),n&&n.metrics)for(const r of Object.keys(n.metrics))isNaN(Number(n.metrics[r]))||(this.counters[r]=Math.floor(Number(n.metrics[r])));qK(this)}incrementMetric(e,t=1){void 0===this.counters[e]?this.putMetric(e,t):this.putMetric(e,this.counters[e]+t)}putMetric(e,t){if(r=e,i=this.name,0===r.length||100<r.length||!(i&&i.startsWith("_wt_")&&-1<zK.indexOf(r))&&r.startsWith("_"))throw aK.create("invalid custom metric name",{customMetricName:e});var n,r,i;this.counters[e]=(t=null!=t?t:0,(n=Math.floor(t))<t&&cK.info(`Metric value should be an Integer, setting the value as : ${n}.`),n)}getMetric(e){return this.counters[e]||0}putAttribute(e,t){var n,r,i=!(0===(n=e).length||40<n.length)&&(!mK.some(e=>n.startsWith(e))&&!!n.match(vK)),s=0!==(r=t).length&&r.length<=100;if(i&&s)this.customAttributes[e]=t;else{if(!i)throw aK.create("invalid attribute name",{attributeName:e});if(!s)throw aK.create("invalid attribute value",{attributeValue:t})}}getAttribute(e){return this.customAttributes[e]}removeAttribute(e){void 0!==this.customAttributes[e]&&delete this.customAttributes[e]}getAttributes(){return Object.assign({},this.customAttributes)}setStartTime(e){this.startTimeUs=e}setDuration(e){this.durationUs=e}calculateTraceMetrics(){var e=this.api.getEntriesByName(this.traceMeasure),e=e&&e[0];e&&(this.durationUs=Math.floor(1e3*e.duration),this.startTimeUs=Math.floor(1e3*(e.startTime+this.api.getTimeOrigin())))}static createOobTrace(e,t,n,r){var i=hK.getInstance().getUrl();if(i){const s=new WK(e,"_wt_"+i,!0);i=Math.floor(1e3*hK.getInstance().getTimeOrigin());s.setStartTime(i),t&&t[0]&&(s.setDuration(Math.floor(1e3*t[0].duration)),s.putMetric("domInteractive",Math.floor(1e3*t[0].domInteractive)),s.putMetric("domContentLoadedEventEnd",Math.floor(1e3*t[0].domContentLoadedEventEnd)),s.putMetric("loadEventEnd",Math.floor(1e3*t[0].loadEventEnd)));n&&((i=n.find(e=>"first-paint"===e.name))&&i.startTime&&s.putMetric("_fp",Math.floor(1e3*i.startTime)),(i=n.find(e=>"first-contentful-paint"===e.name))&&i.startTime&&s.putMetric("_fcp",Math.floor(1e3*i.startTime)),r&&s.putMetric("_fid",Math.floor(1e3*r))),qK(s)}}static createUserTimingTrace(e,t){qK(new WK(e,t,!1,t))}}function GK(e,t){const n=t;var r,i,s;n&&void 0!==n.responseStart&&(s=hK.getInstance().getTimeOrigin(),r=Math.floor(1e3*(n.startTime+s)),i=n.responseStart?Math.floor(1e3*(n.responseStart-n.startTime)):void 0,s=Math.floor(1e3*(n.responseEnd-n.startTime)),function(e){const t=gK.getInstance();var n,r,i;t.instrumentationEnabled&&(n=e.url,r=t.logEndPointUrl.split("?")[0],i=t.flTransportEndpointUrl.split("?")[0],n!==r&&n!==i&&t.loggingEnabled&&t.logNetworkAfterSampling&&setTimeout(()=>jK(e,0),0))}({performanceController:e,url:n.name&&n.name.split("?")[0],responsePayloadBytes:n.transferSize,startTimeUs:r,timeToResponseInitiatedUs:i,timeToResponseCompletedUs:s}))}const HK=5e3;function QK(e){dK&&(setTimeout(()=>function(n){const e=hK.getInstance(),r=e.getEntriesByType("navigation"),i=e.getEntriesByType("paint");if(e.onFirstInputDelay){let t=setTimeout(()=>{WK.createOobTrace(n,r,i),t=void 0},HK);e.onFirstInputDelay(e=>{t&&(clearTimeout(t),WK.createOobTrace(n,r,i,e))})}else WK.createOobTrace(n,r,i)}(e),0),setTimeout(()=>function(t){const e=hK.getInstance(),n=e.getEntriesByType("resource");for(const r of n)GK(t,r);e.setupObserver("resource",e=>GK(t,e))}(e),0),setTimeout(()=>function(t){const e=hK.getInstance(),n=e.getEntriesByType("measure");for(const r of n)YK(t,r);e.setupObserver("measure",e=>YK(t,e))}(e),0))}function YK(e,t){const n=t.name;n.substring(0,eK.length)!==eK&&WK.createUserTimingTrace(e,n)}class JK{constructor(e,t){this.app=e,this.installations=t,this.initialized=!1}_init(e){this.initialized||(void 0!==(null==e?void 0:e.dataCollectionEnabled)&&(this.dataCollectionEnabled=e.dataCollectionEnabled),void 0!==(null==e?void 0:e.instrumentationEnabled)&&(this.instrumentationEnabled=e.instrumentationEnabled),hK.getInstance().requiredApisAvailable()?pd().then(e=>{e&&(LK||(FK(5500),LK=!0),NK(this).then(()=>QK(this),()=>QK(this)),this.initialized=!0)}).catch(e=>{cK.info(`Environment doesn't support IndexedDB: ${e}`)}):cK.info('Firebase Performance cannot start if the browser does not support "Fetch" and "Promise", or cookies are disabled.'))}set instrumentationEnabled(e){gK.getInstance().instrumentationEnabled=e}get instrumentationEnabled(){return gK.getInstance().instrumentationEnabled}set dataCollectionEnabled(e){gK.getInstance().dataCollectionEnabled=e}get dataCollectionEnabled(){return gK.getInstance().dataCollectionEnabled}}const XK="[DEFAULT]";const ZK=(e,{options:t})=>{var n=e.getProvider("app").getImmediate(),r=e.getProvider("installations-internal").getImmediate();if(n.name!==XK)throw aK.create("FB not default");if("undefined"==typeof window)throw aK.create("no window");e=window,uK=e;const i=new JK(n,r);return i._init(t),i};Df(new Gd("performance",ZK,"PUBLIC")),qf(J2,X2),qf(J2,X2,"esm2017");class e${constructor(e,t){this.app=e,this._delegate=t}get instrumentationEnabled(){return this._delegate.instrumentationEnabled}set instrumentationEnabled(e){this._delegate.instrumentationEnabled=e}get dataCollectionEnabled(){return this._delegate.dataCollectionEnabled}set dataCollectionEnabled(e){this._delegate.dataCollectionEnabled=e}trace(e){return t=this._delegate,e=e,t=Wd(t),new WK(t,e);var t}}function t$(e){var t=e.getProvider("app-compat").getImmediate(),n=e.getProvider("performance").getImmediate();return new e$(t,n)}(iK=op).INTERNAL.registerComponent(new Gd("performance-compat",t$,"PUBLIC")),iK.registerVersion("@firebase/performance-compat","0.1.12");const n$="@firebase/remote-config";class r${constructor(){this.listeners=[]}addEventListener(e){this.listeners.push(e)}abort(){this.listeners.forEach(e=>e())}}const i$=new vd("remoteconfig","Remote Config",{"registration-window":"Undefined window object. This SDK only supports usage in a browser environment.","registration-project-id":"Undefined project identifier. Check Firebase app initialization.","registration-api-key":"Undefined API key. Check Firebase app initialization.","registration-app-id":"Undefined app identifier. Check Firebase app initialization.","storage-open":"Error thrown when opening storage. Original error: {$originalErrorMessage}.","storage-get":"Error thrown when reading from storage. Original error: {$originalErrorMessage}.","storage-set":"Error thrown when writing to storage. Original error: {$originalErrorMessage}.","storage-delete":"Error thrown when deleting from storage. Original error: {$originalErrorMessage}.","fetch-client-network":"Fetch client failed to connect to a network. Check Internet connection. Original error: {$originalErrorMessage}.","fetch-timeout":'The config fetch request timed out.  Configure timeout using "fetchTimeoutMillis" SDK setting.',"fetch-throttle":'The config fetch request timed out while in an exponential backoff state. Configure timeout using "fetchTimeoutMillis" SDK setting. Unix timestamp in milliseconds when fetch request throttling ends: {$throttleEndTimeMillis}.',"fetch-client-parse":"Fetch client could not parse response. Original error: {$originalErrorMessage}.","fetch-status":"Fetch server returned an HTTP error status. HTTP status: {$httpStatus}.","indexed-db-unavailable":"Indexed DB is not supported by current browser"});const s$=["1","true","t","yes","y","on"];class o${constructor(e,t=""){this._source=e,this._value=t}asString(){return this._value}asBoolean(){return"static"!==this._source&&0<=s$.indexOf(this._value.toLowerCase())}asNumber(){if("static"===this._source)return 0;let e=Number(this._value);return isNaN(e)&&(e=0),e}getSource(){return this._source}}async function a$(e){const t=Wd(e);var[n,r]=await Promise.all([t._storage.getLastSuccessfulFetchResponse(),t._storage.getActiveConfigEtag()]);return!!(n&&n.config&&n.eTag&&n.eTag!==r)&&(await Promise.all([t._storageCache.setActiveConfig(n.config),t._storage.setActiveConfigEtag(n.eTag)]),!0)}function c$(e){const t=Wd(e);return t._initializePromise||(t._initializePromise=t._storageCache.loadFromStorage().then(()=>{t._isInitializationComplete=!0})),t._initializePromise}async function l$(t){const n=Wd(t),e=new r$;setTimeout(async()=>{e.abort()},n.settings.fetchTimeoutMillis);try{await n._client.fetch({cacheMaxAgeMillis:n.settings.minimumFetchIntervalMillis,signal:e}),await n._storageCache.setLastFetchStatus("success")}catch(e){var r=(i="fetch-throttle",(t=e)instanceof md&&-1!==t.code.indexOf(i)?"throttle":"failure");throw await n._storageCache.setLastFetchStatus(r),e}var i}function u$(n){const e=Wd(n);return[t={},r={}]=[e._storageCache.getActiveConfig(),e.defaultConfig],Object.keys(Object.assign(Object.assign({},t),r)).reduce((e,t)=>(e[t]=h$(n,t),e),{});var t,r}function h$(e,t){const n=Wd(e);n._isInitializationComplete||n._logger.debug(`A value was requested for key "${t}" before SDK initialization completed.`+" Await on ensureInitialized if the intent was to get a previously activated value.");var r=n._storageCache.getActiveConfig();return r&&void 0!==r[t]?new o$("remote",r[t]):n.defaultConfig&&void 0!==n.defaultConfig[t]?new o$("default",String(n.defaultConfig[t])):(n._logger.debug(`Returning static value for key "${t}".`+" Define a default or remote value if this is unintentional."),new o$("static"))}class d${constructor(e,t,n,r){this.client=e,this.storage=t,this.storageCache=n,this.logger=r}isCachedDataFresh(e,t){if(!t)return this.logger.debug("Config fetch cache check. Cache unpopulated."),!1;var n=Date.now()-t,r=n<=e;return this.logger.debug("Config fetch cache check."+` Cache age millis: ${n}.`+` Cache max age millis (minimumFetchIntervalMillis setting): ${e}.`+` Is cache hit: ${r}.`),r}async fetch(e){var[t,n]=await Promise.all([this.storage.getLastSuccessfulFetchTimestampMillis(),this.storage.getLastSuccessfulFetchResponse()]);if(n&&this.isCachedDataFresh(e.cacheMaxAgeMillis,t))return n;e.eTag=n&&n.eTag;n=await this.client.fetch(e);const r=[this.storageCache.setLastSuccessfulFetchTimestampMillis(Date.now())];return 200===n.status&&r.push(this.storage.setLastSuccessfulFetchResponse(n)),await Promise.all(r),n}}class f${constructor(e,t,n,r,i,s){this.firebaseInstallations=e,this.sdkVersion=t,this.namespace=n,this.projectId=r,this.apiKey=i,this.appId=s}async fetch(n){var e,[t,r]=await Promise.all([this.firebaseInstallations.getId(),this.firebaseInstallations.getToken()]),i=`${window.FIREBASE_REMOTE_CONFIG_URL_BASE||"https://firebaseremoteconfig.googleapis.com"}/v1/projects/${this.projectId}/namespaces/${this.namespace}:fetch?key=${this.apiKey}`,s={"Content-Type":"application/json","Content-Encoding":"gzip","If-None-Match":n.eTag||"*"},r={sdk_version:this.sdkVersion,app_instance_id:t,app_instance_id_token:r,app_id:this.appId,language_code:(e=navigator).languages&&e.languages[0]||e.language},r={method:"POST",headers:s,body:JSON.stringify(r)},i=fetch(i,r),r=new Promise((e,t)=>{n.signal.addEventListener(()=>{const e=new Error("The operation was aborted.");e.name="AbortError",t(e)})});let o;try{await Promise.race([i,r]),o=await i}catch(e){let t="fetch-client-network";throw"AbortError"===(null===e||void 0===e?void 0:e.name)&&(t="fetch-timeout"),i$.create(t,{originalErrorMessage:null===e||void 0===e?void 0:e.message})}let a=o.status;i=o.headers.get("ETag")||void 0;let c,l;if(200===o.status){let e;try{e=await o.json()}catch(e){throw i$.create("fetch-client-parse",{originalErrorMessage:null===e||void 0===e?void 0:e.message})}c=e.entries,l=e.state}if("INSTANCE_STATE_UNSPECIFIED"===l?a=500:"NO_CHANGE"===l?a=304:"NO_TEMPLATE"!==l&&"EMPTY_CONFIG"!==l||(c={}),304!==a&&200!==a)throw i$.create("fetch-status",{httpStatus:a});return{status:a,eTag:i,config:c}}}class p${constructor(e,t){this.client=e,this.storage=t}async fetch(e){var t=await this.storage.getThrottleMetadata()||{backoffCount:0,throttleEndTimeMillis:Date.now()};return this.attemptFetch(e,t)}async attemptFetch(t,{throttleEndTimeMillis:e,backoffCount:n}){var i,s;i=t.signal,s=e,await new Promise((e,t)=>{var n=Math.max(s-Date.now(),0);const r=setTimeout(e,n);i.addEventListener(()=>{clearTimeout(r),t(i$.create("fetch-throttle",{throttleEndTimeMillis:s}))})});try{var r=await this.client.fetch(t);return await this.storage.deleteThrottleMetadata(),r}catch(e){if(!function(e){if(e instanceof md&&e.customData){var t=Number(e.customData.httpStatus);return 429===t||500===t||503===t||504===t}}(e))throw e;r={throttleEndTimeMillis:Date.now()+zd(n),backoffCount:n+1};return await this.storage.setThrottleMetadata(r),this.attemptFetch(t,r)}}}class g${constructor(e,t,n,r,i){this.app=e,this._client=t,this._storageCache=n,this._storage=r,this._logger=i,this._isInitializationComplete=!1,this.settings={fetchTimeoutMillis:6e4,minimumFetchIntervalMillis:432e5},this.defaultConfig={}}get fetchTimeMillis(){return this._storageCache.getLastSuccessfulFetchTimestampMillis()||-1}get lastFetchStatus(){return this._storageCache.getLastFetchStatus()||"no-fetch-yet"}}function m$(e,t){var n=e.target.error||void 0;return i$.create(t,{originalErrorMessage:n&&(null===n||void 0===n?void 0:n.message)})}const v$="app_namespace_store";class y${constructor(e,t,n,r=function(){return new Promise((t,n)=>{try{const e=indexedDB.open("firebase_remote_config",1);e.onerror=e=>{n(m$(e,"storage-open"))},e.onsuccess=e=>{t(e.target.result)},e.onupgradeneeded=e=>{const t=e.target.result;0===e.oldVersion&&t.createObjectStore(v$,{keyPath:"compositeKey"})}}catch(e){n(i$.create("storage-open",{originalErrorMessage:null===e||void 0===e?void 0:e.message}))}})}()){this.appId=e,this.appName=t,this.namespace=n,this.openDbPromise=r}getLastFetchStatus(){return this.get("last_fetch_status")}setLastFetchStatus(e){return this.set("last_fetch_status",e)}getLastSuccessfulFetchTimestampMillis(){return this.get("last_successful_fetch_timestamp_millis")}setLastSuccessfulFetchTimestampMillis(e){return this.set("last_successful_fetch_timestamp_millis",e)}getLastSuccessfulFetchResponse(){return this.get("last_successful_fetch_response")}setLastSuccessfulFetchResponse(e){return this.set("last_successful_fetch_response",e)}getActiveConfig(){return this.get("active_config")}setActiveConfig(e){return this.set("active_config",e)}getActiveConfigEtag(){return this.get("active_config_etag")}setActiveConfigEtag(e){return this.set("active_config_etag",e)}getThrottleMetadata(){return this.get("throttle_metadata")}setThrottleMetadata(e){return this.set("throttle_metadata",e)}deleteThrottleMetadata(){return this.delete("throttle_metadata")}async get(o){const a=await this.openDbPromise;return new Promise((n,t)=>{const e=a.transaction([v$],"readonly"),r=e.objectStore(v$);var i=this.createCompositeKey(o);try{const s=r.get(i);s.onerror=e=>{t(m$(e,"storage-get"))},s.onsuccess=e=>{var t=e.target.result;n(t?t.value:void 0)}}catch(e){t(i$.create("storage-get",{originalErrorMessage:null===e||void 0===e?void 0:e.message}))}})}async set(o,a){const c=await this.openDbPromise;return new Promise((e,t)=>{const n=c.transaction([v$],"readwrite"),r=n.objectStore(v$);var i=this.createCompositeKey(o);try{const s=r.put({compositeKey:i,value:a});s.onerror=e=>{t(m$(e,"storage-set"))},s.onsuccess=()=>{e()}}catch(e){t(i$.create("storage-set",{originalErrorMessage:null===e||void 0===e?void 0:e.message}))}})}async delete(o){const a=await this.openDbPromise;return new Promise((e,t)=>{const n=a.transaction([v$],"readwrite"),r=n.objectStore(v$);var i=this.createCompositeKey(o);try{const s=r.delete(i);s.onerror=e=>{t(m$(e,"storage-delete"))},s.onsuccess=()=>{e()}}catch(e){t(i$.create("storage-delete",{originalErrorMessage:null===e||void 0===e?void 0:e.message}))}})}createCompositeKey(e){return[this.appId,this.appName,this.namespace,e].join()}}class _${constructor(e){this.storage=e}getLastFetchStatus(){return this.lastFetchStatus}getLastSuccessfulFetchTimestampMillis(){return this.lastSuccessfulFetchTimestampMillis}getActiveConfig(){return this.activeConfig}async loadFromStorage(){var e=this.storage.getLastFetchStatus(),t=this.storage.getLastSuccessfulFetchTimestampMillis(),n=this.storage.getActiveConfig(),e=await e;e&&(this.lastFetchStatus=e);t=await t;t&&(this.lastSuccessfulFetchTimestampMillis=t);n=await n;n&&(this.activeConfig=n)}setLastFetchStatus(e){return this.lastFetchStatus=e,this.storage.setLastFetchStatus(e)}setLastSuccessfulFetchTimestampMillis(e){return this.lastSuccessfulFetchTimestampMillis=e,this.storage.setLastSuccessfulFetchTimestampMillis(e)}setActiveConfig(e){return this.activeConfig=e,this.storage.setActiveConfig(e)}}async function w$(){if(!fd())return!1;try{return await pd()}catch(e){return!1}}Df(new Gd("remote-config",function(e,{instanceIdentifier:t}){var n=e.getProvider("app").getImmediate(),r=e.getProvider("installations-internal").getImmediate();if("undefined"==typeof window)throw i$.create("registration-window");if(!fd())throw i$.create("indexed-db-unavailable");var{projectId:i,apiKey:s,appId:o}=n.options;if(!i)throw i$.create("registration-project-id");if(!s)throw i$.create("registration-api-key");if(!o)throw i$.create("registration-app-id");t=t||"firebase";const a=new y$(o,n.name,t),c=new _$(a),l=new nf(n$);l.logLevel=$h.ERROR;o=new f$(r,Ff,t,i,s,o),o=new p$(o,a),o=new d$(o,a,c,l),o=new g$(n,o,c,a,l);return c$(o),o},"PUBLIC").setMultipleInstances(!0)),qf(n$,"0.3.11"),qf(n$,"0.3.11","esm2017");class b${constructor(e,t){this.app=e,this._delegate=t}get defaultConfig(){return this._delegate.defaultConfig}set defaultConfig(e){this._delegate.defaultConfig=e}get fetchTimeMillis(){return this._delegate.fetchTimeMillis}get lastFetchStatus(){return this._delegate.lastFetchStatus}get settings(){return this._delegate.settings}set settings(e){this._delegate.settings=e}activate(){return a$(this._delegate)}ensureInitialized(){return c$(this._delegate)}fetch(){return l$(this._delegate)}fetchAndActivate(){return async function(e){return await l$(e=Wd(e)),a$(e)}(this._delegate)}getAll(){return u$(this._delegate)}getBoolean(e){return h$(Wd(this._delegate),e).asBoolean()}getNumber(e){return h$(Wd(this._delegate),e).asNumber()}getString(e){return h$(Wd(this._delegate),e).asString()}getValue(e){return h$(this._delegate,e)}setLogLevel(e){!function(e,t){const n=Wd(e);switch(t){case"debug":n._logger.logLevel=$h.DEBUG;break;case"silent":n._logger.logLevel=$h.SILENT;break;default:n._logger.logLevel=$h.ERROR}}(this._delegate,e)}}function I$(e,{instanceIdentifier:t}){var n=e.getProvider("app-compat").getImmediate(),r=e.getProvider("remote-config").getImmediate({identifier:t});return new b$(n,r)}return(sK=op).INTERNAL.registerComponent(new Gd("remoteConfig-compat",I$,"PUBLIC").setMultipleInstances(!0).setServiceProps({isSupported:w$})),sK.registerVersion("@firebase/remote-config-compat","0.1.12"),console.warn("\nIt looks like you're using the development build of the Firebase JS SDK.\nWhen deploying Firebase apps to production, it is advisable to only import\nthe individual SDK components you intend to use.\n\nFor the CDN builds, these are available in the following manner\n(replace <PACKAGE> with the name of a component - i.e. auth, database, etc):\n\nhttps://www.gstatic.com/firebasejs/5.0.0/firebase-<PACKAGE>.js\n"),op.registerVersion("firebase","9.9.1","compat-cdn"),op});
//# sourceMappingURL=firebase-compat.js.map
